(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))d(m);new MutationObserver(m=>{for(const _ of m)if(_.type==="childList")for(const g of _.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function a(m){const _={};return m.integrity&&(_.integrity=m.integrity),m.referrerPolicy&&(_.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?_.credentials="include":m.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(m){if(m.ep)return;m.ep=!0;const _=a(m);fetch(m.href,_)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function fy(n){const i=Object.create(null);for(const a of n.split(","))i[a]=1;return a=>a in i}const mn={},wh=[],$a=()=>{},xP=()=>!1,Gf=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),my=n=>n.startsWith("onUpdate:"),Jr=Object.assign,gy=(n,i)=>{const a=n.indexOf(i);a>-1&&n.splice(a,1)},bP=Object.prototype.hasOwnProperty,sn=(n,i)=>bP.call(n,i),ai=Array.isArray,Th=n=>Hf(n)==="[object Map]",v1=n=>Hf(n)==="[object Set]",Ii=n=>typeof n=="function",Qn=n=>typeof n=="string",Sc=n=>typeof n=="symbol",En=n=>n!==null&&typeof n=="object",x1=n=>(En(n)||Ii(n))&&Ii(n.then)&&Ii(n.catch),b1=Object.prototype.toString,Hf=n=>b1.call(n),wP=n=>Hf(n).slice(8,-1),w1=n=>Hf(n)==="[object Object]",_y=n=>Qn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Rd=fy(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Wf=n=>{const i=Object.create(null);return a=>i[a]||(i[a]=n(a))},TP=/-(\w)/g,bc=Wf(n=>n.replace(TP,(i,a)=>a?a.toUpperCase():"")),SP=/\B([A-Z])/g,zu=Wf(n=>n.replace(SP,"-$1").toLowerCase()),T1=Wf(n=>n.charAt(0).toUpperCase()+n.slice(1)),Lg=Wf(n=>n?`on${T1(n)}`:""),yc=(n,i)=>!Object.is(n,i),pf=(n,...i)=>{for(let a=0;a<n.length;a++)n[a](...i)},P_=(n,i,a,d=!1)=>{Object.defineProperty(n,i,{configurable:!0,enumerable:!1,writable:d,value:a})},C_=n=>{const i=parseFloat(n);return isNaN(i)?n:i},PP=n=>{const i=Qn(n)?Number(n):NaN;return isNaN(i)?n:i};let X0;const Kf=()=>X0||(X0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Xf(n){if(ai(n)){const i={};for(let a=0;a<n.length;a++){const d=n[a],m=Qn(d)?IP(d):Xf(d);if(m)for(const _ in m)i[_]=m[_]}return i}else if(Qn(n)||En(n))return n}const CP=/;(?![^(]*\))/g,MP=/:([^]+)/,EP=/\/\*[^]*?\*\//g;function IP(n){const i={};return n.replace(EP,"").split(CP).forEach(a=>{if(a){const d=a.split(MP);d.length>1&&(i[d[0].trim()]=d[1].trim())}}),i}function Al(n){let i="";if(Qn(n))i=n;else if(ai(n))for(let a=0;a<n.length;a++){const d=Al(n[a]);d&&(i+=d+" ")}else if(En(n))for(const a in n)n[a]&&(i+=a+" ");return i.trim()}const AP="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",LP=fy(AP);function S1(n){return!!n||n===""}const P1=n=>!!(n&&n.__v_isRef===!0),Kr=n=>Qn(n)?n:n==null?"":ai(n)||En(n)&&(n.toString===b1||!Ii(n.toString))?P1(n)?Kr(n.value):JSON.stringify(n,C1,2):String(n),C1=(n,i)=>P1(i)?C1(n,i.value):Th(i)?{[`Map(${i.size})`]:[...i.entries()].reduce((a,[d,m],_)=>(a[kg(d,_)+" =>"]=m,a),{})}:v1(i)?{[`Set(${i.size})`]:[...i.values()].map(a=>kg(a))}:Sc(i)?kg(i):En(i)&&!ai(i)&&!w1(i)?String(i):i,kg=(n,i="")=>{var a;return Sc(n)?`Symbol(${(a=n.description)!=null?a:i})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let so;class M1{constructor(i=!1){this.detached=i,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=so,!i&&so&&(this.index=(so.scopes||(so.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let i,a;if(this.scopes)for(i=0,a=this.scopes.length;i<a;i++)this.scopes[i].pause();for(i=0,a=this.effects.length;i<a;i++)this.effects[i].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let i,a;if(this.scopes)for(i=0,a=this.scopes.length;i<a;i++)this.scopes[i].resume();for(i=0,a=this.effects.length;i<a;i++)this.effects[i].resume()}}run(i){if(this._active){const a=so;try{return so=this,i()}finally{so=a}}}on(){++this._on===1&&(this.prevScope=so,so=this)}off(){this._on>0&&--this._on===0&&(so=this.prevScope,this.prevScope=void 0)}stop(i){if(this._active){this._active=!1;let a,d;for(a=0,d=this.effects.length;a<d;a++)this.effects[a].stop();for(this.effects.length=0,a=0,d=this.cleanups.length;a<d;a++)this.cleanups[a]();if(this.cleanups.length=0,this.scopes){for(a=0,d=this.scopes.length;a<d;a++)this.scopes[a].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!i){const m=this.parent.scopes.pop();m&&m!==this&&(this.parent.scopes[this.index]=m,m.index=this.index)}this.parent=void 0}}}function E1(n){return new M1(n)}function I1(){return so}function kP(n,i=!1){so&&so.cleanups.push(n)}let bn;const zg=new WeakSet;class A1{constructor(i){this.fn=i,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,so&&so.active&&so.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,zg.has(this)&&(zg.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||k1(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Y0(this),z1(this);const i=bn,a=na;bn=this,na=!0;try{return this.fn()}finally{R1(this),bn=i,na=a,this.flags&=-3}}stop(){if(this.flags&1){for(let i=this.deps;i;i=i.nextDep)xy(i);this.deps=this.depsTail=void 0,Y0(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?zg.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){M_(this)&&this.run()}get dirty(){return M_(this)}}let L1=0,Dd,Od;function k1(n,i=!1){if(n.flags|=8,i){n.next=Od,Od=n;return}n.next=Dd,Dd=n}function yy(){L1++}function vy(){if(--L1>0)return;if(Od){let i=Od;for(Od=void 0;i;){const a=i.next;i.next=void 0,i.flags&=-9,i=a}}let n;for(;Dd;){let i=Dd;for(Dd=void 0;i;){const a=i.next;if(i.next=void 0,i.flags&=-9,i.flags&1)try{i.trigger()}catch(d){n||(n=d)}i=a}}if(n)throw n}function z1(n){for(let i=n.deps;i;i=i.nextDep)i.version=-1,i.prevActiveLink=i.dep.activeLink,i.dep.activeLink=i}function R1(n){let i,a=n.depsTail,d=a;for(;d;){const m=d.prevDep;d.version===-1?(d===a&&(a=m),xy(d),zP(d)):i=d,d.dep.activeLink=d.prevActiveLink,d.prevActiveLink=void 0,d=m}n.deps=i,n.depsTail=a}function M_(n){for(let i=n.deps;i;i=i.nextDep)if(i.dep.version!==i.version||i.dep.computed&&(D1(i.dep.computed)||i.dep.version!==i.version))return!0;return!!n._dirty}function D1(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Wd)||(n.globalVersion=Wd,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!M_(n))))return;n.flags|=2;const i=n.dep,a=bn,d=na;bn=n,na=!0;try{z1(n);const m=n.fn(n._value);(i.version===0||yc(m,n._value))&&(n.flags|=128,n._value=m,i.version++)}catch(m){throw i.version++,m}finally{bn=a,na=d,R1(n),n.flags&=-3}}function xy(n,i=!1){const{dep:a,prevSub:d,nextSub:m}=n;if(d&&(d.nextSub=m,n.prevSub=void 0),m&&(m.prevSub=d,n.nextSub=void 0),a.subs===n&&(a.subs=d,!d&&a.computed)){a.computed.flags&=-5;for(let _=a.computed.deps;_;_=_.nextDep)xy(_,!0)}!i&&!--a.sc&&a.map&&a.map.delete(a.key)}function zP(n){const{prevDep:i,nextDep:a}=n;i&&(i.nextDep=a,n.prevDep=void 0),a&&(a.prevDep=i,n.nextDep=void 0)}let na=!0;const O1=[];function Ll(){O1.push(na),na=!1}function kl(){const n=O1.pop();na=n===void 0?!0:n}function Y0(n){const{cleanup:i}=n;if(n.cleanup=void 0,i){const a=bn;bn=void 0;try{i()}finally{bn=a}}}let Wd=0;class RP{constructor(i,a){this.sub=i,this.dep=a,this.version=a.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class by{constructor(i){this.computed=i,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(i){if(!bn||!na||bn===this.computed)return;let a=this.activeLink;if(a===void 0||a.sub!==bn)a=this.activeLink=new RP(bn,this),bn.deps?(a.prevDep=bn.depsTail,bn.depsTail.nextDep=a,bn.depsTail=a):bn.deps=bn.depsTail=a,F1(a);else if(a.version===-1&&(a.version=this.version,a.nextDep)){const d=a.nextDep;d.prevDep=a.prevDep,a.prevDep&&(a.prevDep.nextDep=d),a.prevDep=bn.depsTail,a.nextDep=void 0,bn.depsTail.nextDep=a,bn.depsTail=a,bn.deps===a&&(bn.deps=d)}return a}trigger(i){this.version++,Wd++,this.notify(i)}notify(i){yy();try{for(let a=this.subs;a;a=a.prevSub)a.sub.notify()&&a.sub.dep.notify()}finally{vy()}}}function F1(n){if(n.dep.sc++,n.sub.flags&4){const i=n.dep.computed;if(i&&!n.dep.subs){i.flags|=20;for(let d=i.deps;d;d=d.nextDep)F1(d)}const a=n.dep.subs;a!==n&&(n.prevSub=a,a&&(a.nextSub=n)),n.dep.subs=n}}const Mf=new WeakMap,bu=Symbol(""),E_=Symbol(""),Kd=Symbol("");function ao(n,i,a){if(na&&bn){let d=Mf.get(n);d||Mf.set(n,d=new Map);let m=d.get(a);m||(d.set(a,m=new by),m.map=d,m.key=a),m.track()}}function Cl(n,i,a,d,m,_){const g=Mf.get(n);if(!g){Wd++;return}const l=E=>{E&&E.trigger()};if(yy(),i==="clear")g.forEach(l);else{const E=ai(n),k=E&&_y(a);if(E&&a==="length"){const O=Number(d);g.forEach(($,X)=>{(X==="length"||X===Kd||!Sc(X)&&X>=O)&&l($)})}else switch((a!==void 0||g.has(void 0))&&l(g.get(a)),k&&l(g.get(Kd)),i){case"add":E?k&&l(g.get("length")):(l(g.get(bu)),Th(n)&&l(g.get(E_)));break;case"delete":E||(l(g.get(bu)),Th(n)&&l(g.get(E_)));break;case"set":Th(n)&&l(g.get(bu));break}}vy()}function DP(n,i){const a=Mf.get(n);return a&&a.get(i)}function fh(n){const i=Hi(n);return i===n?i:(ao(i,"iterate",Kd),Ls(n)?i:i.map(Xr))}function Yf(n){return ao(n=Hi(n),"iterate",Kd),n}const OP={__proto__:null,[Symbol.iterator](){return Rg(this,Symbol.iterator,Xr)},concat(...n){return fh(this).concat(...n.map(i=>ai(i)?fh(i):i))},entries(){return Rg(this,"entries",n=>(n[1]=Xr(n[1]),n))},every(n,i){return Tl(this,"every",n,i,void 0,arguments)},filter(n,i){return Tl(this,"filter",n,i,a=>a.map(Xr),arguments)},find(n,i){return Tl(this,"find",n,i,Xr,arguments)},findIndex(n,i){return Tl(this,"findIndex",n,i,void 0,arguments)},findLast(n,i){return Tl(this,"findLast",n,i,Xr,arguments)},findLastIndex(n,i){return Tl(this,"findLastIndex",n,i,void 0,arguments)},forEach(n,i){return Tl(this,"forEach",n,i,void 0,arguments)},includes(...n){return Dg(this,"includes",n)},indexOf(...n){return Dg(this,"indexOf",n)},join(n){return fh(this).join(n)},lastIndexOf(...n){return Dg(this,"lastIndexOf",n)},map(n,i){return Tl(this,"map",n,i,void 0,arguments)},pop(){return Pd(this,"pop")},push(...n){return Pd(this,"push",n)},reduce(n,...i){return J0(this,"reduce",n,i)},reduceRight(n,...i){return J0(this,"reduceRight",n,i)},shift(){return Pd(this,"shift")},some(n,i){return Tl(this,"some",n,i,void 0,arguments)},splice(...n){return Pd(this,"splice",n)},toReversed(){return fh(this).toReversed()},toSorted(n){return fh(this).toSorted(n)},toSpliced(...n){return fh(this).toSpliced(...n)},unshift(...n){return Pd(this,"unshift",n)},values(){return Rg(this,"values",Xr)}};function Rg(n,i,a){const d=Yf(n),m=d[i]();return d!==n&&!Ls(n)&&(m._next=m.next,m.next=()=>{const _=m._next();return _.value&&(_.value=a(_.value)),_}),m}const FP=Array.prototype;function Tl(n,i,a,d,m,_){const g=Yf(n),l=g!==n&&!Ls(n),E=g[i];if(E!==FP[i]){const $=E.apply(n,_);return l?Xr($):$}let k=a;g!==n&&(l?k=function($,X){return a.call(this,Xr($),X,n)}:a.length>2&&(k=function($,X){return a.call(this,$,X,n)}));const O=E.call(g,k,d);return l&&m?m(O):O}function J0(n,i,a,d){const m=Yf(n);let _=a;return m!==n&&(Ls(n)?a.length>3&&(_=function(g,l,E){return a.call(this,g,l,E,n)}):_=function(g,l,E){return a.call(this,g,Xr(l),E,n)}),m[i](_,...d)}function Dg(n,i,a){const d=Hi(n);ao(d,"iterate",Kd);const m=d[i](...a);return(m===-1||m===!1)&&Sy(a[0])?(a[0]=Hi(a[0]),d[i](...a)):m}function Pd(n,i,a=[]){Ll(),yy();const d=Hi(n)[i].apply(n,a);return vy(),kl(),d}const BP=fy("__proto__,__v_isRef,__isVue"),B1=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Sc));function NP(n){Sc(n)||(n=String(n));const i=Hi(this);return ao(i,"has",n),i.hasOwnProperty(n)}class N1{constructor(i=!1,a=!1){this._isReadonly=i,this._isShallow=a}get(i,a,d){if(a==="__v_skip")return i.__v_skip;const m=this._isReadonly,_=this._isShallow;if(a==="__v_isReactive")return!m;if(a==="__v_isReadonly")return m;if(a==="__v_isShallow")return _;if(a==="__v_raw")return d===(m?_?KP:V1:_?$1:U1).get(i)||Object.getPrototypeOf(i)===Object.getPrototypeOf(d)?i:void 0;const g=ai(i);if(!m){let E;if(g&&(E=OP[a]))return E;if(a==="hasOwnProperty")return NP}const l=Reflect.get(i,a,Jn(i)?i:d);return(Sc(a)?B1.has(a):BP(a))||(m||ao(i,"get",a),_)?l:Jn(l)?g&&_y(a)?l:l.value:En(l)?m?Z1(l):Jf(l):l}}class j1 extends N1{constructor(i=!1){super(!1,i)}set(i,a,d,m){let _=i[a];if(!this._isShallow){const E=wc(_);if(!Ls(d)&&!wc(d)&&(_=Hi(_),d=Hi(d)),!ai(i)&&Jn(_)&&!Jn(d))return E?!1:(_.value=d,!0)}const g=ai(i)&&_y(a)?Number(a)<i.length:sn(i,a),l=Reflect.set(i,a,d,Jn(i)?i:m);return i===Hi(m)&&(g?yc(d,_)&&Cl(i,"set",a,d):Cl(i,"add",a,d)),l}deleteProperty(i,a){const d=sn(i,a);i[a];const m=Reflect.deleteProperty(i,a);return m&&d&&Cl(i,"delete",a,void 0),m}has(i,a){const d=Reflect.has(i,a);return(!Sc(a)||!B1.has(a))&&ao(i,"has",a),d}ownKeys(i){return ao(i,"iterate",ai(i)?"length":bu),Reflect.ownKeys(i)}}class jP extends N1{constructor(i=!1){super(!0,i)}set(i,a){return!0}deleteProperty(i,a){return!0}}const UP=new j1,$P=new jP,VP=new j1(!0);const I_=n=>n,ef=n=>Reflect.getPrototypeOf(n);function ZP(n,i,a){return function(...d){const m=this.__v_raw,_=Hi(m),g=Th(_),l=n==="entries"||n===Symbol.iterator&&g,E=n==="keys"&&g,k=m[n](...d),O=a?I_:i?Ef:Xr;return!i&&ao(_,"iterate",E?E_:bu),{next(){const{value:$,done:X}=k.next();return X?{value:$,done:X}:{value:l?[O($[0]),O($[1])]:O($),done:X}},[Symbol.iterator](){return this}}}}function tf(n){return function(...i){return n==="delete"?!1:n==="clear"?void 0:this}}function qP(n,i){const a={get(m){const _=this.__v_raw,g=Hi(_),l=Hi(m);n||(yc(m,l)&&ao(g,"get",m),ao(g,"get",l));const{has:E}=ef(g),k=i?I_:n?Ef:Xr;if(E.call(g,m))return k(_.get(m));if(E.call(g,l))return k(_.get(l));_!==g&&_.get(m)},get size(){const m=this.__v_raw;return!n&&ao(Hi(m),"iterate",bu),Reflect.get(m,"size",m)},has(m){const _=this.__v_raw,g=Hi(_),l=Hi(m);return n||(yc(m,l)&&ao(g,"has",m),ao(g,"has",l)),m===l?_.has(m):_.has(m)||_.has(l)},forEach(m,_){const g=this,l=g.__v_raw,E=Hi(l),k=i?I_:n?Ef:Xr;return!n&&ao(E,"iterate",bu),l.forEach((O,$)=>m.call(_,k(O),k($),g))}};return Jr(a,n?{add:tf("add"),set:tf("set"),delete:tf("delete"),clear:tf("clear")}:{add(m){!i&&!Ls(m)&&!wc(m)&&(m=Hi(m));const _=Hi(this);return ef(_).has.call(_,m)||(_.add(m),Cl(_,"add",m,m)),this},set(m,_){!i&&!Ls(_)&&!wc(_)&&(_=Hi(_));const g=Hi(this),{has:l,get:E}=ef(g);let k=l.call(g,m);k||(m=Hi(m),k=l.call(g,m));const O=E.call(g,m);return g.set(m,_),k?yc(_,O)&&Cl(g,"set",m,_):Cl(g,"add",m,_),this},delete(m){const _=Hi(this),{has:g,get:l}=ef(_);let E=g.call(_,m);E||(m=Hi(m),E=g.call(_,m)),l&&l.call(_,m);const k=_.delete(m);return E&&Cl(_,"delete",m,void 0),k},clear(){const m=Hi(this),_=m.size!==0,g=m.clear();return _&&Cl(m,"clear",void 0,void 0),g}}),["keys","values","entries",Symbol.iterator].forEach(m=>{a[m]=ZP(m,n,i)}),a}function wy(n,i){const a=qP(n,i);return(d,m,_)=>m==="__v_isReactive"?!n:m==="__v_isReadonly"?n:m==="__v_raw"?d:Reflect.get(sn(a,m)&&m in d?a:d,m,_)}const GP={get:wy(!1,!1)},HP={get:wy(!1,!0)},WP={get:wy(!0,!1)};const U1=new WeakMap,$1=new WeakMap,V1=new WeakMap,KP=new WeakMap;function XP(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function YP(n){return n.__v_skip||!Object.isExtensible(n)?0:XP(wP(n))}function Jf(n){return wc(n)?n:Ty(n,!1,UP,GP,U1)}function JP(n){return Ty(n,!1,VP,HP,$1)}function Z1(n){return Ty(n,!0,$P,WP,V1)}function Ty(n,i,a,d,m){if(!En(n)||n.__v_raw&&!(i&&n.__v_isReactive))return n;const _=YP(n);if(_===0)return n;const g=m.get(n);if(g)return g;const l=new Proxy(n,_===2?d:a);return m.set(n,l),l}function vc(n){return wc(n)?vc(n.__v_raw):!!(n&&n.__v_isReactive)}function wc(n){return!!(n&&n.__v_isReadonly)}function Ls(n){return!!(n&&n.__v_isShallow)}function Sy(n){return n?!!n.__v_raw:!1}function Hi(n){const i=n&&n.__v_raw;return i?Hi(i):n}function Py(n){return!sn(n,"__v_skip")&&Object.isExtensible(n)&&P_(n,"__v_skip",!0),n}const Xr=n=>En(n)?Jf(n):n,Ef=n=>En(n)?Z1(n):n;function Jn(n){return n?n.__v_isRef===!0:!1}function Wi(n){return QP(n,!1)}function QP(n,i){return Jn(n)?n:new eC(n,i)}class eC{constructor(i,a){this.dep=new by,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=a?i:Hi(i),this._value=a?i:Xr(i),this.__v_isShallow=a}get value(){return this.dep.track(),this._value}set value(i){const a=this._rawValue,d=this.__v_isShallow||Ls(i)||wc(i);i=d?i:Hi(i),yc(i,a)&&(this._rawValue=i,this._value=d?i:Xr(i),this.dep.trigger())}}function A_(n){return Jn(n)?n.value:n}const tC={get:(n,i,a)=>i==="__v_raw"?n:A_(Reflect.get(n,i,a)),set:(n,i,a,d)=>{const m=n[i];return Jn(m)&&!Jn(a)?(m.value=a,!0):Reflect.set(n,i,a,d)}};function q1(n){return vc(n)?n:new Proxy(n,tC)}function iC(n){const i=ai(n)?new Array(n.length):{};for(const a in n)i[a]=rC(n,a);return i}class nC{constructor(i,a,d){this._object=i,this._key=a,this._defaultValue=d,this.__v_isRef=!0,this._value=void 0}get value(){const i=this._object[this._key];return this._value=i===void 0?this._defaultValue:i}set value(i){this._object[this._key]=i}get dep(){return DP(Hi(this._object),this._key)}}function rC(n,i,a){const d=n[i];return Jn(d)?d:new nC(n,i,a)}class oC{constructor(i,a,d){this.fn=i,this.setter=a,this._value=void 0,this.dep=new by(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Wd-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!a,this.isSSR=d}notify(){if(this.flags|=16,!(this.flags&8)&&bn!==this)return k1(this,!0),!0}get value(){const i=this.dep.track();return D1(this),i&&(i.version=this.dep.version),this._value}set value(i){this.setter&&this.setter(i)}}function sC(n,i,a=!1){let d,m;return Ii(n)?d=n:(d=n.get,m=n.set),new oC(d,m,a)}const nf={},If=new WeakMap;let fu;function aC(n,i=!1,a=fu){if(a){let d=If.get(a);d||If.set(a,d=[]),d.push(n)}}function lC(n,i,a=mn){const{immediate:d,deep:m,once:_,scheduler:g,augmentJob:l,call:E}=a,k=xe=>m?xe:Ls(xe)||m===!1||m===0?Ml(xe,1):Ml(xe);let O,$,X,q,te=!1,ce=!1;if(Jn(n)?($=()=>n.value,te=Ls(n)):vc(n)?($=()=>k(n),te=!0):ai(n)?(ce=!0,te=n.some(xe=>vc(xe)||Ls(xe)),$=()=>n.map(xe=>{if(Jn(xe))return xe.value;if(vc(xe))return k(xe);if(Ii(xe))return E?E(xe,2):xe()})):Ii(n)?i?$=E?()=>E(n,2):n:$=()=>{if(X){Ll();try{X()}finally{kl()}}const xe=fu;fu=O;try{return E?E(n,3,[q]):n(q)}finally{fu=xe}}:$=$a,i&&m){const xe=$,be=m===!0?1/0:m;$=()=>Ml(xe(),be)}const Ce=I1(),ze=()=>{O.stop(),Ce&&Ce.active&&gy(Ce.effects,O)};if(_&&i){const xe=i;i=(...be)=>{xe(...be),ze()}}let Ue=ce?new Array(n.length).fill(nf):nf;const Fe=xe=>{if(!(!(O.flags&1)||!O.dirty&&!xe))if(i){const be=O.run();if(m||te||(ce?be.some((ke,Qe)=>yc(ke,Ue[Qe])):yc(be,Ue))){X&&X();const ke=fu;fu=O;try{const Qe=[be,Ue===nf?void 0:ce&&Ue[0]===nf?[]:Ue,q];Ue=be,E?E(i,3,Qe):i(...Qe)}finally{fu=ke}}}else O.run()};return l&&l(Fe),O=new A1($),O.scheduler=g?()=>g(Fe,!1):Fe,q=xe=>aC(xe,!1,O),X=O.onStop=()=>{const xe=If.get(O);if(xe){if(E)E(xe,4);else for(const be of xe)be();If.delete(O)}},i?d?Fe(!0):Ue=O.run():g?g(Fe.bind(null,!0),!0):O.run(),ze.pause=O.pause.bind(O),ze.resume=O.resume.bind(O),ze.stop=ze,ze}function Ml(n,i=1/0,a){if(i<=0||!En(n)||n.__v_skip||(a=a||new Set,a.has(n)))return n;if(a.add(n),i--,Jn(n))Ml(n.value,i,a);else if(ai(n))for(let d=0;d<n.length;d++)Ml(n[d],i,a);else if(v1(n)||Th(n))n.forEach(d=>{Ml(d,i,a)});else if(w1(n)){for(const d in n)Ml(n[d],i,a);for(const d of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,d)&&Ml(n[d],i,a)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function dp(n,i,a,d){try{return d?n(...d):n()}catch(m){Qf(m,i,a)}}function ra(n,i,a,d){if(Ii(n)){const m=dp(n,i,a,d);return m&&x1(m)&&m.catch(_=>{Qf(_,i,a)}),m}if(ai(n)){const m=[];for(let _=0;_<n.length;_++)m.push(ra(n[_],i,a,d));return m}}function Qf(n,i,a,d=!0){const m=i?i.vnode:null,{errorHandler:_,throwUnhandledErrorInProduction:g}=i&&i.appContext.config||mn;if(i){let l=i.parent;const E=i.proxy,k=`https://vuejs.org/error-reference/#runtime-${a}`;for(;l;){const O=l.ec;if(O){for(let $=0;$<O.length;$++)if(O[$](n,E,k)===!1)return}l=l.parent}if(_){Ll(),dp(_,null,10,[n,E,k]),kl();return}}cC(n,a,m,d,g)}function cC(n,i,a,d=!0,m=!1){if(m)throw n;console.error(n)}const xo=[];let Ba=-1;const Sh=[];let pc=null,_h=0;const G1=Promise.resolve();let Af=null;function H1(n){const i=Af||G1;return n?i.then(this?n.bind(this):n):i}function uC(n){let i=Ba+1,a=xo.length;for(;i<a;){const d=i+a>>>1,m=xo[d],_=Xd(m);_<n||_===n&&m.flags&2?i=d+1:a=d}return i}function Cy(n){if(!(n.flags&1)){const i=Xd(n),a=xo[xo.length-1];!a||!(n.flags&2)&&i>=Xd(a)?xo.push(n):xo.splice(uC(i),0,n),n.flags|=1,W1()}}function W1(){Af||(Af=G1.then(X1))}function hC(n){ai(n)?Sh.push(...n):pc&&n.id===-1?pc.splice(_h+1,0,n):n.flags&1||(Sh.push(n),n.flags|=1),W1()}function Q0(n,i,a=Ba+1){for(;a<xo.length;a++){const d=xo[a];if(d&&d.flags&2){if(n&&d.id!==n.uid)continue;xo.splice(a,1),a--,d.flags&4&&(d.flags&=-2),d(),d.flags&4||(d.flags&=-2)}}}function K1(n){if(Sh.length){const i=[...new Set(Sh)].sort((a,d)=>Xd(a)-Xd(d));if(Sh.length=0,pc){pc.push(...i);return}for(pc=i,_h=0;_h<pc.length;_h++){const a=pc[_h];a.flags&4&&(a.flags&=-2),a.flags&8||a(),a.flags&=-2}pc=null,_h=0}}const Xd=n=>n.id==null?n.flags&2?-1:1/0:n.id;function X1(n){try{for(Ba=0;Ba<xo.length;Ba++){const i=xo[Ba];i&&!(i.flags&8)&&(i.flags&4&&(i.flags&=-2),dp(i,i.i,i.i?15:14),i.flags&4||(i.flags&=-2))}}finally{for(;Ba<xo.length;Ba++){const i=xo[Ba];i&&(i.flags&=-2)}Ba=-1,xo.length=0,K1(),Af=null,(xo.length||Sh.length)&&X1()}}let Do=null,Y1=null;function Lf(n){const i=Do;return Do=n,Y1=n&&n.type.__scopeId||null,i}function J1(n,i=Do,a){if(!i||n._n)return n;const d=(...m)=>{d._d&&cx(-1);const _=Lf(i);let g;try{g=n(...m)}finally{Lf(_),d._d&&cx(1)}return g};return d._n=!0,d._c=!0,d._d=!0,d}function dC(n,i){if(Do===null)return n;const a=sm(Do),d=n.dirs||(n.dirs=[]);for(let m=0;m<i.length;m++){let[_,g,l,E=mn]=i[m];_&&(Ii(_)&&(_={mounted:_,updated:_}),_.deep&&Ml(g),d.push({dir:_,instance:a,value:g,oldValue:void 0,arg:l,modifiers:E}))}return n}function lu(n,i,a,d){const m=n.dirs,_=i&&i.dirs;for(let g=0;g<m.length;g++){const l=m[g];_&&(l.oldValue=_[g].value);let E=l.dir[d];E&&(Ll(),ra(E,a,8,[n.el,l,n,i]),kl())}}const pC=Symbol("_vte"),Q1=n=>n.__isTeleport,fc=Symbol("_leaveCb"),rf=Symbol("_enterCb");function fC(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Jd(()=>{n.isMounted=!0}),aw(()=>{n.isUnmounting=!0}),n}const Ss=[Function,Array],ew={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ss,onEnter:Ss,onAfterEnter:Ss,onEnterCancelled:Ss,onBeforeLeave:Ss,onLeave:Ss,onAfterLeave:Ss,onLeaveCancelled:Ss,onBeforeAppear:Ss,onAppear:Ss,onAfterAppear:Ss,onAppearCancelled:Ss},tw=n=>{const i=n.subTree;return i.component?tw(i.component):i},mC={name:"BaseTransition",props:ew,setup(n,{slots:i}){const a=hM(),d=fC();return()=>{const m=i.default&&rw(i.default(),!0);if(!m||!m.length)return;const _=iw(m),g=Hi(n),{mode:l}=g;if(d.isLeaving)return Og(_);const E=ex(_);if(!E)return Og(_);let k=L_(E,g,d,a,$=>k=$);E.type!==bo&&Yd(E,k);let O=a.subTree&&ex(a.subTree);if(O&&O.type!==bo&&!yu(E,O)&&tw(a).type!==bo){let $=L_(O,g,d,a);if(Yd(O,$),l==="out-in"&&E.type!==bo)return d.isLeaving=!0,$.afterLeave=()=>{d.isLeaving=!1,a.job.flags&8||a.update(),delete $.afterLeave,O=void 0},Og(_);l==="in-out"&&E.type!==bo?$.delayLeave=(X,q,te)=>{const ce=nw(d,O);ce[String(O.key)]=O,X[fc]=()=>{q(),X[fc]=void 0,delete k.delayedLeave,O=void 0},k.delayedLeave=()=>{te(),delete k.delayedLeave,O=void 0}}:O=void 0}else O&&(O=void 0);return _}}};function iw(n){let i=n[0];if(n.length>1){for(const a of n)if(a.type!==bo){i=a;break}}return i}const gC=mC;function nw(n,i){const{leavingVNodes:a}=n;let d=a.get(i.type);return d||(d=Object.create(null),a.set(i.type,d)),d}function L_(n,i,a,d,m){const{appear:_,mode:g,persisted:l=!1,onBeforeEnter:E,onEnter:k,onAfterEnter:O,onEnterCancelled:$,onBeforeLeave:X,onLeave:q,onAfterLeave:te,onLeaveCancelled:ce,onBeforeAppear:Ce,onAppear:ze,onAfterAppear:Ue,onAppearCancelled:Fe}=i,xe=String(n.key),be=nw(a,n),ke=(et,ht)=>{et&&ra(et,d,9,ht)},Qe=(et,ht)=>{const At=ht[1];ke(et,ht),ai(et)?et.every(lt=>lt.length<=1)&&At():et.length<=1&&At()},tt={mode:g,persisted:l,beforeEnter(et){let ht=E;if(!a.isMounted)if(_)ht=Ce||E;else return;et[fc]&&et[fc](!0);const At=be[xe];At&&yu(n,At)&&At.el[fc]&&At.el[fc](),ke(ht,[et])},enter(et){let ht=k,At=O,lt=$;if(!a.isMounted)if(_)ht=ze||k,At=Ue||O,lt=Fe||$;else return;let Et=!1;const jt=et[rf]=Ni=>{Et||(Et=!0,Ni?ke(lt,[et]):ke(At,[et]),tt.delayedLeave&&tt.delayedLeave(),et[rf]=void 0)};ht?Qe(ht,[et,jt]):jt()},leave(et,ht){const At=String(n.key);if(et[rf]&&et[rf](!0),a.isUnmounting)return ht();ke(X,[et]);let lt=!1;const Et=et[fc]=jt=>{lt||(lt=!0,ht(),jt?ke(ce,[et]):ke(te,[et]),et[fc]=void 0,be[At]===n&&delete be[At])};be[At]=n,q?Qe(q,[et,Et]):Et()},clone(et){const ht=L_(et,i,a,d,m);return m&&m(ht),ht}};return tt}function Og(n){if(em(n))return n=Tc(n),n.children=null,n}function ex(n){if(!em(n))return Q1(n.type)&&n.children?iw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:i,children:a}=n;if(a){if(i&16)return a[0];if(i&32&&Ii(a.default))return a.default()}}function Yd(n,i){n.shapeFlag&6&&n.component?(n.transition=i,Yd(n.component.subTree,i)):n.shapeFlag&128?(n.ssContent.transition=i.clone(n.ssContent),n.ssFallback.transition=i.clone(n.ssFallback)):n.transition=i}function rw(n,i=!1,a){let d=[],m=0;for(let _=0;_<n.length;_++){let g=n[_];const l=a==null?g.key:String(a)+String(g.key!=null?g.key:_);g.type===ns?(g.patchFlag&128&&m++,d=d.concat(rw(g.children,i,l))):(i||g.type!==bo)&&d.push(l!=null?Tc(g,{key:l}):g)}if(m>1)for(let _=0;_<d.length;_++)d[_].patchFlag=-2;return d}function ow(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Fd(n,i,a,d,m=!1){if(ai(n)){n.forEach((te,ce)=>Fd(te,i&&(ai(i)?i[ce]:i),a,d,m));return}if(Bd(d)&&!m){d.shapeFlag&512&&d.type.__asyncResolved&&d.component.subTree.component&&Fd(n,i,a,d.component.subTree);return}const _=d.shapeFlag&4?sm(d.component):d.el,g=m?null:_,{i:l,r:E}=n,k=i&&i.r,O=l.refs===mn?l.refs={}:l.refs,$=l.setupState,X=Hi($),q=$===mn?()=>!1:te=>sn(X,te);if(k!=null&&k!==E&&(Qn(k)?(O[k]=null,q(k)&&($[k]=null)):Jn(k)&&(k.value=null)),Ii(E))dp(E,l,12,[g,O]);else{const te=Qn(E),ce=Jn(E);if(te||ce){const Ce=()=>{if(n.f){const ze=te?q(E)?$[E]:O[E]:E.value;m?ai(ze)&&gy(ze,_):ai(ze)?ze.includes(_)||ze.push(_):te?(O[E]=[_],q(E)&&($[E]=O[E])):(E.value=[_],n.k&&(O[n.k]=E.value))}else te?(O[E]=g,q(E)&&($[E]=g)):ce&&(E.value=g,n.k&&(O[n.k]=g))};g?(Ce.id=-1,es(Ce,a)):Ce()}}}Kf().requestIdleCallback;Kf().cancelIdleCallback;const Bd=n=>!!n.type.__asyncLoader,em=n=>n.type.__isKeepAlive;function _C(n,i){sw(n,"a",i)}function yC(n,i){sw(n,"da",i)}function sw(n,i,a=Yr){const d=n.__wdc||(n.__wdc=()=>{let m=a;for(;m;){if(m.isDeactivated)return;m=m.parent}return n()});if(tm(i,d,a),a){let m=a.parent;for(;m&&m.parent;)em(m.parent.vnode)&&vC(d,i,a,m),m=m.parent}}function vC(n,i,a,d){const m=tm(i,n,d,!0);im(()=>{gy(d[i],m)},a)}function tm(n,i,a=Yr,d=!1){if(a){const m=a[n]||(a[n]=[]),_=i.__weh||(i.__weh=(...g)=>{Ll();const l=fp(a),E=ra(i,a,n,g);return l(),kl(),E});return d?m.unshift(_):m.push(_),_}}const Rl=n=>(i,a=Yr)=>{(!ep||n==="sp")&&tm(n,(...d)=>i(...d),a)},xC=Rl("bm"),Jd=Rl("m"),bC=Rl("bu"),wC=Rl("u"),aw=Rl("bum"),im=Rl("um"),TC=Rl("sp"),SC=Rl("rtg"),PC=Rl("rtc");function CC(n,i=Yr){tm("ec",n,i)}const MC=Symbol.for("v-ndc");function My(n,i,a,d){let m;const _=a,g=ai(n);if(g||Qn(n)){const l=g&&vc(n);let E=!1,k=!1;l&&(E=!Ls(n),k=wc(n),n=Yf(n)),m=new Array(n.length);for(let O=0,$=n.length;O<$;O++)m[O]=i(E?k?Ef(Xr(n[O])):Xr(n[O]):n[O],O,void 0,_)}else if(typeof n=="number"){m=new Array(n);for(let l=0;l<n;l++)m[l]=i(l+1,l,void 0,_)}else if(En(n))if(n[Symbol.iterator])m=Array.from(n,(l,E)=>i(l,E,void 0,_));else{const l=Object.keys(n);m=new Array(l.length);for(let E=0,k=l.length;E<k;E++){const O=l[E];m[E]=i(n[O],O,E,_)}}else m=[];return m}const k_=n=>n?Mw(n)?sm(n):k_(n.parent):null,Nd=Jr(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>k_(n.parent),$root:n=>k_(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>cw(n),$forceUpdate:n=>n.f||(n.f=()=>{Cy(n.update)}),$nextTick:n=>n.n||(n.n=H1.bind(n.proxy)),$watch:n=>XC.bind(n)}),Fg=(n,i)=>n!==mn&&!n.__isScriptSetup&&sn(n,i),EC={get({_:n},i){if(i==="__v_skip")return!0;const{ctx:a,setupState:d,data:m,props:_,accessCache:g,type:l,appContext:E}=n;let k;if(i[0]!=="$"){const q=g[i];if(q!==void 0)switch(q){case 1:return d[i];case 2:return m[i];case 4:return a[i];case 3:return _[i]}else{if(Fg(d,i))return g[i]=1,d[i];if(m!==mn&&sn(m,i))return g[i]=2,m[i];if((k=n.propsOptions[0])&&sn(k,i))return g[i]=3,_[i];if(a!==mn&&sn(a,i))return g[i]=4,a[i];z_&&(g[i]=0)}}const O=Nd[i];let $,X;if(O)return i==="$attrs"&&ao(n.attrs,"get",""),O(n);if(($=l.__cssModules)&&($=$[i]))return $;if(a!==mn&&sn(a,i))return g[i]=4,a[i];if(X=E.config.globalProperties,sn(X,i))return X[i]},set({_:n},i,a){const{data:d,setupState:m,ctx:_}=n;return Fg(m,i)?(m[i]=a,!0):d!==mn&&sn(d,i)?(d[i]=a,!0):sn(n.props,i)||i[0]==="$"&&i.slice(1)in n?!1:(_[i]=a,!0)},has({_:{data:n,setupState:i,accessCache:a,ctx:d,appContext:m,propsOptions:_}},g){let l;return!!a[g]||n!==mn&&sn(n,g)||Fg(i,g)||(l=_[0])&&sn(l,g)||sn(d,g)||sn(Nd,g)||sn(m.config.globalProperties,g)},defineProperty(n,i,a){return a.get!=null?n._.accessCache[i]=0:sn(a,"value")&&this.set(n,i,a.value,null),Reflect.defineProperty(n,i,a)}};function tx(n){return ai(n)?n.reduce((i,a)=>(i[a]=null,i),{}):n}let z_=!0;function IC(n){const i=cw(n),a=n.proxy,d=n.ctx;z_=!1,i.beforeCreate&&ix(i.beforeCreate,n,"bc");const{data:m,computed:_,methods:g,watch:l,provide:E,inject:k,created:O,beforeMount:$,mounted:X,beforeUpdate:q,updated:te,activated:ce,deactivated:Ce,beforeDestroy:ze,beforeUnmount:Ue,destroyed:Fe,unmounted:xe,render:be,renderTracked:ke,renderTriggered:Qe,errorCaptured:tt,serverPrefetch:et,expose:ht,inheritAttrs:At,components:lt,directives:Et,filters:jt}=i;if(k&&AC(k,d,null),g)for(const ri in g){const It=g[ri];Ii(It)&&(d[ri]=It.bind(a))}if(m){const ri=m.call(a,a);En(ri)&&(n.data=Jf(ri))}if(z_=!0,_)for(const ri in _){const It=_[ri],pr=Ii(It)?It.bind(a,a):Ii(It.get)?It.get.bind(a,a):$a,Yt=!Ii(It)&&Ii(It.set)?It.set.bind(a):$a,pi=Ir({get:pr,set:Yt});Object.defineProperty(d,ri,{enumerable:!0,configurable:!0,get:()=>pi.value,set:Jt=>pi.value=Jt})}if(l)for(const ri in l)lw(l[ri],d,a,ri);if(E){const ri=Ii(E)?E.call(a):E;Reflect.ownKeys(ri).forEach(It=>{OC(It,ri[It])})}O&&ix(O,n,"c");function ni(ri,It){ai(It)?It.forEach(pr=>ri(pr.bind(a))):It&&ri(It.bind(a))}if(ni(xC,$),ni(Jd,X),ni(bC,q),ni(wC,te),ni(_C,ce),ni(yC,Ce),ni(CC,tt),ni(PC,ke),ni(SC,Qe),ni(aw,Ue),ni(im,xe),ni(TC,et),ai(ht))if(ht.length){const ri=n.exposed||(n.exposed={});ht.forEach(It=>{Object.defineProperty(ri,It,{get:()=>a[It],set:pr=>a[It]=pr})})}else n.exposed||(n.exposed={});be&&n.render===$a&&(n.render=be),At!=null&&(n.inheritAttrs=At),lt&&(n.components=lt),Et&&(n.directives=Et),et&&ow(n)}function AC(n,i,a=$a){ai(n)&&(n=R_(n));for(const d in n){const m=n[d];let _;En(m)?"default"in m?_=jd(m.from||d,m.default,!0):_=jd(m.from||d):_=jd(m),Jn(_)?Object.defineProperty(i,d,{enumerable:!0,configurable:!0,get:()=>_.value,set:g=>_.value=g}):i[d]=_}}function ix(n,i,a){ra(ai(n)?n.map(d=>d.bind(i.proxy)):n.bind(i.proxy),i,a)}function lw(n,i,a,d){let m=d.includes(".")?ww(a,d):()=>a[d];if(Qn(n)){const _=i[n];Ii(_)&&Va(m,_)}else if(Ii(n))Va(m,n.bind(a));else if(En(n))if(ai(n))n.forEach(_=>lw(_,i,a,d));else{const _=Ii(n.handler)?n.handler.bind(a):i[n.handler];Ii(_)&&Va(m,_,n)}}function cw(n){const i=n.type,{mixins:a,extends:d}=i,{mixins:m,optionsCache:_,config:{optionMergeStrategies:g}}=n.appContext,l=_.get(i);let E;return l?E=l:!m.length&&!a&&!d?E=i:(E={},m.length&&m.forEach(k=>kf(E,k,g,!0)),kf(E,i,g)),En(i)&&_.set(i,E),E}function kf(n,i,a,d=!1){const{mixins:m,extends:_}=i;_&&kf(n,_,a,!0),m&&m.forEach(g=>kf(n,g,a,!0));for(const g in i)if(!(d&&g==="expose")){const l=LC[g]||a&&a[g];n[g]=l?l(n[g],i[g]):i[g]}return n}const LC={data:nx,props:rx,emits:rx,methods:Ad,computed:Ad,beforeCreate:_o,created:_o,beforeMount:_o,mounted:_o,beforeUpdate:_o,updated:_o,beforeDestroy:_o,beforeUnmount:_o,destroyed:_o,unmounted:_o,activated:_o,deactivated:_o,errorCaptured:_o,serverPrefetch:_o,components:Ad,directives:Ad,watch:zC,provide:nx,inject:kC};function nx(n,i){return i?n?function(){return Jr(Ii(n)?n.call(this,this):n,Ii(i)?i.call(this,this):i)}:i:n}function kC(n,i){return Ad(R_(n),R_(i))}function R_(n){if(ai(n)){const i={};for(let a=0;a<n.length;a++)i[n[a]]=n[a];return i}return n}function _o(n,i){return n?[...new Set([].concat(n,i))]:i}function Ad(n,i){return n?Jr(Object.create(null),n,i):i}function rx(n,i){return n?ai(n)&&ai(i)?[...new Set([...n,...i])]:Jr(Object.create(null),tx(n),tx(i??{})):i}function zC(n,i){if(!n)return i;if(!i)return n;const a=Jr(Object.create(null),n);for(const d in i)a[d]=_o(n[d],i[d]);return a}function uw(){return{app:null,config:{isNativeTag:xP,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let RC=0;function DC(n,i){return function(d,m=null){Ii(d)||(d=Jr({},d)),m!=null&&!En(m)&&(m=null);const _=uw(),g=new WeakSet,l=[];let E=!1;const k=_.app={_uid:RC++,_component:d,_props:m,_container:null,_context:_,_instance:null,version:yM,get config(){return _.config},set config(O){},use(O,...$){return g.has(O)||(O&&Ii(O.install)?(g.add(O),O.install(k,...$)):Ii(O)&&(g.add(O),O(k,...$))),k},mixin(O){return _.mixins.includes(O)||_.mixins.push(O),k},component(O,$){return $?(_.components[O]=$,k):_.components[O]},directive(O,$){return $?(_.directives[O]=$,k):_.directives[O]},mount(O,$,X){if(!E){const q=k._ceVNode||Yn(d,m);return q.appContext=_,X===!0?X="svg":X===!1&&(X=void 0),n(q,O,X),E=!0,k._container=O,O.__vue_app__=k,sm(q.component)}},onUnmount(O){l.push(O)},unmount(){E&&(ra(l,k._instance,16),n(null,k._container),delete k._container.__vue_app__)},provide(O,$){return _.provides[O]=$,k},runWithContext(O){const $=wu;wu=k;try{return O()}finally{wu=$}}};return k}}let wu=null;function OC(n,i){if(Yr){let a=Yr.provides;const d=Yr.parent&&Yr.parent.provides;d===a&&(a=Yr.provides=Object.create(d)),a[n]=i}}function jd(n,i,a=!1){const d=Yr||Do;if(d||wu){let m=wu?wu._context.provides:d?d.parent==null||d.ce?d.vnode.appContext&&d.vnode.appContext.provides:d.parent.provides:void 0;if(m&&n in m)return m[n];if(arguments.length>1)return a&&Ii(i)?i.call(d&&d.proxy):i}}function FC(){return!!(Yr||Do||wu)}const hw={},dw=()=>Object.create(hw),pw=n=>Object.getPrototypeOf(n)===hw;function BC(n,i,a,d=!1){const m={},_=dw();n.propsDefaults=Object.create(null),fw(n,i,m,_);for(const g in n.propsOptions[0])g in m||(m[g]=void 0);a?n.props=d?m:JP(m):n.type.props?n.props=m:n.props=_,n.attrs=_}function NC(n,i,a,d){const{props:m,attrs:_,vnode:{patchFlag:g}}=n,l=Hi(m),[E]=n.propsOptions;let k=!1;if((d||g>0)&&!(g&16)){if(g&8){const O=n.vnode.dynamicProps;for(let $=0;$<O.length;$++){let X=O[$];if(nm(n.emitsOptions,X))continue;const q=i[X];if(E)if(sn(_,X))q!==_[X]&&(_[X]=q,k=!0);else{const te=bc(X);m[te]=D_(E,l,te,q,n,!1)}else q!==_[X]&&(_[X]=q,k=!0)}}}else{fw(n,i,m,_)&&(k=!0);let O;for(const $ in l)(!i||!sn(i,$)&&((O=zu($))===$||!sn(i,O)))&&(E?a&&(a[$]!==void 0||a[O]!==void 0)&&(m[$]=D_(E,l,$,void 0,n,!0)):delete m[$]);if(_!==l)for(const $ in _)(!i||!sn(i,$))&&(delete _[$],k=!0)}k&&Cl(n.attrs,"set","")}function fw(n,i,a,d){const[m,_]=n.propsOptions;let g=!1,l;if(i)for(let E in i){if(Rd(E))continue;const k=i[E];let O;m&&sn(m,O=bc(E))?!_||!_.includes(O)?a[O]=k:(l||(l={}))[O]=k:nm(n.emitsOptions,E)||(!(E in d)||k!==d[E])&&(d[E]=k,g=!0)}if(_){const E=Hi(a),k=l||mn;for(let O=0;O<_.length;O++){const $=_[O];a[$]=D_(m,E,$,k[$],n,!sn(k,$))}}return g}function D_(n,i,a,d,m,_){const g=n[a];if(g!=null){const l=sn(g,"default");if(l&&d===void 0){const E=g.default;if(g.type!==Function&&!g.skipFactory&&Ii(E)){const{propsDefaults:k}=m;if(a in k)d=k[a];else{const O=fp(m);d=k[a]=E.call(null,i),O()}}else d=E;m.ce&&m.ce._setProp(a,d)}g[0]&&(_&&!l?d=!1:g[1]&&(d===""||d===zu(a))&&(d=!0))}return d}const jC=new WeakMap;function mw(n,i,a=!1){const d=a?jC:i.propsCache,m=d.get(n);if(m)return m;const _=n.props,g={},l=[];let E=!1;if(!Ii(n)){const O=$=>{E=!0;const[X,q]=mw($,i,!0);Jr(g,X),q&&l.push(...q)};!a&&i.mixins.length&&i.mixins.forEach(O),n.extends&&O(n.extends),n.mixins&&n.mixins.forEach(O)}if(!_&&!E)return En(n)&&d.set(n,wh),wh;if(ai(_))for(let O=0;O<_.length;O++){const $=bc(_[O]);ox($)&&(g[$]=mn)}else if(_)for(const O in _){const $=bc(O);if(ox($)){const X=_[O],q=g[$]=ai(X)||Ii(X)?{type:X}:Jr({},X),te=q.type;let ce=!1,Ce=!0;if(ai(te))for(let ze=0;ze<te.length;++ze){const Ue=te[ze],Fe=Ii(Ue)&&Ue.name;if(Fe==="Boolean"){ce=!0;break}else Fe==="String"&&(Ce=!1)}else ce=Ii(te)&&te.name==="Boolean";q[0]=ce,q[1]=Ce,(ce||sn(q,"default"))&&l.push($)}}const k=[g,l];return En(n)&&d.set(n,k),k}function ox(n){return n[0]!=="$"&&!Rd(n)}const Ey=n=>n[0]==="_"||n==="$stable",Iy=n=>ai(n)?n.map(ja):[ja(n)],UC=(n,i,a)=>{if(i._n)return i;const d=J1((...m)=>Iy(i(...m)),a);return d._c=!1,d},gw=(n,i,a)=>{const d=n._ctx;for(const m in n){if(Ey(m))continue;const _=n[m];if(Ii(_))i[m]=UC(m,_,d);else if(_!=null){const g=Iy(_);i[m]=()=>g}}},_w=(n,i)=>{const a=Iy(i);n.slots.default=()=>a},yw=(n,i,a)=>{for(const d in i)(a||!Ey(d))&&(n[d]=i[d])},$C=(n,i,a)=>{const d=n.slots=dw();if(n.vnode.shapeFlag&32){const m=i.__;m&&P_(d,"__",m,!0);const _=i._;_?(yw(d,i,a),a&&P_(d,"_",_,!0)):gw(i,d)}else i&&_w(n,i)},VC=(n,i,a)=>{const{vnode:d,slots:m}=n;let _=!0,g=mn;if(d.shapeFlag&32){const l=i._;l?a&&l===1?_=!1:yw(m,i,a):(_=!i.$stable,gw(i,m)),g=i}else i&&(_w(n,i),g={default:1});if(_)for(const l in m)!Ey(l)&&g[l]==null&&delete m[l]},es=nM;function ZC(n){return qC(n)}function qC(n,i){const a=Kf();a.__VUE__=!0;const{insert:d,remove:m,patchProp:_,createElement:g,createText:l,createComment:E,setText:k,setElementText:O,parentNode:$,nextSibling:X,setScopeId:q=$a,insertStaticContent:te}=n,ce=(ye,Pe,Ke,ct=null,at=null,nt=null,xt=void 0,_t=null,wt=!!Pe.dynamicChildren)=>{if(ye===Pe)return;ye&&!yu(ye,Pe)&&(ct=On(ye),Jt(ye,at,nt,!0),ye=null),Pe.patchFlag===-2&&(wt=!1,Pe.dynamicChildren=null);const{type:dt,ref:$t,shapeFlag:Pt}=Pe;switch(dt){case rm:Ce(ye,Pe,Ke,ct);break;case bo:ze(ye,Pe,Ke,ct);break;case Ng:ye==null&&Ue(Pe,Ke,ct,xt);break;case ns:lt(ye,Pe,Ke,ct,at,nt,xt,_t,wt);break;default:Pt&1?be(ye,Pe,Ke,ct,at,nt,xt,_t,wt):Pt&6?Et(ye,Pe,Ke,ct,at,nt,xt,_t,wt):(Pt&64||Pt&128)&&dt.process(ye,Pe,Ke,ct,at,nt,xt,_t,wt,Fr)}$t!=null&&at?Fd($t,ye&&ye.ref,nt,Pe||ye,!Pe):$t==null&&ye&&ye.ref!=null&&Fd(ye.ref,null,nt,ye,!0)},Ce=(ye,Pe,Ke,ct)=>{if(ye==null)d(Pe.el=l(Pe.children),Ke,ct);else{const at=Pe.el=ye.el;Pe.children!==ye.children&&k(at,Pe.children)}},ze=(ye,Pe,Ke,ct)=>{ye==null?d(Pe.el=E(Pe.children||""),Ke,ct):Pe.el=ye.el},Ue=(ye,Pe,Ke,ct)=>{[ye.el,ye.anchor]=te(ye.children,Pe,Ke,ct,ye.el,ye.anchor)},Fe=({el:ye,anchor:Pe},Ke,ct)=>{let at;for(;ye&&ye!==Pe;)at=X(ye),d(ye,Ke,ct),ye=at;d(Pe,Ke,ct)},xe=({el:ye,anchor:Pe})=>{let Ke;for(;ye&&ye!==Pe;)Ke=X(ye),m(ye),ye=Ke;m(Pe)},be=(ye,Pe,Ke,ct,at,nt,xt,_t,wt)=>{Pe.type==="svg"?xt="svg":Pe.type==="math"&&(xt="mathml"),ye==null?ke(Pe,Ke,ct,at,nt,xt,_t,wt):et(ye,Pe,at,nt,xt,_t,wt)},ke=(ye,Pe,Ke,ct,at,nt,xt,_t)=>{let wt,dt;const{props:$t,shapeFlag:Pt,transition:Ft,dirs:Qt}=ye;if(wt=ye.el=g(ye.type,nt,$t&&$t.is,$t),Pt&8?O(wt,ye.children):Pt&16&&tt(ye.children,wt,null,ct,at,Bg(ye,nt),xt,_t),Qt&&lu(ye,null,ct,"created"),Qe(wt,ye,ye.scopeId,xt,ct),$t){for(const yi in $t)yi!=="value"&&!Rd(yi)&&_(wt,yi,null,$t[yi],nt,ct);"value"in $t&&_(wt,"value",null,$t.value,nt),(dt=$t.onVnodeBeforeMount)&&Oa(dt,ct,ye)}Qt&&lu(ye,null,ct,"beforeMount");const si=GC(at,Ft);si&&Ft.beforeEnter(wt),d(wt,Pe,Ke),((dt=$t&&$t.onVnodeMounted)||si||Qt)&&es(()=>{dt&&Oa(dt,ct,ye),si&&Ft.enter(wt),Qt&&lu(ye,null,ct,"mounted")},at)},Qe=(ye,Pe,Ke,ct,at)=>{if(Ke&&q(ye,Ke),ct)for(let nt=0;nt<ct.length;nt++)q(ye,ct[nt]);if(at){let nt=at.subTree;if(Pe===nt||Sw(nt.type)&&(nt.ssContent===Pe||nt.ssFallback===Pe)){const xt=at.vnode;Qe(ye,xt,xt.scopeId,xt.slotScopeIds,at.parent)}}},tt=(ye,Pe,Ke,ct,at,nt,xt,_t,wt=0)=>{for(let dt=wt;dt<ye.length;dt++){const $t=ye[dt]=_t?mc(ye[dt]):ja(ye[dt]);ce(null,$t,Pe,Ke,ct,at,nt,xt,_t)}},et=(ye,Pe,Ke,ct,at,nt,xt)=>{const _t=Pe.el=ye.el;let{patchFlag:wt,dynamicChildren:dt,dirs:$t}=Pe;wt|=ye.patchFlag&16;const Pt=ye.props||mn,Ft=Pe.props||mn;let Qt;if(Ke&&cu(Ke,!1),(Qt=Ft.onVnodeBeforeUpdate)&&Oa(Qt,Ke,Pe,ye),$t&&lu(Pe,ye,Ke,"beforeUpdate"),Ke&&cu(Ke,!0),(Pt.innerHTML&&Ft.innerHTML==null||Pt.textContent&&Ft.textContent==null)&&O(_t,""),dt?ht(ye.dynamicChildren,dt,_t,Ke,ct,Bg(Pe,at),nt):xt||It(ye,Pe,_t,null,Ke,ct,Bg(Pe,at),nt,!1),wt>0){if(wt&16)At(_t,Pt,Ft,Ke,at);else if(wt&2&&Pt.class!==Ft.class&&_(_t,"class",null,Ft.class,at),wt&4&&_(_t,"style",Pt.style,Ft.style,at),wt&8){const si=Pe.dynamicProps;for(let yi=0;yi<si.length;yi++){const vi=si[yi],In=Pt[vi],An=Ft[vi];(An!==In||vi==="value")&&_(_t,vi,In,An,at,Ke)}}wt&1&&ye.children!==Pe.children&&O(_t,Pe.children)}else!xt&&dt==null&&At(_t,Pt,Ft,Ke,at);((Qt=Ft.onVnodeUpdated)||$t)&&es(()=>{Qt&&Oa(Qt,Ke,Pe,ye),$t&&lu(Pe,ye,Ke,"updated")},ct)},ht=(ye,Pe,Ke,ct,at,nt,xt)=>{for(let _t=0;_t<Pe.length;_t++){const wt=ye[_t],dt=Pe[_t],$t=wt.el&&(wt.type===ns||!yu(wt,dt)||wt.shapeFlag&198)?$(wt.el):Ke;ce(wt,dt,$t,null,ct,at,nt,xt,!0)}},At=(ye,Pe,Ke,ct,at)=>{if(Pe!==Ke){if(Pe!==mn)for(const nt in Pe)!Rd(nt)&&!(nt in Ke)&&_(ye,nt,Pe[nt],null,at,ct);for(const nt in Ke){if(Rd(nt))continue;const xt=Ke[nt],_t=Pe[nt];xt!==_t&&nt!=="value"&&_(ye,nt,_t,xt,at,ct)}"value"in Ke&&_(ye,"value",Pe.value,Ke.value,at)}},lt=(ye,Pe,Ke,ct,at,nt,xt,_t,wt)=>{const dt=Pe.el=ye?ye.el:l(""),$t=Pe.anchor=ye?ye.anchor:l("");let{patchFlag:Pt,dynamicChildren:Ft,slotScopeIds:Qt}=Pe;Qt&&(_t=_t?_t.concat(Qt):Qt),ye==null?(d(dt,Ke,ct),d($t,Ke,ct),tt(Pe.children||[],Ke,$t,at,nt,xt,_t,wt)):Pt>0&&Pt&64&&Ft&&ye.dynamicChildren?(ht(ye.dynamicChildren,Ft,Ke,at,nt,xt,_t),(Pe.key!=null||at&&Pe===at.subTree)&&vw(ye,Pe,!0)):It(ye,Pe,Ke,$t,at,nt,xt,_t,wt)},Et=(ye,Pe,Ke,ct,at,nt,xt,_t,wt)=>{Pe.slotScopeIds=_t,ye==null?Pe.shapeFlag&512?at.ctx.activate(Pe,Ke,ct,xt,wt):jt(Pe,Ke,ct,at,nt,xt,wt):Ni(ye,Pe,wt)},jt=(ye,Pe,Ke,ct,at,nt,xt)=>{const _t=ye.component=uM(ye,ct,at);if(em(ye)&&(_t.ctx.renderer=Fr),dM(_t,!1,xt),_t.asyncDep){if(at&&at.registerDep(_t,ni,xt),!ye.el){const wt=_t.subTree=Yn(bo);ze(null,wt,Pe,Ke)}}else ni(_t,ye,Pe,Ke,at,nt,xt)},Ni=(ye,Pe,Ke)=>{const ct=Pe.component=ye.component;if(tM(ye,Pe,Ke))if(ct.asyncDep&&!ct.asyncResolved){ri(ct,Pe,Ke);return}else ct.next=Pe,ct.update();else Pe.el=ye.el,ct.vnode=Pe},ni=(ye,Pe,Ke,ct,at,nt,xt)=>{const _t=()=>{if(ye.isMounted){let{next:Pt,bu:Ft,u:Qt,parent:si,vnode:yi}=ye;{const Ee=xw(ye);if(Ee){Pt&&(Pt.el=yi.el,ri(ye,Pt,xt)),Ee.asyncDep.then(()=>{ye.isUnmounted||_t()});return}}let vi=Pt,In;cu(ye,!1),Pt?(Pt.el=yi.el,ri(ye,Pt,xt)):Pt=yi,Ft&&pf(Ft),(In=Pt.props&&Pt.props.onVnodeBeforeUpdate)&&Oa(In,si,Pt,yi),cu(ye,!0);const An=ax(ye),wn=ye.subTree;ye.subTree=An,ce(wn,An,$(wn.el),On(wn),ye,at,nt),Pt.el=An.el,vi===null&&iM(ye,An.el),Qt&&es(Qt,at),(In=Pt.props&&Pt.props.onVnodeUpdated)&&es(()=>Oa(In,si,Pt,yi),at)}else{let Pt;const{el:Ft,props:Qt}=Pe,{bm:si,m:yi,parent:vi,root:In,type:An}=ye,wn=Bd(Pe);cu(ye,!1),si&&pf(si),!wn&&(Pt=Qt&&Qt.onVnodeBeforeMount)&&Oa(Pt,vi,Pe),cu(ye,!0);{In.ce&&In.ce._def.shadowRoot!==!1&&In.ce._injectChildStyle(An);const Ee=ye.subTree=ax(ye);ce(null,Ee,Ke,ct,ye,at,nt),Pe.el=Ee.el}if(yi&&es(yi,at),!wn&&(Pt=Qt&&Qt.onVnodeMounted)){const Ee=Pe;es(()=>Oa(Pt,vi,Ee),at)}(Pe.shapeFlag&256||vi&&Bd(vi.vnode)&&vi.vnode.shapeFlag&256)&&ye.a&&es(ye.a,at),ye.isMounted=!0,Pe=Ke=ct=null}};ye.scope.on();const wt=ye.effect=new A1(_t);ye.scope.off();const dt=ye.update=wt.run.bind(wt),$t=ye.job=wt.runIfDirty.bind(wt);$t.i=ye,$t.id=ye.uid,wt.scheduler=()=>Cy($t),cu(ye,!0),dt()},ri=(ye,Pe,Ke)=>{Pe.component=ye;const ct=ye.vnode.props;ye.vnode=Pe,ye.next=null,NC(ye,Pe.props,ct,Ke),VC(ye,Pe.children,Ke),Ll(),Q0(ye),kl()},It=(ye,Pe,Ke,ct,at,nt,xt,_t,wt=!1)=>{const dt=ye&&ye.children,$t=ye?ye.shapeFlag:0,Pt=Pe.children,{patchFlag:Ft,shapeFlag:Qt}=Pe;if(Ft>0){if(Ft&128){Yt(dt,Pt,Ke,ct,at,nt,xt,_t,wt);return}else if(Ft&256){pr(dt,Pt,Ke,ct,at,nt,xt,_t,wt);return}}Qt&8?($t&16&&oi(dt,at,nt),Pt!==dt&&O(Ke,Pt)):$t&16?Qt&16?Yt(dt,Pt,Ke,ct,at,nt,xt,_t,wt):oi(dt,at,nt,!0):($t&8&&O(Ke,""),Qt&16&&tt(Pt,Ke,ct,at,nt,xt,_t,wt))},pr=(ye,Pe,Ke,ct,at,nt,xt,_t,wt)=>{ye=ye||wh,Pe=Pe||wh;const dt=ye.length,$t=Pe.length,Pt=Math.min(dt,$t);let Ft;for(Ft=0;Ft<Pt;Ft++){const Qt=Pe[Ft]=wt?mc(Pe[Ft]):ja(Pe[Ft]);ce(ye[Ft],Qt,Ke,null,at,nt,xt,_t,wt)}dt>$t?oi(ye,at,nt,!0,!1,Pt):tt(Pe,Ke,ct,at,nt,xt,_t,wt,Pt)},Yt=(ye,Pe,Ke,ct,at,nt,xt,_t,wt)=>{let dt=0;const $t=Pe.length;let Pt=ye.length-1,Ft=$t-1;for(;dt<=Pt&&dt<=Ft;){const Qt=ye[dt],si=Pe[dt]=wt?mc(Pe[dt]):ja(Pe[dt]);if(yu(Qt,si))ce(Qt,si,Ke,null,at,nt,xt,_t,wt);else break;dt++}for(;dt<=Pt&&dt<=Ft;){const Qt=ye[Pt],si=Pe[Ft]=wt?mc(Pe[Ft]):ja(Pe[Ft]);if(yu(Qt,si))ce(Qt,si,Ke,null,at,nt,xt,_t,wt);else break;Pt--,Ft--}if(dt>Pt){if(dt<=Ft){const Qt=Ft+1,si=Qt<$t?Pe[Qt].el:ct;for(;dt<=Ft;)ce(null,Pe[dt]=wt?mc(Pe[dt]):ja(Pe[dt]),Ke,si,at,nt,xt,_t,wt),dt++}}else if(dt>Ft)for(;dt<=Pt;)Jt(ye[dt],at,nt,!0),dt++;else{const Qt=dt,si=dt,yi=new Map;for(dt=si;dt<=Ft;dt++){const ie=Pe[dt]=wt?mc(Pe[dt]):ja(Pe[dt]);ie.key!=null&&yi.set(ie.key,dt)}let vi,In=0;const An=Ft-si+1;let wn=!1,Ee=0;const J=new Array(An);for(dt=0;dt<An;dt++)J[dt]=0;for(dt=Qt;dt<=Pt;dt++){const ie=ye[dt];if(In>=An){Jt(ie,at,nt,!0);continue}let he;if(ie.key!=null)he=yi.get(ie.key);else for(vi=si;vi<=Ft;vi++)if(J[vi-si]===0&&yu(ie,Pe[vi])){he=vi;break}he===void 0?Jt(ie,at,nt,!0):(J[he-si]=dt+1,he>=Ee?Ee=he:wn=!0,ce(ie,Pe[he],Ke,null,at,nt,xt,_t,wt),In++)}const Q=wn?HC(J):wh;for(vi=Q.length-1,dt=An-1;dt>=0;dt--){const ie=si+dt,he=Pe[ie],Te=ie+1<$t?Pe[ie+1].el:ct;J[dt]===0?ce(null,he,Ke,Te,at,nt,xt,_t,wt):wn&&(vi<0||dt!==Q[vi]?pi(he,Ke,Te,2):vi--)}}},pi=(ye,Pe,Ke,ct,at=null)=>{const{el:nt,type:xt,transition:_t,children:wt,shapeFlag:dt}=ye;if(dt&6){pi(ye.component.subTree,Pe,Ke,ct);return}if(dt&128){ye.suspense.move(Pe,Ke,ct);return}if(dt&64){xt.move(ye,Pe,Ke,Fr);return}if(xt===ns){d(nt,Pe,Ke);for(let Pt=0;Pt<wt.length;Pt++)pi(wt[Pt],Pe,Ke,ct);d(ye.anchor,Pe,Ke);return}if(xt===Ng){Fe(ye,Pe,Ke);return}if(ct!==2&&dt&1&&_t)if(ct===0)_t.beforeEnter(nt),d(nt,Pe,Ke),es(()=>_t.enter(nt),at);else{const{leave:Pt,delayLeave:Ft,afterLeave:Qt}=_t,si=()=>{ye.ctx.isUnmounted?m(nt):d(nt,Pe,Ke)},yi=()=>{Pt(nt,()=>{si(),Qt&&Qt()})};Ft?Ft(nt,si,yi):yi()}else d(nt,Pe,Ke)},Jt=(ye,Pe,Ke,ct=!1,at=!1)=>{const{type:nt,props:xt,ref:_t,children:wt,dynamicChildren:dt,shapeFlag:$t,patchFlag:Pt,dirs:Ft,cacheIndex:Qt}=ye;if(Pt===-2&&(at=!1),_t!=null&&(Ll(),Fd(_t,null,Ke,ye,!0),kl()),Qt!=null&&(Pe.renderCache[Qt]=void 0),$t&256){Pe.ctx.deactivate(ye);return}const si=$t&1&&Ft,yi=!Bd(ye);let vi;if(yi&&(vi=xt&&xt.onVnodeBeforeUnmount)&&Oa(vi,Pe,ye),$t&6)Ai(ye.component,Ke,ct);else{if($t&128){ye.suspense.unmount(Ke,ct);return}si&&lu(ye,null,Pe,"beforeUnmount"),$t&64?ye.type.remove(ye,Pe,Ke,Fr,ct):dt&&!dt.hasOnce&&(nt!==ns||Pt>0&&Pt&64)?oi(dt,Pe,Ke,!1,!0):(nt===ns&&Pt&384||!at&&$t&16)&&oi(wt,Pe,Ke),ct&&Xi(ye)}(yi&&(vi=xt&&xt.onVnodeUnmounted)||si)&&es(()=>{vi&&Oa(vi,Pe,ye),si&&lu(ye,null,Pe,"unmounted")},Ke)},Xi=ye=>{const{type:Pe,el:Ke,anchor:ct,transition:at}=ye;if(Pe===ns){ji(Ke,ct);return}if(Pe===Ng){xe(ye);return}const nt=()=>{m(Ke),at&&!at.persisted&&at.afterLeave&&at.afterLeave()};if(ye.shapeFlag&1&&at&&!at.persisted){const{leave:xt,delayLeave:_t}=at,wt=()=>xt(Ke,nt);_t?_t(ye.el,nt,wt):wt()}else nt()},ji=(ye,Pe)=>{let Ke;for(;ye!==Pe;)Ke=X(ye),m(ye),ye=Ke;m(Pe)},Ai=(ye,Pe,Ke)=>{const{bum:ct,scope:at,job:nt,subTree:xt,um:_t,m:wt,a:dt,parent:$t,slots:{__:Pt}}=ye;sx(wt),sx(dt),ct&&pf(ct),$t&&ai(Pt)&&Pt.forEach(Ft=>{$t.renderCache[Ft]=void 0}),at.stop(),nt&&(nt.flags|=8,Jt(xt,ye,Pe,Ke)),_t&&es(_t,Pe),es(()=>{ye.isUnmounted=!0},Pe),Pe&&Pe.pendingBranch&&!Pe.isUnmounted&&ye.asyncDep&&!ye.asyncResolved&&ye.suspenseId===Pe.pendingId&&(Pe.deps--,Pe.deps===0&&Pe.resolve())},oi=(ye,Pe,Ke,ct=!1,at=!1,nt=0)=>{for(let xt=nt;xt<ye.length;xt++)Jt(ye[xt],Pe,Ke,ct,at)},On=ye=>{if(ye.shapeFlag&6)return On(ye.component.subTree);if(ye.shapeFlag&128)return ye.suspense.next();const Pe=X(ye.anchor||ye.el),Ke=Pe&&Pe[pC];return Ke?X(Ke):Pe};let fr=!1;const dn=(ye,Pe,Ke)=>{ye==null?Pe._vnode&&Jt(Pe._vnode,null,null,!0):ce(Pe._vnode||null,ye,Pe,null,null,null,Ke),Pe._vnode=ye,fr||(fr=!0,Q0(),K1(),fr=!1)},Fr={p:ce,um:Jt,m:pi,r:Xi,mt:jt,mc:tt,pc:It,pbc:ht,n:On,o:n};return{render:dn,hydrate:void 0,createApp:DC(dn)}}function Bg({type:n,props:i},a){return a==="svg"&&n==="foreignObject"||a==="mathml"&&n==="annotation-xml"&&i&&i.encoding&&i.encoding.includes("html")?void 0:a}function cu({effect:n,job:i},a){a?(n.flags|=32,i.flags|=4):(n.flags&=-33,i.flags&=-5)}function GC(n,i){return(!n||n&&!n.pendingBranch)&&i&&!i.persisted}function vw(n,i,a=!1){const d=n.children,m=i.children;if(ai(d)&&ai(m))for(let _=0;_<d.length;_++){const g=d[_];let l=m[_];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=m[_]=mc(m[_]),l.el=g.el),!a&&l.patchFlag!==-2&&vw(g,l)),l.type===rm&&(l.el=g.el),l.type===bo&&!l.el&&(l.el=g.el)}}function HC(n){const i=n.slice(),a=[0];let d,m,_,g,l;const E=n.length;for(d=0;d<E;d++){const k=n[d];if(k!==0){if(m=a[a.length-1],n[m]<k){i[d]=m,a.push(d);continue}for(_=0,g=a.length-1;_<g;)l=_+g>>1,n[a[l]]<k?_=l+1:g=l;k<n[a[_]]&&(_>0&&(i[d]=a[_-1]),a[_]=d)}}for(_=a.length,g=a[_-1];_-- >0;)a[_]=g,g=i[g];return a}function xw(n){const i=n.subTree.component;if(i)return i.asyncDep&&!i.asyncResolved?i:xw(i)}function sx(n){if(n)for(let i=0;i<n.length;i++)n[i].flags|=8}const WC=Symbol.for("v-scx"),KC=()=>jd(WC);function Va(n,i,a){return bw(n,i,a)}function bw(n,i,a=mn){const{immediate:d,deep:m,flush:_,once:g}=a,l=Jr({},a),E=i&&d||!i&&_!=="post";let k;if(ep){if(_==="sync"){const q=KC();k=q.__watcherHandles||(q.__watcherHandles=[])}else if(!E){const q=()=>{};return q.stop=$a,q.resume=$a,q.pause=$a,q}}const O=Yr;l.call=(q,te,ce)=>ra(q,O,te,ce);let $=!1;_==="post"?l.scheduler=q=>{es(q,O&&O.suspense)}:_!=="sync"&&($=!0,l.scheduler=(q,te)=>{te?q():Cy(q)}),l.augmentJob=q=>{i&&(q.flags|=4),$&&(q.flags|=2,O&&(q.id=O.uid,q.i=O))};const X=lC(n,i,l);return ep&&(k?k.push(X):E&&X()),X}function XC(n,i,a){const d=this.proxy,m=Qn(n)?n.includes(".")?ww(d,n):()=>d[n]:n.bind(d,d);let _;Ii(i)?_=i:(_=i.handler,a=i);const g=fp(this),l=bw(m,_.bind(d),a);return g(),l}function ww(n,i){const a=i.split(".");return()=>{let d=n;for(let m=0;m<a.length&&d;m++)d=d[a[m]];return d}}const YC=(n,i)=>i==="modelValue"||i==="model-value"?n.modelModifiers:n[`${i}Modifiers`]||n[`${bc(i)}Modifiers`]||n[`${zu(i)}Modifiers`];function JC(n,i,...a){if(n.isUnmounted)return;const d=n.vnode.props||mn;let m=a;const _=i.startsWith("update:"),g=_&&YC(d,i.slice(7));g&&(g.trim&&(m=a.map(O=>Qn(O)?O.trim():O)),g.number&&(m=a.map(C_)));let l,E=d[l=Lg(i)]||d[l=Lg(bc(i))];!E&&_&&(E=d[l=Lg(zu(i))]),E&&ra(E,n,6,m);const k=d[l+"Once"];if(k){if(!n.emitted)n.emitted={};else if(n.emitted[l])return;n.emitted[l]=!0,ra(k,n,6,m)}}function Tw(n,i,a=!1){const d=i.emitsCache,m=d.get(n);if(m!==void 0)return m;const _=n.emits;let g={},l=!1;if(!Ii(n)){const E=k=>{const O=Tw(k,i,!0);O&&(l=!0,Jr(g,O))};!a&&i.mixins.length&&i.mixins.forEach(E),n.extends&&E(n.extends),n.mixins&&n.mixins.forEach(E)}return!_&&!l?(En(n)&&d.set(n,null),null):(ai(_)?_.forEach(E=>g[E]=null):Jr(g,_),En(n)&&d.set(n,g),g)}function nm(n,i){return!n||!Gf(i)?!1:(i=i.slice(2).replace(/Once$/,""),sn(n,i[0].toLowerCase()+i.slice(1))||sn(n,zu(i))||sn(n,i))}function ax(n){const{type:i,vnode:a,proxy:d,withProxy:m,propsOptions:[_],slots:g,attrs:l,emit:E,render:k,renderCache:O,props:$,data:X,setupState:q,ctx:te,inheritAttrs:ce}=n,Ce=Lf(n);let ze,Ue;try{if(a.shapeFlag&4){const xe=m||d,be=xe;ze=ja(k.call(be,xe,O,$,q,X,te)),Ue=l}else{const xe=i;ze=ja(xe.length>1?xe($,{attrs:l,slots:g,emit:E}):xe($,null)),Ue=i.props?l:QC(l)}}catch(xe){Ud.length=0,Qf(xe,n,1),ze=Yn(bo)}let Fe=ze;if(Ue&&ce!==!1){const xe=Object.keys(Ue),{shapeFlag:be}=Fe;xe.length&&be&7&&(_&&xe.some(my)&&(Ue=eM(Ue,_)),Fe=Tc(Fe,Ue,!1,!0))}return a.dirs&&(Fe=Tc(Fe,null,!1,!0),Fe.dirs=Fe.dirs?Fe.dirs.concat(a.dirs):a.dirs),a.transition&&Yd(Fe,a.transition),ze=Fe,Lf(Ce),ze}const QC=n=>{let i;for(const a in n)(a==="class"||a==="style"||Gf(a))&&((i||(i={}))[a]=n[a]);return i},eM=(n,i)=>{const a={};for(const d in n)(!my(d)||!(d.slice(9)in i))&&(a[d]=n[d]);return a};function tM(n,i,a){const{props:d,children:m,component:_}=n,{props:g,children:l,patchFlag:E}=i,k=_.emitsOptions;if(i.dirs||i.transition)return!0;if(a&&E>=0){if(E&1024)return!0;if(E&16)return d?lx(d,g,k):!!g;if(E&8){const O=i.dynamicProps;for(let $=0;$<O.length;$++){const X=O[$];if(g[X]!==d[X]&&!nm(k,X))return!0}}}else return(m||l)&&(!l||!l.$stable)?!0:d===g?!1:d?g?lx(d,g,k):!0:!!g;return!1}function lx(n,i,a){const d=Object.keys(i);if(d.length!==Object.keys(n).length)return!0;for(let m=0;m<d.length;m++){const _=d[m];if(i[_]!==n[_]&&!nm(a,_))return!0}return!1}function iM({vnode:n,parent:i},a){for(;i;){const d=i.subTree;if(d.suspense&&d.suspense.activeBranch===n&&(d.el=n.el),d===n)(n=i.vnode).el=a,i=i.parent;else break}}const Sw=n=>n.__isSuspense;function nM(n,i){i&&i.pendingBranch?ai(n)?i.effects.push(...n):i.effects.push(n):hC(n)}const ns=Symbol.for("v-fgt"),rm=Symbol.for("v-txt"),bo=Symbol.for("v-cmt"),Ng=Symbol.for("v-stc"),Ud=[];let os=null;function Rn(n=!1){Ud.push(os=n?null:[])}function rM(){Ud.pop(),os=Ud[Ud.length-1]||null}let Qd=1;function cx(n,i=!1){Qd+=n,n<0&&os&&i&&(os.hasOnce=!0)}function Pw(n){return n.dynamicChildren=Qd>0?os||wh:null,rM(),Qd>0&&os&&os.push(n),n}function Er(n,i,a,d,m,_){return Pw(Ut(n,i,a,d,m,_,!0))}function pp(n,i,a,d,m){return Pw(Yn(n,i,a,d,m,!0))}function zf(n){return n?n.__v_isVNode===!0:!1}function yu(n,i){return n.type===i.type&&n.key===i.key}const Cw=({key:n})=>n??null,ff=({ref:n,ref_key:i,ref_for:a})=>(typeof n=="number"&&(n=""+n),n!=null?Qn(n)||Jn(n)||Ii(n)?{i:Do,r:n,k:i,f:!!a}:n:null);function Ut(n,i=null,a=null,d=0,m=null,_=n===ns?0:1,g=!1,l=!1){const E={__v_isVNode:!0,__v_skip:!0,type:n,props:i,key:i&&Cw(i),ref:i&&ff(i),scopeId:Y1,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:_,patchFlag:d,dynamicProps:m,dynamicChildren:null,appContext:null,ctx:Do};return l?(Ay(E,a),_&128&&n.normalize(E)):a&&(E.shapeFlag|=Qn(a)?8:16),Qd>0&&!g&&os&&(E.patchFlag>0||_&6)&&E.patchFlag!==32&&os.push(E),E}const Yn=oM;function oM(n,i=null,a=null,d=0,m=null,_=!1){if((!n||n===MC)&&(n=bo),zf(n)){const l=Tc(n,i,!0);return a&&Ay(l,a),Qd>0&&!_&&os&&(l.shapeFlag&6?os[os.indexOf(n)]=l:os.push(l)),l.patchFlag=-2,l}if(gM(n)&&(n=n.__vccOpts),i){i=sM(i);let{class:l,style:E}=i;l&&!Qn(l)&&(i.class=Al(l)),En(E)&&(Sy(E)&&!ai(E)&&(E=Jr({},E)),i.style=Xf(E))}const g=Qn(n)?1:Sw(n)?128:Q1(n)?64:En(n)?4:Ii(n)?2:0;return Ut(n,i,a,d,m,g,_,!0)}function sM(n){return n?Sy(n)||pw(n)?Jr({},n):n:null}function Tc(n,i,a=!1,d=!1){const{props:m,ref:_,patchFlag:g,children:l,transition:E}=n,k=i?aM(m||{},i):m,O={__v_isVNode:!0,__v_skip:!0,type:n.type,props:k,key:k&&Cw(k),ref:i&&i.ref?a&&_?ai(_)?_.concat(ff(i)):[_,ff(i)]:ff(i):_,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:l,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:i&&n.type!==ns?g===-1?16:g|16:g,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:E,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Tc(n.ssContent),ssFallback:n.ssFallback&&Tc(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return E&&d&&Yd(O,E.clone(O)),O}function O_(n=" ",i=0){return Yn(rm,null,n,i)}function om(n="",i=!1){return i?(Rn(),pp(bo,null,n)):Yn(bo,null,n)}function ja(n){return n==null||typeof n=="boolean"?Yn(bo):ai(n)?Yn(ns,null,n.slice()):zf(n)?mc(n):Yn(rm,null,String(n))}function mc(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Tc(n)}function Ay(n,i){let a=0;const{shapeFlag:d}=n;if(i==null)i=null;else if(ai(i))a=16;else if(typeof i=="object")if(d&65){const m=i.default;m&&(m._c&&(m._d=!1),Ay(n,m()),m._c&&(m._d=!0));return}else{a=32;const m=i._;!m&&!pw(i)?i._ctx=Do:m===3&&Do&&(Do.slots._===1?i._=1:(i._=2,n.patchFlag|=1024))}else Ii(i)?(i={default:i,_ctx:Do},a=32):(i=String(i),d&64?(a=16,i=[O_(i)]):a=8);n.children=i,n.shapeFlag|=a}function aM(...n){const i={};for(let a=0;a<n.length;a++){const d=n[a];for(const m in d)if(m==="class")i.class!==d.class&&(i.class=Al([i.class,d.class]));else if(m==="style")i.style=Xf([i.style,d.style]);else if(Gf(m)){const _=i[m],g=d[m];g&&_!==g&&!(ai(_)&&_.includes(g))&&(i[m]=_?[].concat(_,g):g)}else m!==""&&(i[m]=d[m])}return i}function Oa(n,i,a,d=null){ra(n,i,7,[a,d])}const lM=uw();let cM=0;function uM(n,i,a){const d=n.type,m=(i?i.appContext:n.appContext)||lM,_={uid:cM++,vnode:n,type:d,parent:i,appContext:m,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new M1(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:i?i.provides:Object.create(m.provides),ids:i?i.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:mw(d,m),emitsOptions:Tw(d,m),emit:null,emitted:null,propsDefaults:mn,inheritAttrs:d.inheritAttrs,ctx:mn,data:mn,props:mn,attrs:mn,slots:mn,refs:mn,setupState:mn,setupContext:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return _.ctx={_},_.root=i?i.root:_,_.emit=JC.bind(null,_),n.ce&&n.ce(_),_}let Yr=null;const hM=()=>Yr||Do;let Rf,F_;{const n=Kf(),i=(a,d)=>{let m;return(m=n[a])||(m=n[a]=[]),m.push(d),_=>{m.length>1?m.forEach(g=>g(_)):m[0](_)}};Rf=i("__VUE_INSTANCE_SETTERS__",a=>Yr=a),F_=i("__VUE_SSR_SETTERS__",a=>ep=a)}const fp=n=>{const i=Yr;return Rf(n),n.scope.on(),()=>{n.scope.off(),Rf(i)}},ux=()=>{Yr&&Yr.scope.off(),Rf(null)};function Mw(n){return n.vnode.shapeFlag&4}let ep=!1;function dM(n,i=!1,a=!1){i&&F_(i);const{props:d,children:m}=n.vnode,_=Mw(n);BC(n,d,_,i),$C(n,m,a||i);const g=_?pM(n,i):void 0;return i&&F_(!1),g}function pM(n,i){const a=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,EC);const{setup:d}=a;if(d){Ll();const m=n.setupContext=d.length>1?mM(n):null,_=fp(n),g=dp(d,n,0,[n.props,m]),l=x1(g);if(kl(),_(),(l||n.sp)&&!Bd(n)&&ow(n),l){if(g.then(ux,ux),i)return g.then(E=>{hx(n,E)}).catch(E=>{Qf(E,n,0)});n.asyncDep=g}else hx(n,g)}else Ew(n)}function hx(n,i,a){Ii(i)?n.type.__ssrInlineRender?n.ssrRender=i:n.render=i:En(i)&&(n.setupState=q1(i)),Ew(n)}function Ew(n,i,a){const d=n.type;n.render||(n.render=d.render||$a);{const m=fp(n);Ll();try{IC(n)}finally{kl(),m()}}}const fM={get(n,i){return ao(n,"get",""),n[i]}};function mM(n){const i=a=>{n.exposed=a||{}};return{attrs:new Proxy(n.attrs,fM),slots:n.slots,emit:n.emit,expose:i}}function sm(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(q1(Py(n.exposed)),{get(i,a){if(a in i)return i[a];if(a in Nd)return Nd[a](n)},has(i,a){return a in i||a in Nd}})):n.proxy}function gM(n){return Ii(n)&&"__vccOpts"in n}const Ir=(n,i)=>sC(n,i,ep);function _M(n,i,a){const d=arguments.length;return d===2?En(i)&&!ai(i)?zf(i)?Yn(n,null,[i]):Yn(n,i):Yn(n,null,i):(d>3?a=Array.prototype.slice.call(arguments,2):d===3&&zf(a)&&(a=[a]),Yn(n,i,a))}const yM="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let B_;const dx=typeof window<"u"&&window.trustedTypes;if(dx)try{B_=dx.createPolicy("vue",{createHTML:n=>n})}catch{}const Iw=B_?n=>B_.createHTML(n):n=>n,vM="http://www.w3.org/2000/svg",xM="http://www.w3.org/1998/Math/MathML",Pl=typeof document<"u"?document:null,px=Pl&&Pl.createElement("template"),bM={insert:(n,i,a)=>{i.insertBefore(n,a||null)},remove:n=>{const i=n.parentNode;i&&i.removeChild(n)},createElement:(n,i,a,d)=>{const m=i==="svg"?Pl.createElementNS(vM,n):i==="mathml"?Pl.createElementNS(xM,n):a?Pl.createElement(n,{is:a}):Pl.createElement(n);return n==="select"&&d&&d.multiple!=null&&m.setAttribute("multiple",d.multiple),m},createText:n=>Pl.createTextNode(n),createComment:n=>Pl.createComment(n),setText:(n,i)=>{n.nodeValue=i},setElementText:(n,i)=>{n.textContent=i},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Pl.querySelector(n),setScopeId(n,i){n.setAttribute(i,"")},insertStaticContent(n,i,a,d,m,_){const g=a?a.previousSibling:i.lastChild;if(m&&(m===_||m.nextSibling))for(;i.insertBefore(m.cloneNode(!0),a),!(m===_||!(m=m.nextSibling)););else{px.innerHTML=Iw(d==="svg"?`<svg>${n}</svg>`:d==="mathml"?`<math>${n}</math>`:n);const l=px.content;if(d==="svg"||d==="mathml"){const E=l.firstChild;for(;E.firstChild;)l.appendChild(E.firstChild);l.removeChild(E)}i.insertBefore(l,a)}return[g?g.nextSibling:i.firstChild,a?a.previousSibling:i.lastChild]}},uc="transition",Cd="animation",tp=Symbol("_vtc"),Aw={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},wM=Jr({},ew,Aw),TM=n=>(n.displayName="Transition",n.props=wM,n),SM=TM((n,{slots:i})=>_M(gC,PM(n),i)),uu=(n,i=[])=>{ai(n)?n.forEach(a=>a(...i)):n&&n(...i)},fx=n=>n?ai(n)?n.some(i=>i.length>1):n.length>1:!1;function PM(n){const i={};for(const lt in n)lt in Aw||(i[lt]=n[lt]);if(n.css===!1)return i;const{name:a="v",type:d,duration:m,enterFromClass:_=`${a}-enter-from`,enterActiveClass:g=`${a}-enter-active`,enterToClass:l=`${a}-enter-to`,appearFromClass:E=_,appearActiveClass:k=g,appearToClass:O=l,leaveFromClass:$=`${a}-leave-from`,leaveActiveClass:X=`${a}-leave-active`,leaveToClass:q=`${a}-leave-to`}=n,te=CM(m),ce=te&&te[0],Ce=te&&te[1],{onBeforeEnter:ze,onEnter:Ue,onEnterCancelled:Fe,onLeave:xe,onLeaveCancelled:be,onBeforeAppear:ke=ze,onAppear:Qe=Ue,onAppearCancelled:tt=Fe}=i,et=(lt,Et,jt,Ni)=>{lt._enterCancelled=Ni,hu(lt,Et?O:l),hu(lt,Et?k:g),jt&&jt()},ht=(lt,Et)=>{lt._isLeaving=!1,hu(lt,$),hu(lt,q),hu(lt,X),Et&&Et()},At=lt=>(Et,jt)=>{const Ni=lt?Qe:Ue,ni=()=>et(Et,lt,jt);uu(Ni,[Et,ni]),mx(()=>{hu(Et,lt?E:_),Sl(Et,lt?O:l),fx(Ni)||gx(Et,d,ce,ni)})};return Jr(i,{onBeforeEnter(lt){uu(ze,[lt]),Sl(lt,_),Sl(lt,g)},onBeforeAppear(lt){uu(ke,[lt]),Sl(lt,E),Sl(lt,k)},onEnter:At(!1),onAppear:At(!0),onLeave(lt,Et){lt._isLeaving=!0;const jt=()=>ht(lt,Et);Sl(lt,$),lt._enterCancelled?(Sl(lt,X),vx()):(vx(),Sl(lt,X)),mx(()=>{lt._isLeaving&&(hu(lt,$),Sl(lt,q),fx(xe)||gx(lt,d,Ce,jt))}),uu(xe,[lt,jt])},onEnterCancelled(lt){et(lt,!1,void 0,!0),uu(Fe,[lt])},onAppearCancelled(lt){et(lt,!0,void 0,!0),uu(tt,[lt])},onLeaveCancelled(lt){ht(lt),uu(be,[lt])}})}function CM(n){if(n==null)return null;if(En(n))return[jg(n.enter),jg(n.leave)];{const i=jg(n);return[i,i]}}function jg(n){return PP(n)}function Sl(n,i){i.split(/\s+/).forEach(a=>a&&n.classList.add(a)),(n[tp]||(n[tp]=new Set)).add(i)}function hu(n,i){i.split(/\s+/).forEach(d=>d&&n.classList.remove(d));const a=n[tp];a&&(a.delete(i),a.size||(n[tp]=void 0))}function mx(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let MM=0;function gx(n,i,a,d){const m=n._endId=++MM,_=()=>{m===n._endId&&d()};if(a!=null)return setTimeout(_,a);const{type:g,timeout:l,propCount:E}=EM(n,i);if(!g)return d();const k=g+"end";let O=0;const $=()=>{n.removeEventListener(k,X),_()},X=q=>{q.target===n&&++O>=E&&$()};setTimeout(()=>{O<E&&$()},l+1),n.addEventListener(k,X)}function EM(n,i){const a=window.getComputedStyle(n),d=te=>(a[te]||"").split(", "),m=d(`${uc}Delay`),_=d(`${uc}Duration`),g=_x(m,_),l=d(`${Cd}Delay`),E=d(`${Cd}Duration`),k=_x(l,E);let O=null,$=0,X=0;i===uc?g>0&&(O=uc,$=g,X=_.length):i===Cd?k>0&&(O=Cd,$=k,X=E.length):($=Math.max(g,k),O=$>0?g>k?uc:Cd:null,X=O?O===uc?_.length:E.length:0);const q=O===uc&&/\b(transform|all)(,|$)/.test(d(`${uc}Property`).toString());return{type:O,timeout:$,propCount:X,hasTransform:q}}function _x(n,i){for(;n.length<i.length;)n=n.concat(n);return Math.max(...i.map((a,d)=>yx(a)+yx(n[d])))}function yx(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function vx(){return document.body.offsetHeight}function IM(n,i,a){const d=n[tp];d&&(i=(i?[i,...d]:[...d]).join(" ")),i==null?n.removeAttribute("class"):a?n.setAttribute("class",i):n.className=i}const xx=Symbol("_vod"),AM=Symbol("_vsh"),LM=Symbol(""),kM=/(^|;)\s*display\s*:/;function zM(n,i,a){const d=n.style,m=Qn(a);let _=!1;if(a&&!m){if(i)if(Qn(i))for(const g of i.split(";")){const l=g.slice(0,g.indexOf(":")).trim();a[l]==null&&mf(d,l,"")}else for(const g in i)a[g]==null&&mf(d,g,"");for(const g in a)g==="display"&&(_=!0),mf(d,g,a[g])}else if(m){if(i!==a){const g=d[LM];g&&(a+=";"+g),d.cssText=a,_=kM.test(a)}}else i&&n.removeAttribute("style");xx in n&&(n[xx]=_?d.display:"",n[AM]&&(d.display="none"))}const bx=/\s*!important$/;function mf(n,i,a){if(ai(a))a.forEach(d=>mf(n,i,d));else if(a==null&&(a=""),i.startsWith("--"))n.setProperty(i,a);else{const d=RM(n,i);bx.test(a)?n.setProperty(zu(d),a.replace(bx,""),"important"):n[d]=a}}const wx=["Webkit","Moz","ms"],Ug={};function RM(n,i){const a=Ug[i];if(a)return a;let d=bc(i);if(d!=="filter"&&d in n)return Ug[i]=d;d=T1(d);for(let m=0;m<wx.length;m++){const _=wx[m]+d;if(_ in n)return Ug[i]=_}return i}const Tx="http://www.w3.org/1999/xlink";function Sx(n,i,a,d,m,_=LP(i)){d&&i.startsWith("xlink:")?a==null?n.removeAttributeNS(Tx,i.slice(6,i.length)):n.setAttributeNS(Tx,i,a):a==null||_&&!S1(a)?n.removeAttribute(i):n.setAttribute(i,_?"":Sc(a)?String(a):a)}function Px(n,i,a,d,m){if(i==="innerHTML"||i==="textContent"){a!=null&&(n[i]=i==="innerHTML"?Iw(a):a);return}const _=n.tagName;if(i==="value"&&_!=="PROGRESS"&&!_.includes("-")){const l=_==="OPTION"?n.getAttribute("value")||"":n.value,E=a==null?n.type==="checkbox"?"on":"":String(a);(l!==E||!("_value"in n))&&(n.value=E),a==null&&n.removeAttribute(i),n._value=a;return}let g=!1;if(a===""||a==null){const l=typeof n[i];l==="boolean"?a=S1(a):a==null&&l==="string"?(a="",g=!0):l==="number"&&(a=0,g=!0)}try{n[i]=a}catch{}g&&n.removeAttribute(m||i)}function yh(n,i,a,d){n.addEventListener(i,a,d)}function DM(n,i,a,d){n.removeEventListener(i,a,d)}const Cx=Symbol("_vei");function OM(n,i,a,d,m=null){const _=n[Cx]||(n[Cx]={}),g=_[i];if(d&&g)g.value=d;else{const[l,E]=FM(i);if(d){const k=_[i]=jM(d,m);yh(n,l,k,E)}else g&&(DM(n,l,g,E),_[i]=void 0)}}const Mx=/(?:Once|Passive|Capture)$/;function FM(n){let i;if(Mx.test(n)){i={};let d;for(;d=n.match(Mx);)n=n.slice(0,n.length-d[0].length),i[d[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):zu(n.slice(2)),i]}let $g=0;const BM=Promise.resolve(),NM=()=>$g||(BM.then(()=>$g=0),$g=Date.now());function jM(n,i){const a=d=>{if(!d._vts)d._vts=Date.now();else if(d._vts<=a.attached)return;ra(UM(d,a.value),i,5,[d])};return a.value=n,a.attached=NM(),a}function UM(n,i){if(ai(i)){const a=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{a.call(n),n._stopped=!0},i.map(d=>m=>!m._stopped&&d&&d(m))}else return i}const Ex=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,$M=(n,i,a,d,m,_)=>{const g=m==="svg";i==="class"?IM(n,d,g):i==="style"?zM(n,a,d):Gf(i)?my(i)||OM(n,i,a,d,_):(i[0]==="."?(i=i.slice(1),!0):i[0]==="^"?(i=i.slice(1),!1):VM(n,i,d,g))?(Px(n,i,d),!n.tagName.includes("-")&&(i==="value"||i==="checked"||i==="selected")&&Sx(n,i,d,g,_,i!=="value")):n._isVueCE&&(/[A-Z]/.test(i)||!Qn(d))?Px(n,bc(i),d,_,i):(i==="true-value"?n._trueValue=d:i==="false-value"&&(n._falseValue=d),Sx(n,i,d,g))};function VM(n,i,a,d){if(d)return!!(i==="innerHTML"||i==="textContent"||i in n&&Ex(i)&&Ii(a));if(i==="spellcheck"||i==="draggable"||i==="translate"||i==="autocorrect"||i==="form"||i==="list"&&n.tagName==="INPUT"||i==="type"&&n.tagName==="TEXTAREA")return!1;if(i==="width"||i==="height"){const m=n.tagName;if(m==="IMG"||m==="VIDEO"||m==="CANVAS"||m==="SOURCE")return!1}return Ex(i)&&Qn(a)?!1:i in n}const Ix=n=>{const i=n.props["onUpdate:modelValue"]||!1;return ai(i)?a=>pf(i,a):i};function ZM(n){n.target.composing=!0}function Ax(n){const i=n.target;i.composing&&(i.composing=!1,i.dispatchEvent(new Event("input")))}const Vg=Symbol("_assign"),qM={created(n,{modifiers:{lazy:i,trim:a,number:d}},m){n[Vg]=Ix(m);const _=d||m.props&&m.props.type==="number";yh(n,i?"change":"input",g=>{if(g.target.composing)return;let l=n.value;a&&(l=l.trim()),_&&(l=C_(l)),n[Vg](l)}),a&&yh(n,"change",()=>{n.value=n.value.trim()}),i||(yh(n,"compositionstart",ZM),yh(n,"compositionend",Ax),yh(n,"change",Ax))},mounted(n,{value:i}){n.value=i??""},beforeUpdate(n,{value:i,oldValue:a,modifiers:{lazy:d,trim:m,number:_}},g){if(n[Vg]=Ix(g),n.composing)return;const l=(_||n.type==="number")&&!/^0\d/.test(n.value)?C_(n.value):n.value,E=i??"";l!==E&&(document.activeElement===n&&n.type!=="range"&&(d&&i===a||m&&n.value.trim()===E)||(n.value=E))}},GM=["ctrl","shift","alt","meta"],HM={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,i)=>GM.some(a=>n[`${a}Key`]&&!i.includes(a))},WM=(n,i)=>{const a=n._withMods||(n._withMods={}),d=i.join(".");return a[d]||(a[d]=(m,..._)=>{for(let g=0;g<i.length;g++){const l=HM[i[g]];if(l&&l(m,i))return}return n(m,..._)})},KM=Jr({patchProp:$M},bM);let Lx;function XM(){return Lx||(Lx=ZC(KM))}const YM=(...n)=>{const i=XM().createApp(...n),{mount:a}=i;return i.mount=d=>{const m=QM(d);if(!m)return;const _=i._component;!Ii(_)&&!_.render&&!_.template&&(_.template=m.innerHTML),m.nodeType===1&&(m.textContent="");const g=a(m,!1,JM(m));return m instanceof Element&&(m.removeAttribute("v-cloak"),m.setAttribute("data-v-app","")),g},i};function JM(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function QM(n){return Qn(n)?document.querySelector(n):n}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let Lw;const am=n=>Lw=n,kw=Symbol();function N_(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var $d;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})($d||($d={}));function eE(){const n=E1(!0),i=n.run(()=>Wi({}));let a=[],d=[];const m=Py({install(_){am(m),m._a=_,_.provide(kw,m),_.config.globalProperties.$pinia=m,d.forEach(g=>a.push(g)),d=[]},use(_){return this._a?a.push(_):d.push(_),this},_p:a,_a:null,_e:n,_s:new Map,state:i});return m}const zw=()=>{};function kx(n,i,a,d=zw){n.push(i);const m=()=>{const _=n.indexOf(i);_>-1&&(n.splice(_,1),d())};return!a&&I1()&&kP(m),m}function mh(n,...i){n.slice().forEach(a=>{a(...i)})}const tE=n=>n(),zx=Symbol(),Zg=Symbol();function j_(n,i){n instanceof Map&&i instanceof Map?i.forEach((a,d)=>n.set(d,a)):n instanceof Set&&i instanceof Set&&i.forEach(n.add,n);for(const a in i){if(!i.hasOwnProperty(a))continue;const d=i[a],m=n[a];N_(m)&&N_(d)&&n.hasOwnProperty(a)&&!Jn(d)&&!vc(d)?n[a]=j_(m,d):n[a]=d}return n}const iE=Symbol();function nE(n){return!N_(n)||!Object.prototype.hasOwnProperty.call(n,iE)}const{assign:dc}=Object;function rE(n){return!!(Jn(n)&&n.effect)}function oE(n,i,a,d){const{state:m,actions:_,getters:g}=i,l=a.state.value[n];let E;function k(){l||(a.state.value[n]=m?m():{});const O=iC(a.state.value[n]);return dc(O,_,Object.keys(g||{}).reduce(($,X)=>($[X]=Py(Ir(()=>{am(a);const q=a._s.get(n);return g[X].call(q,q)})),$),{}))}return E=Rw(n,k,i,a,d,!0),E}function Rw(n,i,a={},d,m,_){let g;const l=dc({actions:{}},a),E={deep:!0};let k,O,$=[],X=[],q;const te=d.state.value[n];!_&&!te&&(d.state.value[n]={}),Wi({});let ce;function Ce(tt){let et;k=O=!1,typeof tt=="function"?(tt(d.state.value[n]),et={type:$d.patchFunction,storeId:n,events:q}):(j_(d.state.value[n],tt),et={type:$d.patchObject,payload:tt,storeId:n,events:q});const ht=ce=Symbol();H1().then(()=>{ce===ht&&(k=!0)}),O=!0,mh($,et,d.state.value[n])}const ze=_?function(){const{state:et}=a,ht=et?et():{};this.$patch(At=>{dc(At,ht)})}:zw;function Ue(){g.stop(),$=[],X=[],d._s.delete(n)}const Fe=(tt,et="")=>{if(zx in tt)return tt[Zg]=et,tt;const ht=function(){am(d);const At=Array.from(arguments),lt=[],Et=[];function jt(ri){lt.push(ri)}function Ni(ri){Et.push(ri)}mh(X,{args:At,name:ht[Zg],store:be,after:jt,onError:Ni});let ni;try{ni=tt.apply(this&&this.$id===n?this:be,At)}catch(ri){throw mh(Et,ri),ri}return ni instanceof Promise?ni.then(ri=>(mh(lt,ri),ri)).catch(ri=>(mh(Et,ri),Promise.reject(ri))):(mh(lt,ni),ni)};return ht[zx]=!0,ht[Zg]=et,ht},xe={_p:d,$id:n,$onAction:kx.bind(null,X),$patch:Ce,$reset:ze,$subscribe(tt,et={}){const ht=kx($,tt,et.detached,()=>At()),At=g.run(()=>Va(()=>d.state.value[n],lt=>{(et.flush==="sync"?O:k)&&tt({storeId:n,type:$d.direct,events:q},lt)},dc({},E,et)));return ht},$dispose:Ue},be=Jf(xe);d._s.set(n,be);const Qe=(d._a&&d._a.runWithContext||tE)(()=>d._e.run(()=>(g=E1()).run(()=>i({action:Fe}))));for(const tt in Qe){const et=Qe[tt];if(Jn(et)&&!rE(et)||vc(et))_||(te&&nE(et)&&(Jn(et)?et.value=te[tt]:j_(et,te[tt])),d.state.value[n][tt]=et);else if(typeof et=="function"){const ht=Fe(et,tt);Qe[tt]=ht,l.actions[tt]=et}}return dc(be,Qe),dc(Hi(be),Qe),Object.defineProperty(be,"$state",{get:()=>d.state.value[n],set:tt=>{Ce(et=>{dc(et,tt)})}}),d._p.forEach(tt=>{dc(be,g.run(()=>tt({store:be,app:d._a,pinia:d,options:l})))}),te&&_&&a.hydrate&&a.hydrate(be.$state,te),k=!0,O=!0,be}/*! #__NO_SIDE_EFFECTS__ */function sE(n,i,a){let d;const m=typeof i=="function";d=m?a:i;function _(g,l){const E=FC();return g=g||(E?jd(kw,null):null),g&&am(g),g=Lw,g._s.has(n)||(m?Rw(n,i,d,g):oE(n,d,g)),g._s.get(n)}return _.$id=n,_}const aE="/assets/Linraya-by-TfB-DcgugJ4q.svg",Wa=(n,i)=>{const a=n.__vccOpts||n;for(const[d,m]of i)a[d]=m;return a},lE={class:"navbar"},cE={__name:"SiteHeader",setup(n){const i=Wi(!1),a=()=>{i.value=!i.value};return(d,m)=>(Rn(),Er("header",lE,[m[2]||(m[2]=Ut("div",null,[Ut("a",{href:"/"},[Ut("img",{src:aE,alt:"Linraya Logo",width:"150",height:"60"})])],-1)),Ut("nav",{class:Al(["nav-links",{open:i.value}])},m[0]||(m[0]=[Ut("ul",null,[Ut("li",null,[Ut("a",{href:"/tentang",class:"bold"},"Tentang Linraya")]),Ut("li",null,[Ut("a",{href:"/perkakas",class:"bold"},"Perkakas")]),Ut("li",null,[Ut("a",{href:"https://transportforbandung.org",class:"button",style:{color:"#FFFFFF"}},"Transport for Bandung")])],-1)]),2),Ut("button",{class:Al(["hamburger",{active:i.value}]),onClick:a,"aria-label":"Navigation Menu"},m[1]||(m[1]=[Ut("span",{class:"hamburger-box"},[Ut("span",{class:"hamburger-inner"})],-1)]),2)]))}},uE=Wa(cE,[["__scopeId","data-v-11da6c35"]]);var of=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lm(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ld={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var hE=Ld.exports,Rx;function Dw(){return Rx||(Rx=1,function(n,i){(function(a,d){d(i)})(hE,function(a){var d="1.9.4";function m(c){var y,P,z,U;for(P=1,z=arguments.length;P<z;P++){U=arguments[P];for(y in U)c[y]=U[y]}return c}var _=Object.create||function(){function c(){}return function(y){return c.prototype=y,new c}}();function g(c,y){var P=Array.prototype.slice;if(c.bind)return c.bind.apply(c,P.call(arguments,1));var z=P.call(arguments,2);return function(){return c.apply(y,z.length?z.concat(P.call(arguments)):arguments)}}var l=0;function E(c){return"_leaflet_id"in c||(c._leaflet_id=++l),c._leaflet_id}function k(c,y,P){var z,U,ee,ve;return ve=function(){z=!1,U&&(ee.apply(P,U),U=!1)},ee=function(){z?U=arguments:(c.apply(P,arguments),setTimeout(ve,y),z=!0)},ee}function O(c,y,P){var z=y[1],U=y[0],ee=z-U;return c===z&&P?c:((c-U)%ee+ee)%ee+U}function $(){return!1}function X(c,y){if(y===!1)return c;var P=Math.pow(10,y===void 0?6:y);return Math.round(c*P)/P}function q(c){return c.trim?c.trim():c.replace(/^\s+|\s+$/g,"")}function te(c){return q(c).split(/\s+/)}function ce(c,y){Object.prototype.hasOwnProperty.call(c,"options")||(c.options=c.options?_(c.options):{});for(var P in y)c.options[P]=y[P];return c.options}function Ce(c,y,P){var z=[];for(var U in c)z.push(encodeURIComponent(P?U.toUpperCase():U)+"="+encodeURIComponent(c[U]));return(!y||y.indexOf("?")===-1?"?":"&")+z.join("&")}var ze=/\{ *([\w_ -]+) *\}/g;function Ue(c,y){return c.replace(ze,function(P,z){var U=y[z];if(U===void 0)throw new Error("No value provided for variable "+P);return typeof U=="function"&&(U=U(y)),U})}var Fe=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"};function xe(c,y){for(var P=0;P<c.length;P++)if(c[P]===y)return P;return-1}var be="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ke(c){return window["webkit"+c]||window["moz"+c]||window["ms"+c]}var Qe=0;function tt(c){var y=+new Date,P=Math.max(0,16-(y-Qe));return Qe=y+P,window.setTimeout(c,P)}var et=window.requestAnimationFrame||ke("RequestAnimationFrame")||tt,ht=window.cancelAnimationFrame||ke("CancelAnimationFrame")||ke("CancelRequestAnimationFrame")||function(c){window.clearTimeout(c)};function At(c,y,P){if(P&&et===tt)c.call(y);else return et.call(window,g(c,y))}function lt(c){c&&ht.call(window,c)}var Et={__proto__:null,extend:m,create:_,bind:g,get lastId(){return l},stamp:E,throttle:k,wrapNum:O,falseFn:$,formatNum:X,trim:q,splitWords:te,setOptions:ce,getParamString:Ce,template:Ue,isArray:Fe,indexOf:xe,emptyImageUrl:be,requestFn:et,cancelFn:ht,requestAnimFrame:At,cancelAnimFrame:lt};function jt(){}jt.extend=function(c){var y=function(){ce(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=y.__super__=this.prototype,z=_(P);z.constructor=y,y.prototype=z;for(var U in this)Object.prototype.hasOwnProperty.call(this,U)&&U!=="prototype"&&U!=="__super__"&&(y[U]=this[U]);return c.statics&&m(y,c.statics),c.includes&&(Ni(c.includes),m.apply(null,[z].concat(c.includes))),m(z,c),delete z.statics,delete z.includes,z.options&&(z.options=P.options?_(P.options):{},m(z.options,c.options)),z._initHooks=[],z.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var ee=0,ve=z._initHooks.length;ee<ve;ee++)z._initHooks[ee].call(this)}},y},jt.include=function(c){var y=this.prototype.options;return m(this.prototype,c),c.options&&(this.prototype.options=y,this.mergeOptions(c.options)),this},jt.mergeOptions=function(c){return m(this.prototype.options,c),this},jt.addInitHook=function(c){var y=Array.prototype.slice.call(arguments,1),P=typeof c=="function"?c:function(){this[c].apply(this,y)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function Ni(c){if(!(typeof L>"u"||!L||!L.Mixin)){c=Fe(c)?c:[c];for(var y=0;y<c.length;y++)c[y]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var ni={on:function(c,y,P){if(typeof c=="object")for(var z in c)this._on(z,c[z],y);else{c=te(c);for(var U=0,ee=c.length;U<ee;U++)this._on(c[U],y,P)}return this},off:function(c,y,P){if(!arguments.length)delete this._events;else if(typeof c=="object")for(var z in c)this._off(z,c[z],y);else{c=te(c);for(var U=arguments.length===1,ee=0,ve=c.length;ee<ve;ee++)U?this._off(c[ee]):this._off(c[ee],y,P)}return this},_on:function(c,y,P,z){if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}if(this._listens(c,y,P)===!1){P===this&&(P=void 0);var U={fn:y,ctx:P};z&&(U.once=!0),this._events=this._events||{},this._events[c]=this._events[c]||[],this._events[c].push(U)}},_off:function(c,y,P){var z,U,ee;if(this._events&&(z=this._events[c],!!z)){if(arguments.length===1){if(this._firingCount)for(U=0,ee=z.length;U<ee;U++)z[U].fn=$;delete this._events[c];return}if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}var ve=this._listens(c,y,P);if(ve!==!1){var Oe=z[ve];this._firingCount&&(Oe.fn=$,this._events[c]=z=z.slice()),z.splice(ve,1)}}},fire:function(c,y,P){if(!this.listens(c,P))return this;var z=m({},y,{type:c,target:this,sourceTarget:y&&y.sourceTarget||this});if(this._events){var U=this._events[c];if(U){this._firingCount=this._firingCount+1||1;for(var ee=0,ve=U.length;ee<ve;ee++){var Oe=U[ee],Ge=Oe.fn;Oe.once&&this.off(c,Ge,Oe.ctx),Ge.call(Oe.ctx||this,z)}this._firingCount--}}return P&&this._propagateEvent(z),this},listens:function(c,y,P,z){typeof c!="string"&&console.warn('"string" type argument expected');var U=y;typeof y!="function"&&(z=!!y,U=void 0,P=void 0);var ee=this._events&&this._events[c];if(ee&&ee.length&&this._listens(c,U,P)!==!1)return!0;if(z){for(var ve in this._eventParents)if(this._eventParents[ve].listens(c,y,P,z))return!0}return!1},_listens:function(c,y,P){if(!this._events)return!1;var z=this._events[c]||[];if(!y)return!!z.length;P===this&&(P=void 0);for(var U=0,ee=z.length;U<ee;U++)if(z[U].fn===y&&z[U].ctx===P)return U;return!1},once:function(c,y,P){if(typeof c=="object")for(var z in c)this._on(z,c[z],y,!0);else{c=te(c);for(var U=0,ee=c.length;U<ee;U++)this._on(c[U],y,P,!0)}return this},addEventParent:function(c){return this._eventParents=this._eventParents||{},this._eventParents[E(c)]=c,this},removeEventParent:function(c){return this._eventParents&&delete this._eventParents[E(c)],this},_propagateEvent:function(c){for(var y in this._eventParents)this._eventParents[y].fire(c.type,m({layer:c.target,propagatedFrom:c.target},c),!0)}};ni.addEventListener=ni.on,ni.removeEventListener=ni.clearAllEventListeners=ni.off,ni.addOneTimeEventListener=ni.once,ni.fireEvent=ni.fire,ni.hasEventListeners=ni.listens;var ri=jt.extend(ni);function It(c,y,P){this.x=P?Math.round(c):c,this.y=P?Math.round(y):y}var pr=Math.trunc||function(c){return c>0?Math.floor(c):Math.ceil(c)};It.prototype={clone:function(){return new It(this.x,this.y)},add:function(c){return this.clone()._add(Yt(c))},_add:function(c){return this.x+=c.x,this.y+=c.y,this},subtract:function(c){return this.clone()._subtract(Yt(c))},_subtract:function(c){return this.x-=c.x,this.y-=c.y,this},divideBy:function(c){return this.clone()._divideBy(c)},_divideBy:function(c){return this.x/=c,this.y/=c,this},multiplyBy:function(c){return this.clone()._multiplyBy(c)},_multiplyBy:function(c){return this.x*=c,this.y*=c,this},scaleBy:function(c){return new It(this.x*c.x,this.y*c.y)},unscaleBy:function(c){return new It(this.x/c.x,this.y/c.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=pr(this.x),this.y=pr(this.y),this},distanceTo:function(c){c=Yt(c);var y=c.x-this.x,P=c.y-this.y;return Math.sqrt(y*y+P*P)},equals:function(c){return c=Yt(c),c.x===this.x&&c.y===this.y},contains:function(c){return c=Yt(c),Math.abs(c.x)<=Math.abs(this.x)&&Math.abs(c.y)<=Math.abs(this.y)},toString:function(){return"Point("+X(this.x)+", "+X(this.y)+")"}};function Yt(c,y,P){return c instanceof It?c:Fe(c)?new It(c[0],c[1]):c==null?c:typeof c=="object"&&"x"in c&&"y"in c?new It(c.x,c.y):new It(c,y,P)}function pi(c,y){if(c)for(var P=y?[c,y]:c,z=0,U=P.length;z<U;z++)this.extend(P[z])}pi.prototype={extend:function(c){var y,P;if(!c)return this;if(c instanceof It||typeof c[0]=="number"||"x"in c)y=P=Yt(c);else if(c=Jt(c),y=c.min,P=c.max,!y||!P)return this;return!this.min&&!this.max?(this.min=y.clone(),this.max=P.clone()):(this.min.x=Math.min(y.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(y.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(c){return Yt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,c)},getBottomLeft:function(){return Yt(this.min.x,this.max.y)},getTopRight:function(){return Yt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(c){var y,P;return typeof c[0]=="number"||c instanceof It?c=Yt(c):c=Jt(c),c instanceof pi?(y=c.min,P=c.max):y=P=c,y.x>=this.min.x&&P.x<=this.max.x&&y.y>=this.min.y&&P.y<=this.max.y},intersects:function(c){c=Jt(c);var y=this.min,P=this.max,z=c.min,U=c.max,ee=U.x>=y.x&&z.x<=P.x,ve=U.y>=y.y&&z.y<=P.y;return ee&&ve},overlaps:function(c){c=Jt(c);var y=this.min,P=this.max,z=c.min,U=c.max,ee=U.x>y.x&&z.x<P.x,ve=U.y>y.y&&z.y<P.y;return ee&&ve},isValid:function(){return!!(this.min&&this.max)},pad:function(c){var y=this.min,P=this.max,z=Math.abs(y.x-P.x)*c,U=Math.abs(y.y-P.y)*c;return Jt(Yt(y.x-z,y.y-U),Yt(P.x+z,P.y+U))},equals:function(c){return c?(c=Jt(c),this.min.equals(c.getTopLeft())&&this.max.equals(c.getBottomRight())):!1}};function Jt(c,y){return!c||c instanceof pi?c:new pi(c,y)}function Xi(c,y){if(c)for(var P=y?[c,y]:c,z=0,U=P.length;z<U;z++)this.extend(P[z])}Xi.prototype={extend:function(c){var y=this._southWest,P=this._northEast,z,U;if(c instanceof Ai)z=c,U=c;else if(c instanceof Xi){if(z=c._southWest,U=c._northEast,!z||!U)return this}else return c?this.extend(oi(c)||ji(c)):this;return!y&&!P?(this._southWest=new Ai(z.lat,z.lng),this._northEast=new Ai(U.lat,U.lng)):(y.lat=Math.min(z.lat,y.lat),y.lng=Math.min(z.lng,y.lng),P.lat=Math.max(U.lat,P.lat),P.lng=Math.max(U.lng,P.lng)),this},pad:function(c){var y=this._southWest,P=this._northEast,z=Math.abs(y.lat-P.lat)*c,U=Math.abs(y.lng-P.lng)*c;return new Xi(new Ai(y.lat-z,y.lng-U),new Ai(P.lat+z,P.lng+U))},getCenter:function(){return new Ai((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ai(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ai(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(c){typeof c[0]=="number"||c instanceof Ai||"lat"in c?c=oi(c):c=ji(c);var y=this._southWest,P=this._northEast,z,U;return c instanceof Xi?(z=c.getSouthWest(),U=c.getNorthEast()):z=U=c,z.lat>=y.lat&&U.lat<=P.lat&&z.lng>=y.lng&&U.lng<=P.lng},intersects:function(c){c=ji(c);var y=this._southWest,P=this._northEast,z=c.getSouthWest(),U=c.getNorthEast(),ee=U.lat>=y.lat&&z.lat<=P.lat,ve=U.lng>=y.lng&&z.lng<=P.lng;return ee&&ve},overlaps:function(c){c=ji(c);var y=this._southWest,P=this._northEast,z=c.getSouthWest(),U=c.getNorthEast(),ee=U.lat>y.lat&&z.lat<P.lat,ve=U.lng>y.lng&&z.lng<P.lng;return ee&&ve},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(c,y){return c?(c=ji(c),this._southWest.equals(c.getSouthWest(),y)&&this._northEast.equals(c.getNorthEast(),y)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ji(c,y){return c instanceof Xi?c:new Xi(c,y)}function Ai(c,y,P){if(isNaN(c)||isNaN(y))throw new Error("Invalid LatLng object: ("+c+", "+y+")");this.lat=+c,this.lng=+y,P!==void 0&&(this.alt=+P)}Ai.prototype={equals:function(c,y){if(!c)return!1;c=oi(c);var P=Math.max(Math.abs(this.lat-c.lat),Math.abs(this.lng-c.lng));return P<=(y===void 0?1e-9:y)},toString:function(c){return"LatLng("+X(this.lat,c)+", "+X(this.lng,c)+")"},distanceTo:function(c){return fr.distance(this,oi(c))},wrap:function(){return fr.wrapLatLng(this)},toBounds:function(c){var y=180*c/40075017,P=y/Math.cos(Math.PI/180*this.lat);return ji([this.lat-y,this.lng-P],[this.lat+y,this.lng+P])},clone:function(){return new Ai(this.lat,this.lng,this.alt)}};function oi(c,y,P){return c instanceof Ai?c:Fe(c)&&typeof c[0]!="object"?c.length===3?new Ai(c[0],c[1],c[2]):c.length===2?new Ai(c[0],c[1]):null:c==null?c:typeof c=="object"&&"lat"in c?new Ai(c.lat,"lng"in c?c.lng:c.lon,c.alt):y===void 0?null:new Ai(c,y,P)}var On={latLngToPoint:function(c,y){var P=this.projection.project(c),z=this.scale(y);return this.transformation._transform(P,z)},pointToLatLng:function(c,y){var P=this.scale(y),z=this.transformation.untransform(c,P);return this.projection.unproject(z)},project:function(c){return this.projection.project(c)},unproject:function(c){return this.projection.unproject(c)},scale:function(c){return 256*Math.pow(2,c)},zoom:function(c){return Math.log(c/256)/Math.LN2},getProjectedBounds:function(c){if(this.infinite)return null;var y=this.projection.bounds,P=this.scale(c),z=this.transformation.transform(y.min,P),U=this.transformation.transform(y.max,P);return new pi(z,U)},infinite:!1,wrapLatLng:function(c){var y=this.wrapLng?O(c.lng,this.wrapLng,!0):c.lng,P=this.wrapLat?O(c.lat,this.wrapLat,!0):c.lat,z=c.alt;return new Ai(P,y,z)},wrapLatLngBounds:function(c){var y=c.getCenter(),P=this.wrapLatLng(y),z=y.lat-P.lat,U=y.lng-P.lng;if(z===0&&U===0)return c;var ee=c.getSouthWest(),ve=c.getNorthEast(),Oe=new Ai(ee.lat-z,ee.lng-U),Ge=new Ai(ve.lat-z,ve.lng-U);return new Xi(Oe,Ge)}},fr=m({},On,{wrapLng:[-180,180],R:6371e3,distance:function(c,y){var P=Math.PI/180,z=c.lat*P,U=y.lat*P,ee=Math.sin((y.lat-c.lat)*P/2),ve=Math.sin((y.lng-c.lng)*P/2),Oe=ee*ee+Math.cos(z)*Math.cos(U)*ve*ve,Ge=2*Math.atan2(Math.sqrt(Oe),Math.sqrt(1-Oe));return this.R*Ge}}),dn=6378137,Fr={R:dn,MAX_LATITUDE:85.0511287798,project:function(c){var y=Math.PI/180,P=this.MAX_LATITUDE,z=Math.max(Math.min(P,c.lat),-P),U=Math.sin(z*y);return new It(this.R*c.lng*y,this.R*Math.log((1+U)/(1-U))/2)},unproject:function(c){var y=180/Math.PI;return new Ai((2*Math.atan(Math.exp(c.y/this.R))-Math.PI/2)*y,c.x*y/this.R)},bounds:function(){var c=dn*Math.PI;return new pi([-c,-c],[c,c])}()};function er(c,y,P,z){if(Fe(c)){this._a=c[0],this._b=c[1],this._c=c[2],this._d=c[3];return}this._a=c,this._b=y,this._c=P,this._d=z}er.prototype={transform:function(c,y){return this._transform(c.clone(),y)},_transform:function(c,y){return y=y||1,c.x=y*(this._a*c.x+this._b),c.y=y*(this._c*c.y+this._d),c},untransform:function(c,y){return y=y||1,new It((c.x/y-this._b)/this._a,(c.y/y-this._d)/this._c)}};function ye(c,y,P,z){return new er(c,y,P,z)}var Pe=m({},fr,{code:"EPSG:3857",projection:Fr,transformation:function(){var c=.5/(Math.PI*Fr.R);return ye(c,.5,-c,.5)}()}),Ke=m({},Pe,{code:"EPSG:900913"});function ct(c){return document.createElementNS("http://www.w3.org/2000/svg",c)}function at(c,y){var P="",z,U,ee,ve,Oe,Ge;for(z=0,ee=c.length;z<ee;z++){for(Oe=c[z],U=0,ve=Oe.length;U<ve;U++)Ge=Oe[U],P+=(U?"L":"M")+Ge.x+" "+Ge.y;P+=y?yt.svg?"z":"x":""}return P||"M0 0"}var nt=document.documentElement.style,xt="ActiveXObject"in window,_t=xt&&!document.addEventListener,wt="msLaunchUri"in navigator&&!("documentMode"in document),dt=Nt("webkit"),$t=Nt("android"),Pt=Nt("android 2")||Nt("android 3"),Ft=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Qt=$t&&Nt("Google")&&Ft<537&&!("AudioNode"in window),si=!!window.opera,yi=!wt&&Nt("chrome"),vi=Nt("gecko")&&!dt&&!si&&!xt,In=!yi&&Nt("safari"),An=Nt("phantom"),wn="OTransition"in nt,Ee=navigator.platform.indexOf("Win")===0,J=xt&&"transition"in nt,Q="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Pt,ie="MozPerspective"in nt,he=!window.L_DISABLE_3D&&(J||Q||ie)&&!wn&&!An,Te=typeof orientation<"u"||Nt("mobile"),Le=Te&&dt,je=Te&&Q,Ie=!window.PointerEvent&&window.MSPointerEvent,He=!!(window.PointerEvent||Ie),qe="ontouchstart"in window||!!window.TouchEvent,Re=!window.L_NO_TOUCH&&(qe||He),Je=Te&&si,Se=Te&&vi,Tt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Wt=function(){var c=!1;try{var y=Object.defineProperty({},"passive",{get:function(){c=!0}});window.addEventListener("testPassiveEventSupport",$,y),window.removeEventListener("testPassiveEventSupport",$,y)}catch{}return c}(),Ct=function(){return!!document.createElement("canvas").getContext}(),Bt=!!(document.createElementNS&&ct("svg").createSVGRect),ei=!!Bt&&function(){var c=document.createElement("div");return c.innerHTML="<svg/>",(c.firstChild&&c.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Yi=!Bt&&function(){try{var c=document.createElement("div");c.innerHTML='<v:shape adj="1"/>';var y=c.firstChild;return y.style.behavior="url(#default#VML)",y&&typeof y.adj=="object"}catch{return!1}}(),Ui=navigator.platform.indexOf("Mac")===0,Oi=navigator.platform.indexOf("Linux")===0;function Nt(c){return navigator.userAgent.toLowerCase().indexOf(c)>=0}var yt={ie:xt,ielt9:_t,edge:wt,webkit:dt,android:$t,android23:Pt,androidStock:Qt,opera:si,chrome:yi,gecko:vi,safari:In,phantom:An,opera12:wn,win:Ee,ie3d:J,webkit3d:Q,gecko3d:ie,any3d:he,mobile:Te,mobileWebkit:Le,mobileWebkit3d:je,msPointer:Ie,pointer:He,touch:Re,touchNative:qe,mobileOpera:Je,mobileGecko:Se,retina:Tt,passiveEvents:Wt,canvas:Ct,svg:Bt,vml:Yi,inlineSvg:ei,mac:Ui,linux:Oi},Fn=yt.msPointer?"MSPointerDown":"pointerdown",ft=yt.msPointer?"MSPointerMove":"pointermove",Un=yt.msPointer?"MSPointerUp":"pointerup",ln=yt.msPointer?"MSPointerCancel":"pointercancel",wo={touchstart:Fn,touchmove:ft,touchend:Un,touchcancel:ln},ls={touchstart:Tn,touchmove:So,touchend:So,touchcancel:So},mt={},ci=!1;function fi(c,y,P){return y==="touchstart"&&Bo(),ls[y]?(P=ls[y].bind(this,P),c.addEventListener(wo[y],P,!1),P):(console.warn("wrong event specified:",y),$)}function Br(c,y,P){if(!wo[y]){console.warn("wrong event specified:",y);return}c.removeEventListener(wo[y],P,!1)}function Dl(c){mt[c.pointerId]=c}function To(c){mt[c.pointerId]&&(mt[c.pointerId]=c)}function ui(c){delete mt[c.pointerId]}function Bo(){ci||(document.addEventListener(Fn,Dl,!0),document.addEventListener(ft,To,!0),document.addEventListener(Un,ui,!0),document.addEventListener(ln,ui,!0),ci=!0)}function So(c,y){if(y.pointerType!==(y.MSPOINTER_TYPE_MOUSE||"mouse")){y.touches=[];for(var P in mt)y.touches.push(mt[P]);y.changedTouches=[y],c(y)}}function Tn(c,y){y.MSPOINTER_TYPE_TOUCH&&y.pointerType===y.MSPOINTER_TYPE_TOUCH&&Vt(y),So(c,y)}function Ka(c){var y={},P,z;for(z in c)P=c[z],y[z]=P&&P.bind?P.bind(c):P;return c=y,y.type="dblclick",y.detail=2,y.isTrusted=!1,y._simulated=!0,y}var Xa=200;function No(c,y){c.addEventListener("dblclick",y);var P=0,z;function U(ee){if(ee.detail!==1){z=ee.detail;return}if(!(ee.pointerType==="mouse"||ee.sourceCapabilities&&!ee.sourceCapabilities.firesTouchEvents)){var ve=Kt(ee);if(!(ve.some(function(Ge){return Ge instanceof HTMLLabelElement&&Ge.attributes.for})&&!ve.some(function(Ge){return Ge instanceof HTMLInputElement||Ge instanceof HTMLSelectElement}))){var Oe=Date.now();Oe-P<=Xa?(z++,z===2&&y(Ka(ee))):z=1,P=Oe}}}return c.addEventListener("click",U),{dblclick:y,simDblclick:U}}function Ya(c,y){c.removeEventListener("dblclick",y.dblclick),c.removeEventListener("click",y.simDblclick)}var mr=ua(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ki=ua(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Cc=Ki==="webkitTransition"||Ki==="OTransition"?Ki+"End":"transitionend";function la(c){return typeof c=="string"?document.getElementById(c):c}function cs(c,y){var P=c.style[y]||c.currentStyle&&c.currentStyle[y];if((!P||P==="auto")&&document.defaultView){var z=document.defaultView.getComputedStyle(c,null);P=z?z[y]:null}return P==="auto"?null:P}function Si(c,y,P){var z=document.createElement(c);return z.className=y||"",P&&P.appendChild(z),z}function qi(c){var y=c.parentNode;y&&y.removeChild(c)}function Ja(c){for(;c.firstChild;)c.removeChild(c.firstChild)}function ks(c){var y=c.parentNode;y&&y.lastChild!==c&&y.appendChild(c)}function zs(c){var y=c.parentNode;y&&y.firstChild!==c&&y.insertBefore(c,y.firstChild)}function us(c,y){if(c.classList!==void 0)return c.classList.contains(y);var P=Ol(c);return P.length>0&&new RegExp("(^|\\s)"+y+"(\\s|$)").test(P)}function xi(c,y){if(c.classList!==void 0)for(var P=te(y),z=0,U=P.length;z<U;z++)c.classList.add(P[z]);else if(!us(c,y)){var ee=Ol(c);Rs(c,(ee?ee+" ":"")+y)}}function gn(c,y){c.classList!==void 0?c.classList.remove(y):Rs(c,q((" "+Ol(c)+" ").replace(" "+y+" "," ")))}function Rs(c,y){c.className.baseVal===void 0?c.className=y:c.className.baseVal=y}function Ol(c){return c.correspondingElement&&(c=c.correspondingElement),c.className.baseVal===void 0?c.className:c.className.baseVal}function Nr(c,y){"opacity"in c.style?c.style.opacity=y:"filter"in c.style&&ca(c,y)}function ca(c,y){var P=!1,z="DXImageTransform.Microsoft.Alpha";try{P=c.filters.item(z)}catch{if(y===1)return}y=Math.round(y*100),P?(P.Enabled=y!==100,P.Opacity=y):c.style.filter+=" progid:"+z+"(opacity="+y+")"}function ua(c){for(var y=document.documentElement.style,P=0;P<c.length;P++)if(c[P]in y)return c[P];return!1}function jo(c,y,P){var z=y||new It(0,0);c.style[mr]=(yt.ie3d?"translate("+z.x+"px,"+z.y+"px)":"translate3d("+z.x+"px,"+z.y+"px,0)")+(P?" scale("+P+")":"")}function Sn(c,y){c._leaflet_pos=y,yt.any3d?jo(c,y):(c.style.left=y.x+"px",c.style.top=y.y+"px")}function Po(c){return c._leaflet_pos||new It(0,0)}var hs,Ar,mi;if("onselectstart"in document)hs=function(){hi(window,"selectstart",Vt)},Ar=function(){li(window,"selectstart",Vt)};else{var jr=ua(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);hs=function(){if(jr){var c=document.documentElement.style;mi=c[jr],c[jr]="none"}},Ar=function(){jr&&(document.documentElement.style[jr]=mi,mi=void 0)}}function co(){hi(window,"dragstart",Vt)}function Uo(){li(window,"dragstart",Vt)}var ha,Qa;function Lr(c){for(;c.tabIndex===-1;)c=c.parentNode;c.style&&(Qr(),ha=c,Qa=c.style.outlineStyle,c.style.outlineStyle="none",hi(window,"keydown",Qr))}function Qr(){ha&&(ha.style.outlineStyle=Qa,ha=void 0,Qa=void 0,li(window,"keydown",Qr))}function bi(c){do c=c.parentNode;while((!c.offsetWidth||!c.offsetHeight)&&c!==document.body);return c}function Ds(c){var y=c.getBoundingClientRect();return{x:y.width/c.offsetWidth||1,y:y.height/c.offsetHeight||1,boundingClientRect:y}}var Fl={__proto__:null,TRANSFORM:mr,TRANSITION:Ki,TRANSITION_END:Cc,get:la,getStyle:cs,create:Si,remove:qi,empty:Ja,toFront:ks,toBack:zs,hasClass:us,addClass:xi,removeClass:gn,setClass:Rs,getClass:Ol,setOpacity:Nr,testProp:ua,setTransform:jo,setPosition:Sn,getPosition:Po,get disableTextSelection(){return hs},get enableTextSelection(){return Ar},disableImageDrag:co,enableImageDrag:Uo,preventOutline:Lr,restoreOutline:Qr,getSizedParentNode:bi,getScale:Ds};function hi(c,y,P,z){if(y&&typeof y=="object")for(var U in y)tn(c,U,y[U],P);else{y=te(y);for(var ee=0,ve=y.length;ee<ve;ee++)tn(c,y[ee],P,z)}return this}var cn="_leaflet_events";function li(c,y,P,z){if(arguments.length===1)Gn(c),delete c[cn];else if(y&&typeof y=="object")for(var U in y)da(c,U,y[U],P);else if(y=te(y),arguments.length===2)Gn(c,function(Oe){return xe(y,Oe)!==-1});else for(var ee=0,ve=y.length;ee<ve;ee++)da(c,y[ee],P,z);return this}function Gn(c,y){for(var P in c[cn]){var z=P.split(/\d/)[0];(!y||y(z))&&da(c,z,null,null,P)}}var Ln={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function tn(c,y,P,z){var U=y+E(P)+(z?"_"+E(z):"");if(c[cn]&&c[cn][U])return this;var ee=function(Oe){return P.call(z||c,Oe||window.event)},ve=ee;!yt.touchNative&&yt.pointer&&y.indexOf("touch")===0?ee=fi(c,y,ee):yt.touch&&y==="dblclick"?ee=No(c,ee):"addEventListener"in c?y==="touchstart"||y==="touchmove"||y==="wheel"||y==="mousewheel"?c.addEventListener(Ln[y]||y,ee,yt.passiveEvents?{passive:!1}:!1):y==="mouseenter"||y==="mouseleave"?(ee=function(Oe){Oe=Oe||window.event,ir(c,Oe)&&ve(Oe)},c.addEventListener(Ln[y],ee,!1)):c.addEventListener(y,ve,!1):c.attachEvent("on"+y,ee),c[cn]=c[cn]||{},c[cn][U]=ee}function da(c,y,P,z,U){U=U||y+E(P)+(z?"_"+E(z):"");var ee=c[cn]&&c[cn][U];if(!ee)return this;!yt.touchNative&&yt.pointer&&y.indexOf("touch")===0?Br(c,y,ee):yt.touch&&y==="dblclick"?Ya(c,ee):"removeEventListener"in c?c.removeEventListener(Ln[y]||y,ee,!1):c.detachEvent("on"+y,ee),c[cn][U]=null}function di(c){return c.stopPropagation?c.stopPropagation():c.originalEvent?c.originalEvent._stopped=!0:c.cancelBubble=!0,this}function tr(c){return tn(c,"wheel",di),this}function ti(c){return hi(c,"mousedown touchstart dblclick contextmenu",di),c._leaflet_disable_click=!0,this}function Vt(c){return c.preventDefault?c.preventDefault():c.returnValue=!1,this}function Ur(c){return Vt(c),di(c),this}function Kt(c){if(c.composedPath)return c.composedPath();for(var y=[],P=c.target;P;)y.push(P),P=P.parentNode;return y}function ds(c,y){if(!y)return new It(c.clientX,c.clientY);var P=Ds(y),z=P.boundingClientRect;return new It((c.clientX-z.left)/P.x-y.clientLeft,(c.clientY-z.top)/P.y-y.clientTop)}var gr=yt.linux&&yt.chrome?window.devicePixelRatio:yt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Os(c){return yt.edge?c.wheelDeltaY/2:c.deltaY&&c.deltaMode===0?-c.deltaY/gr:c.deltaY&&c.deltaMode===1?-c.deltaY*20:c.deltaY&&c.deltaMode===2?-c.deltaY*60:c.deltaX||c.deltaZ?0:c.wheelDelta?(c.wheelDeltaY||c.wheelDelta)/2:c.detail&&Math.abs(c.detail)<32765?-c.detail*20:c.detail?c.detail/-32765*60:0}function ir(c,y){var P=y.relatedTarget;if(!P)return!0;try{for(;P&&P!==c;)P=P.parentNode}catch{return!1}return P!==c}var Mc={__proto__:null,on:hi,off:li,stopPropagation:di,disableScrollPropagation:tr,disableClickPropagation:ti,preventDefault:Vt,stop:Ur,getPropagationPath:Kt,getMousePosition:ds,getWheelDelta:Os,isExternalTarget:ir,addListener:hi,removeListener:li},uo=ri.extend({run:function(c,y,P,z){this.stop(),this._el=c,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(z||.5,.2),this._startPos=Po(c),this._offset=y.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=At(this._animate,this),this._step()},_step:function(c){var y=+new Date-this._startTime,P=this._duration*1e3;y<P?this._runFrame(this._easeOut(y/P),c):(this._runFrame(1),this._complete())},_runFrame:function(c,y){var P=this._startPos.add(this._offset.multiplyBy(c));y&&P._round(),Sn(this._el,P),this.fire("step")},_complete:function(){lt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(c){return 1-Math.pow(1-c,this._easeOutPower)}}),zi=ri.extend({options:{crs:Pe,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(c,y){y=ce(this,y),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(c),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),y.maxBounds&&this.setMaxBounds(y.maxBounds),y.zoom!==void 0&&(this._zoom=this._limitZoom(y.zoom)),y.center&&y.zoom!==void 0&&this.setView(oi(y.center),y.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ki&&yt.any3d&&!yt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),hi(this._proxy,Cc,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(c,y,P){if(y=y===void 0?this._zoom:this._limitZoom(y),c=this._limitCenter(oi(c),y,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=m({animate:P.animate},P.zoom),P.pan=m({animate:P.animate,duration:P.duration},P.pan));var z=this._zoom!==y?this._tryAnimatedZoom&&this._tryAnimatedZoom(c,y,P.zoom):this._tryAnimatedPan(c,P.pan);if(z)return clearTimeout(this._sizeTimer),this}return this._resetView(c,y,P.pan&&P.pan.noMoveStart),this},setZoom:function(c,y){return this._loaded?this.setView(this.getCenter(),c,{zoom:y}):(this._zoom=c,this)},zoomIn:function(c,y){return c=c||(yt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+c,y)},zoomOut:function(c,y){return c=c||(yt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-c,y)},setZoomAround:function(c,y,P){var z=this.getZoomScale(y),U=this.getSize().divideBy(2),ee=c instanceof It?c:this.latLngToContainerPoint(c),ve=ee.subtract(U).multiplyBy(1-1/z),Oe=this.containerPointToLatLng(U.add(ve));return this.setView(Oe,y,{zoom:P})},_getBoundsCenterZoom:function(c,y){y=y||{},c=c.getBounds?c.getBounds():ji(c);var P=Yt(y.paddingTopLeft||y.padding||[0,0]),z=Yt(y.paddingBottomRight||y.padding||[0,0]),U=this.getBoundsZoom(c,!1,P.add(z));if(U=typeof y.maxZoom=="number"?Math.min(y.maxZoom,U):U,U===1/0)return{center:c.getCenter(),zoom:U};var ee=z.subtract(P).divideBy(2),ve=this.project(c.getSouthWest(),U),Oe=this.project(c.getNorthEast(),U),Ge=this.unproject(ve.add(Oe).divideBy(2).add(ee),U);return{center:Ge,zoom:U}},fitBounds:function(c,y){if(c=ji(c),!c.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(c,y);return this.setView(P.center,P.zoom,y)},fitWorld:function(c){return this.fitBounds([[-90,-180],[90,180]],c)},panTo:function(c,y){return this.setView(c,this._zoom,{pan:y})},panBy:function(c,y){if(c=Yt(c).round(),y=y||{},!c.x&&!c.y)return this.fire("moveend");if(y.animate!==!0&&!this.getSize().contains(c))return this._resetView(this.unproject(this.project(this.getCenter()).add(c)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new uo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),y.noMoveStart||this.fire("movestart"),y.animate!==!1){xi(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(c).round();this._panAnim.run(this._mapPane,P,y.duration||.25,y.easeLinearity)}else this._rawPanBy(c),this.fire("move").fire("moveend");return this},flyTo:function(c,y,P){if(P=P||{},P.animate===!1||!yt.any3d)return this.setView(c,y,P);this._stop();var z=this.project(this.getCenter()),U=this.project(c),ee=this.getSize(),ve=this._zoom;c=oi(c),y=y===void 0?ve:y;var Oe=Math.max(ee.x,ee.y),Ge=Oe*this.getZoomScale(ve,y),st=U.distanceTo(z)||1,Lt=1.42,Ht=Lt*Lt;function Pi($i){var qs=$i?-1:1,gl=$i?Ge:Oe,Sa=Ge*Ge-Oe*Oe+qs*Ht*Ht*st*st,Pa=2*gl*Ht*st,_l=Sa/Pa,Ca=Math.sqrt(_l*_l+1)-_l,$c=Ca<1e-9?-18:Math.log(Ca);return $c}function or($i){return(Math.exp($i)-Math.exp(-$i))/2}function Pn($i){return(Math.exp($i)+Math.exp(-$i))/2}function zr($i){return or($i)/Pn($i)}var xr=Pi(0);function Zs($i){return Oe*(Pn(xr)/Pn(xr+Lt*$i))}function ml($i){return Oe*(Pn(xr)*zr(xr+Lt*$i)-or(xr))/Ht}function Kl($i){return 1-Math.pow(1-$i,1.5)}var Xl=Date.now(),Uc=(Pi(1)-xr)/Lt,pn=P.duration?1e3*P.duration:1e3*Uc*.8;function Go(){var $i=(Date.now()-Xl)/pn,qs=Kl($i)*Uc;$i<=1?(this._flyToFrame=At(Go,this),this._move(this.unproject(z.add(U.subtract(z).multiplyBy(ml(qs)/st)),ve),this.getScaleZoom(Oe/Zs(qs),ve),{flyTo:!0})):this._move(c,y)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),Go.call(this),this},flyToBounds:function(c,y){var P=this._getBoundsCenterZoom(c,y);return this.flyTo(P.center,P.zoom,y)},setMaxBounds:function(c){return c=ji(c),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),c.isValid()?(this.options.maxBounds=c,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(c){var y=this.options.minZoom;return this.options.minZoom=c,this._loaded&&y!==c&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(c):this},setMaxZoom:function(c){var y=this.options.maxZoom;return this.options.maxZoom=c,this._loaded&&y!==c&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(c):this},panInsideBounds:function(c,y){this._enforcingBounds=!0;var P=this.getCenter(),z=this._limitCenter(P,this._zoom,ji(c));return P.equals(z)||this.panTo(z,y),this._enforcingBounds=!1,this},panInside:function(c,y){y=y||{};var P=Yt(y.paddingTopLeft||y.padding||[0,0]),z=Yt(y.paddingBottomRight||y.padding||[0,0]),U=this.project(this.getCenter()),ee=this.project(c),ve=this.getPixelBounds(),Oe=Jt([ve.min.add(P),ve.max.subtract(z)]),Ge=Oe.getSize();if(!Oe.contains(ee)){this._enforcingBounds=!0;var st=ee.subtract(Oe.getCenter()),Lt=Oe.extend(ee).getSize().subtract(Ge);U.x+=st.x<0?-Lt.x:Lt.x,U.y+=st.y<0?-Lt.y:Lt.y,this.panTo(this.unproject(U),y),this._enforcingBounds=!1}return this},invalidateSize:function(c){if(!this._loaded)return this;c=m({animate:!1,pan:!0},c===!0?{animate:!0}:c);var y=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),z=y.divideBy(2).round(),U=P.divideBy(2).round(),ee=z.subtract(U);return!ee.x&&!ee.y?this:(c.animate&&c.pan?this.panBy(ee):(c.pan&&this._rawPanBy(ee),this.fire("move"),c.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:y,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(c){if(c=this._locateOptions=m({timeout:1e4,watch:!1},c),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var y=g(this._handleGeolocationResponse,this),P=g(this._handleGeolocationError,this);return c.watch?this._locationWatchId=navigator.geolocation.watchPosition(y,P,c):navigator.geolocation.getCurrentPosition(y,P,c),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(c){if(this._container._leaflet_id){var y=c.code,P=c.message||(y===1?"permission denied":y===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:y,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(c){if(this._container._leaflet_id){var y=c.coords.latitude,P=c.coords.longitude,z=new Ai(y,P),U=z.toBounds(c.coords.accuracy*2),ee=this._locateOptions;if(ee.setView){var ve=this.getBoundsZoom(U);this.setView(z,ee.maxZoom?Math.min(ve,ee.maxZoom):ve)}var Oe={latlng:z,bounds:U,timestamp:c.timestamp};for(var Ge in c.coords)typeof c.coords[Ge]=="number"&&(Oe[Ge]=c.coords[Ge]);this.fire("locationfound",Oe)}},addHandler:function(c,y){if(!y)return this;var P=this[c]=new y(this);return this._handlers.push(P),this.options[c]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),qi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(lt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var c;for(c in this._layers)this._layers[c].remove();for(c in this._panes)qi(this._panes[c]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(c,y){var P="leaflet-pane"+(c?" leaflet-"+c.replace("Pane","")+"-pane":""),z=Si("div",P,y||this._mapPane);return c&&(this._panes[c]=z),z},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var c=this.getPixelBounds(),y=this.unproject(c.getBottomLeft()),P=this.unproject(c.getTopRight());return new Xi(y,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(c,y,P){c=ji(c),P=Yt(P||[0,0]);var z=this.getZoom()||0,U=this.getMinZoom(),ee=this.getMaxZoom(),ve=c.getNorthWest(),Oe=c.getSouthEast(),Ge=this.getSize().subtract(P),st=Jt(this.project(Oe,z),this.project(ve,z)).getSize(),Lt=yt.any3d?this.options.zoomSnap:1,Ht=Ge.x/st.x,Pi=Ge.y/st.y,or=y?Math.max(Ht,Pi):Math.min(Ht,Pi);return z=this.getScaleZoom(or,z),Lt&&(z=Math.round(z/(Lt/100))*(Lt/100),z=y?Math.ceil(z/Lt)*Lt:Math.floor(z/Lt)*Lt),Math.max(U,Math.min(ee,z))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new It(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(c,y){var P=this._getTopLeftPoint(c,y);return new pi(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(c){return this.options.crs.getProjectedBounds(c===void 0?this.getZoom():c)},getPane:function(c){return typeof c=="string"?this._panes[c]:c},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(c,y){var P=this.options.crs;return y=y===void 0?this._zoom:y,P.scale(c)/P.scale(y)},getScaleZoom:function(c,y){var P=this.options.crs;y=y===void 0?this._zoom:y;var z=P.zoom(c*P.scale(y));return isNaN(z)?1/0:z},project:function(c,y){return y=y===void 0?this._zoom:y,this.options.crs.latLngToPoint(oi(c),y)},unproject:function(c,y){return y=y===void 0?this._zoom:y,this.options.crs.pointToLatLng(Yt(c),y)},layerPointToLatLng:function(c){var y=Yt(c).add(this.getPixelOrigin());return this.unproject(y)},latLngToLayerPoint:function(c){var y=this.project(oi(c))._round();return y._subtract(this.getPixelOrigin())},wrapLatLng:function(c){return this.options.crs.wrapLatLng(oi(c))},wrapLatLngBounds:function(c){return this.options.crs.wrapLatLngBounds(ji(c))},distance:function(c,y){return this.options.crs.distance(oi(c),oi(y))},containerPointToLayerPoint:function(c){return Yt(c).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(c){return Yt(c).add(this._getMapPanePos())},containerPointToLatLng:function(c){var y=this.containerPointToLayerPoint(Yt(c));return this.layerPointToLatLng(y)},latLngToContainerPoint:function(c){return this.layerPointToContainerPoint(this.latLngToLayerPoint(oi(c)))},mouseEventToContainerPoint:function(c){return ds(c,this._container)},mouseEventToLayerPoint:function(c){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(c))},mouseEventToLatLng:function(c){return this.layerPointToLatLng(this.mouseEventToLayerPoint(c))},_initContainer:function(c){var y=this._container=la(c);if(y){if(y._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");hi(y,"scroll",this._onScroll,this),this._containerId=E(y)},_initLayout:function(){var c=this._container;this._fadeAnimated=this.options.fadeAnimation&&yt.any3d,xi(c,"leaflet-container"+(yt.touch?" leaflet-touch":"")+(yt.retina?" leaflet-retina":"")+(yt.ielt9?" leaflet-oldie":"")+(yt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var y=cs(c,"position");y!=="absolute"&&y!=="relative"&&y!=="fixed"&&y!=="sticky"&&(c.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var c=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Sn(this._mapPane,new It(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(xi(c.markerPane,"leaflet-zoom-hide"),xi(c.shadowPane,"leaflet-zoom-hide"))},_resetView:function(c,y,P){Sn(this._mapPane,new It(0,0));var z=!this._loaded;this._loaded=!0,y=this._limitZoom(y),this.fire("viewprereset");var U=this._zoom!==y;this._moveStart(U,P)._move(c,y)._moveEnd(U),this.fire("viewreset"),z&&this.fire("load")},_moveStart:function(c,y){return c&&this.fire("zoomstart"),y||this.fire("movestart"),this},_move:function(c,y,P,z){y===void 0&&(y=this._zoom);var U=this._zoom!==y;return this._zoom=y,this._lastCenter=c,this._pixelOrigin=this._getNewPixelOrigin(c),z?P&&P.pinch&&this.fire("zoom",P):((U||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(c){return c&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return lt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(c){Sn(this._mapPane,this._getMapPanePos().subtract(c))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(c){this._targets={},this._targets[E(this._container)]=this;var y=c?li:hi;y(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&y(window,"resize",this._onResize,this),yt.any3d&&this.options.transform3DLimit&&(c?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){lt(this._resizeRequest),this._resizeRequest=At(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var c=this._getMapPanePos();Math.max(Math.abs(c.x),Math.abs(c.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(c,y){for(var P=[],z,U=y==="mouseout"||y==="mouseover",ee=c.target||c.srcElement,ve=!1;ee;){if(z=this._targets[E(ee)],z&&(y==="click"||y==="preclick")&&this._draggableMoved(z)){ve=!0;break}if(z&&z.listens(y,!0)&&(U&&!ir(ee,c)||(P.push(z),U))||ee===this._container)break;ee=ee.parentNode}return!P.length&&!ve&&!U&&this.listens(y,!0)&&(P=[this]),P},_isClickDisabled:function(c){for(;c&&c!==this._container;){if(c._leaflet_disable_click)return!0;c=c.parentNode}},_handleDOMEvent:function(c){var y=c.target||c.srcElement;if(!(!this._loaded||y._leaflet_disable_events||c.type==="click"&&this._isClickDisabled(y))){var P=c.type;P==="mousedown"&&Lr(y),this._fireDOMEvent(c,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(c,y,P){if(c.type==="click"){var z=m({},c);z.type="preclick",this._fireDOMEvent(z,z.type,P)}var U=this._findEventTargets(c,y);if(P){for(var ee=[],ve=0;ve<P.length;ve++)P[ve].listens(y,!0)&&ee.push(P[ve]);U=ee.concat(U)}if(U.length){y==="contextmenu"&&Vt(c);var Oe=U[0],Ge={originalEvent:c};if(c.type!=="keypress"&&c.type!=="keydown"&&c.type!=="keyup"){var st=Oe.getLatLng&&(!Oe._radius||Oe._radius<=10);Ge.containerPoint=st?this.latLngToContainerPoint(Oe.getLatLng()):this.mouseEventToContainerPoint(c),Ge.layerPoint=this.containerPointToLayerPoint(Ge.containerPoint),Ge.latlng=st?Oe.getLatLng():this.layerPointToLatLng(Ge.layerPoint)}for(ve=0;ve<U.length;ve++)if(U[ve].fire(y,Ge,!0),Ge.originalEvent._stopped||U[ve].options.bubblingMouseEvents===!1&&xe(this._mouseEvents,y)!==-1)return}},_draggableMoved:function(c){return c=c.dragging&&c.dragging.enabled()?c:this,c.dragging&&c.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var c=0,y=this._handlers.length;c<y;c++)this._handlers[c].disable()},whenReady:function(c,y){return this._loaded?c.call(y||this,{target:this}):this.on("load",c,y),this},_getMapPanePos:function(){return Po(this._mapPane)||new It(0,0)},_moved:function(){var c=this._getMapPanePos();return c&&!c.equals([0,0])},_getTopLeftPoint:function(c,y){var P=c&&y!==void 0?this._getNewPixelOrigin(c,y):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(c,y){var P=this.getSize()._divideBy(2);return this.project(c,y)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(c,y,P){var z=this._getNewPixelOrigin(P,y);return this.project(c,y)._subtract(z)},_latLngBoundsToNewLayerBounds:function(c,y,P){var z=this._getNewPixelOrigin(P,y);return Jt([this.project(c.getSouthWest(),y)._subtract(z),this.project(c.getNorthWest(),y)._subtract(z),this.project(c.getSouthEast(),y)._subtract(z),this.project(c.getNorthEast(),y)._subtract(z)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(c){return this.latLngToLayerPoint(c).subtract(this._getCenterLayerPoint())},_limitCenter:function(c,y,P){if(!P)return c;var z=this.project(c,y),U=this.getSize().divideBy(2),ee=new pi(z.subtract(U),z.add(U)),ve=this._getBoundsOffset(ee,P,y);return Math.abs(ve.x)<=1&&Math.abs(ve.y)<=1?c:this.unproject(z.add(ve),y)},_limitOffset:function(c,y){if(!y)return c;var P=this.getPixelBounds(),z=new pi(P.min.add(c),P.max.add(c));return c.add(this._getBoundsOffset(z,y))},_getBoundsOffset:function(c,y,P){var z=Jt(this.project(y.getNorthEast(),P),this.project(y.getSouthWest(),P)),U=z.min.subtract(c.min),ee=z.max.subtract(c.max),ve=this._rebound(U.x,-ee.x),Oe=this._rebound(U.y,-ee.y);return new It(ve,Oe)},_rebound:function(c,y){return c+y>0?Math.round(c-y)/2:Math.max(0,Math.ceil(c))-Math.max(0,Math.floor(y))},_limitZoom:function(c){var y=this.getMinZoom(),P=this.getMaxZoom(),z=yt.any3d?this.options.zoomSnap:1;return z&&(c=Math.round(c/z)*z),Math.max(y,Math.min(P,c))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){gn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(c,y){var P=this._getCenterOffset(c)._trunc();return(y&&y.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,y),!0)},_createAnimProxy:function(){var c=this._proxy=Si("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(c),this.on("zoomanim",function(y){var P=mr,z=this._proxy.style[P];jo(this._proxy,this.project(y.center,y.zoom),this.getZoomScale(y.zoom,1)),z===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){qi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var c=this.getCenter(),y=this.getZoom();jo(this._proxy,this.project(c,y),this.getZoomScale(y,1))},_catchTransitionEnd:function(c){this._animatingZoom&&c.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(c,y,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(y-this._zoom)>this.options.zoomAnimationThreshold)return!1;var z=this.getZoomScale(y),U=this._getCenterOffset(c)._divideBy(1-1/z);return P.animate!==!0&&!this.getSize().contains(U)?!1:(At(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(c,y,!0)},this),!0)},_animateZoom:function(c,y,P,z){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=c,this._animateToZoom=y,xi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:c,zoom:y,noUpdate:z}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&gn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ru(c,y){return new zi(c,y)}var _r=jt.extend({options:{position:"topright"},initialize:function(c){ce(this,c)},getPosition:function(){return this.options.position},setPosition:function(c){var y=this._map;return y&&y.removeControl(this),this.options.position=c,y&&y.addControl(this),this},getContainer:function(){return this._container},addTo:function(c){this.remove(),this._map=c;var y=this._container=this.onAdd(c),P=this.getPosition(),z=c._controlCorners[P];return xi(y,"leaflet-control"),P.indexOf("bottom")!==-1?z.insertBefore(y,z.firstChild):z.appendChild(y),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(qi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(c){this._map&&c&&c.screenX>0&&c.screenY>0&&this._map.getContainer().focus()}}),$o=function(c){return new _r(c)};zi.include({addControl:function(c){return c.addTo(this),this},removeControl:function(c){return c.remove(),this},_initControlPos:function(){var c=this._controlCorners={},y="leaflet-",P=this._controlContainer=Si("div",y+"control-container",this._container);function z(U,ee){var ve=y+U+" "+y+ee;c[U+ee]=Si("div",ve,P)}z("top","left"),z("top","right"),z("bottom","left"),z("bottom","right")},_clearControlPos:function(){for(var c in this._controlCorners)qi(this._controlCorners[c]);qi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var eo=_r.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(c,y,P,z){return P<z?-1:z<P?1:0}},initialize:function(c,y,P){ce(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var z in c)this._addLayer(c[z],z);for(z in y)this._addLayer(y[z],z,!0)},onAdd:function(c){this._initLayout(),this._update(),this._map=c,c.on("zoomend",this._checkDisabledLayers,this);for(var y=0;y<this._layers.length;y++)this._layers[y].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(c){return _r.prototype.addTo.call(this,c),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(c,y){return this._addLayer(c,y),this._map?this._update():this},addOverlay:function(c,y){return this._addLayer(c,y,!0),this._map?this._update():this},removeLayer:function(c){c.off("add remove",this._onLayerChange,this);var y=this._getLayer(E(c));return y&&this._layers.splice(this._layers.indexOf(y),1),this._map?this._update():this},expand:function(){xi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var c=this._map.getSize().y-(this._container.offsetTop+50);return c<this._section.clientHeight?(xi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=c+"px"):gn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return gn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var c="leaflet-control-layers",y=this._container=Si("div",c),P=this.options.collapsed;y.setAttribute("aria-haspopup",!0),ti(y),tr(y);var z=this._section=Si("section",c+"-list");P&&(this._map.on("click",this.collapse,this),hi(y,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var U=this._layersLink=Si("a",c+"-toggle",y);U.href="#",U.title="Layers",U.setAttribute("role","button"),hi(U,{keydown:function(ee){ee.keyCode===13&&this._expandSafely()},click:function(ee){Vt(ee),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=Si("div",c+"-base",z),this._separator=Si("div",c+"-separator",z),this._overlaysList=Si("div",c+"-overlays",z),y.appendChild(z)},_getLayer:function(c){for(var y=0;y<this._layers.length;y++)if(this._layers[y]&&E(this._layers[y].layer)===c)return this._layers[y]},_addLayer:function(c,y,P){this._map&&c.on("add remove",this._onLayerChange,this),this._layers.push({layer:c,name:y,overlay:P}),this.options.sortLayers&&this._layers.sort(g(function(z,U){return this.options.sortFunction(z.layer,U.layer,z.name,U.name)},this)),this.options.autoZIndex&&c.setZIndex&&(this._lastZIndex++,c.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ja(this._baseLayersList),Ja(this._overlaysList),this._layerControlInputs=[];var c,y,P,z,U=0;for(P=0;P<this._layers.length;P++)z=this._layers[P],this._addItem(z),y=y||z.overlay,c=c||!z.overlay,U+=z.overlay?0:1;return this.options.hideSingleBase&&(c=c&&U>1,this._baseLayersList.style.display=c?"":"none"),this._separator.style.display=y&&c?"":"none",this},_onLayerChange:function(c){this._handlingClick||this._update();var y=this._getLayer(E(c.target)),P=y.overlay?c.type==="add"?"overlayadd":"overlayremove":c.type==="add"?"baselayerchange":null;P&&this._map.fire(P,y)},_createRadioElement:function(c,y){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+c+'"'+(y?' checked="checked"':"")+"/>",z=document.createElement("div");return z.innerHTML=P,z.firstChild},_addItem:function(c){var y=document.createElement("label"),P=this._map.hasLayer(c.layer),z;c.overlay?(z=document.createElement("input"),z.type="checkbox",z.className="leaflet-control-layers-selector",z.defaultChecked=P):z=this._createRadioElement("leaflet-base-layers_"+E(this),P),this._layerControlInputs.push(z),z.layerId=E(c.layer),hi(z,"click",this._onInputClick,this);var U=document.createElement("span");U.innerHTML=" "+c.name;var ee=document.createElement("span");y.appendChild(ee),ee.appendChild(z),ee.appendChild(U);var ve=c.overlay?this._overlaysList:this._baseLayersList;return ve.appendChild(y),this._checkDisabledLayers(),y},_onInputClick:function(){if(!this._preventClick){var c=this._layerControlInputs,y,P,z=[],U=[];this._handlingClick=!0;for(var ee=c.length-1;ee>=0;ee--)y=c[ee],P=this._getLayer(y.layerId).layer,y.checked?z.push(P):y.checked||U.push(P);for(ee=0;ee<U.length;ee++)this._map.hasLayer(U[ee])&&this._map.removeLayer(U[ee]);for(ee=0;ee<z.length;ee++)this._map.hasLayer(z[ee])||this._map.addLayer(z[ee]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var c=this._layerControlInputs,y,P,z=this._map.getZoom(),U=c.length-1;U>=0;U--)y=c[U],P=this._getLayer(y.layerId).layer,y.disabled=P.options.minZoom!==void 0&&z<P.options.minZoom||P.options.maxZoom!==void 0&&z>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var c=this._section;this._preventClick=!0,hi(c,"click",Vt),this.expand();var y=this;setTimeout(function(){li(c,"click",Vt),y._preventClick=!1})}}),$n=function(c,y,P){return new eo(c,y,P)},ps=_r.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(c){var y="leaflet-control-zoom",P=Si("div",y+" leaflet-bar"),z=this.options;return this._zoomInButton=this._createButton(z.zoomInText,z.zoomInTitle,y+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(z.zoomOutText,z.zoomOutTitle,y+"-out",P,this._zoomOut),this._updateDisabled(),c.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(c){c.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(c){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(c.shiftKey?3:1))},_zoomOut:function(c){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(c.shiftKey?3:1))},_createButton:function(c,y,P,z,U){var ee=Si("a",P,z);return ee.innerHTML=c,ee.href="#",ee.title=y,ee.setAttribute("role","button"),ee.setAttribute("aria-label",y),ti(ee),hi(ee,"click",Ur),hi(ee,"click",U,this),hi(ee,"click",this._refocusOnMap,this),ee},_updateDisabled:function(){var c=this._map,y="leaflet-disabled";gn(this._zoomInButton,y),gn(this._zoomOutButton,y),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||c._zoom===c.getMinZoom())&&(xi(this._zoomOutButton,y),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||c._zoom===c.getMaxZoom())&&(xi(this._zoomInButton,y),this._zoomInButton.setAttribute("aria-disabled","true"))}});zi.mergeOptions({zoomControl:!0}),zi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ps,this.addControl(this.zoomControl))});var el=function(c){return new ps(c)},Fs=_r.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(c){var y="leaflet-control-scale",P=Si("div",y),z=this.options;return this._addScales(z,y+"-line",P),c.on(z.updateWhenIdle?"moveend":"move",this._update,this),c.whenReady(this._update,this),P},onRemove:function(c){c.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(c,y,P){c.metric&&(this._mScale=Si("div",y,P)),c.imperial&&(this._iScale=Si("div",y,P))},_update:function(){var c=this._map,y=c.getSize().y/2,P=c.distance(c.containerPointToLatLng([0,y]),c.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(P)},_updateScales:function(c){this.options.metric&&c&&this._updateMetric(c),this.options.imperial&&c&&this._updateImperial(c)},_updateMetric:function(c){var y=this._getRoundNum(c),P=y<1e3?y+" m":y/1e3+" km";this._updateScale(this._mScale,P,y/c)},_updateImperial:function(c){var y=c*3.2808399,P,z,U;y>5280?(P=y/5280,z=this._getRoundNum(P),this._updateScale(this._iScale,z+" mi",z/P)):(U=this._getRoundNum(y),this._updateScale(this._iScale,U+" ft",U/y))},_updateScale:function(c,y,P){c.style.width=Math.round(this.options.maxWidth*P)+"px",c.innerHTML=y},_getRoundNum:function(c){var y=Math.pow(10,(Math.floor(c)+"").length-1),P=c/y;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,y*P}}),kn=function(c){return new Fs(c)},tl='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',fs=_r.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(yt.inlineSvg?tl+" ":"")+"Leaflet</a>"},initialize:function(c){ce(this,c),this._attributions={}},onAdd:function(c){c.attributionControl=this,this._container=Si("div","leaflet-control-attribution"),ti(this._container);for(var y in c._layers)c._layers[y].getAttribution&&this.addAttribution(c._layers[y].getAttribution());return this._update(),c.on("layeradd",this._addAttribution,this),this._container},onRemove:function(c){c.off("layeradd",this._addAttribution,this)},_addAttribution:function(c){c.layer.getAttribution&&(this.addAttribution(c.layer.getAttribution()),c.layer.once("remove",function(){this.removeAttribution(c.layer.getAttribution())},this))},setPrefix:function(c){return this.options.prefix=c,this._update(),this},addAttribution:function(c){return c?(this._attributions[c]||(this._attributions[c]=0),this._attributions[c]++,this._update(),this):this},removeAttribution:function(c){return c?(this._attributions[c]&&(this._attributions[c]--,this._update()),this):this},_update:function(){if(this._map){var c=[];for(var y in this._attributions)this._attributions[y]&&c.push(y);var P=[];this.options.prefix&&P.push(this.options.prefix),c.length&&P.push(c.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});zi.mergeOptions({attributionControl:!0}),zi.addInitHook(function(){this.options.attributionControl&&new fs().addTo(this)});var pa=function(c){return new fs(c)};_r.Layers=eo,_r.Zoom=ps,_r.Scale=Fs,_r.Attribution=fs,$o.layers=$n,$o.zoom=el,$o.scale=kn,$o.attribution=pa;var Co=jt.extend({initialize:function(c){this._map=c},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Co.addTo=function(c,y){return c.addHandler(y,this),this};var ms={Events:ni},fa=yt.touch?"touchstart mousedown":"mousedown",Mo=ri.extend({options:{clickTolerance:3},initialize:function(c,y,P,z){ce(this,z),this._element=c,this._dragStartTarget=y||c,this._preventOutline=P},enable:function(){this._enabled||(hi(this._dragStartTarget,fa,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Mo._dragging===this&&this.finishDrag(!0),li(this._dragStartTarget,fa,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(c){if(this._enabled&&(this._moved=!1,!us(this._element,"leaflet-zoom-anim"))){if(c.touches&&c.touches.length!==1){Mo._dragging===this&&this.finishDrag();return}if(!(Mo._dragging||c.shiftKey||c.which!==1&&c.button!==1&&!c.touches)&&(Mo._dragging=this,this._preventOutline&&Lr(this._element),co(),hs(),!this._moving)){this.fire("down");var y=c.touches?c.touches[0]:c,P=bi(this._element);this._startPoint=new It(y.clientX,y.clientY),this._startPos=Po(this._element),this._parentScale=Ds(P);var z=c.type==="mousedown";hi(document,z?"mousemove":"touchmove",this._onMove,this),hi(document,z?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(c){if(this._enabled){if(c.touches&&c.touches.length>1){this._moved=!0;return}var y=c.touches&&c.touches.length===1?c.touches[0]:c,P=new It(y.clientX,y.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,Vt(c),this._moved||(this.fire("dragstart"),this._moved=!0,xi(document.body,"leaflet-dragging"),this._lastTarget=c.target||c.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=c,this._updatePosition())}},_updatePosition:function(){var c={originalEvent:this._lastEvent};this.fire("predrag",c),Sn(this._element,this._newPos),this.fire("drag",c)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(c){gn(document.body,"leaflet-dragging"),this._lastTarget&&(gn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),li(document,"mousemove touchmove",this._onMove,this),li(document,"mouseup touchend touchcancel",this._onUp,this),Uo(),Ar();var y=this._moved&&this._moving;this._moving=!1,Mo._dragging=!1,y&&this.fire("dragend",{noInertia:c,distance:this._newPos.distanceTo(this._startPos)})}});function Du(c,y,P){var z,U=[1,4,2,8],ee,ve,Oe,Ge,st,Lt,Ht,Pi;for(ee=0,Lt=c.length;ee<Lt;ee++)c[ee]._code=Eo(c[ee],y);for(Oe=0;Oe<4;Oe++){for(Ht=U[Oe],z=[],ee=0,Lt=c.length,ve=Lt-1;ee<Lt;ve=ee++)Ge=c[ee],st=c[ve],Ge._code&Ht?st._code&Ht||(Pi=Nl(st,Ge,Ht,y,P),Pi._code=Eo(Pi,y),z.push(Pi)):(st._code&Ht&&(Pi=Nl(st,Ge,Ht,y,P),Pi._code=Eo(Pi,y),z.push(Pi)),z.push(Ge));c=z}return c}function nr(c,y){var P,z,U,ee,ve,Oe,Ge,st,Lt;if(!c||c.length===0)throw new Error("latlngs not passed");rr(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var Ht=oi([0,0]),Pi=ji(c),or=Pi.getNorthWest().distanceTo(Pi.getSouthWest())*Pi.getNorthEast().distanceTo(Pi.getNorthWest());or<1700&&(Ht=gs(c));var Pn=c.length,zr=[];for(P=0;P<Pn;P++){var xr=oi(c[P]);zr.push(y.project(oi([xr.lat-Ht.lat,xr.lng-Ht.lng])))}for(Oe=Ge=st=0,P=0,z=Pn-1;P<Pn;z=P++)U=zr[P],ee=zr[z],ve=U.y*ee.x-ee.y*U.x,Ge+=(U.x+ee.x)*ve,st+=(U.y+ee.y)*ve,Oe+=ve*3;Oe===0?Lt=zr[0]:Lt=[Ge/Oe,st/Oe];var Zs=y.unproject(Yt(Lt));return oi([Zs.lat+Ht.lat,Zs.lng+Ht.lng])}function gs(c){for(var y=0,P=0,z=0,U=0;U<c.length;U++){var ee=oi(c[U]);y+=ee.lat,P+=ee.lng,z++}return oi([y/z,P/z])}var $r={__proto__:null,clipPolygon:Du,polygonCenter:nr,centroid:gs};function yr(c,y){if(!y||!c.length)return c.slice();var P=y*y;return c=Oh(c,P),c=ma(c,P),c}function Bl(c,y,P){return Math.sqrt(_s(c,y,P,!0))}function il(c,y,P){return _s(c,y,P)}function ma(c,y){var P=c.length,z=typeof Uint8Array<"u"?Uint8Array:Array,U=new z(P);U[0]=U[P-1]=1,nl(c,U,y,0,P-1);var ee,ve=[];for(ee=0;ee<P;ee++)U[ee]&&ve.push(c[ee]);return ve}function nl(c,y,P,z,U){var ee=0,ve,Oe,Ge;for(Oe=z+1;Oe<=U-1;Oe++)Ge=_s(c[Oe],c[z],c[U],!0),Ge>ee&&(ve=Oe,ee=Ge);ee>P&&(y[ve]=1,nl(c,y,P,z,ve),nl(c,y,P,ve,U))}function Oh(c,y){for(var P=[c[0]],z=1,U=0,ee=c.length;z<ee;z++)jl(c[z],c[U])>y&&(P.push(c[z]),U=z);return U<ee-1&&P.push(c[ee-1]),P}var Ou;function Fu(c,y,P,z,U){var ee=z?Ou:Eo(c,P),ve=Eo(y,P),Oe,Ge,st;for(Ou=ve;;){if(!(ee|ve))return[c,y];if(ee&ve)return!1;Oe=ee||ve,Ge=Nl(c,y,Oe,P,U),st=Eo(Ge,P),Oe===ee?(c=Ge,ee=st):(y=Ge,ve=st)}}function Nl(c,y,P,z,U){var ee=y.x-c.x,ve=y.y-c.y,Oe=z.min,Ge=z.max,st,Lt;return P&8?(st=c.x+ee*(Ge.y-c.y)/ve,Lt=Ge.y):P&4?(st=c.x+ee*(Oe.y-c.y)/ve,Lt=Oe.y):P&2?(st=Ge.x,Lt=c.y+ve*(Ge.x-c.x)/ee):P&1&&(st=Oe.x,Lt=c.y+ve*(Oe.x-c.x)/ee),new It(st,Lt,U)}function Eo(c,y){var P=0;return c.x<y.min.x?P|=1:c.x>y.max.x&&(P|=2),c.y<y.min.y?P|=4:c.y>y.max.y&&(P|=8),P}function jl(c,y){var P=y.x-c.x,z=y.y-c.y;return P*P+z*z}function _s(c,y,P,z){var U=y.x,ee=y.y,ve=P.x-U,Oe=P.y-ee,Ge=ve*ve+Oe*Oe,st;return Ge>0&&(st=((c.x-U)*ve+(c.y-ee)*Oe)/Ge,st>1?(U=P.x,ee=P.y):st>0&&(U+=ve*st,ee+=Oe*st)),ve=c.x-U,Oe=c.y-ee,z?ve*ve+Oe*Oe:new It(U,ee)}function rr(c){return!Fe(c[0])||typeof c[0][0]!="object"&&typeof c[0][0]<"u"}function Ul(c){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),rr(c)}function rl(c,y){var P,z,U,ee,ve,Oe,Ge,st;if(!c||c.length===0)throw new Error("latlngs not passed");rr(c)||(console.warn("latlngs are not flat! Only the first ring will be used"),c=c[0]);var Lt=oi([0,0]),Ht=ji(c),Pi=Ht.getNorthWest().distanceTo(Ht.getSouthWest())*Ht.getNorthEast().distanceTo(Ht.getNorthWest());Pi<1700&&(Lt=gs(c));var or=c.length,Pn=[];for(P=0;P<or;P++){var zr=oi(c[P]);Pn.push(y.project(oi([zr.lat-Lt.lat,zr.lng-Lt.lng])))}for(P=0,z=0;P<or-1;P++)z+=Pn[P].distanceTo(Pn[P+1])/2;if(z===0)st=Pn[0];else for(P=0,ee=0;P<or-1;P++)if(ve=Pn[P],Oe=Pn[P+1],U=ve.distanceTo(Oe),ee+=U,ee>z){Ge=(ee-z)/U,st=[Oe.x-Ge*(Oe.x-ve.x),Oe.y-Ge*(Oe.y-ve.y)];break}var xr=y.unproject(Yt(st));return oi([xr.lat+Lt.lat,xr.lng+Lt.lng])}var Io={__proto__:null,simplify:yr,pointToSegmentDistance:Bl,closestPointOnSegment:il,clipSegment:Fu,_getEdgeIntersection:Nl,_getBitCode:Eo,_sqClosestPointOnSegment:_s,isFlat:rr,_flat:Ul,polylineCenter:rl},Ec={project:function(c){return new It(c.lng,c.lat)},unproject:function(c){return new Ai(c.y,c.x)},bounds:new pi([-180,-90],[180,90])},ol={R:6378137,R_MINOR:6356752314245179e-9,bounds:new pi([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(c){var y=Math.PI/180,P=this.R,z=c.lat*y,U=this.R_MINOR/P,ee=Math.sqrt(1-U*U),ve=ee*Math.sin(z),Oe=Math.tan(Math.PI/4-z/2)/Math.pow((1-ve)/(1+ve),ee/2);return z=-P*Math.log(Math.max(Oe,1e-10)),new It(c.lng*y*P,z)},unproject:function(c){for(var y=180/Math.PI,P=this.R,z=this.R_MINOR/P,U=Math.sqrt(1-z*z),ee=Math.exp(-c.y/P),ve=Math.PI/2-2*Math.atan(ee),Oe=0,Ge=.1,st;Oe<15&&Math.abs(Ge)>1e-7;Oe++)st=U*Math.sin(ve),st=Math.pow((1-st)/(1+st),U/2),Ge=Math.PI/2-2*Math.atan(ee*st)-ve,ve+=Ge;return new Ai(ve*y,c.x*y/P)}},sl={__proto__:null,LonLat:Ec,Mercator:ol,SphericalMercator:Fr},al=m({},fr,{code:"EPSG:3395",projection:ol,transformation:function(){var c=.5/(Math.PI*ol.R);return ye(c,.5,-c,.5)}()}),Ic=m({},fr,{code:"EPSG:4326",projection:Ec,transformation:ye(1/180,1,-1/180,.5)}),ll=m({},On,{projection:Ec,transformation:ye(1,0,-1,0),scale:function(c){return Math.pow(2,c)},zoom:function(c){return Math.log(c)/Math.LN2},distance:function(c,y){var P=y.lng-c.lng,z=y.lat-c.lat;return Math.sqrt(P*P+z*z)},infinite:!0});On.Earth=fr,On.EPSG3395=al,On.EPSG3857=Pe,On.EPSG900913=Ke,On.EPSG4326=Ic,On.Simple=ll;var to=ri.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(c){return c.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(c){return c&&c.removeLayer(this),this},getPane:function(c){return this._map.getPane(c?this.options[c]||c:this.options.pane)},addInteractiveTarget:function(c){return this._map._targets[E(c)]=this,this},removeInteractiveTarget:function(c){return delete this._map._targets[E(c)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(c){var y=c.target;if(y.hasLayer(this)){if(this._map=y,this._zoomAnimated=y._zoomAnimated,this.getEvents){var P=this.getEvents();y.on(P,this),this.once("remove",function(){y.off(P,this)},this)}this.onAdd(y),this.fire("add"),y.fire("layeradd",{layer:this})}}});zi.include({addLayer:function(c){if(!c._layerAdd)throw new Error("The provided object is not a Layer.");var y=E(c);return this._layers[y]?this:(this._layers[y]=c,c._mapToAdd=this,c.beforeAdd&&c.beforeAdd(this),this.whenReady(c._layerAdd,c),this)},removeLayer:function(c){var y=E(c);return this._layers[y]?(this._loaded&&c.onRemove(this),delete this._layers[y],this._loaded&&(this.fire("layerremove",{layer:c}),c.fire("remove")),c._map=c._mapToAdd=null,this):this},hasLayer:function(c){return E(c)in this._layers},eachLayer:function(c,y){for(var P in this._layers)c.call(y,this._layers[P]);return this},_addLayers:function(c){c=c?Fe(c)?c:[c]:[];for(var y=0,P=c.length;y<P;y++)this.addLayer(c[y])},_addZoomLimit:function(c){(!isNaN(c.options.maxZoom)||!isNaN(c.options.minZoom))&&(this._zoomBoundLayers[E(c)]=c,this._updateZoomLevels())},_removeZoomLimit:function(c){var y=E(c);this._zoomBoundLayers[y]&&(delete this._zoomBoundLayers[y],this._updateZoomLevels())},_updateZoomLevels:function(){var c=1/0,y=-1/0,P=this._getZoomSpan();for(var z in this._zoomBoundLayers){var U=this._zoomBoundLayers[z].options;c=U.minZoom===void 0?c:Math.min(c,U.minZoom),y=U.maxZoom===void 0?y:Math.max(y,U.maxZoom)}this._layersMaxZoom=y===-1/0?void 0:y,this._layersMinZoom=c===1/0?void 0:c,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ho=to.extend({initialize:function(c,y){ce(this,y),this._layers={};var P,z;if(c)for(P=0,z=c.length;P<z;P++)this.addLayer(c[P])},addLayer:function(c){var y=this.getLayerId(c);return this._layers[y]=c,this._map&&this._map.addLayer(c),this},removeLayer:function(c){var y=c in this._layers?c:this.getLayerId(c);return this._map&&this._layers[y]&&this._map.removeLayer(this._layers[y]),delete this._layers[y],this},hasLayer:function(c){var y=typeof c=="number"?c:this.getLayerId(c);return y in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(c){var y=Array.prototype.slice.call(arguments,1),P,z;for(P in this._layers)z=this._layers[P],z[c]&&z[c].apply(z,y);return this},onAdd:function(c){this.eachLayer(c.addLayer,c)},onRemove:function(c){this.eachLayer(c.removeLayer,c)},eachLayer:function(c,y){for(var P in this._layers)c.call(y,this._layers[P]);return this},getLayer:function(c){return this._layers[c]},getLayers:function(){var c=[];return this.eachLayer(c.push,c),c},setZIndex:function(c){return this.invoke("setZIndex",c)},getLayerId:function(c){return E(c)}}),Fh=function(c,y){return new ho(c,y)},Ao=ho.extend({addLayer:function(c){return this.hasLayer(c)?this:(c.addEventParent(this),ho.prototype.addLayer.call(this,c),this.fire("layeradd",{layer:c}))},removeLayer:function(c){return this.hasLayer(c)?(c in this._layers&&(c=this._layers[c]),c.removeEventParent(this),ho.prototype.removeLayer.call(this,c),this.fire("layerremove",{layer:c})):this},setStyle:function(c){return this.invoke("setStyle",c)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var c=new Xi;for(var y in this._layers){var P=this._layers[y];c.extend(P.getBounds?P.getBounds():P.getLatLng())}return c}}),Bh=function(c,y){return new Ao(c,y)},Vo=jt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(c){ce(this,c)},createIcon:function(c){return this._createIcon("icon",c)},createShadow:function(c){return this._createIcon("shadow",c)},_createIcon:function(c,y){var P=this._getIconUrl(c);if(!P){if(c==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var z=this._createImg(P,y&&y.tagName==="IMG"?y:null);return this._setIconStyles(z,c),(this.options.crossOrigin||this.options.crossOrigin==="")&&(z.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),z},_setIconStyles:function(c,y){var P=this.options,z=P[y+"Size"];typeof z=="number"&&(z=[z,z]);var U=Yt(z),ee=Yt(y==="shadow"&&P.shadowAnchor||P.iconAnchor||U&&U.divideBy(2,!0));c.className="leaflet-marker-"+y+" "+(P.className||""),ee&&(c.style.marginLeft=-ee.x+"px",c.style.marginTop=-ee.y+"px"),U&&(c.style.width=U.x+"px",c.style.height=U.y+"px")},_createImg:function(c,y){return y=y||document.createElement("img"),y.src=c,y},_getIconUrl:function(c){return yt.retina&&this.options[c+"RetinaUrl"]||this.options[c+"Url"]}});function Ac(c){return new Vo(c)}var ga=Vo.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(c){return typeof ga.imagePath!="string"&&(ga.imagePath=this._detectIconPath()),(this.options.imagePath||ga.imagePath)+Vo.prototype._getIconUrl.call(this,c)},_stripUrl:function(c){var y=function(P,z,U){var ee=z.exec(P);return ee&&ee[U]};return c=y(c,/^url\((['"])?(.+)\1\)$/,2),c&&y(c,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var c=Si("div","leaflet-default-icon-path",document.body),y=cs(c,"background-image")||cs(c,"backgroundImage");if(document.body.removeChild(c),y=this._stripUrl(y),y)return y;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),Lc=Co.extend({initialize:function(c){this._marker=c},addHooks:function(){var c=this._marker._icon;this._draggable||(this._draggable=new Mo(c,c,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xi(c,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&gn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(c){var y=this._marker,P=y._map,z=this._marker.options.autoPanSpeed,U=this._marker.options.autoPanPadding,ee=Po(y._icon),ve=P.getPixelBounds(),Oe=P.getPixelOrigin(),Ge=Jt(ve.min._subtract(Oe).add(U),ve.max._subtract(Oe).subtract(U));if(!Ge.contains(ee)){var st=Yt((Math.max(Ge.max.x,ee.x)-Ge.max.x)/(ve.max.x-Ge.max.x)-(Math.min(Ge.min.x,ee.x)-Ge.min.x)/(ve.min.x-Ge.min.x),(Math.max(Ge.max.y,ee.y)-Ge.max.y)/(ve.max.y-Ge.max.y)-(Math.min(Ge.min.y,ee.y)-Ge.min.y)/(ve.min.y-Ge.min.y)).multiplyBy(z);P.panBy(st,{animate:!1}),this._draggable._newPos._add(st),this._draggable._startPos._add(st),Sn(y._icon,this._draggable._newPos),this._onDrag(c),this._panRequest=At(this._adjustPan.bind(this,c))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(c){this._marker.options.autoPan&&(lt(this._panRequest),this._panRequest=At(this._adjustPan.bind(this,c)))},_onDrag:function(c){var y=this._marker,P=y._shadow,z=Po(y._icon),U=y._map.layerPointToLatLng(z);P&&Sn(P,z),y._latlng=U,c.latlng=U,c.oldLatLng=this._oldLatLng,y.fire("move",c).fire("drag",c)},_onDragEnd:function(c){lt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",c)}}),_a=to.extend({options:{icon:new ga,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(c,y){ce(this,y),this._latlng=oi(c)},onAdd:function(c){this._zoomAnimated=this._zoomAnimated&&c.options.markerZoomAnimation,this._zoomAnimated&&c.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(c){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&c.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(c){var y=this._latlng;return this._latlng=oi(c),this.update(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},setZIndexOffset:function(c){return this.options.zIndexOffset=c,this.update()},getIcon:function(){return this.options.icon},setIcon:function(c){return this.options.icon=c,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var c=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(c)}return this},_initIcon:function(){var c=this.options,y="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=c.icon.createIcon(this._icon),z=!1;P!==this._icon&&(this._icon&&this._removeIcon(),z=!0,c.title&&(P.title=c.title),P.tagName==="IMG"&&(P.alt=c.alt||"")),xi(P,y),c.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,c.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hi(P,"focus",this._panOnFocus,this);var U=c.icon.createShadow(this._shadow),ee=!1;U!==this._shadow&&(this._removeShadow(),ee=!0),U&&(xi(U,y),U.alt=""),this._shadow=U,c.opacity<1&&this._updateOpacity(),z&&this.getPane().appendChild(this._icon),this._initInteraction(),U&&ee&&this.getPane(c.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&li(this._icon,"focus",this._panOnFocus,this),qi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&qi(this._shadow),this._shadow=null},_setPos:function(c){this._icon&&Sn(this._icon,c),this._shadow&&Sn(this._shadow,c),this._zIndex=c.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(c){this._icon&&(this._icon.style.zIndex=this._zIndex+c)},_animateZoom:function(c){var y=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center).round();this._setPos(y)},_initInteraction:function(){if(this.options.interactive&&(xi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Lc)){var c=this.options.draggable;this.dragging&&(c=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Lc(this),c&&this.dragging.enable()}},setOpacity:function(c){return this.options.opacity=c,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var c=this.options.opacity;this._icon&&Nr(this._icon,c),this._shadow&&Nr(this._shadow,c)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var c=this._map;if(c){var y=this.options.icon.options,P=y.iconSize?Yt(y.iconSize):Yt(0,0),z=y.iconAnchor?Yt(y.iconAnchor):Yt(0,0);c.panInside(this._latlng,{paddingTopLeft:z,paddingBottomRight:P.subtract(z)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function kc(c,y){return new _a(c,y)}var kr=to.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(c){this._renderer=c.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(c){return ce(this,c),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&c&&Object.prototype.hasOwnProperty.call(c,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),cl=kr.extend({options:{fill:!0,radius:10},initialize:function(c,y){ce(this,y),this._latlng=oi(c),this._radius=this.options.radius},setLatLng:function(c){var y=this._latlng;return this._latlng=oi(c),this.redraw(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(c){return this.options.radius=this._radius=c,this.redraw()},getRadius:function(){return this._radius},setStyle:function(c){var y=c&&c.radius||this._radius;return kr.prototype.setStyle.call(this,c),this.setRadius(y),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var c=this._radius,y=this._radiusY||c,P=this._clickTolerance(),z=[c+P,y+P];this._pxBounds=new pi(this._point.subtract(z),this._point.add(z))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(c){return c.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function zc(c,y){return new cl(c,y)}var ys=cl.extend({initialize:function(c,y,P){if(typeof y=="number"&&(y=m({},P,{radius:y})),ce(this,y),this._latlng=oi(c),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(c){return this._mRadius=c,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var c=[this._radius,this._radiusY||this._radius];return new Xi(this._map.layerPointToLatLng(this._point.subtract(c)),this._map.layerPointToLatLng(this._point.add(c)))},setStyle:kr.prototype.setStyle,_project:function(){var c=this._latlng.lng,y=this._latlng.lat,P=this._map,z=P.options.crs;if(z.distance===fr.distance){var U=Math.PI/180,ee=this._mRadius/fr.R/U,ve=P.project([y+ee,c]),Oe=P.project([y-ee,c]),Ge=ve.add(Oe).divideBy(2),st=P.unproject(Ge).lat,Lt=Math.acos((Math.cos(ee*U)-Math.sin(y*U)*Math.sin(st*U))/(Math.cos(y*U)*Math.cos(st*U)))/U;(isNaN(Lt)||Lt===0)&&(Lt=ee/Math.cos(Math.PI/180*y)),this._point=Ge.subtract(P.getPixelOrigin()),this._radius=isNaN(Lt)?0:Ge.x-P.project([st,c-Lt]).x,this._radiusY=Ge.y-ve.y}else{var Ht=z.unproject(z.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Ht).x}this._updateBounds()}});function Nh(c,y,P){return new ys(c,y,P)}var io=kr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(c,y){ce(this,y),this._setLatLngs(c)},getLatLngs:function(){return this._latlngs},setLatLngs:function(c){return this._setLatLngs(c),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(c){for(var y=1/0,P=null,z=_s,U,ee,ve=0,Oe=this._parts.length;ve<Oe;ve++)for(var Ge=this._parts[ve],st=1,Lt=Ge.length;st<Lt;st++){U=Ge[st-1],ee=Ge[st];var Ht=z(c,U,ee,!0);Ht<y&&(y=Ht,P=z(c,U,ee))}return P&&(P.distance=Math.sqrt(y)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return rl(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(c,y){return y=y||this._defaultShape(),c=oi(c),y.push(c),this._bounds.extend(c),this.redraw()},_setLatLngs:function(c){this._bounds=new Xi,this._latlngs=this._convertLatLngs(c)},_defaultShape:function(){return rr(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(c){for(var y=[],P=rr(c),z=0,U=c.length;z<U;z++)P?(y[z]=oi(c[z]),this._bounds.extend(y[z])):y[z]=this._convertLatLngs(c[z]);return y},_project:function(){var c=new pi;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,c),this._bounds.isValid()&&c.isValid()&&(this._rawPxBounds=c,this._updateBounds())},_updateBounds:function(){var c=this._clickTolerance(),y=new It(c,c);this._rawPxBounds&&(this._pxBounds=new pi([this._rawPxBounds.min.subtract(y),this._rawPxBounds.max.add(y)]))},_projectLatlngs:function(c,y,P){var z=c[0]instanceof Ai,U=c.length,ee,ve;if(z){for(ve=[],ee=0;ee<U;ee++)ve[ee]=this._map.latLngToLayerPoint(c[ee]),P.extend(ve[ee]);y.push(ve)}else for(ee=0;ee<U;ee++)this._projectLatlngs(c[ee],y,P)},_clipPoints:function(){var c=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}var y=this._parts,P,z,U,ee,ve,Oe,Ge;for(P=0,U=0,ee=this._rings.length;P<ee;P++)for(Ge=this._rings[P],z=0,ve=Ge.length;z<ve-1;z++)Oe=Fu(Ge[z],Ge[z+1],c,z,!0),Oe&&(y[U]=y[U]||[],y[U].push(Oe[0]),(Oe[1]!==Ge[z+1]||z===ve-2)&&(y[U].push(Oe[1]),U++))}},_simplifyPoints:function(){for(var c=this._parts,y=this.options.smoothFactor,P=0,z=c.length;P<z;P++)c[P]=yr(c[P],y)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(c,y){var P,z,U,ee,ve,Oe,Ge=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(P=0,ee=this._parts.length;P<ee;P++)for(Oe=this._parts[P],z=0,ve=Oe.length,U=ve-1;z<ve;U=z++)if(!(!y&&z===0)&&Bl(c,Oe[U],Oe[z])<=Ge)return!0;return!1}});function jh(c,y){return new io(c,y)}io._flat=Ul;var Bs=io.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return nr(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(c){var y=io.prototype._convertLatLngs.call(this,c),P=y.length;return P>=2&&y[0]instanceof Ai&&y[0].equals(y[P-1])&&y.pop(),y},_setLatLngs:function(c){io.prototype._setLatLngs.call(this,c),rr(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return rr(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var c=this._renderer._bounds,y=this.options.weight,P=new It(y,y);if(c=new pi(c.min.subtract(P),c.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(c))){if(this.options.noClip){this._parts=this._rings;return}for(var z=0,U=this._rings.length,ee;z<U;z++)ee=Du(this._rings[z],c,!0),ee.length&&this._parts.push(ee)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(c){var y=!1,P,z,U,ee,ve,Oe,Ge,st;if(!this._pxBounds||!this._pxBounds.contains(c))return!1;for(ee=0,Ge=this._parts.length;ee<Ge;ee++)for(P=this._parts[ee],ve=0,st=P.length,Oe=st-1;ve<st;Oe=ve++)z=P[ve],U=P[Oe],z.y>c.y!=U.y>c.y&&c.x<(U.x-z.x)*(c.y-z.y)/(U.y-z.y)+z.x&&(y=!y);return y||io.prototype._containsPoint.call(this,c,!0)}});function Bu(c,y){return new Bs(c,y)}var Lo=Ao.extend({initialize:function(c,y){ce(this,y),this._layers={},c&&this.addData(c)},addData:function(c){var y=Fe(c)?c:c.features,P,z,U;if(y){for(P=0,z=y.length;P<z;P++)U=y[P],(U.geometries||U.geometry||U.features||U.coordinates)&&this.addData(U);return this}var ee=this.options;if(ee.filter&&!ee.filter(c))return this;var ve=ul(c,ee);return ve?(ve.feature=va(c),ve.defaultOptions=ve.options,this.resetStyle(ve),ee.onEachFeature&&ee.onEachFeature(c,ve),this.addLayer(ve)):this},resetStyle:function(c){return c===void 0?this.eachLayer(this.resetStyle,this):(c.options=m({},c.defaultOptions),this._setLayerStyle(c,this.options.style),this)},setStyle:function(c){return this.eachLayer(function(y){this._setLayerStyle(y,c)},this)},_setLayerStyle:function(c,y){c.setStyle&&(typeof y=="function"&&(y=y(c.feature)),c.setStyle(y))}});function ul(c,y){var P=c.type==="Feature"?c.geometry:c,z=P?P.coordinates:null,U=[],ee=y&&y.pointToLayer,ve=y&&y.coordsToLatLng||Ri,Oe,Ge,st,Lt;if(!z&&!P)return null;switch(P.type){case"Point":return Oe=ve(z),$l(ee,c,Oe,y);case"MultiPoint":for(st=0,Lt=z.length;st<Lt;st++)Oe=ve(z[st]),U.push($l(ee,c,Oe,y));return new Ao(U);case"LineString":case"MultiLineString":return Ge=Ns(z,P.type==="LineString"?0:1,ve),new io(Ge,y);case"Polygon":case"MultiPolygon":return Ge=Ns(z,P.type==="Polygon"?1:2,ve),new Bs(Ge,y);case"GeometryCollection":for(st=0,Lt=P.geometries.length;st<Lt;st++){var Ht=ul({geometry:P.geometries[st],type:"Feature",properties:c.properties},y);Ht&&U.push(Ht)}return new Ao(U);case"FeatureCollection":for(st=0,Lt=P.features.length;st<Lt;st++){var Pi=ul(P.features[st],y);Pi&&U.push(Pi)}return new Ao(U);default:throw new Error("Invalid GeoJSON object.")}}function $l(c,y,P,z){return c?c(y,P):new _a(P,z&&z.markersInheritOptions&&z)}function Ri(c){return new Ai(c[1],c[0],c[2])}function Ns(c,y,P){for(var z=[],U=0,ee=c.length,ve;U<ee;U++)ve=y?Ns(c[U],y-1,P):(P||Ri)(c[U]),z.push(ve);return z}function po(c,y){return c=oi(c),c.alt!==void 0?[X(c.lng,y),X(c.lat,y),X(c.alt,y)]:[X(c.lng,y),X(c.lat,y)]}function ya(c,y,P,z){for(var U=[],ee=0,ve=c.length;ee<ve;ee++)U.push(y?ya(c[ee],rr(c[ee])?0:y-1,P,z):po(c[ee],z));return!y&&P&&U.length>0&&U.push(U[0].slice()),U}function vs(c,y){return c.feature?m({},c.feature,{geometry:y}):va(y)}function va(c){return c.type==="Feature"||c.type==="FeatureCollection"?c:{type:"Feature",properties:{},geometry:c}}var Vl={toGeoJSON:function(c){return vs(this,{type:"Point",coordinates:po(this.getLatLng(),c)})}};_a.include(Vl),ys.include(Vl),cl.include(Vl),io.include({toGeoJSON:function(c){var y=!rr(this._latlngs),P=ya(this._latlngs,y?1:0,!1,c);return vs(this,{type:(y?"Multi":"")+"LineString",coordinates:P})}}),Bs.include({toGeoJSON:function(c){var y=!rr(this._latlngs),P=y&&!rr(this._latlngs[0]),z=ya(this._latlngs,P?2:y?1:0,!0,c);return y||(z=[z]),vs(this,{type:(P?"Multi":"")+"Polygon",coordinates:z})}}),ho.include({toMultiPoint:function(c){var y=[];return this.eachLayer(function(P){y.push(P.toGeoJSON(c).geometry.coordinates)}),vs(this,{type:"MultiPoint",coordinates:y})},toGeoJSON:function(c){var y=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(y==="MultiPoint")return this.toMultiPoint(c);var P=y==="GeometryCollection",z=[];return this.eachLayer(function(U){if(U.toGeoJSON){var ee=U.toGeoJSON(c);if(P)z.push(ee.geometry);else{var ve=va(ee);ve.type==="FeatureCollection"?z.push.apply(z,ve.features):z.push(ve)}}}),P?vs(this,{geometries:z,type:"GeometryCollection"}):{type:"FeatureCollection",features:z}}});function Zl(c,y){return new Lo(c,y)}var js=Zl,xa=to.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(c,y,P){this._url=c,this._bounds=ji(y),ce(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){qi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(c){return this.options.opacity=c,this._image&&this._updateOpacity(),this},setStyle:function(c){return c.opacity&&this.setOpacity(c.opacity),this},bringToFront:function(){return this._map&&ks(this._image),this},bringToBack:function(){return this._map&&zs(this._image),this},setUrl:function(c){return this._url=c,this._image&&(this._image.src=c),this},setBounds:function(c){return this._bounds=ji(c),this._map&&this._reset(),this},getEvents:function(){var c={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var c=this._url.tagName==="IMG",y=this._image=c?this._url:Si("img");if(xi(y,"leaflet-image-layer"),this._zoomAnimated&&xi(y,"leaflet-zoom-animated"),this.options.className&&xi(y,this.options.className),y.onselectstart=$,y.onmousemove=$,y.onload=g(this.fire,this,"load"),y.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),c){this._url=y.src;return}y.src=this._url,y.alt=this.options.alt},_animateZoom:function(c){var y=this._map.getZoomScale(c.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,c.zoom,c.center).min;jo(this._image,P,y)},_reset:function(){var c=this._image,y=new pi(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=y.getSize();Sn(c,y.min),c.style.width=P.x+"px",c.style.height=P.y+"px"},_updateOpacity:function(){Nr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var c=this.options.errorOverlayUrl;c&&this._url!==c&&(this._url=c,this._image.src=c)},getCenter:function(){return this._bounds.getCenter()}}),Uh=function(c,y,P){return new xa(c,y,P)},Nu=xa.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var c=this._url.tagName==="VIDEO",y=this._image=c?this._url:Si("video");if(xi(y,"leaflet-image-layer"),this._zoomAnimated&&xi(y,"leaflet-zoom-animated"),this.options.className&&xi(y,this.options.className),y.onselectstart=$,y.onmousemove=$,y.onloadeddata=g(this.fire,this,"load"),c){for(var P=y.getElementsByTagName("source"),z=[],U=0;U<P.length;U++)z.push(P[U].src);this._url=P.length>0?z:[y.src];return}Fe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(y.style,"objectFit")&&(y.style.objectFit="fill"),y.autoplay=!!this.options.autoplay,y.loop=!!this.options.loop,y.muted=!!this.options.muted,y.playsInline=!!this.options.playsInline;for(var ee=0;ee<this._url.length;ee++){var ve=Si("source");ve.src=this._url[ee],y.appendChild(ve)}}});function $h(c,y,P){return new Nu(c,y,P)}var ju=xa.extend({_initImage:function(){var c=this._image=this._url;xi(c,"leaflet-image-layer"),this._zoomAnimated&&xi(c,"leaflet-zoom-animated"),this.options.className&&xi(c,this.options.className),c.onselectstart=$,c.onmousemove=$}});function Uu(c,y,P){return new ju(c,y,P)}var ko=to.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(c,y){c&&(c instanceof Ai||Fe(c))?(this._latlng=oi(c),ce(this,y)):(ce(this,c),this._source=y),this.options.content&&(this._content=this.options.content)},openOn:function(c){return c=arguments.length?c:this._source._map,c.hasLayer(this)||c.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(c){return this._map?this.close():(arguments.length?this._source=c:c=this._source,this._prepareOpen(),this.openOn(c._map)),this},onAdd:function(c){this._zoomAnimated=c._zoomAnimated,this._container||this._initLayout(),c._fadeAnimated&&Nr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),c._fadeAnimated&&Nr(this._container,1),this.bringToFront(),this.options.interactive&&(xi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(c){c._fadeAnimated?(Nr(this._container,0),this._removeTimeout=setTimeout(g(qi,void 0,this._container),200)):qi(this._container),this.options.interactive&&(gn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(c){return this._latlng=oi(c),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(c){return this._content=c,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var c={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ks(this._container),this},bringToBack:function(){return this._map&&zs(this._container),this},_prepareOpen:function(c){var y=this._source;if(!y._map)return!1;if(y instanceof Ao){y=null;var P=this._source._layers;for(var z in P)if(P[z]._map){y=P[z];break}if(!y)return!1;this._source=y}if(!c)if(y.getCenter)c=y.getCenter();else if(y.getLatLng)c=y.getLatLng();else if(y.getBounds)c=y.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(c),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var c=this._contentNode,y=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof y=="string")c.innerHTML=y;else{for(;c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(y)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var c=this._map.latLngToLayerPoint(this._latlng),y=Yt(this.options.offset),P=this._getAnchor();this._zoomAnimated?Sn(this._container,c.add(P)):y=y.add(c).add(P);var z=this._containerBottom=-y.y,U=this._containerLeft=-Math.round(this._containerWidth/2)+y.x;this._container.style.bottom=z+"px",this._container.style.left=U+"px"}},_getAnchor:function(){return[0,0]}});zi.include({_initOverlay:function(c,y,P,z){var U=y;return U instanceof c||(U=new c(z).setContent(y)),P&&U.setLatLng(P),U}}),to.include({_initOverlay:function(c,y,P,z){var U=P;return U instanceof c?(ce(U,z),U._source=this):(U=y&&!z?y:new c(z,this),U.setContent(P)),U}});var hl=ko.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(c){return c=arguments.length?c:this._source._map,!c.hasLayer(this)&&c._popup&&c._popup.options.autoClose&&c.removeLayer(c._popup),c._popup=this,ko.prototype.openOn.call(this,c)},onAdd:function(c){ko.prototype.onAdd.call(this,c),c.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof kr||this._source.on("preclick",di))},onRemove:function(c){ko.prototype.onRemove.call(this,c),c.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof kr||this._source.off("preclick",di))},getEvents:function(){var c=ko.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(c.preclick=this.close),this.options.keepInView&&(c.moveend=this._adjustPan),c},_initLayout:function(){var c="leaflet-popup",y=this._container=Si("div",c+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=Si("div",c+"-content-wrapper",y);if(this._contentNode=Si("div",c+"-content",P),ti(y),tr(this._contentNode),hi(y,"contextmenu",di),this._tipContainer=Si("div",c+"-tip-container",y),this._tip=Si("div",c+"-tip",this._tipContainer),this.options.closeButton){var z=this._closeButton=Si("a",c+"-close-button",y);z.setAttribute("role","button"),z.setAttribute("aria-label","Close popup"),z.href="#close",z.innerHTML='<span aria-hidden="true">&#215;</span>',hi(z,"click",function(U){Vt(U),this.close()},this)}},_updateLayout:function(){var c=this._contentNode,y=c.style;y.width="",y.whiteSpace="nowrap";var P=c.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),y.width=P+1+"px",y.whiteSpace="",y.height="";var z=c.offsetHeight,U=this.options.maxHeight,ee="leaflet-popup-scrolled";U&&z>U?(y.height=U+"px",xi(c,ee)):gn(c,ee),this._containerWidth=this._container.offsetWidth},_animateZoom:function(c){var y=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center),P=this._getAnchor();Sn(this._container,y.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var c=this._map,y=parseInt(cs(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+y,z=this._containerWidth,U=new It(this._containerLeft,-P-this._containerBottom);U._add(Po(this._container));var ee=c.layerPointToContainerPoint(U),ve=Yt(this.options.autoPanPadding),Oe=Yt(this.options.autoPanPaddingTopLeft||ve),Ge=Yt(this.options.autoPanPaddingBottomRight||ve),st=c.getSize(),Lt=0,Ht=0;ee.x+z+Ge.x>st.x&&(Lt=ee.x+z-st.x+Ge.x),ee.x-Lt-Oe.x<0&&(Lt=ee.x-Oe.x),ee.y+P+Ge.y>st.y&&(Ht=ee.y+P-st.y+Ge.y),ee.y-Ht-Oe.y<0&&(Ht=ee.y-Oe.y),(Lt||Ht)&&(this.options.keepInView&&(this._autopanning=!0),c.fire("autopanstart").panBy([Lt,Ht]))}},_getAnchor:function(){return Yt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ql=function(c,y){return new hl(c,y)};zi.mergeOptions({closePopupOnClick:!0}),zi.include({openPopup:function(c,y,P){return this._initOverlay(hl,c,y,P).openOn(this),this},closePopup:function(c){return c=arguments.length?c:this._popup,c&&c.close(),this}}),to.include({bindPopup:function(c,y){return this._popup=this._initOverlay(hl,this._popup,c,y),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(c){return this._popup&&(this instanceof Ao||(this._popup._source=this),this._popup._prepareOpen(c||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(c){return this._popup&&this._popup.setContent(c),this},getPopup:function(){return this._popup},_openPopup:function(c){if(!(!this._popup||!this._map)){Ur(c);var y=c.layer||c.target;if(this._popup._source===y&&!(y instanceof kr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(c.latlng);return}this._popup._source=y,this.openPopup(c.latlng)}},_movePopup:function(c){this._popup.setLatLng(c.latlng)},_onKeyPress:function(c){c.originalEvent.keyCode===13&&this._openPopup(c)}});var Us=ko.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(c){ko.prototype.onAdd.call(this,c),this.setOpacity(this.options.opacity),c.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(c){ko.prototype.onRemove.call(this,c),c.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var c=ko.prototype.getEvents.call(this);return this.options.permanent||(c.preclick=this.close),c},_initLayout:function(){var c="leaflet-tooltip",y=c+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Si("div",y),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+E(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(c){var y,P,z=this._map,U=this._container,ee=z.latLngToContainerPoint(z.getCenter()),ve=z.layerPointToContainerPoint(c),Oe=this.options.direction,Ge=U.offsetWidth,st=U.offsetHeight,Lt=Yt(this.options.offset),Ht=this._getAnchor();Oe==="top"?(y=Ge/2,P=st):Oe==="bottom"?(y=Ge/2,P=0):Oe==="center"?(y=Ge/2,P=st/2):Oe==="right"?(y=0,P=st/2):Oe==="left"?(y=Ge,P=st/2):ve.x<ee.x?(Oe="right",y=0,P=st/2):(Oe="left",y=Ge+(Lt.x+Ht.x)*2,P=st/2),c=c.subtract(Yt(y,P,!0)).add(Lt).add(Ht),gn(U,"leaflet-tooltip-right"),gn(U,"leaflet-tooltip-left"),gn(U,"leaflet-tooltip-top"),gn(U,"leaflet-tooltip-bottom"),xi(U,"leaflet-tooltip-"+Oe),Sn(U,c)},_updatePosition:function(){var c=this._map.latLngToLayerPoint(this._latlng);this._setPosition(c)},setOpacity:function(c){this.options.opacity=c,this._container&&Nr(this._container,c)},_animateZoom:function(c){var y=this._map._latLngToNewLayerPoint(this._latlng,c.zoom,c.center);this._setPosition(y)},_getAnchor:function(){return Yt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Gl=function(c,y){return new Us(c,y)};zi.include({openTooltip:function(c,y,P){return this._initOverlay(Us,c,y,P).openOn(this),this},closeTooltip:function(c){return c.close(),this}}),to.include({bindTooltip:function(c,y){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Us,this._tooltip,c,y),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(c){if(!(!c&&this._tooltipHandlersAdded)){var y=c?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[y](P),this._tooltipHandlersAdded=!c}},openTooltip:function(c){return this._tooltip&&(this instanceof Ao||(this._tooltip._source=this),this._tooltip._prepareOpen(c)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(c){return this._tooltip&&this._tooltip.setContent(c),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(c){var y=typeof c.getElement=="function"&&c.getElement();y&&(hi(y,"focus",function(){this._tooltip._source=c,this.openTooltip()},this),hi(y,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(c){var y=typeof c.getElement=="function"&&c.getElement();y&&y.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(c){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var y=this;this._map.once("moveend",function(){y._openOnceFlag=!1,y._openTooltip(c)});return}this._tooltip._source=c.layer||c.target,this.openTooltip(this._tooltip.options.sticky?c.latlng:void 0)}},_moveTooltip:function(c){var y=c.latlng,P,z;this._tooltip.options.sticky&&c.originalEvent&&(P=this._map.mouseEventToContainerPoint(c.originalEvent),z=this._map.containerPointToLayerPoint(P),y=this._map.layerPointToLatLng(z)),this._tooltip.setLatLng(y)}});var Hl=Vo.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(c){var y=c&&c.tagName==="DIV"?c:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Ja(y),y.appendChild(P.html)):y.innerHTML=P.html!==!1?P.html:"",P.bgPos){var z=Yt(P.bgPos);y.style.backgroundPosition=-z.x+"px "+-z.y+"px"}return this._setIconStyles(y,"icon"),y},createShadow:function(){return null}});function $s(c){return new Hl(c)}Vo.Default=ga;var Zo=to.extend({options:{tileSize:256,opacity:1,updateWhenIdle:yt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(c){ce(this,c)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(c){c._addZoomLimit(this)},onRemove:function(c){this._removeAllTiles(),qi(this._container),c._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ks(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(zs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(c){return this.options.opacity=c,this._updateOpacity(),this},setZIndex:function(c){return this.options.zIndex=c,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var c=this._clampZoom(this._map.getZoom());c!==this._tileZoom&&(this._tileZoom=c,this._updateLevels()),this._update()}return this},getEvents:function(){var c={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=k(this._onMoveEnd,this.options.updateInterval,this)),c.move=this._onMove),this._zoomAnimated&&(c.zoomanim=this._animateZoom),c},createTile:function(){return document.createElement("div")},getTileSize:function(){var c=this.options.tileSize;return c instanceof It?c:new It(c,c)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(c){for(var y=this.getPane().children,P=-c(-1/0,1/0),z=0,U=y.length,ee;z<U;z++)ee=y[z].style.zIndex,y[z]!==this._container&&ee&&(P=c(P,+ee));isFinite(P)&&(this.options.zIndex=P+c(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!yt.ielt9){Nr(this._container,this.options.opacity);var c=+new Date,y=!1,P=!1;for(var z in this._tiles){var U=this._tiles[z];if(!(!U.current||!U.loaded)){var ee=Math.min(1,(c-U.loaded)/200);Nr(U.el,ee),ee<1?y=!0:(U.active?P=!0:this._onOpaqueTile(U),U.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),y&&(lt(this._fadeFrame),this._fadeFrame=At(this._updateOpacity,this))}},_onOpaqueTile:$,_initContainer:function(){this._container||(this._container=Si("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var c=this._tileZoom,y=this.options.maxZoom;if(c!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===c?(this._levels[P].el.style.zIndex=y-Math.abs(c-P),this._onUpdateLevel(P)):(qi(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var z=this._levels[c],U=this._map;return z||(z=this._levels[c]={},z.el=Si("div","leaflet-tile-container leaflet-zoom-animated",this._container),z.el.style.zIndex=y,z.origin=U.project(U.unproject(U.getPixelOrigin()),c).round(),z.zoom=c,this._setZoomTransform(z,U.getCenter(),U.getZoom()),$(z.el.offsetWidth),this._onCreateLevel(z)),this._level=z,z}},_onUpdateLevel:$,_onRemoveLevel:$,_onCreateLevel:$,_pruneTiles:function(){if(this._map){var c,y,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(c in this._tiles)y=this._tiles[c],y.retain=y.current;for(c in this._tiles)if(y=this._tiles[c],y.current&&!y.active){var z=y.coords;this._retainParent(z.x,z.y,z.z,z.z-5)||this._retainChildren(z.x,z.y,z.z,z.z+2)}for(c in this._tiles)this._tiles[c].retain||this._removeTile(c)}},_removeTilesAtZoom:function(c){for(var y in this._tiles)this._tiles[y].coords.z===c&&this._removeTile(y)},_removeAllTiles:function(){for(var c in this._tiles)this._removeTile(c)},_invalidateAll:function(){for(var c in this._levels)qi(this._levels[c].el),this._onRemoveLevel(Number(c)),delete this._levels[c];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(c,y,P,z){var U=Math.floor(c/2),ee=Math.floor(y/2),ve=P-1,Oe=new It(+U,+ee);Oe.z=+ve;var Ge=this._tileCoordsToKey(Oe),st=this._tiles[Ge];return st&&st.active?(st.retain=!0,!0):(st&&st.loaded&&(st.retain=!0),ve>z?this._retainParent(U,ee,ve,z):!1)},_retainChildren:function(c,y,P,z){for(var U=2*c;U<2*c+2;U++)for(var ee=2*y;ee<2*y+2;ee++){var ve=new It(U,ee);ve.z=P+1;var Oe=this._tileCoordsToKey(ve),Ge=this._tiles[Oe];if(Ge&&Ge.active){Ge.retain=!0;continue}else Ge&&Ge.loaded&&(Ge.retain=!0);P+1<z&&this._retainChildren(U,ee,P+1,z)}},_resetView:function(c){var y=c&&(c.pinch||c.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),y,y)},_animateZoom:function(c){this._setView(c.center,c.zoom,!0,c.noUpdate)},_clampZoom:function(c){var y=this.options;return y.minNativeZoom!==void 0&&c<y.minNativeZoom?y.minNativeZoom:y.maxNativeZoom!==void 0&&y.maxNativeZoom<c?y.maxNativeZoom:c},_setView:function(c,y,P,z){var U=Math.round(y);this.options.maxZoom!==void 0&&U>this.options.maxZoom||this.options.minZoom!==void 0&&U<this.options.minZoom?U=void 0:U=this._clampZoom(U);var ee=this.options.updateWhenZooming&&U!==this._tileZoom;(!z||ee)&&(this._tileZoom=U,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),U!==void 0&&this._update(c),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(c,y)},_setZoomTransforms:function(c,y){for(var P in this._levels)this._setZoomTransform(this._levels[P],c,y)},_setZoomTransform:function(c,y,P){var z=this._map.getZoomScale(P,c.zoom),U=c.origin.multiplyBy(z).subtract(this._map._getNewPixelOrigin(y,P)).round();yt.any3d?jo(c.el,U,z):Sn(c.el,U)},_resetGrid:function(){var c=this._map,y=c.options.crs,P=this._tileSize=this.getTileSize(),z=this._tileZoom,U=this._map.getPixelWorldBounds(this._tileZoom);U&&(this._globalTileRange=this._pxBoundsToTileRange(U)),this._wrapX=y.wrapLng&&!this.options.noWrap&&[Math.floor(c.project([0,y.wrapLng[0]],z).x/P.x),Math.ceil(c.project([0,y.wrapLng[1]],z).x/P.y)],this._wrapY=y.wrapLat&&!this.options.noWrap&&[Math.floor(c.project([y.wrapLat[0],0],z).y/P.x),Math.ceil(c.project([y.wrapLat[1],0],z).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(c){var y=this._map,P=y._animatingZoom?Math.max(y._animateToZoom,y.getZoom()):y.getZoom(),z=y.getZoomScale(P,this._tileZoom),U=y.project(c,this._tileZoom).floor(),ee=y.getSize().divideBy(z*2);return new pi(U.subtract(ee),U.add(ee))},_update:function(c){var y=this._map;if(y){var P=this._clampZoom(y.getZoom());if(c===void 0&&(c=y.getCenter()),this._tileZoom!==void 0){var z=this._getTiledPixelBounds(c),U=this._pxBoundsToTileRange(z),ee=U.getCenter(),ve=[],Oe=this.options.keepBuffer,Ge=new pi(U.getBottomLeft().subtract([Oe,-Oe]),U.getTopRight().add([Oe,-Oe]));if(!(isFinite(U.min.x)&&isFinite(U.min.y)&&isFinite(U.max.x)&&isFinite(U.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var st in this._tiles){var Lt=this._tiles[st].coords;(Lt.z!==this._tileZoom||!Ge.contains(new It(Lt.x,Lt.y)))&&(this._tiles[st].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(c,P);return}for(var Ht=U.min.y;Ht<=U.max.y;Ht++)for(var Pi=U.min.x;Pi<=U.max.x;Pi++){var or=new It(Pi,Ht);if(or.z=this._tileZoom,!!this._isValidTile(or)){var Pn=this._tiles[this._tileCoordsToKey(or)];Pn?Pn.current=!0:ve.push(or)}}if(ve.sort(function(xr,Zs){return xr.distanceTo(ee)-Zs.distanceTo(ee)}),ve.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var zr=document.createDocumentFragment();for(Pi=0;Pi<ve.length;Pi++)this._addTile(ve[Pi],zr);this._level.el.appendChild(zr)}}}},_isValidTile:function(c){var y=this._map.options.crs;if(!y.infinite){var P=this._globalTileRange;if(!y.wrapLng&&(c.x<P.min.x||c.x>P.max.x)||!y.wrapLat&&(c.y<P.min.y||c.y>P.max.y))return!1}if(!this.options.bounds)return!0;var z=this._tileCoordsToBounds(c);return ji(this.options.bounds).overlaps(z)},_keyToBounds:function(c){return this._tileCoordsToBounds(this._keyToTileCoords(c))},_tileCoordsToNwSe:function(c){var y=this._map,P=this.getTileSize(),z=c.scaleBy(P),U=z.add(P),ee=y.unproject(z,c.z),ve=y.unproject(U,c.z);return[ee,ve]},_tileCoordsToBounds:function(c){var y=this._tileCoordsToNwSe(c),P=new Xi(y[0],y[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(c){return c.x+":"+c.y+":"+c.z},_keyToTileCoords:function(c){var y=c.split(":"),P=new It(+y[0],+y[1]);return P.z=+y[2],P},_removeTile:function(c){var y=this._tiles[c];y&&(qi(y.el),delete this._tiles[c],this.fire("tileunload",{tile:y.el,coords:this._keyToTileCoords(c)}))},_initTile:function(c){xi(c,"leaflet-tile");var y=this.getTileSize();c.style.width=y.x+"px",c.style.height=y.y+"px",c.onselectstart=$,c.onmousemove=$,yt.ielt9&&this.options.opacity<1&&Nr(c,this.options.opacity)},_addTile:function(c,y){var P=this._getTilePos(c),z=this._tileCoordsToKey(c),U=this.createTile(this._wrapCoords(c),g(this._tileReady,this,c));this._initTile(U),this.createTile.length<2&&At(g(this._tileReady,this,c,null,U)),Sn(U,P),this._tiles[z]={el:U,coords:c,current:!0},y.appendChild(U),this.fire("tileloadstart",{tile:U,coords:c})},_tileReady:function(c,y,P){y&&this.fire("tileerror",{error:y,tile:P,coords:c});var z=this._tileCoordsToKey(c);P=this._tiles[z],P&&(P.loaded=+new Date,this._map._fadeAnimated?(Nr(P.el,0),lt(this._fadeFrame),this._fadeFrame=At(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),y||(xi(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:c})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),yt.ielt9||!this._map._fadeAnimated?At(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(c){return c.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(c){var y=new It(this._wrapX?O(c.x,this._wrapX):c.x,this._wrapY?O(c.y,this._wrapY):c.y);return y.z=c.z,y},_pxBoundsToTileRange:function(c){var y=this.getTileSize();return new pi(c.min.unscaleBy(y).floor(),c.max.unscaleBy(y).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var c in this._tiles)if(!this._tiles[c].loaded)return!1;return!0}});function ba(c){return new Zo(c)}var Hn=Zo.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(c,y){this._url=c,y=ce(this,y),y.detectRetina&&yt.retina&&y.maxZoom>0?(y.tileSize=Math.floor(y.tileSize/2),y.zoomReverse?(y.zoomOffset--,y.minZoom=Math.min(y.maxZoom,y.minZoom+1)):(y.zoomOffset++,y.maxZoom=Math.max(y.minZoom,y.maxZoom-1)),y.minZoom=Math.max(0,y.minZoom)):y.zoomReverse?y.minZoom=Math.min(y.maxZoom,y.minZoom):y.maxZoom=Math.max(y.minZoom,y.maxZoom),typeof y.subdomains=="string"&&(y.subdomains=y.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(c,y){return this._url===c&&y===void 0&&(y=!0),this._url=c,y||this.redraw(),this},createTile:function(c,y){var P=document.createElement("img");return hi(P,"load",g(this._tileOnLoad,this,y,P)),hi(P,"error",g(this._tileOnError,this,y,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(c),P},getTileUrl:function(c){var y={r:yt.retina?"@2x":"",s:this._getSubdomain(c),x:c.x,y:c.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-c.y;this.options.tms&&(y.y=P),y["-y"]=P}return Ue(this._url,m(y,this.options))},_tileOnLoad:function(c,y){yt.ielt9?setTimeout(g(c,this,null,y),0):c(null,y)},_tileOnError:function(c,y,P){var z=this.options.errorTileUrl;z&&y.getAttribute("src")!==z&&(y.src=z),c(P,y)},_onTileRemove:function(c){c.tile.onload=null},_getZoomForUrl:function(){var c=this._tileZoom,y=this.options.maxZoom,P=this.options.zoomReverse,z=this.options.zoomOffset;return P&&(c=y-c),c+z},_getSubdomain:function(c){var y=Math.abs(c.x+c.y)%this.options.subdomains.length;return this.options.subdomains[y]},_abortLoading:function(){var c,y;for(c in this._tiles)if(this._tiles[c].coords.z!==this._tileZoom&&(y=this._tiles[c].el,y.onload=$,y.onerror=$,!y.complete)){y.src=be;var P=this._tiles[c].coords;qi(y),delete this._tiles[c],this.fire("tileabort",{tile:y,coords:P})}},_removeTile:function(c){var y=this._tiles[c];if(y)return y.el.setAttribute("src",be),Zo.prototype._removeTile.call(this,c)},_tileReady:function(c,y,P){if(!(!this._map||P&&P.getAttribute("src")===be))return Zo.prototype._tileReady.call(this,c,y,P)}});function Rc(c,y){return new Hn(c,y)}var Dc=Hn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(c,y){this._url=c;var P=m({},this.defaultWmsParams);for(var z in y)z in this.options||(P[z]=y[z]);y=ce(this,y);var U=y.detectRetina&&yt.retina?2:1,ee=this.getTileSize();P.width=ee.x*U,P.height=ee.y*U,this.wmsParams=P},onAdd:function(c){this._crs=this.options.crs||c.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var y=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[y]=this._crs.code,Hn.prototype.onAdd.call(this,c)},getTileUrl:function(c){var y=this._tileCoordsToNwSe(c),P=this._crs,z=Jt(P.project(y[0]),P.project(y[1])),U=z.min,ee=z.max,ve=(this._wmsVersion>=1.3&&this._crs===Ic?[U.y,U.x,ee.y,ee.x]:[U.x,U.y,ee.x,ee.y]).join(","),Oe=Hn.prototype.getTileUrl.call(this,c);return Oe+Ce(this.wmsParams,Oe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ve},setParams:function(c,y){return m(this.wmsParams,c),y||this.redraw(),this}});function Oc(c,y){return new Dc(c,y)}Hn.WMS=Dc,Rc.wms=Oc;var vr=to.extend({options:{padding:.1},initialize:function(c){ce(this,c),E(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var c={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(c.zoomanim=this._onAnimZoom),c},_onAnimZoom:function(c){this._updateTransform(c.center,c.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(c,y){var P=this._map.getZoomScale(y,this._zoom),z=this._map.getSize().multiplyBy(.5+this.options.padding),U=this._map.project(this._center,y),ee=z.multiplyBy(-P).add(U).subtract(this._map._getNewPixelOrigin(c,y));yt.any3d?jo(this._container,ee,P):Sn(this._container,ee)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var c in this._layers)this._layers[c]._reset()},_onZoomEnd:function(){for(var c in this._layers)this._layers[c]._project()},_updatePaths:function(){for(var c in this._layers)this._layers[c]._update()},_update:function(){var c=this.options.padding,y=this._map.getSize(),P=this._map.containerPointToLayerPoint(y.multiplyBy(-c)).round();this._bounds=new pi(P,P.add(y.multiplyBy(1+c*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),dl=vr.extend({options:{tolerance:0},getEvents:function(){var c=vr.prototype.getEvents.call(this);return c.viewprereset=this._onViewPreReset,c},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){vr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var c=this._container=document.createElement("canvas");hi(c,"mousemove",this._onMouseMove,this),hi(c,"click dblclick mousedown mouseup contextmenu",this._onClick,this),hi(c,"mouseout",this._handleMouseOut,this),c._leaflet_disable_events=!0,this._ctx=c.getContext("2d")},_destroyContainer:function(){lt(this._redrawRequest),delete this._ctx,qi(this._container),li(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var c;this._redrawBounds=null;for(var y in this._layers)c=this._layers[y],c._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vr.prototype._update.call(this);var c=this._bounds,y=this._container,P=c.getSize(),z=yt.retina?2:1;Sn(y,c.min),y.width=z*P.x,y.height=z*P.y,y.style.width=P.x+"px",y.style.height=P.y+"px",yt.retina&&this._ctx.scale(2,2),this._ctx.translate(-c.min.x,-c.min.y),this.fire("update")}},_reset:function(){vr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(c){this._updateDashArray(c),this._layers[E(c)]=c;var y=c._order={layer:c,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=y),this._drawLast=y,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(c){this._requestRedraw(c)},_removePath:function(c){var y=c._order,P=y.next,z=y.prev;P?P.prev=z:this._drawLast=z,z?z.next=P:this._drawFirst=P,delete c._order,delete this._layers[E(c)],this._requestRedraw(c)},_updatePath:function(c){this._extendRedrawBounds(c),c._project(),c._update(),this._requestRedraw(c)},_updateStyle:function(c){this._updateDashArray(c),this._requestRedraw(c)},_updateDashArray:function(c){if(typeof c.options.dashArray=="string"){var y=c.options.dashArray.split(/[, ]+/),P=[],z,U;for(U=0;U<y.length;U++){if(z=Number(y[U]),isNaN(z))return;P.push(z)}c.options._dashArray=P}else c.options._dashArray=c.options.dashArray},_requestRedraw:function(c){this._map&&(this._extendRedrawBounds(c),this._redrawRequest=this._redrawRequest||At(this._redraw,this))},_extendRedrawBounds:function(c){if(c._pxBounds){var y=(c.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new pi,this._redrawBounds.extend(c._pxBounds.min.subtract([y,y])),this._redrawBounds.extend(c._pxBounds.max.add([y,y]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var c=this._redrawBounds;if(c){var y=c.getSize();this._ctx.clearRect(c.min.x,c.min.y,y.x,y.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var c,y=this._redrawBounds;if(this._ctx.save(),y){var P=y.getSize();this._ctx.beginPath(),this._ctx.rect(y.min.x,y.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var z=this._drawFirst;z;z=z.next)c=z.layer,(!y||c._pxBounds&&c._pxBounds.intersects(y))&&c._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(c,y){if(this._drawing){var P,z,U,ee,ve=c._parts,Oe=ve.length,Ge=this._ctx;if(Oe){for(Ge.beginPath(),P=0;P<Oe;P++){for(z=0,U=ve[P].length;z<U;z++)ee=ve[P][z],Ge[z?"lineTo":"moveTo"](ee.x,ee.y);y&&Ge.closePath()}this._fillStroke(Ge,c)}}},_updateCircle:function(c){if(!(!this._drawing||c._empty())){var y=c._point,P=this._ctx,z=Math.max(Math.round(c._radius),1),U=(Math.max(Math.round(c._radiusY),1)||z)/z;U!==1&&(P.save(),P.scale(1,U)),P.beginPath(),P.arc(y.x,y.y/U,z,0,Math.PI*2,!1),U!==1&&P.restore(),this._fillStroke(P,c)}},_fillStroke:function(c,y){var P=y.options;P.fill&&(c.globalAlpha=P.fillOpacity,c.fillStyle=P.fillColor||P.color,c.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(c.setLineDash&&c.setLineDash(y.options&&y.options._dashArray||[]),c.globalAlpha=P.opacity,c.lineWidth=P.weight,c.strokeStyle=P.color,c.lineCap=P.lineCap,c.lineJoin=P.lineJoin,c.stroke())},_onClick:function(c){for(var y=this._map.mouseEventToLayerPoint(c),P,z,U=this._drawFirst;U;U=U.next)P=U.layer,P.options.interactive&&P._containsPoint(y)&&(!(c.type==="click"||c.type==="preclick")||!this._map._draggableMoved(P))&&(z=P);this._fireEvent(z?[z]:!1,c)},_onMouseMove:function(c){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var y=this._map.mouseEventToLayerPoint(c);this._handleMouseHover(c,y)}},_handleMouseOut:function(c){var y=this._hoveredLayer;y&&(gn(this._container,"leaflet-interactive"),this._fireEvent([y],c,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(c,y){if(!this._mouseHoverThrottled){for(var P,z,U=this._drawFirst;U;U=U.next)P=U.layer,P.options.interactive&&P._containsPoint(y)&&(z=P);z!==this._hoveredLayer&&(this._handleMouseOut(c),z&&(xi(this._container,"leaflet-interactive"),this._fireEvent([z],c,"mouseover"),this._hoveredLayer=z)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,c),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(c,y,P){this._map._fireDOMEvent(y,P||y.type,c)},_bringToFront:function(c){var y=c._order;if(y){var P=y.next,z=y.prev;if(P)P.prev=z;else return;z?z.next=P:P&&(this._drawFirst=P),y.prev=this._drawLast,this._drawLast.next=y,y.next=null,this._drawLast=y,this._requestRedraw(c)}},_bringToBack:function(c){var y=c._order;if(y){var P=y.next,z=y.prev;if(z)z.next=P;else return;P?P.prev=z:z&&(this._drawLast=z),y.prev=null,y.next=this._drawFirst,this._drawFirst.prev=y,this._drawFirst=y,this._requestRedraw(c)}}});function pl(c){return yt.canvas?new dl(c):null}var qo=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(c){return document.createElement("<lvml:"+c+' class="lvml">')}}catch{}return function(c){return document.createElement("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),wa={_initContainer:function(){this._container=Si("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(vr.prototype._update.call(this),this.fire("update"))},_initPath:function(c){var y=c._container=qo("shape");xi(y,"leaflet-vml-shape "+(this.options.className||"")),y.coordsize="1 1",c._path=qo("path"),y.appendChild(c._path),this._updateStyle(c),this._layers[E(c)]=c},_addPath:function(c){var y=c._container;this._container.appendChild(y),c.options.interactive&&c.addInteractiveTarget(y)},_removePath:function(c){var y=c._container;qi(y),c.removeInteractiveTarget(y),delete this._layers[E(c)]},_updateStyle:function(c){var y=c._stroke,P=c._fill,z=c.options,U=c._container;U.stroked=!!z.stroke,U.filled=!!z.fill,z.stroke?(y||(y=c._stroke=qo("stroke")),U.appendChild(y),y.weight=z.weight+"px",y.color=z.color,y.opacity=z.opacity,z.dashArray?y.dashStyle=Fe(z.dashArray)?z.dashArray.join(" "):z.dashArray.replace(/( *, *)/g," "):y.dashStyle="",y.endcap=z.lineCap.replace("butt","flat"),y.joinstyle=z.lineJoin):y&&(U.removeChild(y),c._stroke=null),z.fill?(P||(P=c._fill=qo("fill")),U.appendChild(P),P.color=z.fillColor||z.color,P.opacity=z.fillOpacity):P&&(U.removeChild(P),c._fill=null)},_updateCircle:function(c){var y=c._point.round(),P=Math.round(c._radius),z=Math.round(c._radiusY||P);this._setPath(c,c._empty()?"M0 0":"AL "+y.x+","+y.y+" "+P+","+z+" 0,"+65535*360)},_setPath:function(c,y){c._path.v=y},_bringToFront:function(c){ks(c._container)},_bringToBack:function(c){zs(c._container)}},fl=yt.vml?qo:ct,zo=vr.extend({_initContainer:function(){this._container=fl("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fl("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){qi(this._container),li(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){vr.prototype._update.call(this);var c=this._bounds,y=c.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(y))&&(this._svgSize=y,P.setAttribute("width",y.x),P.setAttribute("height",y.y)),Sn(P,c.min),P.setAttribute("viewBox",[c.min.x,c.min.y,y.x,y.y].join(" ")),this.fire("update")}},_initPath:function(c){var y=c._path=fl("path");c.options.className&&xi(y,c.options.className),c.options.interactive&&xi(y,"leaflet-interactive"),this._updateStyle(c),this._layers[E(c)]=c},_addPath:function(c){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(c._path),c.addInteractiveTarget(c._path)},_removePath:function(c){qi(c._path),c.removeInteractiveTarget(c._path),delete this._layers[E(c)]},_updatePath:function(c){c._project(),c._update()},_updateStyle:function(c){var y=c._path,P=c.options;y&&(P.stroke?(y.setAttribute("stroke",P.color),y.setAttribute("stroke-opacity",P.opacity),y.setAttribute("stroke-width",P.weight),y.setAttribute("stroke-linecap",P.lineCap),y.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?y.setAttribute("stroke-dasharray",P.dashArray):y.removeAttribute("stroke-dasharray"),P.dashOffset?y.setAttribute("stroke-dashoffset",P.dashOffset):y.removeAttribute("stroke-dashoffset")):y.setAttribute("stroke","none"),P.fill?(y.setAttribute("fill",P.fillColor||P.color),y.setAttribute("fill-opacity",P.fillOpacity),y.setAttribute("fill-rule",P.fillRule||"evenodd")):y.setAttribute("fill","none"))},_updatePoly:function(c,y){this._setPath(c,at(c._parts,y))},_updateCircle:function(c){var y=c._point,P=Math.max(Math.round(c._radius),1),z=Math.max(Math.round(c._radiusY),1)||P,U="a"+P+","+z+" 0 1,0 ",ee=c._empty()?"M0 0":"M"+(y.x-P)+","+y.y+U+P*2+",0 "+U+-P*2+",0 ";this._setPath(c,ee)},_setPath:function(c,y){c._path.setAttribute("d",y)},_bringToFront:function(c){ks(c._path)},_bringToBack:function(c){zs(c._path)}});yt.vml&&zo.include(wa);function Vs(c){return yt.svg||yt.vml?new zo(c):null}zi.include({getRenderer:function(c){var y=c.options.renderer||this._getPaneRenderer(c.options.pane)||this.options.renderer||this._renderer;return y||(y=this._renderer=this._createRenderer()),this.hasLayer(y)||this.addLayer(y),y},_getPaneRenderer:function(c){if(c==="overlayPane"||c===void 0)return!1;var y=this._paneRenderers[c];return y===void 0&&(y=this._createRenderer({pane:c}),this._paneRenderers[c]=y),y},_createRenderer:function(c){return this.options.preferCanvas&&pl(c)||Vs(c)}});var Wl=Bs.extend({initialize:function(c,y){Bs.prototype.initialize.call(this,this._boundsToLatLngs(c),y)},setBounds:function(c){return this.setLatLngs(this._boundsToLatLngs(c))},_boundsToLatLngs:function(c){return c=ji(c),[c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast()]}});function Fc(c,y){return new Wl(c,y)}zo.create=fl,zo.pointsToPath=at,Lo.geometryToLayer=ul,Lo.coordsToLatLng=Ri,Lo.coordsToLatLngs=Ns,Lo.latLngToCoords=po,Lo.latLngsToCoords=ya,Lo.getFeature=vs,Lo.asFeature=va,zi.mergeOptions({boxZoom:!0});var wi=Co.extend({initialize:function(c){this._map=c,this._container=c._container,this._pane=c._panes.overlayPane,this._resetStateTimeout=0,c.on("unload",this._destroy,this)},addHooks:function(){hi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){li(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){qi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(c){if(!c.shiftKey||c.which!==1&&c.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),hs(),co(),this._startPoint=this._map.mouseEventToContainerPoint(c),hi(document,{contextmenu:Ur,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(c){this._moved||(this._moved=!0,this._box=Si("div","leaflet-zoom-box",this._container),xi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(c);var y=new pi(this._point,this._startPoint),P=y.getSize();Sn(this._box,y.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(qi(this._box),gn(this._container,"leaflet-crosshair")),Ar(),Uo(),li(document,{contextmenu:Ur,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(c){if(!(c.which!==1&&c.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var y=new Xi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(y).fire("boxzoomend",{boxZoomBounds:y})}},_onKeyDown:function(c){c.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});zi.addInitHook("addHandler","boxZoom",wi),zi.mergeOptions({doubleClickZoom:!0});var xs=Co.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(c){var y=this._map,P=y.getZoom(),z=y.options.zoomDelta,U=c.originalEvent.shiftKey?P-z:P+z;y.options.doubleClickZoom==="center"?y.setZoom(U):y.setZoomAround(c.containerPoint,U)}});zi.addInitHook("addHandler","doubleClickZoom",xs),zi.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Bc=Co.extend({addHooks:function(){if(!this._draggable){var c=this._map;this._draggable=new Mo(c._mapPane,c._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),c.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),c.on("zoomend",this._onZoomEnd,this),c.whenReady(this._onZoomEnd,this))}xi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){gn(this._map._container,"leaflet-grab"),gn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var c=this._map;if(c._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var y=ji(this._map.options.maxBounds);this._offsetLimit=Jt(this._map.latLngToContainerPoint(y.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(y.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;c.fire("movestart").fire("dragstart"),c.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(c){if(this._map.options.inertia){var y=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(y),this._prunePositions(y)}this._map.fire("move",c).fire("drag",c)},_prunePositions:function(c){for(;this._positions.length>1&&c-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var c=this._map.getSize().divideBy(2),y=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=y.subtract(c).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(c,y){return c-(c-y)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var c=this._draggable._newPos.subtract(this._draggable._startPos),y=this._offsetLimit;c.x<y.min.x&&(c.x=this._viscousLimit(c.x,y.min.x)),c.y<y.min.y&&(c.y=this._viscousLimit(c.y,y.min.y)),c.x>y.max.x&&(c.x=this._viscousLimit(c.x,y.max.x)),c.y>y.max.y&&(c.y=this._viscousLimit(c.y,y.max.y)),this._draggable._newPos=this._draggable._startPos.add(c)}},_onPreDragWrap:function(){var c=this._worldWidth,y=Math.round(c/2),P=this._initialWorldOffset,z=this._draggable._newPos.x,U=(z-y+P)%c+y-P,ee=(z+y+P)%c-y-P,ve=Math.abs(U+P)<Math.abs(ee+P)?U:ee;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ve},_onDragEnd:function(c){var y=this._map,P=y.options,z=!P.inertia||c.noInertia||this._times.length<2;if(y.fire("dragend",c),z)y.fire("moveend");else{this._prunePositions(+new Date);var U=this._lastPos.subtract(this._positions[0]),ee=(this._lastTime-this._times[0])/1e3,ve=P.easeLinearity,Oe=U.multiplyBy(ve/ee),Ge=Oe.distanceTo([0,0]),st=Math.min(P.inertiaMaxSpeed,Ge),Lt=Oe.multiplyBy(st/Ge),Ht=st/(P.inertiaDeceleration*ve),Pi=Lt.multiplyBy(-Ht/2).round();!Pi.x&&!Pi.y?y.fire("moveend"):(Pi=y._limitOffset(Pi,y.options.maxBounds),At(function(){y.panBy(Pi,{duration:Ht,easeLinearity:ve,noMoveStart:!0,animate:!0})}))}}});zi.addInitHook("addHandler","dragging",Bc),zi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Nc=Co.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(c){this._map=c,this._setPanDelta(c.options.keyboardPanDelta),this._setZoomDelta(c.options.zoomDelta)},addHooks:function(){var c=this._map._container;c.tabIndex<=0&&(c.tabIndex="0"),hi(c,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),li(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var c=document.body,y=document.documentElement,P=c.scrollTop||y.scrollTop,z=c.scrollLeft||y.scrollLeft;this._map._container.focus(),window.scrollTo(z,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(c){var y=this._panKeys={},P=this.keyCodes,z,U;for(z=0,U=P.left.length;z<U;z++)y[P.left[z]]=[-1*c,0];for(z=0,U=P.right.length;z<U;z++)y[P.right[z]]=[c,0];for(z=0,U=P.down.length;z<U;z++)y[P.down[z]]=[0,c];for(z=0,U=P.up.length;z<U;z++)y[P.up[z]]=[0,-1*c]},_setZoomDelta:function(c){var y=this._zoomKeys={},P=this.keyCodes,z,U;for(z=0,U=P.zoomIn.length;z<U;z++)y[P.zoomIn[z]]=c;for(z=0,U=P.zoomOut.length;z<U;z++)y[P.zoomOut[z]]=-c},_addHooks:function(){hi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){li(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(c){if(!(c.altKey||c.ctrlKey||c.metaKey)){var y=c.keyCode,P=this._map,z;if(y in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(z=this._panKeys[y],c.shiftKey&&(z=Yt(z).multiplyBy(3)),P.options.maxBounds&&(z=P._limitOffset(Yt(z),P.options.maxBounds)),P.options.worldCopyJump){var U=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(z)));P.panTo(U)}else P.panBy(z)}else if(y in this._zoomKeys)P.setZoom(P.getZoom()+(c.shiftKey?3:1)*this._zoomKeys[y]);else if(y===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;Ur(c)}}});zi.addInitHook("addHandler","keyboard",Nc),zi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ta=Co.extend({addHooks:function(){hi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){li(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(c){var y=Os(c),P=this._map.options.wheelDebounceTime;this._delta+=y,this._lastMousePos=this._map.mouseEventToContainerPoint(c),this._startTime||(this._startTime=+new Date);var z=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),z),Ur(c)},_performZoom:function(){var c=this._map,y=c.getZoom(),P=this._map.options.zoomSnap||0;c._stop();var z=this._delta/(this._map.options.wheelPxPerZoomLevel*4),U=4*Math.log(2/(1+Math.exp(-Math.abs(z))))/Math.LN2,ee=P?Math.ceil(U/P)*P:U,ve=c._limitZoom(y+(this._delta>0?ee:-ee))-y;this._delta=0,this._startTime=null,ve&&(c.options.scrollWheelZoom==="center"?c.setZoom(y+ve):c.setZoomAround(this._lastMousePos,y+ve))}});zi.addInitHook("addHandler","scrollWheelZoom",Ta);var Vh=600;zi.mergeOptions({tapHold:yt.touchNative&&yt.safari&&yt.mobile,tapTolerance:15});var $u=Co.extend({addHooks:function(){hi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){li(this._map._container,"touchstart",this._onDown,this)},_onDown:function(c){if(clearTimeout(this._holdTimeout),c.touches.length===1){var y=c.touches[0];this._startPos=this._newPos=new It(y.clientX,y.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(hi(document,"touchend",Vt),hi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",y))},this),Vh),hi(document,"touchend touchcancel contextmenu",this._cancel,this),hi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function c(){li(document,"touchend",Vt),li(document,"touchend touchcancel",c)},_cancel:function(){clearTimeout(this._holdTimeout),li(document,"touchend touchcancel contextmenu",this._cancel,this),li(document,"touchmove",this._onMove,this)},_onMove:function(c){var y=c.touches[0];this._newPos=new It(y.clientX,y.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(c,y){var P=new MouseEvent(c,{bubbles:!0,cancelable:!0,view:window,screenX:y.screenX,screenY:y.screenY,clientX:y.clientX,clientY:y.clientY});P._simulated=!0,y.target.dispatchEvent(P)}});zi.addInitHook("addHandler","tapHold",$u),zi.mergeOptions({touchZoom:yt.touch,bounceAtZoomLimits:!0});var jc=Co.extend({addHooks:function(){xi(this._map._container,"leaflet-touch-zoom"),hi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){gn(this._map._container,"leaflet-touch-zoom"),li(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(c){var y=this._map;if(!(!c.touches||c.touches.length!==2||y._animatingZoom||this._zooming)){var P=y.mouseEventToContainerPoint(c.touches[0]),z=y.mouseEventToContainerPoint(c.touches[1]);this._centerPoint=y.getSize()._divideBy(2),this._startLatLng=y.containerPointToLatLng(this._centerPoint),y.options.touchZoom!=="center"&&(this._pinchStartLatLng=y.containerPointToLatLng(P.add(z)._divideBy(2))),this._startDist=P.distanceTo(z),this._startZoom=y.getZoom(),this._moved=!1,this._zooming=!0,y._stop(),hi(document,"touchmove",this._onTouchMove,this),hi(document,"touchend touchcancel",this._onTouchEnd,this),Vt(c)}},_onTouchMove:function(c){if(!(!c.touches||c.touches.length!==2||!this._zooming)){var y=this._map,P=y.mouseEventToContainerPoint(c.touches[0]),z=y.mouseEventToContainerPoint(c.touches[1]),U=P.distanceTo(z)/this._startDist;if(this._zoom=y.getScaleZoom(U,this._startZoom),!y.options.bounceAtZoomLimits&&(this._zoom<y.getMinZoom()&&U<1||this._zoom>y.getMaxZoom()&&U>1)&&(this._zoom=y._limitZoom(this._zoom)),y.options.touchZoom==="center"){if(this._center=this._startLatLng,U===1)return}else{var ee=P._add(z)._divideBy(2)._subtract(this._centerPoint);if(U===1&&ee.x===0&&ee.y===0)return;this._center=y.unproject(y.project(this._pinchStartLatLng,this._zoom).subtract(ee),this._zoom)}this._moved||(y._moveStart(!0,!1),this._moved=!0),lt(this._animRequest);var ve=g(y._move,y,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=At(ve,this,!0),Vt(c)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,lt(this._animRequest),li(document,"touchmove",this._onTouchMove,this),li(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});zi.addInitHook("addHandler","touchZoom",jc),zi.BoxZoom=wi,zi.DoubleClickZoom=xs,zi.Drag=Bc,zi.Keyboard=Nc,zi.ScrollWheelZoom=Ta,zi.TapHold=$u,zi.TouchZoom=jc,a.Bounds=pi,a.Browser=yt,a.CRS=On,a.Canvas=dl,a.Circle=ys,a.CircleMarker=cl,a.Class=jt,a.Control=_r,a.DivIcon=Hl,a.DivOverlay=ko,a.DomEvent=Mc,a.DomUtil=Fl,a.Draggable=Mo,a.Evented=ri,a.FeatureGroup=Ao,a.GeoJSON=Lo,a.GridLayer=Zo,a.Handler=Co,a.Icon=Vo,a.ImageOverlay=xa,a.LatLng=Ai,a.LatLngBounds=Xi,a.Layer=to,a.LayerGroup=ho,a.LineUtil=Io,a.Map=zi,a.Marker=_a,a.Mixin=ms,a.Path=kr,a.Point=It,a.PolyUtil=$r,a.Polygon=Bs,a.Polyline=io,a.Popup=hl,a.PosAnimation=uo,a.Projection=sl,a.Rectangle=Wl,a.Renderer=vr,a.SVG=zo,a.SVGOverlay=ju,a.TileLayer=Hn,a.Tooltip=Us,a.Transformation=er,a.Util=Et,a.VideoOverlay=Nu,a.bind=g,a.bounds=Jt,a.canvas=pl,a.circle=Nh,a.circleMarker=zc,a.control=$o,a.divIcon=$s,a.extend=m,a.featureGroup=Bh,a.geoJSON=Zl,a.geoJson=js,a.gridLayer=ba,a.icon=Ac,a.imageOverlay=Uh,a.latLng=oi,a.latLngBounds=ji,a.layerGroup=Fh,a.map=Ru,a.marker=kc,a.point=Yt,a.polygon=Bu,a.polyline=jh,a.popup=ql,a.rectangle=Fc,a.setOptions=ce,a.stamp=E,a.svg=Vs,a.svgOverlay=Uu,a.tileLayer=Rc,a.tooltip=Gl,a.transformation=ye,a.version=d,a.videoOverlay=$h;var Vu=window.L;a.noConflict=function(){return window.L=Vu,this},window.L=a})}(Ld,Ld.exports)),Ld.exports}var dE=Dw();const Fi=lm(dE);var gf={exports:{}},pE=gf.exports,Dx;function fE(){return Dx||(Dx=1,function(n){(function(i,a){n.exports?n.exports=a(Dw()):a(i.L)})(typeof self<"u"?self:pE,i=>{if(typeof document>"u")return console.warn('"window.document" is undefined; leaflet.fullscreen requires this object to access the DOM'),!1;const a=(()=>{const _=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"]],g=_[0],l={};for(const E of _)if(E[1]in document){for(let k=0;k<E.length;k++)l[g[k]]=E[k];return l}return!1})(),d={change:a.fullscreenchange,error:a.fullscreenerror},m={request(_,g){return new Promise((l,E)=>{const k=(function(){this.off("change",k),l()}).bind(this);this.on("change",k),_=_||document.documentElement;const O=_[a.requestFullscreen](g);O instanceof Promise&&O.then(k).catch(E)})},exit(){return new Promise((_,g)=>{if(!this.isFullscreen){_();return}const l=(function(){this.off("change",l),_()}).bind(this);this.on("change",l);const E=document[a.exitFullscreen]();E instanceof Promise&&E.then(l).catch(g)})},on(_,g){const l=d[_];l&&document.addEventListener(l,g,!1)},off(_,g){const l=d[_];l&&document.removeEventListener(l,g,!1)},nativeAPI:a};return Object.defineProperties(m,{isFullscreen:{get(){return!!document[a.fullscreenElement]}},isEnabled:{enumerable:!0,get(){return!!document[a.fullscreenEnabled]}}}),i.Control.FullScreen=i.Control.extend({options:{position:"topleft",title:"Full Screen",titleCancel:"Exit Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1,fullscreenElement:!1},_screenfull:m,onAdd(_){let g="leaflet-control-zoom-fullscreen",l,E="";return _.zoomControl&&!this.options.forceSeparateButton?l=_.zoomControl._container:l=i.DomUtil.create("div","leaflet-bar"),this.options.content?E=this.options.content:g+=" leaflet-fullscreen-icon",this._createButton(this.options.title,g,E,l,this.toggleFullScreen,this),this._map.fullscreenControl=this,this._map.on("enterFullscreen exitFullscreen",this._toggleState,this),l},onRemove(){i.DomEvent.off(this.link,"click",i.DomEvent.stop).off(this.link,"click",this.toggleFullScreen,this),this._screenfull.isEnabled&&(i.DomEvent.off(this._container,this._screenfull.nativeAPI.fullscreenchange,i.DomEvent.stop).off(this._container,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,this),i.DomEvent.off(document,this._screenfull.nativeAPI.fullscreenchange,i.DomEvent.stop).off(document,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,this))},_createButton(_,g,l,E,k,O){return this.link=i.DomUtil.create("a",g,E),this.link.href="#",this.link.title=_,this.link.innerHTML=l,this.link.setAttribute("role","button"),this.link.setAttribute("aria-label",_),L.DomEvent.disableClickPropagation(E),i.DomEvent.on(this.link,"click",i.DomEvent.stop).on(this.link,"click",k,O),this._screenfull.isEnabled&&(i.DomEvent.on(E,this._screenfull.nativeAPI.fullscreenchange,i.DomEvent.stop).on(E,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,O),i.DomEvent.on(document,this._screenfull.nativeAPI.fullscreenchange,i.DomEvent.stop).on(document,this._screenfull.nativeAPI.fullscreenchange,this._handleFullscreenChange,O)),this.link},toggleFullScreen(){const _=this._map;_._exitFired=!1,_._isFullscreen?(this._screenfull.isEnabled&&!this.options.forcePseudoFullscreen?this._screenfull.exit().then(()=>_.invalidateSize()):(i.DomUtil.removeClass(this.options.fullscreenElement?this.options.fullscreenElement:_._container,"leaflet-pseudo-fullscreen"),_.invalidateSize()),_.fire("exitFullscreen"),_._exitFired=!0,_._isFullscreen=!1):(this._screenfull.isEnabled&&!this.options.forcePseudoFullscreen?this._screenfull.request(this.options.fullscreenElement?this.options.fullscreenElement:_._container).then(()=>_.invalidateSize()):(i.DomUtil.addClass(this.options.fullscreenElement?this.options.fullscreenElement:_._container,"leaflet-pseudo-fullscreen"),_.invalidateSize()),_.fire("enterFullscreen"),_._isFullscreen=!0)},_toggleState(){this.link.title=this._map._isFullscreen?this.options.title:this.options.titleCancel,this._map._isFullscreen?L.DomUtil.removeClass(this.link,"leaflet-fullscreen-on"):L.DomUtil.addClass(this.link,"leaflet-fullscreen-on")},_handleFullscreenChange(_){const g=this._map;_.target===g.getContainer()&&!this._screenfull.isFullscreen&&!g._exitFired&&(this._screenfull.exit().then(()=>g.invalidateSize()),g.fire("exitFullscreen"),g._exitFired=!0,g._isFullscreen=!1)}}),i.Map.include({toggleFullscreen(){this.fullscreenControl.toggleFullScreen()}}),i.Map.addInitHook(function(){this.options.fullscreenControl&&this.addControl(i.control.fullscreen(this.options.fullscreenControlOptions))}),i.control.fullscreen=function(_){return new i.Control.FullScreen(_)},{leaflet:i}})}(gf)),gf.exports}fE();var _f={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var mE=_f.exports,Ox;function gE(){return Ox||(Ox=1,function(n,i){(function(a,d){n.exports=d()})(mE,function(){var a={},d={};function m(g,l,E){if(d[g]=E,g==="index"){var k="var sharedModule = {}; ("+d.shared+")(sharedModule); ("+d.worker+")(sharedModule);",O={};return d.shared(O),d.index(a,O),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([k],{type:"text/javascript"}))),a}}m("shared",["exports"],function(g){function l(s,t,o,u){return new(o||(o=Promise))(function(f,b){function w(A){try{M(u.next(A))}catch(D){b(D)}}function S(A){try{M(u.throw(A))}catch(D){b(D)}}function M(A){var D;A.done?f(A.value):(D=A.value,D instanceof o?D:new o(function(B){B(D)})).then(w,S)}M((u=u.apply(s,t||[])).next())})}function E(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var k,O;function $(){if(O)return k;function s(t,o){this.x=t,this.y=o}return O=1,k=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(t,o){var u=Math.cos(t),f=Math.sin(t),b=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(t){return t instanceof s?t:Array.isArray(t)?new s(t[0],t[1]):t},k}typeof SuppressedError=="function"&&SuppressedError;var X,q,te=E($()),ce=function(){if(q)return X;function s(t,o,u,f){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=o,this.p2x=u,this.p2y=f}return q=1,X=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,o){if(o===void 0&&(o=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,f=0;f<8;f++){var b=this.sampleCurveX(u)-t;if(Math.abs(b)<o)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=b/w}var S=0,M=1;for(u=t,f=0;f<20&&(b=this.sampleCurveX(u),!(Math.abs(b-t)<o));f++)t>b?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))}},X}(),Ce=E(ce);let ze,Ue;function Fe(){return ze==null&&(ze=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ze}function xe(){if(Ue==null&&(Ue=!1,Fe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<5*5;u++){const f=4*u;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}const o=t.getImageData(0,0,5,5).data;for(let u=0;u<5*5*4;u++)if(u%4!=3&&o[u]!==u){Ue=!0;break}}}return Ue||!1}var be=1e-6,ke=typeof Float32Array<"u"?Float32Array:Array;function Qe(){var s=new ke(9);return ke!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function tt(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function et(){var s=new ke(3);return ke!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function ht(s){return Math.hypot(s[0],s[1],s[2])}function At(s,t,o){var u=new ke(3);return u[0]=s,u[1]=t,u[2]=o,u}function lt(s,t,o){return s[0]=t[0]+o[0],s[1]=t[1]+o[1],s[2]=t[2]+o[2],s}function Et(s,t,o){return s[0]=t[0]*o,s[1]=t[1]*o,s[2]=t[2]*o,s}function jt(s,t,o){var u=t[0],f=t[1],b=t[2],w=o[0],S=o[1],M=o[2];return s[0]=f*M-b*S,s[1]=b*w-u*M,s[2]=u*S-f*w,s}Math.hypot||(Math.hypot=function(){for(var s=0,t=arguments.length;t--;)s+=arguments[t]*arguments[t];return Math.sqrt(s)});var Ni,ni=ht;function ri(s,t,o){var u=t[0],f=t[1],b=t[2],w=t[3];return s[0]=o[0]*u+o[4]*f+o[8]*b+o[12]*w,s[1]=o[1]*u+o[5]*f+o[9]*b+o[13]*w,s[2]=o[2]*u+o[6]*f+o[10]*b+o[14]*w,s[3]=o[3]*u+o[7]*f+o[11]*b+o[15]*w,s}function It(){var s=new ke(4);return ke!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function pr(s,t,o,u){var f=.5*Math.PI/180;t*=f,o*=f,u*=f;var b=Math.sin(t),w=Math.cos(t),S=Math.sin(o),M=Math.cos(o),A=Math.sin(u),D=Math.cos(u);return s[0]=b*M*D-w*S*A,s[1]=w*S*D+b*M*A,s[2]=w*M*A-b*S*D,s[3]=w*M*D+b*S*A,s}function Yt(){var s=new ke(2);return ke!=Float32Array&&(s[0]=0,s[1]=0),s}function pi(s,t){var o=new ke(2);return o[0]=s,o[1]=t,o}et(),Ni=new ke(4),ke!=Float32Array&&(Ni[0]=0,Ni[1]=0,Ni[2]=0,Ni[3]=0),et(),At(1,0,0),At(0,1,0),It(),It(),Qe(),Yt();const Jt=8192;function Xi(s,t,o){return t*(Jt/(s.tileSize*Math.pow(2,o-s.tileID.overscaledZ)))}function ji(s,t){return(s%t+t)%t}function Ai(s,t,o){return s*(1-o)+t*o}function oi(s){if(s<=0)return 0;if(s>=1)return 1;const t=s*s,o=t*s;return 4*(s<.5?o:3*(s-t)+o-.75)}function On(s,t,o,u){const f=new Ce(s,t,o,u);return b=>f.solve(b)}const fr=On(.25,.1,.25,1);function dn(s,t,o){return Math.min(o,Math.max(t,s))}function Fr(s,t,o){const u=o-t,f=((s-t)%u+u)%u+t;return f===t?o:f}function er(s,...t){for(const o of t)for(const u in o)s[u]=o[u];return s}let ye=1;function Pe(s,t,o){const u={};for(const f in s)u[f]=t.call(this,s[f],f,s);return u}function Ke(s,t,o){const u={};for(const f in s)t.call(this,s[f],f,s)&&(u[f]=s[f]);return u}function ct(s){return Array.isArray(s)?s.map(ct):typeof s=="object"&&s?Pe(s,ct):s}const at={};function nt(s){at[s]||(typeof console<"u"&&console.warn(s),at[s]=!0)}function xt(s,t,o){return(o.y-s.y)*(t.x-s.x)>(t.y-s.y)*(o.x-s.x)}function _t(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let wt=null;function dt(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pt(s,t,o,u,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(s,{timestamp:0});try{const w=b?.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const S=w.startsWith("BGR"),M=new Uint8ClampedArray(u*f*4);if(yield b.copyTo(M,function(A,D,B,V,H){const W=4*Math.max(-D,0),Y=(Math.max(0,B)-B)*V*4+W,re=4*V,le=Math.max(0,D),Me=Math.max(0,B);return{rect:{x:le,y:Me,width:Math.min(A.width,D+V)-le,height:Math.min(A.height,B+H)-Me},layout:[{offset:Y,stride:re}]}}(s,t,o,u,f)),S)for(let A=0;A<M.length;A+=4){const D=M[A];M[A]=M[A+2],M[A+2]=D}return M}finally{b.close()}})}let Ft,Qt;function si(s,t,o,u){return s.addEventListener(t,o,u),{unsubscribe:()=>{s.removeEventListener(t,o,u)}}}function yi(s){return s*Math.PI/180}function vi(s){return s/Math.PI*180}const In={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},An={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},wn="AbortError";function Ee(){return new Error(wn)}const J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Q(s){return J.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const ie="global-dispatcher";class he extends Error{constructor(t,o,u,f){super(`AJAXError: ${o} (${t}): ${u}`),this.status=t,this.statusText=o,this.url=u,this.body=f}}const Te=()=>_t(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Le=function(s,t){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const u=Q(s.url);if(u)return u(s,t);if(_t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:ie},t)}if(!(/^file:/.test(o=s.url)||/^file:/.test(Te())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(u,f){return l(this,void 0,void 0,function*(){const b=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:Te(),signal:f.signal});let w,S;u.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{w=yield fetch(b)}catch(A){throw new he(0,A.message,u.url,new Blob)}if(!w.ok){const A=yield w.blob();throw new he(w.status,w.statusText,u.url,A)}S=u.type==="arrayBuffer"||u.type==="image"?w.arrayBuffer():u.type==="json"?w.json():w.text();const M=yield S;if(f.signal.aborted)throw Ee();return{data:M,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(s,t);if(_t(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:ie},t)}var o;return function(u,f){return new Promise((b,w)=>{var S;const M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(const A in u.headers)M.setRequestHeader(A,u.headers[A]);u.type==="json"&&(M.responseType="text",!((S=u.headers)===null||S===void 0)&&S.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{w(new Error(M.statusText))},M.onload=()=>{if(!f.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let A=M.response;if(u.type==="json")try{A=JSON.parse(M.response)}catch(D){return void w(D)}b({data:A,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const A=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});w(new he(M.status,M.statusText,u.url,A))}},f.signal.addEventListener("abort",()=>{M.abort(),w(Ee())}),M.send(u.body)})}(s,t)};function je(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const t=new URL(s),o=window.location;return t.protocol===o.protocol&&t.host===o.host}function Ie(s,t,o){o[s]&&o[s].indexOf(t)!==-1||(o[s]=o[s]||[],o[s].push(t))}function He(s,t,o){if(o&&o[s]){const u=o[s].indexOf(t);u!==-1&&o[s].splice(u,1)}}class qe{constructor(t,o={}){er(this,o),this.type=t}}class Re extends qe{constructor(t,o={}){super("error",er({error:t},o))}}class Je{on(t,o){return this._listeners=this._listeners||{},Ie(t,o,this._listeners),{unsubscribe:()=>{this.off(t,o)}}}off(t,o){return He(t,o,this._listeners),He(t,o,this._oneTimeListeners),this}once(t,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Ie(t,o,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,o){typeof t=="string"&&(t=new qe(t,o||{}));const u=t.type;if(this.listens(u)){t.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const S of f)S.call(this,t);const b=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const S of b)He(u,S,this._oneTimeListeners),S.call(this,t);const w=this._eventedParent;w&&(er(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(t))}else t instanceof Re&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var Se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Wt(s,t){const o={};for(const u in s)u!=="ref"&&(o[u]=s[u]);return Tt.forEach(u=>{u in t&&(o[u]=t[u])}),o}function Ct(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let o=0;o<s.length;o++)if(!Ct(s[o],t[o]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const o in s)if(!Ct(s[o],t[o]))return!1;return!0}return s===t}function Bt(s,t){s.push(t)}function ei(s,t,o){Bt(o,{command:"addSource",args:[s,t[s]]})}function Yi(s,t,o){Bt(t,{command:"removeSource",args:[s]}),o[s]=!0}function Ui(s,t,o,u){Yi(s,o,u),ei(s,t,o)}function Oi(s,t,o){let u;for(u in s[o])if(Object.prototype.hasOwnProperty.call(s[o],u)&&u!=="data"&&!Ct(s[o][u],t[o][u]))return!1;for(u in t[o])if(Object.prototype.hasOwnProperty.call(t[o],u)&&u!=="data"&&!Ct(s[o][u],t[o][u]))return!1;return!0}function Nt(s,t,o,u,f,b){s=s||{},t=t||{};for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&(Ct(s[w],t[w])||o.push({command:b,args:[u,w,t[w],f]}));for(const w in t)Object.prototype.hasOwnProperty.call(t,w)&&!Object.prototype.hasOwnProperty.call(s,w)&&(Ct(s[w],t[w])||o.push({command:b,args:[u,w,t[w],f]}))}function yt(s){return s.id}function Fn(s,t){return s[t.id]=t,s}class ft{constructor(t,o,u,f){this.message=(t?`${t}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function Un(s,...t){for(const o of t)for(const u in o)s[u]=o[u];return s}class ln extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class wo{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[u,f]of o)this.bindings[u]=f}concat(t){return new wo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ls={kind:"null"},mt={kind:"number"},ci={kind:"string"},fi={kind:"boolean"},Br={kind:"color"},Dl={kind:"projectionDefinition"},To={kind:"object"},ui={kind:"value"},Bo={kind:"collator"},So={kind:"formatted"},Tn={kind:"padding"},Ka={kind:"colorArray"},Xa={kind:"numberArray"},No={kind:"resolvedImage"},Ya={kind:"variableAnchorOffsetCollection"};function mr(s,t){return{kind:"array",itemType:s,N:t}}function Ki(s){if(s.kind==="array"){const t=Ki(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const Cc=[ls,mt,ci,fi,Br,Dl,So,To,mr(ui),Tn,Xa,Ka,No,Ya];function la(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!la(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const o of Cc)if(!la(o,t))return null}}return`Expected ${Ki(s)} but found ${Ki(t)} instead.`}function cs(s,t){return t.some(o=>o.kind===s.kind)}function Si(s,t){return t.some(o=>o==="null"?s===null:o==="array"?Array.isArray(s):o==="object"?s&&!Array.isArray(s)&&typeof s=="object":o===typeof s)}function qi(s,t){return s.kind==="array"&&t.kind==="array"?s.itemType.kind===t.itemType.kind&&typeof s.N=="number":s.kind===t.kind}const Ja=.96422,ks=.82521,zs=4/29,us=6/29,xi=3*us*us,gn=us*us*us,Rs=Math.PI/180,Ol=180/Math.PI;function Nr(s){return(s%=360)<0&&(s+=360),s}function ca([s,t,o,u]){let f,b;const w=jo((.2225045*(s=ua(s))+.7168786*(t=ua(t))+.0606169*(o=ua(o)))/1);s===t&&t===o?f=b=w:(f=jo((.4360747*s+.3850649*t+.1430804*o)/Ja),b=jo((.0139322*s+.0971045*t+.7141733*o)/ks));const S=116*w-16;return[S<0?0:S,500*(f-w),200*(w-b),u]}function ua(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function jo(s){return s>gn?Math.pow(s,1/3):s/xi+zs}function Sn([s,t,o,u]){let f=(s+16)/116,b=isNaN(t)?f:f+t/500,w=isNaN(o)?f:f-o/200;return f=1*hs(f),b=Ja*hs(b),w=ks*hs(w),[Po(3.1338561*b-1.6168667*f-.4906146*w),Po(-.9787684*b+1.9161415*f+.033454*w),Po(.0719453*b-.2289914*f+1.4052427*w),u]}function Po(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function hs(s){return s>us?s*s*s:xi*(s-zs)}const Ar=Object.hasOwn||function(s,t){return Object.prototype.hasOwnProperty.call(s,t)};function mi(s,t){return Ar(s,t)?s[t]:void 0}function jr(s){return parseInt(s.padEnd(2,s),16)/255}function co(s,t){return Uo(t?s/100:s,0,1)}function Uo(s,t,o){return Math.min(Math.max(t,s),o)}function ha(s){return!s.some(Number.isNaN)}const Qa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Lr(s,t,o){return s+o*(t-s)}function Qr(s,t,o){return s.map((u,f)=>Lr(u,t[f],o))}class bi{constructor(t,o,u,f=1,b=!0){this.r=t,this.g=o,this.b=u,this.a=f,b||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,o,u,f]))}static parse(t){if(t instanceof bi)return t;if(typeof t!="string")return;const o=function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=mi(Qa,u);if(f){const[w,S,M]=f;return[w/255,S/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const w=u.length<6?1:2;let S=1;return[jr(u.slice(S,S+=w)),jr(u.slice(S,S+=w)),jr(u.slice(S,S+=w)),jr(u.slice(S,S+w)||"ff")]}if(u.startsWith("rgb")){const w=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[S,M,A,D,B,V,H,W,Y,re,le,Me]=w,me=[D||" ",H||" ",re].join("");if(me==="  "||me==="  /"||me===",,"||me===",,,"){const G=[A,V,Y].join(""),ne=G==="%%%"?100:G===""?255:0;if(ne){const ge=[Uo(+M/ne,0,1),Uo(+B/ne,0,1),Uo(+W/ne,0,1),le?co(+le,Me):1];if(ha(ge))return ge}}return}}const b=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,S,M,A,D,B,V,H,W]=b,Y=[M||" ",D||" ",V].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const re=[+S,Uo(+A,0,100),Uo(+B,0,100),H?co(+H,W):1];if(ha(re))return function([le,Me,me,G]){function ne(ge){const Ne=(ge+le/30)%12,it=Me*Math.min(me,1-me);return me-it*Math.max(-1,Math.min(Ne-3,9-Ne,1))}return le=Nr(le),Me/=100,me/=100,[ne(0),ne(8),ne(4),G]}(re)}}}(t);return o?new bi(...o,!1):void 0}get rgb(){const{r:t,g:o,b:u,a:f}=this,b=f||1/0;return this.overwriteGetter("rgb",[t/b,o/b,u/b,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[o,u,f,b]=ca(t),w=Math.sqrt(u*u+f*f);return[Math.round(1e4*w)?Nr(Math.atan2(f,u)*Ol):NaN,w,o,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ca(this.rgb))}overwriteGetter(t,o){return Object.defineProperty(this,t,{value:o}),o}toString(){const[t,o,u,f]=this.rgb;return`rgba(${[t,o,u].map(b=>Math.round(255*b)).join(",")},${f})`}static interpolate(t,o,u,f="rgb"){switch(f){case"rgb":{const[b,w,S,M]=Qr(t.rgb,o.rgb,u);return new bi(b,w,S,M,!1)}case"hcl":{const[b,w,S,M]=t.hcl,[A,D,B,V]=o.hcl;let H,W;if(isNaN(b)||isNaN(A))isNaN(b)?isNaN(A)?H=NaN:(H=A,S!==1&&S!==0||(W=D)):(H=b,B!==1&&B!==0||(W=w));else{let me=A-b;A>b&&me>180?me-=360:A<b&&b-A>180&&(me+=360),H=b+u*me}const[Y,re,le,Me]=function([me,G,ne,ge]){return me=isNaN(me)?0:me*Rs,Sn([ne,Math.cos(me)*G,Math.sin(me)*G,ge])}([H,W??Lr(w,D,u),Lr(S,B,u),Lr(M,V,u)]);return new bi(Y,re,le,Me,!1)}case"lab":{const[b,w,S,M]=Sn(Qr(t.lab,o.lab,u));return new bi(b,w,S,M,!1)}}}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);class Ds{constructor(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Fl=["bottom","center","top"];class hi{constructor(t,o,u,f,b,w){this.text=t,this.image=o,this.scale=u,this.fontStack=f,this.textColor=b,this.verticalAlign=w}}class cn{constructor(t){this.sections=t}static fromString(t){return new cn([new hi(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof cn?t:cn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class li{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof li)return t;if(typeof t=="number")return new li([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const o of t)if(typeof o!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new li(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,o,u){return new li(Qr(t.values,o.values,u))}}class Gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gn)return t;if(typeof t=="number")return new Gn([t]);if(Array.isArray(t)){for(const o of t)if(typeof o!="number")return;return new Gn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,o,u){return new Gn(Qr(t.values,o.values,u))}}class Ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ln)return t;if(typeof t=="string"){const u=bi.parse(t);return u?new Ln([u]):void 0}if(!Array.isArray(t))return;const o=[];for(const u of t){if(typeof u!="string")return;const f=bi.parse(u);if(!f)return;o.push(f)}return new Ln(o)}toString(){return JSON.stringify(this.values)}static interpolate(t,o,u,f="rgb"){const b=[];if(t.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let w=0;w<t.values.length;w++)b.push(bi.interpolate(t.values[w],o.values[w],u,f));return new Ln(b)}}class tn extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const da=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class di{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof di)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let o=0;o<t.length;o+=2){const u=t[o],f=t[o+1];if(typeof u!="string"||!da.has(u)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new di(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,o,u){const f=t.values,b=o.values;if(f.length!==b.length)throw new tn(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${o.toString()}`);const w=[];for(let S=0;S<f.length;S+=2){if(f[S]!==b[S])throw new tn(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${f[S]}, to[${S}]: ${b[S]}`);w.push(f[S]);const[M,A]=f[S+1],[D,B]=b[S+1];w.push([Lr(M,D,u),Lr(A,B,u)])}return new di(w)}}class tr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new tr({name:t,available:!1}):null}}class ti{constructor(t,o,u){this.from=t,this.to=o,this.transition=u}static interpolate(t,o,u){return new ti(t,o,u)}static parse(t){return t instanceof ti?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new ti(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new ti(t.from,t.to,t.transition):typeof t=="string"?new ti(t,t,1):void 0}}function Vt(s,t,o,u){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[s,t,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[s,t,o,u]:[s,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ur(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ti||s instanceof bi||s instanceof Ds||s instanceof cn||s instanceof li||s instanceof Gn||s instanceof Ln||s instanceof di||s instanceof tr)return!0;if(Array.isArray(s)){for(const t of s)if(!Ur(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!Ur(s[t]))return!1;return!0}return!1}function Kt(s){if(s===null)return ls;if(typeof s=="string")return ci;if(typeof s=="boolean")return fi;if(typeof s=="number")return mt;if(s instanceof bi)return Br;if(s instanceof ti)return Dl;if(s instanceof Ds)return Bo;if(s instanceof cn)return So;if(s instanceof li)return Tn;if(s instanceof Gn)return Xa;if(s instanceof Ln)return Ka;if(s instanceof di)return Ya;if(s instanceof tr)return No;if(Array.isArray(s)){const t=s.length;let o;for(const u of s){const f=Kt(u);if(o){if(o===f)continue;o=ui;break}o=f}return mr(o||ui,t)}return To}function ds(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof bi||s instanceof ti||s instanceof cn||s instanceof li||s instanceof Gn||s instanceof Ln||s instanceof di||s instanceof tr?s.toString():JSON.stringify(s)}class gr{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ur(t[1]))return o.error("invalid value");const u=t[1];let f=Kt(u);const b=o.expectedType;return f.kind!=="array"||f.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(f=b),new gr(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Os={string:ci,number:mt,boolean:fi,object:To};class ir{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let u,f=1;const b=t[0];if(b==="array"){let S,M;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in Os)||A==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);S=Os[A],f++}else S=ui;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);M=t[2],f++}u=mr(S,M)}else{if(!Os[b])throw new Error(`Types doesn't contain name = ${b}`);u=Os[b]}const w=[];for(;f<t.length;f++){const S=o.parse(t[f],f,ui);if(!S)return null;w.push(S)}return new ir(u,w)}evaluate(t){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(t);if(!la(this.type,Kt(u)))return u;if(o===this.args.length-1)throw new tn(`Expected value to be of type ${Ki(this.type)}, but found ${Ki(Kt(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Mc={"to-boolean":fi,"to-color":Br,"to-number":mt,"to-string":ci};class uo{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const u=t[0];if(!Mc[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");const f=Mc[u],b=[];for(let w=1;w<t.length;w++){const S=o.parse(t[w],w,ui);if(!S)return null;b.push(S)}return new uo(f,b)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let o,u;for(const f of this.args){if(o=f.evaluate(t),u=null,o instanceof bi)return o;if(typeof o=="string"){const b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Vt(o[0],o[1],o[2],o[3]),!u))return new bi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new tn(u||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const u of this.args){o=u.evaluate(t);const f=li.parse(o);if(f)return f}throw new tn(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const u of this.args){o=u.evaluate(t);const f=Gn.parse(o);if(f)return f}throw new tn(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const u of this.args){o=u.evaluate(t);const f=Ln.parse(o);if(f)return f}throw new tn(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const u of this.args){o=u.evaluate(t);const f=di.parse(o);if(f)return f}throw new tn(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const u of this.args){if(o=u.evaluate(t),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new tn(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return cn.fromString(ds(this.args[0].evaluate(t)));case"resolvedImage":return tr.fromString(ds(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ds(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const zi=["Unknown","Point","LineString","Polygon"];class Ru{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let o=this._parseColorCache.get(t);return o||(o=bi.parse(t),this._parseColorCache.set(t,o)),o}}class _r{constructor(t,o,u=[],f,b=new wo,w=[]){this.registry=t,this.path=u,this.key=u.map(S=>`[${S}]`).join(""),this.scope=b,this.errors=w,this.expectedType=f,this._isConstant=o}parse(t,o,u,f,b={}){return o?this.concat(o,u,f)._parse(t,b):this._parse(t,b)}_parse(t,o){function u(f,b,w){return w==="assert"?new ir(b,[f]):w==="coerce"?new uo(b,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let w=b.parse(t,this);if(!w)return null;if(this.expectedType){const S=this.expectedType,M=w.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value"){if(S.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(S.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(S.kind)&&["value","number","array"].includes(M.kind)||S.kind==="colorArray"&&["value","string","array"].includes(M.kind)||S.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))w=u(w,S,o.typeAnnotation||"coerce");else if(this.checkSubtype(S,M))return null}else w=u(w,S,o.typeAnnotation||"assert")}if(!(w instanceof gr)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const S=new Ru;try{w=new gr(w.type,w.evaluate(S))}catch(M){return this.error(M.message),null}}return w}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,u){const f=typeof t=="number"?this.path.concat(t):this.path,b=u?this.scope.concat(u):this.scope;return new _r(this.registry,this._isConstant,f,o||null,b,this.errors)}error(t,...o){const u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new ln(u,t))}checkSubtype(t,o){const u=la(t,o);return u&&this.error(u),u}}class $o{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let b=1;b<t.length-1;b+=2){const w=t[b];if(typeof w!="string")return o.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return o.error("Variable names must contain only alphanumeric characters or '_'.",b);const S=o.parse(t[b+1],b+1);if(!S)return null;u.push([w,S])}const f=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return f?new $o(u,f):null}outputDefined(){return this.result.outputDefined()}}class eo{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=t[1];return o.scope.has(u)?new eo(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class $n{constructor(t,o,u){this.type=t,this.index=o,this.input=u}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,mt),f=o.parse(t[2],2,mr(o.expectedType||ui));return u&&f?new $n(f.type.itemType,u,f):null}evaluate(t){const o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new tn(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new tn(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new tn(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ps{constructor(t,o){this.type=fi,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,ui),f=o.parse(t[2],2,ui);return u&&f?cs(u.type,[fi,ci,mt,ls,ui])?new ps(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(u.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Si(o,["boolean","string","number","null"]))throw new tn(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(Kt(o))} instead.`);if(!Si(u,["string","array"]))throw new tn(`Expected second argument to be of type array or string, but found ${Ki(Kt(u))} instead.`);return u.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class el{constructor(t,o,u){this.type=mt,this.needle=t,this.haystack=o,this.fromIndex=u}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,ui),f=o.parse(t[2],2,ui);if(!u||!f)return null;if(!cs(u.type,[fi,ci,mt,ls,ui]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(u.type)} instead`);if(t.length===4){const b=o.parse(t[3],3,mt);return b?new el(u,f,b):null}return new el(u,f)}evaluate(t){const o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Si(o,["boolean","string","number","null"]))throw new tn(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(Kt(o))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),Si(u,["string"])){const b=u.indexOf(o,f);return b===-1?-1:[...u.slice(0,b)].length}if(Si(u,["array"]))return u.indexOf(o,f);throw new tn(`Expected second argument to be of type array or string, but found ${Ki(Kt(u))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Fs{constructor(t,o,u,f,b,w){this.inputType=t,this.type=o,this.input=u,this.cases=f,this.outputs=b,this.otherwise=w}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const b={},w=[];for(let A=2;A<t.length-1;A+=2){let D=t[A];const B=t[A+1];Array.isArray(D)||(D=[D]);const V=o.concat(A);if(D.length===0)return V.error("Expected at least one branch label.");for(const W of D){if(typeof W!="number"&&typeof W!="string")return V.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return V.error("Numeric branch labels must be integer values.");if(u){if(V.checkSubtype(u,Kt(W)))return null}else u=Kt(W);if(b[String(W)]!==void 0)return V.error("Branch labels must be unique.");b[String(W)]=w.length}const H=o.parse(B,A,f);if(!H)return null;f=f||H.type,w.push(H)}const S=o.parse(t[1],1,ui);if(!S)return null;const M=o.parse(t[t.length-1],t.length-1,f);return M?S.type.kind!=="value"&&o.concat(1).checkSubtype(u,S.type)?null:new Fs(u,f,S,b,w,M):null}evaluate(t){const o=this.input.evaluate(t);return(Kt(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class kn{constructor(t,o,u){this.type=t,this.branches=o,this.otherwise=u}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const f=[];for(let w=1;w<t.length-1;w+=2){const S=o.parse(t[w],w,fi);if(!S)return null;const M=o.parse(t[w+1],w+1,u);if(!M)return null;f.push([S,M]),u=u||M.type}const b=o.parse(t[t.length-1],t.length-1,u);if(!b)return null;if(!u)throw new Error("Can't infer output type");return new kn(u,f,b)}evaluate(t){for(const[o,u]of this.branches)if(o.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,u]of this.branches)t(o),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class tl{constructor(t,o,u,f){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,ui),f=o.parse(t[2],2,mt);if(!u||!f)return null;if(!cs(u.type,[mr(ui),ci,ui]))return o.error(`Expected first argument to be of type array or string, but found ${Ki(u.type)} instead`);if(t.length===4){const b=o.parse(t[3],3,mt);return b?new tl(u.type,u,f,b):null}return new tl(u.type,u,f)}evaluate(t){const o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),Si(o,["string"]))return[...o].slice(u,f).join("");if(Si(o,["array"]))return o.slice(u,f);throw new tn(`Expected first argument to be of type array or string, but found ${Ki(Kt(o))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function fs(s,t){const o=s.length-1;let u,f,b=0,w=o,S=0;for(;b<=w;)if(S=Math.floor((b+w)/2),u=s[S],f=s[S+1],u<=t){if(S===o||t<f)return S;b=S+1}else{if(!(u>t))throw new tn("Input is not a number.");w=S-1}return 0}class pa{constructor(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[f,b]of u)this.labels.push(f),this.outputs.push(b)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(t[1],1,mt);if(!u)return null;const f=[];let b=null;o.expectedType&&o.expectedType.kind!=="value"&&(b=o.expectedType);for(let w=1;w<t.length;w+=2){const S=w===1?-1/0:t[w],M=t[w+1],A=w,D=w+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const B=o.parse(M,D,b);if(!B)return null;b=b||B.type,f.push([S,B])}return new pa(b,u,f)}evaluate(t){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return u[0].evaluate(t);const b=o.length;return f>=o[b-1]?u[b-1].evaluate(t):u[fs(o,f)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Co(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ms,fa,Mo=function(){if(fa)return ms;function s(t,o,u,f){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=o,this.p2x=u,this.p2y=f}return fa=1,ms=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,o){if(o===void 0&&(o=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,f=0;f<8;f++){var b=this.sampleCurveX(u)-t;if(Math.abs(b)<o)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=b/w}var S=0,M=1;for(u=t,f=0;f<20&&(b=this.sampleCurveX(u),!(Math.abs(b-t)<o));f++)t>b?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))}},ms}(),Du=Co(Mo);class nr{constructor(t,o,u,f,b){this.type=t,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[w,S]of b)this.labels.push(w),this.outputs.push(S)}static interpolationFactor(t,o,u,f){let b=0;if(t.name==="exponential")b=gs(o,t.base,u,f);else if(t.name==="linear")b=gs(o,1,u,f);else if(t.name==="cubic-bezier"){const w=t.controlPoints;b=new Du(w[0],w[1],w[2],w[3]).solve(gs(o,1,u,f))}return b}static parse(t,o){let[u,f,b,...w]=t;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const A=f[1];if(typeof A!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(A.length!==4||A.some(D=>typeof D!="number"||D<0||D>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(b=o.parse(b,2,mt),!b)return null;const S=[];let M=null;u!=="interpolate-hcl"&&u!=="interpolate-lab"||o.expectedType==Ka?o.expectedType&&o.expectedType.kind!=="value"&&(M=o.expectedType):M=Br;for(let A=0;A<w.length;A+=2){const D=w[A],B=w[A+1],V=A+3,H=A+4;if(typeof D!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(S.length&&S[S.length-1][0]>=D)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const W=o.parse(B,H,M);if(!W)return null;M=M||W.type,S.push([D,W])}return qi(M,mt)||qi(M,Dl)||qi(M,Br)||qi(M,Tn)||qi(M,Xa)||qi(M,Ka)||qi(M,Ya)||qi(M,mr(mt))?new nr(M,u,f,b,S):o.error(`Type ${Ki(M)} is not interpolatable.`)}evaluate(t){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return u[0].evaluate(t);const b=o.length;if(f>=o[b-1])return u[b-1].evaluate(t);const w=fs(o,f),S=nr.interpolationFactor(this.interpolation,f,o[w],o[w+1]),M=u[w].evaluate(t),A=u[w+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Lr(M,A,S);case"color":return bi.interpolate(M,A,S);case"padding":return li.interpolate(M,A,S);case"colorArray":return Ln.interpolate(M,A,S);case"numberArray":return Gn.interpolate(M,A,S);case"variableAnchorOffsetCollection":return di.interpolate(M,A,S);case"array":return Qr(M,A,S);case"projectionDefinition":return ti.interpolate(M,A,S)}case"interpolate-hcl":switch(this.type.kind){case"color":return bi.interpolate(M,A,S,"hcl");case"colorArray":return Ln.interpolate(M,A,S,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return bi.interpolate(M,A,S,"lab");case"colorArray":return Ln.interpolate(M,A,S,"lab")}}}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function gs(s,t,o,u){const f=u-o,b=s-o;return f===0?0:t===1?b/f:(Math.pow(t,b)-1)/(Math.pow(t,f)-1)}const $r={color:bi.interpolate,number:Lr,padding:li.interpolate,numberArray:Gn.interpolate,colorArray:Ln.interpolate,variableAnchorOffsetCollection:di.interpolate,array:Qr};class yr{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let u=null;const f=o.expectedType;f&&f.kind!=="value"&&(u=f);const b=[];for(const S of t.slice(1)){const M=o.parse(S,1+b.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,b.push(M)}if(!u)throw new Error("No output type");const w=f&&b.some(S=>la(f,S.type));return new yr(w?ui:u,b)}evaluate(t){let o,u=null,f=0;for(const b of this.args)if(f++,u=b.evaluate(t),u&&u instanceof tr&&!u.available&&(o||(o=u.name),u=null,f===this.args.length&&(u=o)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Bl(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function il(s,t,o,u){return u.compare(t,o)===0}function ma(s,t,o){const u=s!=="=="&&s!=="!=";return class Ow{constructor(b,w,S){this.type=fi,this.lhs=b,this.rhs=w,this.collator=S,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const S=b[0];let M=w.parse(b[1],1,ui);if(!M)return null;if(!Bl(S,M.type))return w.concat(1).error(`"${S}" comparisons are not supported for type '${Ki(M.type)}'.`);let A=w.parse(b[2],2,ui);if(!A)return null;if(!Bl(S,A.type))return w.concat(2).error(`"${S}" comparisons are not supported for type '${Ki(A.type)}'.`);if(M.type.kind!==A.type.kind&&M.type.kind!=="value"&&A.type.kind!=="value")return w.error(`Cannot compare types '${Ki(M.type)}' and '${Ki(A.type)}'.`);u&&(M.type.kind==="value"&&A.type.kind!=="value"?M=new ir(A.type,[M]):M.type.kind!=="value"&&A.type.kind==="value"&&(A=new ir(M.type,[A])));let D=null;if(b.length===4){if(M.type.kind!=="string"&&A.type.kind!=="string"&&M.type.kind!=="value"&&A.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(D=w.parse(b[3],3,Bo),!D)return null}return new Ow(M,A,D)}evaluate(b){const w=this.lhs.evaluate(b),S=this.rhs.evaluate(b);if(u&&this.hasUntypedArgument){const M=Kt(w),A=Kt(S);if(M.kind!==A.kind||M.kind!=="string"&&M.kind!=="number")throw new tn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=Kt(w),A=Kt(S);if(M.kind!=="string"||A.kind!=="string")return t(b,w,S)}return this.collator?o(b,w,S,this.collator.evaluate(b)):t(b,w,S)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const nl=ma("==",function(s,t,o){return t===o},il),Oh=ma("!=",function(s,t,o){return t!==o},function(s,t,o,u){return!il(0,t,o,u)}),Ou=ma("<",function(s,t,o){return t<o},function(s,t,o,u){return u.compare(t,o)<0}),Fu=ma(">",function(s,t,o){return t>o},function(s,t,o,u){return u.compare(t,o)>0}),Nl=ma("<=",function(s,t,o){return t<=o},function(s,t,o,u){return u.compare(t,o)<=0}),Eo=ma(">=",function(s,t,o){return t>=o},function(s,t,o,u){return u.compare(t,o)>=0});class jl{constructor(t,o,u){this.type=Bo,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const f=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,fi);if(!f)return null;const b=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,fi);if(!b)return null;let w=null;return u.locale&&(w=o.parse(u.locale,1,ci),!w)?null:new jl(f,b,w)}evaluate(t){return new Ds(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class _s{constructor(t,o,u,f,b){this.type=ci,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=f,this.maxFractionDigits=b}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const u=o.parse(t[1],1,mt);if(!u)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=o.parse(f.locale,1,ci),!b))return null;let w=null;if(f.currency&&(w=o.parse(f.currency,1,ci),!w))return null;let S=null;if(f["min-fraction-digits"]&&(S=o.parse(f["min-fraction-digits"],1,mt),!S))return null;let M=null;return f["max-fraction-digits"]&&(M=o.parse(f["max-fraction-digits"],1,mt),!M)?null:new _s(u,b,w,S,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class rr{constructor(t){this.type=So,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const f=[];let b=!1;for(let w=1;w<=t.length-1;++w){const S=t[w];if(b&&typeof S=="object"&&!Array.isArray(S)){b=!1;let M=null;if(S["font-scale"]&&(M=o.parse(S["font-scale"],1,mt),!M))return null;let A=null;if(S["text-font"]&&(A=o.parse(S["text-font"],1,mr(ci)),!A))return null;let D=null;if(S["text-color"]&&(D=o.parse(S["text-color"],1,Br),!D))return null;let B=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!Fl.includes(S["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(B=o.parse(S["vertical-align"],1,ci),!B)return null}const V=f[f.length-1];V.scale=M,V.font=A,V.textColor=D,V.verticalAlign=B}else{const M=o.parse(t[w],1,ui);if(!M)return null;const A=M.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new rr(f)}evaluate(t){return new cn(this.sections.map(o=>{const u=o.content.evaluate(t);return Kt(u)===No?new hi("",u,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(t):null):new hi(ds(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null,o.verticalAlign?o.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor),o.verticalAlign&&t(o.verticalAlign)}outputDefined(){return!1}}class Ul{constructor(t){this.type=No,this.input=t}static parse(t,o){if(t.length!==2)return o.error("Expected two arguments.");const u=o.parse(t[1],1,ci);return u?new Ul(u):o.error("No image name provided.")}evaluate(t){const o=this.input.evaluate(t),u=tr.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class rl{constructor(t){this.type=mt,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Ki(u.type)} instead.`):new rl(u):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new tn(`Expected value to be of type string or array, but found ${Ki(Kt(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Io=8192;function Ec(s,t){const o=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(o*f*Io),Math.round(u*f*Io)]}function ol(s,t){const o=Math.pow(2,t.z);return[(f=(s[0]/Io+t.x)/o,360*f-180),(u=(s[1]/Io+t.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,f}function sl(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function al(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function Ic(s,t,o){const u=s[0]-t[0],f=s[1]-t[1],b=s[0]-o[0],w=s[1]-o[1];return u*w-b*f==0&&u*b<=0&&f*w<=0}function ll(s,t,o,u){return(f=[u[0]-o[0],u[1]-o[1]])[0]*(b=[t[0]-s[0],t[1]-s[1]])[1]-f[1]*b[0]!=0&&!(!Vo(s,t,o,u)||!Vo(o,u,s,t));var f,b}function to(s,t,o){for(const u of o)for(let f=0;f<u.length-1;++f)if(ll(s,t,u[f],u[f+1]))return!0;return!1}function ho(s,t,o=!1){let u=!1;for(const S of t)for(let M=0;M<S.length-1;M++){if(Ic(s,S[M],S[M+1]))return o;(b=S[M])[1]>(f=s)[1]!=(w=S[M+1])[1]>f[1]&&f[0]<(w[0]-b[0])*(f[1]-b[1])/(w[1]-b[1])+b[0]&&(u=!u)}var f,b,w;return u}function Fh(s,t){for(const o of t)if(ho(s,o))return!0;return!1}function Ao(s,t){for(const o of s)if(!ho(o,t))return!1;for(let o=0;o<s.length-1;++o)if(to(s[o],s[o+1],t))return!1;return!0}function Bh(s,t){for(const o of t)if(Ao(s,o))return!0;return!1}function Vo(s,t,o,u){const f=u[0]-o[0],b=u[1]-o[1],w=(s[0]-o[0])*b-f*(s[1]-o[1]),S=(t[0]-o[0])*b-f*(t[1]-o[1]);return w>0&&S<0||w<0&&S>0}function Ac(s,t,o){const u=[];for(let f=0;f<s.length;f++){const b=[];for(let w=0;w<s[f].length;w++){const S=Ec(s[f][w],o);sl(t,S),b.push(S)}u.push(b)}return u}function ga(s,t,o){const u=[];for(let f=0;f<s.length;f++){const b=Ac(s[f],t,o);u.push(b)}return u}function Lc(s,t,o,u){if(s[0]<o[0]||s[0]>o[2]){const f=.5*u;let b=s[0]-o[0]>f?-u:o[0]-s[0]>f?u:0;b===0&&(b=s[0]-o[2]>f?-u:o[2]-s[0]>f?u:0),s[0]+=b}sl(t,s)}function _a(s,t,o,u){const f=Math.pow(2,u.z)*Io,b=[u.x*Io,u.y*Io],w=[];for(const S of s)for(const M of S){const A=[M.x+b[0],M.y+b[1]];Lc(A,t,o,f),w.push(A)}return w}function kc(s,t,o,u){const f=Math.pow(2,u.z)*Io,b=[u.x*Io,u.y*Io],w=[];for(const M of s){const A=[];for(const D of M){const B=[D.x+b[0],D.y+b[1]];sl(t,B),A.push(B)}w.push(A)}if(t[2]-t[0]<=f/2){(S=t)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const M of w)for(const A of M)Lc(A,t,o,f)}var S;return w}class kr{constructor(t,o){this.type=fi,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ur(t[1])){const u=t[1];if(u.type==="FeatureCollection"){const f=[];for(const b of u.features){const{type:w,coordinates:S}=b.geometry;w==="Polygon"&&f.push(S),w==="MultiPolygon"&&f.push(...S)}if(f.length)return new kr(u,{type:"MultiPolygon",coordinates:f})}else if(u.type==="Feature"){const f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new kr(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new kr(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=o.canonicalID();if(u.type==="Polygon"){const S=Ac(u.coordinates,b,w),M=_a(o.geometry(),f,b,w);if(!al(f,b))return!1;for(const A of M)if(!ho(A,S))return!1}if(u.type==="MultiPolygon"){const S=ga(u.coordinates,b,w),M=_a(o.geometry(),f,b,w);if(!al(f,b))return!1;for(const A of M)if(!Fh(A,S))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=o.canonicalID();if(u.type==="Polygon"){const S=Ac(u.coordinates,b,w),M=kc(o.geometry(),f,b,w);if(!al(f,b))return!1;for(const A of M)if(!Ao(A,S))return!1}if(u.type==="MultiPolygon"){const S=ga(u.coordinates,b,w),M=kc(o.geometry(),f,b,w);if(!al(f,b))return!1;for(const A of M)if(!Bh(A,S))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let cl=class{constructor(s=[],t=(o,u)=>o<u?-1:o>u?1:0){if(this.data=s,this.length=this.data.length,this.compare=t,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:t,compare:o}=this,u=t[s];for(;s>0;){const f=s-1>>1,b=t[f];if(o(u,b)>=0)break;t[s]=b,s=f}t[s]=u}_down(s){const{data:t,compare:o}=this,u=this.length>>1,f=t[s];for(;s<u;){let b=1+(s<<1);const w=b+1;if(w<this.length&&o(t[w],t[b])<0&&(b=w),o(t[b],f)>=0)break;t[s]=t[b],s=b}t[s]=f}};function zc(s,t,o=0,u=s.length-1,f=Nh){for(;u>o;){if(u-o>600){const M=u-o+1,A=t-o+1,D=Math.log(M),B=.5*Math.exp(2*D/3),V=.5*Math.sqrt(D*B*(M-B)/M)*(A-M/2<0?-1:1);zc(s,t,Math.max(o,Math.floor(t-A*B/M+V)),Math.min(u,Math.floor(t+(M-A)*B/M+V)),f)}const b=s[t];let w=o,S=u;for(ys(s,o,t),f(s[u],b)>0&&ys(s,o,u);w<S;){for(ys(s,w,S),w++,S--;f(s[w],b)<0;)w++;for(;f(s[S],b)>0;)S--}f(s[o],b)===0?ys(s,o,S):(S++,ys(s,S,u)),S<=t&&(o=S+1),t<=S&&(u=S-1)}}function ys(s,t,o){const u=s[t];s[t]=s[o],s[o]=u}function Nh(s,t){return s<t?-1:s>t?1:0}function io(s,t){if(s.length<=1)return[s];const o=[];let u,f;for(const b of s){const w=Bs(b);w!==0&&(b.area=Math.abs(w),f===void 0&&(f=w<0),f===w<0?(u&&o.push(u),u=[b]):u.push(b))}if(u&&o.push(u),t>1)for(let b=0;b<o.length;b++)o[b].length<=t||(zc(o[b],t,1,o[b].length-1,jh),o[b]=o[b].slice(0,t));return o}function jh(s,t){return t.area-s.area}function Bs(s){let t=0;for(let o,u,f=0,b=s.length,w=b-1;f<b;w=f++)o=s[f],u=s[w],t+=(u.x-o.x)*(o.y+u.y);return t}const Bu=1/298.257223563,Lo=Bu*(2-Bu),ul=Math.PI/180;class $l{constructor(t){const o=6378.137*ul*1e3,u=Math.cos(t*ul),f=1/(1-Lo*(1-u*u)),b=Math.sqrt(f);this.kx=o*b*u,this.ky=o*b*f*(1-Lo)}distance(t,o){const u=this.wrap(t[0]-o[0])*this.kx,f=(t[1]-o[1])*this.ky;return Math.sqrt(u*u+f*f)}pointOnLine(t,o){let u,f,b,w,S=1/0;for(let M=0;M<t.length-1;M++){let A=t[M][0],D=t[M][1],B=this.wrap(t[M+1][0]-A)*this.kx,V=(t[M+1][1]-D)*this.ky,H=0;B===0&&V===0||(H=(this.wrap(o[0]-A)*this.kx*B+(o[1]-D)*this.ky*V)/(B*B+V*V),H>1?(A=t[M+1][0],D=t[M+1][1]):H>0&&(A+=B/this.kx*H,D+=V/this.ky*H)),B=this.wrap(o[0]-A)*this.kx,V=(o[1]-D)*this.ky;const W=B*B+V*V;W<S&&(S=W,u=A,f=D,b=M,w=H)}return{point:[u,f],index:b,t:Math.max(0,Math.min(1,w))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ri(s,t){return t[0]-s[0]}function Ns(s){return s[1]-s[0]+1}function po(s,t){return s[1]>=s[0]&&s[1]<t}function ya(s,t){if(s[0]>s[1])return[null,null];const o=Ns(s);if(t){if(o===2)return[s,null];const f=Math.floor(o/2);return[[s[0],s[0]+f],[s[0]+f,s[1]]]}if(o===1)return[s,null];const u=Math.floor(o/2)-1;return[[s[0],s[0]+u],[s[0]+u+1,s[1]]]}function vs(s,t){if(!po(t,s.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let u=t[0];u<=t[1];++u)sl(o,s[u]);return o}function va(s){const t=[1/0,1/0,-1/0,-1/0];for(const o of s)for(const u of o)sl(t,u);return t}function Vl(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function Zl(s,t,o){if(!Vl(s)||!Vl(t))return NaN;let u=0,f=0;return s[2]<t[0]&&(u=t[0]-s[2]),s[0]>t[2]&&(u=s[0]-t[2]),s[1]>t[3]&&(f=s[1]-t[3]),s[3]<t[1]&&(f=t[1]-s[3]),o.distance([0,0],[u,f])}function js(s,t,o){const u=o.pointOnLine(t,s);return o.distance(s,u.point)}function xa(s,t,o,u,f){const b=Math.min(js(s,[o,u],f),js(t,[o,u],f)),w=Math.min(js(o,[s,t],f),js(u,[s,t],f));return Math.min(b,w)}function Uh(s,t,o,u,f){if(!po(t,s.length)||!po(u,o.length))return 1/0;let b=1/0;for(let w=t[0];w<t[1];++w){const S=s[w],M=s[w+1];for(let A=u[0];A<u[1];++A){const D=o[A],B=o[A+1];if(ll(S,M,D,B))return 0;b=Math.min(b,xa(S,M,D,B,f))}}return b}function Nu(s,t,o,u,f){if(!po(t,s.length)||!po(u,o.length))return NaN;let b=1/0;for(let w=t[0];w<=t[1];++w)for(let S=u[0];S<=u[1];++S)if(b=Math.min(b,f.distance(s[w],o[S])),b===0)return b;return b}function $h(s,t,o){if(ho(s,t,!0))return 0;let u=1/0;for(const f of t){const b=f[0],w=f[f.length-1];if(b!==w&&(u=Math.min(u,js(s,[w,b],o)),u===0))return u;const S=o.pointOnLine(f,s);if(u=Math.min(u,o.distance(s,S.point)),u===0)return u}return u}function ju(s,t,o,u){if(!po(t,s.length))return NaN;for(let b=t[0];b<=t[1];++b)if(ho(s[b],o,!0))return 0;let f=1/0;for(let b=t[0];b<t[1];++b){const w=s[b],S=s[b+1];for(const M of o)for(let A=0,D=M.length,B=D-1;A<D;B=A++){const V=M[B],H=M[A];if(ll(w,S,V,H))return 0;f=Math.min(f,xa(w,S,V,H,u))}}return f}function Uu(s,t){for(const o of s)for(const u of o)if(ho(u,t,!0))return!0;return!1}function ko(s,t,o,u=1/0){const f=va(s),b=va(t);if(u!==1/0&&Zl(f,b,o)>=u)return u;if(al(f,b)){if(Uu(s,t))return 0}else if(Uu(t,s))return 0;let w=1/0;for(const S of s)for(let M=0,A=S.length,D=A-1;M<A;D=M++){const B=S[D],V=S[M];for(const H of t)for(let W=0,Y=H.length,re=Y-1;W<Y;re=W++){const le=H[re],Me=H[W];if(ll(B,V,le,Me))return 0;w=Math.min(w,xa(B,V,le,Me,o))}}return w}function hl(s,t,o,u,f,b){if(!b)return;const w=Zl(vs(u,b),f,o);w<t&&s.push([w,b,[0,0]])}function ql(s,t,o,u,f,b,w){if(!b||!w)return;const S=Zl(vs(u,b),vs(f,w),o);S<t&&s.push([S,b,w])}function Us(s,t,o,u,f=1/0){let b=Math.min(u.distance(s[0],o[0][0]),f);if(b===0)return b;const w=new cl([[0,[0,s.length-1],[0,0]]],Ri),S=va(o);for(;w.length>0;){const M=w.pop();if(M[0]>=b)continue;const A=M[1],D=t?50:100;if(Ns(A)<=D){if(!po(A,s.length))return NaN;if(t){const B=ju(s,A,o,u);if(isNaN(B)||B===0)return B;b=Math.min(b,B)}else for(let B=A[0];B<=A[1];++B){const V=$h(s[B],o,u);if(b=Math.min(b,V),b===0)return 0}}else{const B=ya(A,t);hl(w,b,u,s,S,B[0]),hl(w,b,u,s,S,B[1])}}return b}function Gl(s,t,o,u,f,b=1/0){let w=Math.min(b,f.distance(s[0],o[0]));if(w===0)return w;const S=new cl([[0,[0,s.length-1],[0,o.length-1]]],Ri);for(;S.length>0;){const M=S.pop();if(M[0]>=w)continue;const A=M[1],D=M[2],B=t?50:100,V=u?50:100;if(Ns(A)<=B&&Ns(D)<=V){if(!po(A,s.length)&&po(D,o.length))return NaN;let H;if(t&&u)H=Uh(s,A,o,D,f),w=Math.min(w,H);else if(t&&!u){const W=s.slice(A[0],A[1]+1);for(let Y=D[0];Y<=D[1];++Y)if(H=js(o[Y],W,f),w=Math.min(w,H),w===0)return w}else if(!t&&u){const W=o.slice(D[0],D[1]+1);for(let Y=A[0];Y<=A[1];++Y)if(H=js(s[Y],W,f),w=Math.min(w,H),w===0)return w}else H=Nu(s,A,o,D,f),w=Math.min(w,H)}else{const H=ya(A,t),W=ya(D,u);ql(S,w,f,s,o,H[0],W[0]),ql(S,w,f,s,o,H[0],W[1]),ql(S,w,f,s,o,H[1],W[0]),ql(S,w,f,s,o,H[1],W[1])}}return w}function Hl(s){return s.type==="MultiPolygon"?s.coordinates.map(t=>({type:"Polygon",coordinates:t})):s.type==="MultiLineString"?s.coordinates.map(t=>({type:"LineString",coordinates:t})):s.type==="MultiPoint"?s.coordinates.map(t=>({type:"Point",coordinates:t})):[s]}class $s{constructor(t,o){this.type=mt,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ur(t[1])){const u=t[1];if(u.type==="FeatureCollection")return new $s(u,u.features.map(f=>Hl(f.geometry)).flat());if(u.type==="Feature")return new $s(u,Hl(u.geometry));if("type"in u&&"coordinates"in u)return new $s(u,Hl(u))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){const f=o.geometry(),b=f.flat().map(M=>ol([M.x,M.y],o.canonical));if(f.length===0)return NaN;const w=new $l(b[0][1]);let S=1/0;for(const M of u){switch(M.type){case"Point":S=Math.min(S,Gl(b,!1,[M.coordinates],!1,w,S));break;case"LineString":S=Math.min(S,Gl(b,!1,M.coordinates,!0,w,S));break;case"Polygon":S=Math.min(S,Us(b,!1,M.coordinates,w,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){const f=o.geometry(),b=f.flat().map(M=>ol([M.x,M.y],o.canonical));if(f.length===0)return NaN;const w=new $l(b[0][1]);let S=1/0;for(const M of u){switch(M.type){case"Point":S=Math.min(S,Gl(b,!0,[M.coordinates],!1,w,S));break;case"LineString":S=Math.min(S,Gl(b,!0,M.coordinates,!0,w,S));break;case"Polygon":S=Math.min(S,Us(b,!0,M.coordinates,w,S))}if(S===0)return S}return S}(t,this.geometries);if(t.geometryType()==="Polygon")return function(o,u){const f=o.geometry();if(f.length===0||f[0].length===0)return NaN;const b=io(f,0).map(M=>M.map(A=>A.map(D=>ol([D.x,D.y],o.canonical)))),w=new $l(b[0][0][0][1]);let S=1/0;for(const M of u)for(const A of b){switch(M.type){case"Point":S=Math.min(S,Us([M.coordinates],!1,A,w,S));break;case"LineString":S=Math.min(S,Us(M.coordinates,!0,A,w,S));break;case"Polygon":S=Math.min(S,ko(A,M.coordinates,w,S))}if(S===0)return S}return S}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Zo{constructor(t){this.type=ui,this.key=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=t[1];return u==null?o.error("Global state property must be defined."):typeof u!="string"?o.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Zo(u)}evaluate(t){var o;const u=(o=t.globals)===null||o===void 0?void 0:o.globalState;return u&&Object.keys(u).length!==0?mi(u,this.key):null}eachChild(){}outputDefined(){return!1}}const ba={"==":nl,"!=":Oh,">":Fu,"<":Ou,">=":Eo,"<=":Nl,array:ir,at:$n,boolean:ir,case:kn,coalesce:yr,collator:jl,format:rr,image:Ul,in:ps,"index-of":el,interpolate:nr,"interpolate-hcl":nr,"interpolate-lab":nr,length:rl,let:$o,literal:gr,match:Fs,number:ir,"number-format":_s,object:ir,slice:tl,step:pa,string:ir,"to-boolean":uo,"to-color":uo,"to-number":uo,"to-string":uo,var:eo,within:kr,distance:$s,"global-state":Zo};class Hn{constructor(t,o,u,f){this.name=t,this.type=o,this._evaluate=u,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,o){const u=t[0],f=Hn.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,w=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=w.filter(([A])=>!Array.isArray(A)||A.length===t.length-1);let M=null;for(const[A,D]of S){M=new _r(o.registry,dl,o.path,null,o.scope);const B=[];let V=!1;for(let H=1;H<t.length;H++){const W=t[H],Y=Array.isArray(A)?A[H-1]:A.type,re=M.parse(W,1+B.length,Y);if(!re){V=!0;break}B.push(re)}if(!V)if(Array.isArray(A)&&A.length!==B.length)M.error(`Expected ${A.length} arguments, but found ${B.length} instead.`);else{for(let H=0;H<B.length;H++){const W=Array.isArray(A)?A[H]:A.type,Y=B[H];M.concat(H+1).checkSubtype(W,Y.type)}if(M.errors.length===0)return new Hn(u,b,D,B)}}if(S.length===1)o.errors.push(...M.errors);else{const A=(S.length?S:w).map(([B])=>{return V=B,Array.isArray(V)?`(${V.map(Ki).join(", ")})`:`(${Ki(V.type)}...)`;var V}).join(" | "),D=[];for(let B=1;B<t.length;B++){const V=o.parse(t[B],1+D.length);if(!V)return null;D.push(Ki(V.type))}o.error(`Expected arguments of type ${A}, but found (${D.join(", ")}) instead.`)}return null}static register(t,o){Hn.definitions=o;for(const u in o)t[u]=Hn}}function Rc(s,[t,o,u,f]){t=t.evaluate(s),o=o.evaluate(s),u=u.evaluate(s);const b=f?f.evaluate(s):1,w=Vt(t,o,u,b);if(w)throw new tn(w);return new bi(t/255,o/255,u/255,b,!1)}function Dc(s,t){return s in t}function Oc(s,t){const o=t[s];return o===void 0?null:o}function vr(s){return{type:s}}function dl(s){if(s instanceof eo)return dl(s.boundExpression);if(s instanceof Hn&&s.name==="error"||s instanceof jl||s instanceof kr||s instanceof $s||s instanceof Zo)return!1;const t=s instanceof uo||s instanceof ir;let o=!0;return s.eachChild(u=>{o=t?o&&dl(u):o&&u instanceof gr}),!!o&&pl(s)&&wa(s,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function pl(s){if(s instanceof Hn&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof kr||s instanceof $s)return!1;let t=!0;return s.eachChild(o=>{t&&!pl(o)&&(t=!1)}),t}function qo(s){if(s instanceof Hn&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(o=>{t&&!qo(o)&&(t=!1)}),t}function wa(s,t){if(s instanceof Hn&&t.indexOf(s.name)>=0)return!1;let o=!0;return s.eachChild(u=>{o&&!wa(u,t)&&(o=!1)}),o}function fl(s){return{result:"success",value:s}}function zo(s){return{result:"error",value:s}}function Vs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Wl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Fc(s){return!!s.expression&&s.expression.interpolated}function wi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function xs(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&Kt(s)===To}function Bc(s){return s}function Nc(s,t){const o=s.stops&&typeof s.stops[0][0]=="object",u=o||!(o||s.property!==void 0),f=s.type||(Fc(t)?"exponential":"interval"),b=function(D){switch(D.type){case"color":return bi.parse;case"padding":return li.parse;case"numberArray":return Gn.parse;case"colorArray":return Ln.parse;default:return null}}(t);if(b&&((s=Un({},s)).stops&&(s.stops=s.stops.map(D=>[D[0],b(D[1])])),s.default=b(s.default?s.default:t.default)),s.colorSpace&&(w=s.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var w;const S=function(D){switch(D){case"exponential":return jc;case"interval":return $u;case"categorical":return Vh;case"identity":return Vu;default:throw new Error(`Unknown function type "${D}"`)}}(f);let M,A;if(f==="categorical"){M=Object.create(null);for(const D of s.stops)M[D[0]]=D[1];A=typeof s.stops[0][0]}if(o){const D={},B=[];for(let W=0;W<s.stops.length;W++){const Y=s.stops[W],re=Y[0].zoom;D[re]===void 0&&(D[re]={zoom:re,type:s.type,property:s.property,default:s.default,stops:[]},B.push(re)),D[re].stops.push([Y[0].value,Y[1]])}const V=[];for(const W of B)V.push([D[W].zoom,Nc(D[W],t)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:nr.interpolationFactor.bind(void 0,H),zoomStops:V.map(W=>W[0]),evaluate:({zoom:W},Y)=>jc({stops:V,base:s.base},t,W).evaluate(W,Y)}}if(u){const D=f==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:nr.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(B=>B[0]),evaluate:({zoom:B})=>S(s,t,B,M,A)}}return{kind:"source",evaluate(D,B){const V=B&&B.properties?B.properties[s.property]:void 0;return V===void 0?Ta(s.default,t.default):S(s,t,V,M,A)}}}function Ta(s,t,o){return s!==void 0?s:t!==void 0?t:o!==void 0?o:void 0}function Vh(s,t,o,u,f){return Ta(typeof o===f?u[o]:void 0,s.default,t.default)}function $u(s,t,o){if(wi(o)!=="number")return Ta(s.default,t.default);const u=s.stops.length;if(u===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[u-1][0])return s.stops[u-1][1];const f=fs(s.stops.map(b=>b[0]),o);return s.stops[f][1]}function jc(s,t,o){const u=s.base!==void 0?s.base:1;if(wi(o)!=="number")return Ta(s.default,t.default);const f=s.stops.length;if(f===1||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[f-1][0])return s.stops[f-1][1];const b=fs(s.stops.map(D=>D[0]),o),w=function(D,B,V,H){const W=H-V,Y=D-V;return W===0?0:B===1?Y/W:(Math.pow(B,Y)-1)/(Math.pow(B,W)-1)}(o,u,s.stops[b][0],s.stops[b+1][0]),S=s.stops[b][1],M=s.stops[b+1][1],A=$r[t.type]||Bc;return typeof S.evaluate=="function"?{evaluate(...D){const B=S.evaluate.apply(void 0,D),V=M.evaluate.apply(void 0,D);if(B!==void 0&&V!==void 0)return A(B,V,w,s.colorSpace)}}:A(S,M,w,s.colorSpace)}function Vu(s,t,o){switch(t.type){case"color":o=bi.parse(o);break;case"formatted":o=cn.fromString(o.toString());break;case"resolvedImage":o=tr.fromString(o.toString());break;case"padding":o=li.parse(o);break;case"colorArray":o=Ln.parse(o);break;case"numberArray":o=Gn.parse(o);break;default:wi(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0)}return Ta(o,s.default,t.default)}Hn.register(ba,{error:[{kind:"error"},[ci],(s,[t])=>{throw new tn(t.evaluate(s))}],typeof:[ci,[ui],(s,[t])=>Ki(Kt(t.evaluate(s)))],"to-rgba":[mr(mt,4),[Br],(s,[t])=>{const[o,u,f,b]=t.evaluate(s).rgb;return[255*o,255*u,255*f,b]}],rgb:[Br,[mt,mt,mt],Rc],rgba:[Br,[mt,mt,mt,mt],Rc],has:{type:fi,overloads:[[[ci],(s,[t])=>Dc(t.evaluate(s),s.properties())],[[ci,To],(s,[t,o])=>Dc(t.evaluate(s),o.evaluate(s))]]},get:{type:ui,overloads:[[[ci],(s,[t])=>Oc(t.evaluate(s),s.properties())],[[ci,To],(s,[t,o])=>Oc(t.evaluate(s),o.evaluate(s))]]},"feature-state":[ui,[ci],(s,[t])=>Oc(t.evaluate(s),s.featureState||{})],properties:[To,[],s=>s.properties()],"geometry-type":[ci,[],s=>s.geometryType()],id:[ui,[],s=>s.id()],zoom:[mt,[],s=>s.globals.zoom],"heatmap-density":[mt,[],s=>s.globals.heatmapDensity||0],elevation:[mt,[],s=>s.globals.elevation||0],"line-progress":[mt,[],s=>s.globals.lineProgress||0],accumulated:[ui,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[mt,vr(mt),(s,t)=>{let o=0;for(const u of t)o+=u.evaluate(s);return o}],"*":[mt,vr(mt),(s,t)=>{let o=1;for(const u of t)o*=u.evaluate(s);return o}],"-":{type:mt,overloads:[[[mt,mt],(s,[t,o])=>t.evaluate(s)-o.evaluate(s)],[[mt],(s,[t])=>-t.evaluate(s)]]},"/":[mt,[mt,mt],(s,[t,o])=>t.evaluate(s)/o.evaluate(s)],"%":[mt,[mt,mt],(s,[t,o])=>t.evaluate(s)%o.evaluate(s)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(s,[t,o])=>Math.pow(t.evaluate(s),o.evaluate(s))],sqrt:[mt,[mt],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[mt,[mt],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[mt,[mt],(s,[t])=>Math.log(t.evaluate(s))],log2:[mt,[mt],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[mt,[mt],(s,[t])=>Math.sin(t.evaluate(s))],cos:[mt,[mt],(s,[t])=>Math.cos(t.evaluate(s))],tan:[mt,[mt],(s,[t])=>Math.tan(t.evaluate(s))],asin:[mt,[mt],(s,[t])=>Math.asin(t.evaluate(s))],acos:[mt,[mt],(s,[t])=>Math.acos(t.evaluate(s))],atan:[mt,[mt],(s,[t])=>Math.atan(t.evaluate(s))],min:[mt,vr(mt),(s,t)=>Math.min(...t.map(o=>o.evaluate(s)))],max:[mt,vr(mt),(s,t)=>Math.max(...t.map(o=>o.evaluate(s)))],abs:[mt,[mt],(s,[t])=>Math.abs(t.evaluate(s))],round:[mt,[mt],(s,[t])=>{const o=t.evaluate(s);return o<0?-Math.round(-o):Math.round(o)}],floor:[mt,[mt],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[mt,[mt],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[fi,[ci,ui],(s,[t,o])=>s.properties()[t.value]===o.value],"filter-id-==":[fi,[ui],(s,[t])=>s.id()===t.value],"filter-type-==":[fi,[ci],(s,[t])=>s.geometryType()===t.value],"filter-<":[fi,[ci,ui],(s,[t,o])=>{const u=s.properties()[t.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[fi,[ui],(s,[t])=>{const o=s.id(),u=t.value;return typeof o==typeof u&&o<u}],"filter->":[fi,[ci,ui],(s,[t,o])=>{const u=s.properties()[t.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[fi,[ui],(s,[t])=>{const o=s.id(),u=t.value;return typeof o==typeof u&&o>u}],"filter-<=":[fi,[ci,ui],(s,[t,o])=>{const u=s.properties()[t.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[fi,[ui],(s,[t])=>{const o=s.id(),u=t.value;return typeof o==typeof u&&o<=u}],"filter->=":[fi,[ci,ui],(s,[t,o])=>{const u=s.properties()[t.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[fi,[ui],(s,[t])=>{const o=s.id(),u=t.value;return typeof o==typeof u&&o>=u}],"filter-has":[fi,[ui],(s,[t])=>t.value in s.properties()],"filter-has-id":[fi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[fi,[mr(ci)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[fi,[mr(ui)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[fi,[ci,mr(ui)],(s,[t,o])=>o.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[fi,[ci,mr(ui)],(s,[t,o])=>function(u,f,b,w){for(;b<=w;){const S=b+w>>1;if(f[S]===u)return!0;f[S]>u?w=S-1:b=S+1}return!1}(s.properties()[t.value],o.value,0,o.value.length-1)],all:{type:fi,overloads:[[[fi,fi],(s,[t,o])=>t.evaluate(s)&&o.evaluate(s)],[vr(fi),(s,t)=>{for(const o of t)if(!o.evaluate(s))return!1;return!0}]]},any:{type:fi,overloads:[[[fi,fi],(s,[t,o])=>t.evaluate(s)||o.evaluate(s)],[vr(fi),(s,t)=>{for(const o of t)if(o.evaluate(s))return!0;return!1}]]},"!":[fi,[fi],(s,[t])=>!t.evaluate(s)],"is-supported-script":[fi,[ci],(s,[t])=>{const o=s.globals&&s.globals.isSupportedScript;return!o||o(t.evaluate(s))}],upcase:[ci,[ci],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[ci,[ci],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[ci,vr(ui),(s,t)=>t.map(o=>ds(o.evaluate(s))).join("")],"resolved-locale":[ci,[Bo],(s,[t])=>t.evaluate(s).resolvedLocale()]});class c{constructor(t,o){this.expression=t,this._warningHistory={},this._evaluator=new Ru,this._defaultValue=o?function(u){if(u.type==="color"&&xs(u.default))return new bi(0,0,0,0);switch(u.type){case"color":return bi.parse(u.default)||null;case"padding":return li.parse(u.default)||null;case"numberArray":return Gn.parse(u.default)||null;case"colorArray":return Ln.parse(u.default)||null;case"variableAnchorOffsetCollection":return di.parse(u.default)||null;case"projectionDefinition":return ti.parse(u.default)||null;default:return u.default===void 0?null:u.default}}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,u,f,b,w){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(t,o,u,f,b,w){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new tn(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function y(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in ba}function P(s,t){const o=new _r(ba,dl,[],t?function(f){const b={color:Br,string:ci,number:mt,enum:ci,boolean:fi,formatted:So,padding:Tn,numberArray:Xa,colorArray:Ka,projectionDefinition:Dl,resolvedImage:No,variableAnchorOffsetCollection:Ya};return f.type==="array"?mr(b[f.value]||ui,f.length):b[f.type]}(t):void 0),u=o.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?fl(new c(u,t)):zo(o.errors)}class z{constructor(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!qo(o.expression),this.globalStateRefs=Ge(o.expression)}evaluateWithoutErrorHandling(t,o,u,f,b,w){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,f,b,w)}evaluate(t,o,u,f,b,w){return this._styleExpression.evaluate(t,o,u,f,b,w)}}class U{constructor(t,o,u,f){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!qo(o.expression),this.globalStateRefs=Ge(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,o,u,f,b,w){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,f,b,w)}evaluate(t,o,u,f,b,w){return this._styleExpression.evaluate(t,o,u,f,b,w)}interpolationFactor(t,o,u){return this.interpolationType?nr.interpolationFactor(this.interpolationType,t,o,u):0}}function ee(s,t){const o=P(s,t);if(o.result==="error")return o;const u=o.value.expression,f=pl(u);if(!f&&!Vs(t))return zo([new ln("","data expressions not supported")]);const b=wa(u,["zoom"]);if(!b&&!Wl(t))return zo([new ln("","zoom expressions not supported")]);const w=Oe(u);return w||b?w instanceof ln?zo([w]):w instanceof nr&&!Fc(t)?zo([new ln("",'"interpolate" expressions cannot be used with this property')]):fl(w?new U(f?"camera":"composite",o.value,w.labels,w instanceof nr?w.interpolation:void 0):new z(f?"constant":"source",o.value)):zo([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ve{constructor(t,o){this._parameters=t,this._specification=o,Un(this,Nc(this._parameters,this._specification))}static deserialize(t){return new ve(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Oe(s){let t=null;if(s instanceof $o)t=Oe(s.result);else if(s instanceof yr){for(const o of s.args)if(t=Oe(o),t)break}else(s instanceof pa||s instanceof nr)&&s.input instanceof Hn&&s.input.name==="zoom"&&(t=s);return t instanceof ln||s.eachChild(o=>{const u=Oe(o);u instanceof ln?t=u:!t&&u?t=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ge(s,t=new Set){return s instanceof Zo&&t.add(s.key),s.eachChild(o=>{Ge(o,t)}),t}function st(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!st(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Lt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ht(s){if(s==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};st(s)||(s=Pn(s));const t=P(s,Lt);if(t.result==="error")throw new Error(t.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,f)=>t.value.evaluate(o,u,{},f),needGeometry:or(s),getGlobalStateRefs:()=>Ge(t.value.expression)}}function Pi(s,t){return s<t?-1:s>t?1:0}function or(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let t=1;t<s.length;t++)if(or(s[t]))return!0;return!1}function Pn(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?zr(s[1],s[2],"=="):t==="!="?ml(zr(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?zr(s[1],s[2],t):t==="any"?(o=s.slice(1),["any"].concat(o.map(Pn))):t==="all"?["all"].concat(s.slice(1).map(Pn)):t==="none"?["all"].concat(s.slice(1).map(Pn).map(ml)):t==="in"?xr(s[1],s.slice(2)):t==="!in"?ml(xr(s[1],s.slice(2))):t==="has"?Zs(s[1]):t!=="!has"||ml(Zs(s[1]));var o}function zr(s,t,o){switch(s){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,s,t]}}function xr(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",s,["literal",t.sort(Pi)]]:["filter-in-small",s,["literal",t]]}}function Zs(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ml(s){return["!",s]}function Kl(s){const t=typeof s;if(t==="number"||t==="boolean"||t==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let f="[";for(const b of s)f+=`${Kl(b)},`;return`${f}]`}const o=Object.keys(s).sort();let u="{";for(let f=0;f<o.length;f++)u+=`${JSON.stringify(o[f])}:${Kl(s[o[f]])},`;return`${u}}`}function Xl(s){let t="";for(const o of Tt)t+=`/${Kl(s[o])}`;return t}function Uc(s){const t=s.value;return t?[new ft(s.key,t,"constants have been deprecated as of v8")]:[]}function pn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Go(s){if(Array.isArray(s))return s.map(Go);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const o in s)t[o]=Go(s[o]);return t}return pn(s)}function $i(s){const t=s.key,o=s.value,u=s.valueSpec||{},f=s.objectElementValidators||{},b=s.style,w=s.styleSpec,S=s.validateSpec;let M=[];const A=wi(o);if(A!=="object")return[new ft(t,o,`object expected, ${A} found`)];for(const D in o){const B=D.split(".")[0],V=mi(u,B)||u["*"];let H;if(mi(f,B))H=f[B];else if(mi(u,B))H=S;else if(f["*"])H=f["*"];else{if(!u["*"]){M.push(new ft(t,o[D],`unknown property "${D}"`));continue}H=S}M=M.concat(H({key:(t&&`${t}.`)+D,value:o[D],valueSpec:V,style:b,styleSpec:w,object:o,objectKey:D,validateSpec:S},o))}for(const D in u)f[D]||u[D].required&&u[D].default===void 0&&o[D]===void 0&&M.push(new ft(t,o,`missing required property "${D}"`));return M}function qs(s){const t=s.value,o=s.valueSpec,u=s.style,f=s.styleSpec,b=s.key,w=s.arrayElementValidator||s.validateSpec;if(wi(t)!=="array")return[new ft(b,t,`array expected, ${wi(t)} found`)];if(o.length&&t.length!==o.length)return[new ft(b,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new ft(b,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let S={type:o.value,values:o.values};f.$version<7&&(S.function=o.function),wi(o.value)==="object"&&(S=o.value);let M=[];for(let A=0;A<t.length;A++)M=M.concat(w({array:t,arrayIndex:A,value:t[A],valueSpec:S,validateSpec:s.validateSpec,style:u,styleSpec:f,key:`${b}[${A}]`}));return M}function gl(s){const t=s.key,o=s.value,u=s.valueSpec;let f=wi(o);return f==="number"&&o!=o&&(f="NaN"),f!=="number"?[new ft(t,o,`number expected, ${f} found`)]:"minimum"in u&&o<u.minimum?[new ft(t,o,`${o} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&o>u.maximum?[new ft(t,o,`${o} is greater than the maximum value ${u.maximum}`)]:[]}function Sa(s){const t=s.valueSpec,o=pn(s.value.type);let u,f,b,w={};const S=o!=="categorical"&&s.value.property===void 0,M=!S,A=wi(s.value.stops)==="array"&&wi(s.value.stops[0])==="array"&&wi(s.value.stops[0][0])==="object",D=$i({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(H){if(o==="identity")return[new ft(H.key,H.value,'identity function may not have a "stops" property')];let W=[];const Y=H.value;return W=W.concat(qs({key:H.key,value:Y,valueSpec:H.valueSpec,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:B})),wi(Y)==="array"&&Y.length===0&&W.push(new ft(H.key,Y,"array must have at least one stop")),W},default:function(H){return H.validateSpec({key:H.key,value:H.value,valueSpec:t,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec})}}});return o==="identity"&&S&&D.push(new ft(s.key,s.value,'missing required property "property"')),o==="identity"||s.value.stops||D.push(new ft(s.key,s.value,'missing required property "stops"')),o==="exponential"&&s.valueSpec.expression&&!Fc(s.valueSpec)&&D.push(new ft(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!Vs(s.valueSpec)?D.push(new ft(s.key,s.value,"property functions not supported")):S&&!Wl(s.valueSpec)&&D.push(new ft(s.key,s.value,"zoom functions not supported"))),o!=="categorical"&&!A||s.value.property!==void 0||D.push(new ft(s.key,s.value,'"property" property is required')),D;function B(H){let W=[];const Y=H.value,re=H.key;if(wi(Y)!=="array")return[new ft(re,Y,`array expected, ${wi(Y)} found`)];if(Y.length!==2)return[new ft(re,Y,`array length 2 expected, length ${Y.length} found`)];if(A){if(wi(Y[0])!=="object")return[new ft(re,Y,`object expected, ${wi(Y[0])} found`)];if(Y[0].zoom===void 0)return[new ft(re,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new ft(re,Y,"object stop key must have value")];if(b&&b>pn(Y[0].zoom))return[new ft(re,Y[0].zoom,"stop zoom values must appear in ascending order")];pn(Y[0].zoom)!==b&&(b=pn(Y[0].zoom),f=void 0,w={}),W=W.concat($i({key:`${re}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:gl,value:V}}))}else W=W.concat(V({key:`${re}[0]`,value:Y[0],validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec},Y));return y(Go(Y[1]))?W.concat([new ft(`${re}[1]`,Y[1],"expressions are not allowed in function stops.")]):W.concat(H.validateSpec({key:`${re}[1]`,value:Y[1],valueSpec:t,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec}))}function V(H,W){const Y=wi(H.value),re=pn(H.value),le=H.value!==null?H.value:W;if(u){if(Y!==u)return[new ft(H.key,le,`${Y} stop domain type must match previous stop domain type ${u}`)]}else u=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new ft(H.key,le,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&o!=="categorical"){let Me=`number expected, ${Y} found`;return Vs(t)&&o===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(H.key,le,Me)]}return o!=="categorical"||Y!=="number"||isFinite(re)&&Math.floor(re)===re?o!=="categorical"&&Y==="number"&&f!==void 0&&re<f?[new ft(H.key,le,"stop domain values must appear in ascending order")]:(f=re,o==="categorical"&&re in w?[new ft(H.key,le,"stop domain values must be unique")]:(w[re]=!0,[])):[new ft(H.key,le,`integer expected, found ${re}`)]}}function Pa(s){const t=(s.expressionContext==="property"?ee:P)(Go(s.value),s.valueSpec);if(t.result==="error")return t.value.map(u=>new ft(`${s.key}${u.key}`,s.value,u.message));const o=t.value.expression||t.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!o.outputDefined())return[new ft(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!qo(o))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!qo(o))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!wa(o,["zoom","feature-state"]))return[new ft(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!pl(o))return[new ft(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _l(s){const t=s.key,o=s.value,u=wi(o);return u!=="string"?[new ft(t,o,`color expected, ${u} found`)]:bi.parse(String(o))?[]:[new ft(t,o,`color expected, "${o}" found`)]}function Ca(s){const t=s.key,o=s.value,u=s.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(pn(o))===-1&&f.push(new ft(t,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(pn(o))===-1&&f.push(new ft(t,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function $c(s){return st(Go(s.value))?Pa(Un({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Tp(s)}function Tp(s){const t=s.value,o=s.key;if(wi(t)!=="array")return[new ft(o,t,`array expected, ${wi(t)} found`)];const u=s.styleSpec;let f,b=[];if(t.length<1)return[new ft(o,t,"filter array must have at least 1 element")];switch(b=b.concat(Ca({key:`${o}[0]`,value:t[0],valueSpec:u.filter_operator,style:s.style,styleSpec:s.styleSpec})),pn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&pn(t[1])==="$type"&&b.push(new ft(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&b.push(new ft(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=wi(t[1]),f!=="string"&&b.push(new ft(`${o}[1]`,t[1],`string expected, ${f} found`)));for(let w=2;w<t.length;w++)f=wi(t[w]),pn(t[1])==="$type"?b=b.concat(Ca({key:`${o}[${w}]`,value:t[w],valueSpec:u.geometry_type,style:s.style,styleSpec:s.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&b.push(new ft(`${o}[${w}]`,t[w],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let w=1;w<t.length;w++)b=b.concat(Tp({key:`${o}[${w}]`,value:t[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=wi(t[1]),t.length!==2?b.push(new ft(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&b.push(new ft(`${o}[1]`,t[1],`string expected, ${f} found`))}return b}function Sp(s,t){const o=s.key,u=s.validateSpec,f=s.style,b=s.styleSpec,w=s.value,S=s.objectKey,M=b[`${t}_${s.layerType}`];if(!M)return[];const A=S.match(/^(.*)-transition$/);if(t==="paint"&&A&&M[A[1]]&&M[A[1]].transition)return u({key:o,value:w,valueSpec:b.transition,style:f,styleSpec:b});const D=s.valueSpec||M[S];if(!D)return[new ft(o,w,`unknown property "${S}"`)];let B;if(wi(w)==="string"&&Vs(D)&&!D.tokens&&(B=/^{([^}]+)}$/.exec(w)))return[new ft(o,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const V=[];return s.layerType==="symbol"&&(S==="text-field"&&f&&!f.glyphs&&V.push(new ft(o,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&xs(Go(w))&&pn(w.type)==="identity"&&V.push(new ft(o,w,'"text-font" does not support identity functions'))),V.concat(u({key:s.key,value:w,valueSpec:D,style:f,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:S}))}function Yl(s){return Sp(s,"paint")}function Jl(s){return Sp(s,"layout")}function no(s){let t=[];const o=s.value,u=s.key,f=s.style,b=s.styleSpec;if(wi(o)!=="object")return[new ft(u,o,`object expected, ${wi(o)} found`)];o.type||o.ref||t.push(new ft(u,o,'either "type" or "ref" is required'));let w=pn(o.type);const S=pn(o.ref);if(o.id){const M=pn(o.id);for(let A=0;A<s.arrayIndex;A++){const D=f.layers[A];pn(D.id)===M&&t.push(new ft(u,o.id,`duplicate layer id "${o.id}", previously used at line ${D.id.__line__}`))}}if("ref"in o){let M;["type","source","source-layer","filter","layout"].forEach(A=>{A in o&&t.push(new ft(u,o[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{pn(A.id)===S&&(M=A)}),M?M.ref?t.push(new ft(u,o.ref,"ref cannot reference another ref layer")):w=pn(M.type):t.push(new ft(u,o.ref,`ref layer "${S}" not found`))}else if(w!=="background")if(o.source){const M=f.sources&&f.sources[o.source],A=M&&pn(M.type);M?A==="vector"&&w==="raster"?t.push(new ft(u,o.source,`layer "${o.id}" requires a raster source`)):A!=="raster-dem"&&w==="hillshade"||A!=="raster-dem"&&w==="color-relief"?t.push(new ft(u,o.source,`layer "${o.id}" requires a raster-dem source`)):A==="raster"&&w!=="raster"?t.push(new ft(u,o.source,`layer "${o.id}" requires a vector source`)):A!=="vector"||o["source-layer"]?A==="raster-dem"&&w!=="hillshade"&&w!=="color-relief"?t.push(new ft(u,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):w!=="line"||!o.paint||!o.paint["line-gradient"]||A==="geojson"&&M.lineMetrics||t.push(new ft(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ft(u,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new ft(u,o.source,`source "${o.source}" not found`))}else t.push(new ft(u,o,'missing required property "source"'));return t=t.concat($i({key:u,value:o,valueSpec:b.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${u}.type`,value:o.type,valueSpec:b.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:o,objectKey:"type"}),filter:$c,layout:M=>$i({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>Jl(Un({layerType:w},A))}}),paint:M=>$i({layer:o,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":A=>Yl(Un({layerType:w},A))}})}})),t}function Ho(s){const t=s.value,o=s.key,u=wi(t);return u!=="string"?[new ft(o,t,`string expected, ${u} found`)]:[]}const Zh={promoteId:function({key:s,value:t}){if(wi(t)==="string")return Ho({key:s,value:t});{const o=[];for(const u in t)o.push(...Ho({key:`${s}.${u}`,value:t[u]}));return o}}};function Pp(s){const t=s.value,o=s.key,u=s.styleSpec,f=s.style,b=s.validateSpec;if(!t.type)return[new ft(o,t,'"type" is required')];const w=pn(t.type);let S;switch(w){case"vector":case"raster":return S=$i({key:o,value:t,valueSpec:u[`source_${w.replace("-","_")}`],style:s.style,styleSpec:u,objectElementValidators:Zh,validateSpec:b}),S;case"raster-dem":return S=function(M){var A;const D=(A=M.sourceName)!==null&&A!==void 0?A:"",B=M.value,V=M.styleSpec,H=V.source_raster_dem,W=M.style;let Y=[];const re=wi(B);if(B===void 0)return Y;if(re!=="object")return Y.push(new ft("source_raster_dem",B,`object expected, ${re} found`)),Y;const le=pn(B.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],me=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const G in B)!le&&Me.includes(G)?Y.push(new ft(G,B[G],`In "${D}": "${G}" is only valid when "encoding" is set to "custom". ${me} encoding found`)):H[G]?Y=Y.concat(M.validateSpec({key:G,value:B[G],valueSpec:H[G],validateSpec:M.validateSpec,style:W,styleSpec:V})):Y.push(new ft(G,B[G],`unknown property "${G}"`));return Y}({sourceName:o,value:t,style:s.style,styleSpec:u,validateSpec:b}),S;case"geojson":if(S=$i({key:o,value:t,valueSpec:u.source_geojson,style:f,styleSpec:u,validateSpec:b,objectElementValidators:Zh}),t.cluster)for(const M in t.clusterProperties){const[A,D]=t.clusterProperties[M],B=typeof A=="string"?[A,["accumulated"],["get",M]]:A;S.push(...Pa({key:`${o}.${M}.map`,value:D,expressionContext:"cluster-map"})),S.push(...Pa({key:`${o}.${M}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return $i({key:o,value:t,valueSpec:u.source_video,style:f,validateSpec:b,styleSpec:u});case"image":return $i({key:o,value:t,valueSpec:u.source_image,style:f,validateSpec:b,styleSpec:u});case"canvas":return[new ft(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ca({key:`${o}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Cp(s){const t=s.value,o=s.styleSpec,u=o.light,f=s.style;let b=[];const w=wi(t);if(t===void 0)return b;if(w!=="object")return b=b.concat([new ft("light",t,`object expected, ${w} found`)]),b;for(const S in t){const M=S.match(/^(.*)-transition$/);b=b.concat(M&&u[M[1]]&&u[M[1]].transition?s.validateSpec({key:S,value:t[S],valueSpec:o.transition,validateSpec:s.validateSpec,style:f,styleSpec:o}):u[S]?s.validateSpec({key:S,value:t[S],valueSpec:u[S],validateSpec:s.validateSpec,style:f,styleSpec:o}):[new ft(S,t[S],`unknown property "${S}"`)])}return b}function Ql(s){const t=s.value,o=s.styleSpec,u=o.sky,f=s.style,b=wi(t);if(t===void 0)return[];if(b!=="object")return[new ft("sky",t,`object expected, ${b} found`)];let w=[];for(const S in t)w=w.concat(u[S]?s.validateSpec({key:S,value:t[S],valueSpec:u[S],style:f,styleSpec:o}):[new ft(S,t[S],`unknown property "${S}"`)]);return w}function qh(s){const t=s.value,o=s.styleSpec,u=o.terrain,f=s.style;let b=[];const w=wi(t);if(t===void 0)return b;if(w!=="object")return b=b.concat([new ft("terrain",t,`object expected, ${w} found`)]),b;for(const S in t)b=b.concat(u[S]?s.validateSpec({key:S,value:t[S],valueSpec:u[S],validateSpec:s.validateSpec,style:f,styleSpec:o}):[new ft(S,t[S],`unknown property "${S}"`)]);return b}function Zu(s){let t=[];const o=s.value,u=s.key;if(Array.isArray(o)){const f=[],b=[];for(const w in o)o[w].id&&f.includes(o[w].id)&&t.push(new ft(u,o,`all the sprites' ids must be unique, but ${o[w].id} is duplicated`)),f.push(o[w].id),o[w].url&&b.includes(o[w].url)&&t.push(new ft(u,o,`all the sprites' URLs must be unique, but ${o[w].url} is duplicated`)),b.push(o[w].url),t=t.concat($i({key:`${u}[${w}]`,value:o[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return t}return Ho({key:u,value:o})}function Mp(s){return t=s.value,t&&t.constructor===Object?[]:[new ft(s.key,s.value,`object expected, ${wi(s.value)} found`)];var t}const qu={"*":()=>[],array:qs,boolean:function(s){const t=s.value,o=s.key,u=wi(t);return u!=="boolean"?[new ft(o,t,`boolean expected, ${u} found`)]:[]},number:gl,color:_l,constants:Uc,enum:Ca,filter:$c,function:Sa,layer:no,object:$i,source:Pp,light:Cp,sky:Ql,terrain:qh,projection:function(s){const t=s.value,o=s.styleSpec,u=o.projection,f=s.style,b=wi(t);if(t===void 0)return[];if(b!=="object")return[new ft("projection",t,`object expected, ${b} found`)];let w=[];for(const S in t)w=w.concat(u[S]?s.validateSpec({key:S,value:t[S],valueSpec:u[S],style:f,styleSpec:o}):[new ft(S,t[S],`unknown property "${S}"`)]);return w},projectionDefinition:function(s){const t=s.key;let o=s.value;o=o instanceof String?o.valueOf():o;const u=wi(o);return u!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(o)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(o)?["array","string"].includes(u)?[]:[new ft(t,o,`projection expected, invalid type "${u}" found`)]:[new ft(t,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:Ho,formatted:function(s){return Ho(s).length===0?[]:Pa(s)},resolvedImage:function(s){return Ho(s).length===0?[]:Pa(s)},padding:function(s){const t=s.key,o=s.value;if(wi(o)==="array"){if(o.length<1||o.length>4)return[new ft(t,o,`padding requires 1 to 4 values; ${o.length} values found`)];const u={type:"number"};let f=[];for(let b=0;b<o.length;b++)f=f.concat(s.validateSpec({key:`${t}[${b}]`,value:o[b],validateSpec:s.validateSpec,valueSpec:u}));return f}return gl({key:t,value:o,valueSpec:{}})},numberArray:function(s){const t=s.key,o=s.value;if(wi(o)==="array"){const u={type:"number"};if(o.length<1)return[new ft(t,o,"array length at least 1 expected, length 0 found")];let f=[];for(let b=0;b<o.length;b++)f=f.concat(s.validateSpec({key:`${t}[${b}]`,value:o[b],validateSpec:s.validateSpec,valueSpec:u}));return f}return gl({key:t,value:o,valueSpec:{}})},colorArray:function(s){const t=s.key,o=s.value;if(wi(o)==="array"){if(o.length<1)return[new ft(t,o,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<o.length;f++)u=u.concat(_l({key:`${t}[${f}]`,value:o[f]}));return u}return _l({key:t,value:o})},variableAnchorOffsetCollection:function(s){const t=s.key,o=s.value,u=wi(o),f=s.styleSpec;if(u!=="array"||o.length<1||o.length%2!=0)return[new ft(t,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<o.length;w+=2)b=b.concat(Ca({key:`${t}[${w}]`,value:o[w],valueSpec:f.layout_symbol["text-anchor"]})),b=b.concat(qs({key:`${t}[${w+1}]`,value:o[w+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:f}));return b},sprite:Zu,state:Mp};function Gu(s){const t=s.value,o=s.valueSpec,u=s.styleSpec;return s.validateSpec=Gu,o.expression&&xs(pn(t))?Sa(s):o.expression&&y(Go(t))?Pa(s):o.type&&qu[o.type]?qu[o.type](s):$i(Un({},s,{valueSpec:o.type?u[o.type]:o}))}function ec(s){const t=s.value,o=s.key,u=Ho(s);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new ft(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new ft(o,t,'"glyphs" url must include a "{range}" token'))),u}function Ro(s,t=Se){let o=[];return o=o.concat(Gu({key:"",value:s,valueSpec:t.$root,styleSpec:t,style:s,validateSpec:Gu,objectElementValidators:{glyphs:ec,"*":()=>[]}})),s.constants&&(o=o.concat(Uc({key:"constants",value:s.constants}))),Ep(o)}function Wo(s){return function(t){return s({...t,validateSpec:Gu})}}function Ep(s){return[].concat(s).sort((t,o)=>t.line-o.line)}function Vr(s){return function(...t){return Ep(s.apply(this,t))}}Ro.source=Vr(Wo(Pp)),Ro.sprite=Vr(Wo(Zu)),Ro.glyphs=Vr(Wo(ec)),Ro.light=Vr(Wo(Cp)),Ro.sky=Vr(Wo(Ql)),Ro.terrain=Vr(Wo(qh)),Ro.state=Vr(Wo(Mp)),Ro.layer=Vr(Wo(no)),Ro.filter=Vr(Wo($c)),Ro.paintProperty=Vr(Wo(Yl)),Ro.layoutProperty=Vr(Wo(Jl));const tc=Ro,Dm=tc.light,Hu=tc.sky,Om=tc.paintProperty,Gh=tc.layoutProperty;function Vc(s,t){let o=!1;if(t&&t.length)for(const u of t)s.fire(new Re(new Error(u.message))),o=!0;return o}class ic{constructor(t,o,u){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const w=new Int32Array(this.arrayBuffer);t=w[0],this.d=(o=w[1])+2*(u=w[2]);for(let M=0;M<this.d*this.d;M++){const A=w[3+M],D=w[3+M+1];f.push(A===D?null:w.subarray(A,D))}const S=w[3+f.length+1];this.keys=w.subarray(w[3+f.length],S),this.bboxes=w.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*u;for(let w=0;w<this.d*this.d;w++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;const b=u/o*t;this.min=-b,this.max=t+b}insert(t,o,u,f,b){this._forEachCell(o,u,f,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,o,u,f,b,w){this.cells[b].push(w)}query(t,o,u,f,b){const w=this.min,S=this.max;if(t<=w&&o<=w&&S<=u&&S<=f&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,o,u,f,this._queryCell,M,{},b),M}}_queryCell(t,o,u,f,b,w,S,M){const A=this.cells[b];if(A!==null){const D=this.keys,B=this.bboxes;for(let V=0;V<A.length;V++){const H=A[V];if(S[H]===void 0){const W=4*H;(M?M(B[W+0],B[W+1],B[W+2],B[W+3]):t<=B[W+2]&&o<=B[W+3]&&u>=B[W+0]&&f>=B[W+1])?(S[H]=!0,w.push(D[H])):S[H]=!1}}}}_forEachCell(t,o,u,f,b,w,S,M){const A=this._convertToCellCoord(t),D=this._convertToCellCoord(o),B=this._convertToCellCoord(u),V=this._convertToCellCoord(f);for(let H=A;H<=B;H++)for(let W=D;W<=V;W++){const Y=this.d*W+H;if((!M||M(this._convertFromCellCoord(H),this._convertFromCellCoord(W),this._convertFromCellCoord(H+1),this._convertFromCellCoord(W+1)))&&b.call(this,t,o,u,f,Y,w,S,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,o=3+this.cells.length+1+1;let u=0;for(let w=0;w<this.cells.length;w++)u+=this.cells[w].length;const f=new Int32Array(o+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let b=o;for(let w=0;w<t.length;w++){const S=t[w];f[3+w]=b,f.set(S,b),b+=S.length}return f[3+t.length]=b,f.set(this.keys,b),b+=this.keys.length,f[3+t.length+1]=b,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer}static serialize(t,o){const u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}}static deserialize(t){return new ic(t.buffer)}}const bs={};function Mt(s,t,o={}){if(bs[s])throw new Error(`${s} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:s,writeable:!1}),bs[s]={klass:t,omit:o.omit||[],shallow:o.shallow||[]}}Mt("Object",Object),Mt("Set",Set),Mt("TransferableGridIndex",ic),Mt("Color",bi),Mt("Error",Error),Mt("AJAXError",he),Mt("ResolvedImage",tr),Mt("StylePropertyFunction",ve),Mt("StyleExpression",c,{omit:["_evaluator"]}),Mt("ZoomDependentExpression",U),Mt("ZoomConstantExpression",z),Mt("CompoundExpression",Hn,{omit:["_evaluate"]});for(const s in ba)ba[s]._classRegistryKey||Mt(`Expression_${s}`,ba[s]);function Hh(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Zc(s){return s.$name||s.constructor._classRegistryKey}function Wh(s){return!function(t){if(t===null||typeof t!="object")return!1;const o=Zc(t);return!(!o||o==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Hh(s)||dt(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function qc(s,t){if(Wh(s))return(Hh(s)||dt(s))&&t&&t.push(s),ArrayBuffer.isView(s)&&t&&t.push(s.buffer),s instanceof ImageData&&t&&t.push(s.data.buffer),s;if(Array.isArray(s)){const b=[];for(const w of s)b.push(qc(w,t));return b}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const o=Zc(s);if(!o)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!bs[o])throw new Error(`${o} is not registered.`);const{klass:u}=bs[o],f=u.serialize?u.serialize(s,t):{};if(u.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in s){if(!s.hasOwnProperty(b)||bs[o].omit.indexOf(b)>=0)continue;const w=s[b];f[b]=bs[o].shallow.indexOf(b)>=0?w:qc(w,t)}s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(f.$name=o),f}function nc(s){if(Wh(s))return s;if(Array.isArray(s))return s.map(nc);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const t=Zc(s)||"Object";if(!bs[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:o}=bs[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(s);const u=Object.create(o.prototype);for(const f of Object.keys(s)){if(f==="$name")continue;const b=s[f];u[f]=bs[t].shallow.indexOf(f)>=0?b:nc(b)}return u}class Kh{constructor(){this.first=!0}update(t,o){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const Ci={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Hangul Syllables":s=>s>=44032&&s<=55215,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Xh(s){for(const t of s)if(Ku(t.charCodeAt(0)))return!0;return!1}function Ip(s){for(const t of s)if(!Bm(t.charCodeAt(0)))return!1;return!0}function Wu(s){const t=s.map(o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}}).filter(o=>o);return new RegExp(t.join("|"),"u")}const Fm=Wu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Bm(s){return!Fm.test(String.fromCodePoint(s))}const Yh=Wu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ku(s){return!(s!==746&&s!==747&&(s<4352||!(Ci["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ci["CJK Compatibility"](s)||Ci["CJK Strokes"](s)||!(!Ci["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ci["Enclosed CJK Letters and Months"](s)||Ci["Ideographic Description Characters"](s)||Ci.Kanbun(s)||Ci.Katakana(s)&&s!==12540||!(!Ci["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ci["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ci["Vertical Forms"](s)||Ci["Yijing Hexagram Symbols"](s)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(s))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(s))||Yh.test(String.fromCodePoint(s)))))}function Jh(s){return!(Ku(s)||function(t){return!!(Ci["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ci["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ci["Letterlike Symbols"](t)||Ci["Number Forms"](t)||Ci["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ci["Control Pictures"](t)&&t!==9251||Ci["Optical Character Recognition"](t)||Ci["Enclosed Alphanumerics"](t)||Ci["Geometric Shapes"](t)||Ci["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ci["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ci["CJK Symbols and Punctuation"](t)||Ci.Katakana(t)||Ci["Private Use Area"](t)||Ci["CJK Compatibility Forms"](t)||Ci["Small Form Variants"](t)||Ci["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}const Ap=Wu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Gc(s){return Ap.test(String.fromCodePoint(s))}function Nm(s,t){return!(!t&&Gc(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ci.Khmer(s))}function Qh(s){for(const t of s)if(Gc(t.charCodeAt(0)))return!0;return!1}const Ma=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){if(Ma.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(s,t){return l(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(s.pluginStatus!=="loading")return this.setState(s),s;const o=s.pluginURL,u=new Promise(b=>{this.loadScriptResolve=b});t(o);const f=new Promise(b=>setTimeout(()=>b(),this.TIMEOUT));if(yield Promise.race([u,f]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:o};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)})}};class fn{constructor(t,o){this.zoom=t,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new Kh,this.transition=o.transition||{},this.globalState=o.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kh,this.transition={},this.globalState={})}isSupportedScript(t){return function(o,u){for(const f of o)if(!Nm(f.charCodeAt(0),u))return!1;return!0}(t,Ma.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}}}class Hc{constructor(t,o){this.property=t,this.value=o,this.expression=function(u,f){if(xs(u))return new ve(u,f);if(y(u)){const b=ee(u,f);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=u;return f.type==="color"&&typeof u=="string"?b=bi.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?b=di.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(b=ti.parse(u)):b=Ln.parse(u):b=Gn.parse(u):b=li.parse(u),{globalStateRefs:new Set,kind:"constant",evaluate:()=>b}}}(o===void 0?t.specification.default:o,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)}}class Xu{constructor(t){this.property=t,this.value=new Hc(t,void 0)}transitioned(t,o){return new Lp(this.property,this.value,o,er({},t.transition,this.transition),t.now)}untransitioned(){return new Lp(this.property,this.value,null,{},0)}}class ed{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ct(this._values[t].value.value)}setValue(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xu(this._values[t].property)),this._values[t].value=new Hc(this._values[t].property,o===null?void 0:ct(o))}getTransition(t){return ct(this._values[t].transition)}setTransition(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xu(this._values[t].property)),this._values[t].transition=ct(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(t[o]=u);const f=this.getTransition(o);f!==void 0&&(t[`${o}-transition`]=f)}return t}transitioned(t,o){const u=new kp(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(t,o._values[f]);return u}untransitioned(){const t=new kp(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class Lp{constructor(t,o,u,f,b){this.property=t,this.value=o,this.begin=b+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(t,o,u){const f=t.now||0,b=this.value.possiblyEvaluate(t,o,u),w=this.prior;if(w){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return w.possiblyEvaluate(t,o,u);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(t,o,u),b,oi(S))}}return b}}class kp{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,u){const f=new Yu(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(t,o,u);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class jm{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ct(this._values[t].value)}setValue(t,o){this._values[t]=new Hc(this._values[t].property,o===null?void 0:ct(o))}serialize(){const t={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(t[o]=u)}return t}possiblyEvaluate(t,o,u){const f=new Yu(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(t,o,u);return f}}class ws{constructor(t,o,u){this.property=t,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,u,f){return this.property.evaluate(this.value,this.parameters,t,o,u,f)}}class Yu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Rt{constructor(t){this.specification=t}possiblyEvaluate(t,o){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(o)}interpolate(t,o,u){const f=$r[this.specification.type];return f?f(t,o,u):t}}class Xt{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,u,f){return new ws(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,f)}:t.expression,o)}interpolate(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},t.parameters);const f=$r[this.specification.type];if(f){const b=f(t.value.value,o.value.value,u);return new ws(this,{kind:"constant",value:b},t.parameters)}return t}evaluate(t,o,u,f,b,w){return t.kind==="constant"?t.value:t.evaluate(o,u,f,b,w)}}class Ju extends Xt{possiblyEvaluate(t,o,u,f){if(t.value===void 0)return new ws(this,{kind:"constant",value:void 0},o);if(t.expression.kind==="constant"){const b=t.expression.evaluate(o,null,{},u,f),w=t.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,S=this._calculate(w,w,w,o);return new ws(this,{kind:"constant",value:S},o)}if(t.expression.kind==="camera"){const b=this._calculate(t.expression.evaluate({zoom:o.zoom-1}),t.expression.evaluate({zoom:o.zoom}),t.expression.evaluate({zoom:o.zoom+1}),o);return new ws(this,{kind:"constant",value:b},o)}return new ws(this,t.expression,o)}evaluate(t,o,u,f,b,w){if(t.kind==="source"){const S=t.evaluate(o,u,f,b,w);return this._calculate(S,S,S,o)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(o.zoom)-1},u,f),t.evaluate({zoom:Math.floor(o.zoom)},u,f),t.evaluate({zoom:Math.floor(o.zoom)+1},u,f),o):t.value}_calculate(t,o,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}}interpolate(t){return t}}class td{constructor(t){this.specification=t}possiblyEvaluate(t,o,u,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const b=t.expression.evaluate(o,null,{},u,f);return this._calculate(b,b,b,o)}return this._calculate(t.expression.evaluate(new fn(Math.floor(o.zoom-1),o)),t.expression.evaluate(new fn(Math.floor(o.zoom),o)),t.expression.evaluate(new fn(Math.floor(o.zoom+1),o)),o)}}_calculate(t,o,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}}interpolate(t){return t}}class Wc{constructor(t){this.specification=t}possiblyEvaluate(t,o,u,f){return!!t.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class Zr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in t){const u=t[o];u.specification.overridable&&this.overridableProperties.push(o);const f=this.defaultPropertyValues[o]=new Hc(u,void 0),b=this.defaultTransitionablePropertyValues[o]=new Xu(u);this.defaultTransitioningPropertyValues[o]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate({})}}}Mt("DataDrivenProperty",Xt),Mt("DataConstantProperty",Rt),Mt("CrossFadedDataDrivenProperty",Ju),Mt("CrossFadedProperty",td),Mt("ColorRampProperty",Wc);const zp="-transition";class br extends Je{constructor(t,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Ht(t.filter)),o.layout&&(this._unevaluatedLayout=new jm(o.layout)),o.paint)){this._transitionablePaint=new ed(o.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yu(o.paint)}}setFilter(t){this.filter=t,this._featureFilter=Ht(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const u=this._unevaluatedLayout._values[o];for(const f of u.getGlobalStateRefs())t.add(f)}for(const o of this._featureFilter.getGlobalStateRefs())t.add(o);return t}setLayoutProperty(t,o,u={}){o!=null&&this._validate(Gh,`layers.${this.id}.layout.${t}`,t,o,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,o):this.visibility=o)}getPaintProperty(t){return t.endsWith(zp)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o,u={}){if(o!=null&&this._validate(Om,`layers.${this.id}.paint.${t}`,t,o,u))return!1;if(t.endsWith(zp))return this._transitionablePaint.setTransition(t.slice(0,-11),o||void 0),!1;{const f=this._transitionablePaint._values[t],b=f.property.specification["property-type"]==="cross-faded-data-driven",w=f.value.isDataDriven(),S=f.value;this._transitionablePaint.setValue(t,o),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(t,S,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,o,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ke(t,(o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length))}_validate(t,o,u,f,b={}){return(!b||b.validate!==!1)&&Vc(this,t.call(tc,{key:o,layerType:this.type,objectKey:u,value:f,styleSpec:Se,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof ws&&Vs(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Rp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yl{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Cn(s,t=1){let o=0,u=0;return{members:s.map(f=>{const b=Rp[f.type].BYTES_PER_ELEMENT,w=o=Dp(o,Math.max(t,b)),S=f.components||1;return u=Math.max(u,b),o+=b*S,{name:f.name,type:f.type,components:S,offset:w}}),size:Dp(o,Math.max(u,t)),alignment:t}}function Dp(s,t){return Math.ceil(s/t)*t}class Ea extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.int16[f+0]=o,this.int16[f+1]=u,t}}Ea.prototype.bytesPerElement=4,Mt("StructArrayLayout2i4",Ea);class Ia extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const b=3*t;return this.int16[b+0]=o,this.int16[b+1]=u,this.int16[b+2]=f,t}}Ia.prototype.bytesPerElement=6,Mt("StructArrayLayout3i6",Ia);class id extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,t,o,u,f)}emplace(t,o,u,f,b){const w=4*t;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=f,this.int16[w+3]=b,t}}id.prototype.bytesPerElement=8,Mt("StructArrayLayout4i8",id);class Qu extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,o,u,f,b,w)}emplace(t,o,u,f,b,w,S){const M=6*t;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=b,this.int16[M+4]=w,this.int16[M+5]=S,t}}Qu.prototype.bytesPerElement=12,Mt("StructArrayLayout2i4i12",Qu);class vl extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,o,u,f,b,w)}emplace(t,o,u,f,b,w,S){const M=4*t,A=8*t;return this.int16[M+0]=o,this.int16[M+1]=u,this.uint8[A+4]=f,this.uint8[A+5]=b,this.uint8[A+6]=w,this.uint8[A+7]=S,t}}vl.prototype.bytesPerElement=8,Mt("StructArrayLayout2i4ub8",vl);class Kc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.float32[f+0]=o,this.float32[f+1]=u,t}}Kc.prototype.bytesPerElement=8,Mt("StructArrayLayout2f8",Kc);class nd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w,S,M,A,D){const B=this.length;return this.resize(B+1),this.emplace(B,t,o,u,f,b,w,S,M,A,D)}emplace(t,o,u,f,b,w,S,M,A,D,B){const V=10*t;return this.uint16[V+0]=o,this.uint16[V+1]=u,this.uint16[V+2]=f,this.uint16[V+3]=b,this.uint16[V+4]=w,this.uint16[V+5]=S,this.uint16[V+6]=M,this.uint16[V+7]=A,this.uint16[V+8]=D,this.uint16[V+9]=B,t}}nd.prototype.bytesPerElement=20,Mt("StructArrayLayout10ui20",nd);class eh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w,S,M,A,D,B,V){const H=this.length;return this.resize(H+1),this.emplace(H,t,o,u,f,b,w,S,M,A,D,B,V)}emplace(t,o,u,f,b,w,S,M,A,D,B,V,H){const W=12*t;return this.int16[W+0]=o,this.int16[W+1]=u,this.int16[W+2]=f,this.int16[W+3]=b,this.uint16[W+4]=w,this.uint16[W+5]=S,this.uint16[W+6]=M,this.uint16[W+7]=A,this.int16[W+8]=D,this.int16[W+9]=B,this.int16[W+10]=V,this.int16[W+11]=H,t}}eh.prototype.bytesPerElement=24,Mt("StructArrayLayout4i4ui4i24",eh);class rd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const b=3*t;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=f,t}}rd.prototype.bytesPerElement=12,Mt("StructArrayLayout3f12",rd);class v extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}v.prototype.bytesPerElement=4,Mt("StructArrayLayout1ul4",v);class e extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w,S,M,A){const D=this.length;return this.resize(D+1),this.emplace(D,t,o,u,f,b,w,S,M,A)}emplace(t,o,u,f,b,w,S,M,A,D){const B=10*t,V=5*t;return this.int16[B+0]=o,this.int16[B+1]=u,this.int16[B+2]=f,this.int16[B+3]=b,this.int16[B+4]=w,this.int16[B+5]=S,this.uint32[V+3]=M,this.uint16[B+8]=A,this.uint16[B+9]=D,t}}e.prototype.bytesPerElement=20,Mt("StructArrayLayout6i1ul2ui20",e);class r extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,o,u,f,b,w)}emplace(t,o,u,f,b,w,S){const M=6*t;return this.int16[M+0]=o,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=b,this.int16[M+4]=w,this.int16[M+5]=S,t}}r.prototype.bytesPerElement=12,Mt("StructArrayLayout2i2i2i12",r);class h extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,o,u,f,b)}emplace(t,o,u,f,b,w){const S=4*t,M=8*t;return this.float32[S+0]=o,this.float32[S+1]=u,this.float32[S+2]=f,this.int16[M+6]=b,this.int16[M+7]=w,t}}h.prototype.bytesPerElement=16,Mt("StructArrayLayout2f1f2i16",h);class p extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,o,u,f,b,w)}emplace(t,o,u,f,b,w,S){const M=16*t,A=4*t,D=8*t;return this.uint8[M+0]=o,this.uint8[M+1]=u,this.float32[A+1]=f,this.float32[A+2]=b,this.int16[D+6]=w,this.int16[D+7]=S,t}}p.prototype.bytesPerElement=16,Mt("StructArrayLayout2ub2f2i16",p);class x extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const b=3*t;return this.uint16[b+0]=o,this.uint16[b+1]=u,this.uint16[b+2]=f,t}}x.prototype.bytesPerElement=6,Mt("StructArrayLayout3ui6",x);class T extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le){const Me=this.length;return this.resize(Me+1),this.emplace(Me,t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le)}emplace(t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le,Me){const me=24*t,G=12*t,ne=48*t;return this.int16[me+0]=o,this.int16[me+1]=u,this.uint16[me+2]=f,this.uint16[me+3]=b,this.uint32[G+2]=w,this.uint32[G+3]=S,this.uint32[G+4]=M,this.uint16[me+10]=A,this.uint16[me+11]=D,this.uint16[me+12]=B,this.float32[G+7]=V,this.float32[G+8]=H,this.uint8[ne+36]=W,this.uint8[ne+37]=Y,this.uint8[ne+38]=re,this.uint32[G+10]=le,this.int16[me+22]=Me,t}}T.prototype.bytesPerElement=48,Mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class C extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le,Me,me,G,ne,ge,Ne,it,Ze,We,ut,ot){const pt=this.length;return this.resize(pt+1),this.emplace(pt,t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le,Me,me,G,ne,ge,Ne,it,Ze,We,ut,ot)}emplace(t,o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le,Me,me,G,ne,ge,Ne,it,Ze,We,ut,ot,pt){const Xe=32*t,zt=16*t;return this.int16[Xe+0]=o,this.int16[Xe+1]=u,this.int16[Xe+2]=f,this.int16[Xe+3]=b,this.int16[Xe+4]=w,this.int16[Xe+5]=S,this.int16[Xe+6]=M,this.int16[Xe+7]=A,this.uint16[Xe+8]=D,this.uint16[Xe+9]=B,this.uint16[Xe+10]=V,this.uint16[Xe+11]=H,this.uint16[Xe+12]=W,this.uint16[Xe+13]=Y,this.uint16[Xe+14]=re,this.uint16[Xe+15]=le,this.uint16[Xe+16]=Me,this.uint16[Xe+17]=me,this.uint16[Xe+18]=G,this.uint16[Xe+19]=ne,this.uint16[Xe+20]=ge,this.uint16[Xe+21]=Ne,this.uint16[Xe+22]=it,this.uint32[zt+12]=Ze,this.float32[zt+13]=We,this.float32[zt+14]=ut,this.uint16[Xe+30]=ot,this.uint16[Xe+31]=pt,t}}C.prototype.bytesPerElement=64,Mt("StructArrayLayout8i15ui1ul2f2ui64",C);class I extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}I.prototype.bytesPerElement=4,Mt("StructArrayLayout1f4",I);class R extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const b=3*t;return this.uint16[6*t+0]=o,this.float32[b+1]=u,this.float32[b+2]=f,t}}R.prototype.bytesPerElement=12,Mt("StructArrayLayout1ui2f12",R);class F extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const b=4*t;return this.uint32[2*t+0]=o,this.uint16[b+2]=u,this.uint16[b+3]=f,t}}F.prototype.bytesPerElement=8,Mt("StructArrayLayout1ul2ui8",F);class j extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.uint16[f+0]=o,this.uint16[f+1]=u,t}}j.prototype.bytesPerElement=4,Mt("StructArrayLayout2ui4",j);class N extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}N.prototype.bytesPerElement=2,Mt("StructArrayLayout1ui2",N);class Z extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const b=this.length;return this.resize(b+1),this.emplace(b,t,o,u,f)}emplace(t,o,u,f,b){const w=4*t;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=f,this.float32[w+3]=b,t}}Z.prototype.bytesPerElement=16,Mt("StructArrayLayout4f16",Z);class K extends yl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}K.prototype.size=20;class se extends e{get(t){return new K(this,t)}}Mt("CollisionBoxArray",se);class oe extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}oe.prototype.size=48;class ae extends T{get(t){return new oe(this,t)}}Mt("PlacedSymbolArray",ae);class ue extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ue.prototype.size=64;class fe extends C{get(t){return new ue(this,t)}}Mt("SymbolInstanceArray",fe);class de extends I{getoffsetX(t){return this.float32[1*t+0]}}Mt("GlyphOffsetArray",de);class _e extends Ia{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Mt("SymbolLineVertexArray",_e);class we extends yl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}we.prototype.size=12;class pe extends R{get(t){return new we(this,t)}}Mt("TextAnchorOffsetArray",pe);class Ae extends yl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ae.prototype.size=8;class $e extends F{get(t){return new Ae(this,t)}}Mt("FeatureIndexArray",$e);class De extends Ea{}class Be extends Ea{}class Ve extends Ea{}class vt extends Qu{}class gt extends vl{}class rt extends Kc{}class kt extends nd{}class gi extends eh{}class Vi extends rd{}class yn extends v{}class Ji extends r{}class vn extends p{}class nn extends x{}class Qi extends j{}const rn=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:wr}=rn;class Di{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,o,u,f){const b=this.segments[this.segments.length-1];return t>Di.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${Di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Di.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+t>Di.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f?this.createNewSegment(o,u,f):b}createNewSegment(t,o,u){const f={vertexOffset:t.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return u!==void 0&&(f.sortKey=u),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(t,o,u){return this.prepareSegment(0,t,o,u)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,u,f){return new Di([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}function sr(s,t){return 256*(s=dn(Math.floor(s),0,255))+dn(Math.floor(t),0,255)}Di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt("SegmentVector",Di);const Tr=Cn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Aa,La,ka,Ts={exports:{}},Xc={exports:{}},Yc={exports:{}},rc=function(){if(ka)return Ts.exports;ka=1;var s=(Aa||(Aa=1,Xc.exports=function(o,u){var f,b,w,S,M,A,D,B;for(b=o.length-(f=3&o.length),w=u,M=3432918353,A=461845907,B=0;B<b;)D=255&o.charCodeAt(B)|(255&o.charCodeAt(++B))<<8|(255&o.charCodeAt(++B))<<16|(255&o.charCodeAt(++B))<<24,++B,w=27492+(65535&(S=5*(65535&(w=(w^=D=(65535&(D=(D=(65535&D)*M+(((D>>>16)*M&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(D=0,f){case 3:D^=(255&o.charCodeAt(B+2))<<16;case 2:D^=(255&o.charCodeAt(B+1))<<8;case 1:w^=D=(65535&(D=(D=(65535&(D^=255&o.charCodeAt(B)))*M+(((D>>>16)*M&65535)<<16)&4294967295)<<15|D>>>17))*A+(((D>>>16)*A&65535)<<16)&4294967295}return w^=o.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0}),Xc.exports),t=(La||(La=1,Yc.exports=function(o,u){for(var f,b=o.length,w=u^b,S=0;b>=4;)f=1540483477*(65535&(f=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),b-=4,++S;switch(b){case 3:w^=(255&o.charCodeAt(S+2))<<16;case 2:w^=(255&o.charCodeAt(S+1))<<8;case 1:w=1540483477*(65535&(w^=255&o.charCodeAt(S)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0}),Yc.exports);return Ts.exports=s,Ts.exports.murmur3=s,Ts.exports.murmur2=t,Ts.exports}(),ro=E(rc);class Ko{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,o,u,f){this.ids.push(za(t)),this.positions.push(o,u,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=za(t);let u=0,f=this.ids.length-1;for(;u<f;){const w=u+f>>1;this.ids[w]>=o?f=w:u=w+1}const b=[];for(;this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b}static serialize(t,o){const u=new Float64Array(t.ids),f=new Uint32Array(t.positions);return xl(u,f,0,u.length-1),o&&o.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(t){const o=new Ko;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o}}function za(s){const t=+s;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ro(String(s))}function xl(s,t,o,u){for(;o<u;){const f=s[o+u>>1];let b=o-1,w=u+1;for(;;){do b++;while(s[b]<f);do w--;while(s[w]>f);if(b>=w)break;zn(s,b,w),zn(t,3*b,3*w),zn(t,3*b+1,3*w+1),zn(t,3*b+2,3*w+2)}w-o<u-w?(xl(s,t,o,w),o=w+1):(xl(s,t,w+1,u),u=w)}}function zn(s,t,o){const u=s[t];s[t]=s[o],s[o]=u}Mt("FeaturePositionMap",Ko);class un{constructor(t,o){this.gl=t.gl,this.location=o}}class qr extends un{constructor(t,o){super(t,o),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Wn extends un{constructor(t,o){super(t,o),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Op extends un{constructor(t,o){super(t,o),this.current=bi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Um=new Float32Array(16);function od(s){return[sr(255*s.r,255*s.g),sr(255*s.b,255*s.a)]}class Jc{constructor(t,o,u){this.value=t,this.uniformNames=o.map(f=>`u_${f}`),this.type=u}setUniform(t,o,u){t.set(u.constantOr(this.value))}getBinding(t,o,u){return this.type==="color"?new Op(t,o):new qr(t,o)}}class oc{constructor(t,o){this.uniformNames=o.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr}setUniform(t,o,u,f){const b=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&t.set(b)}getBinding(t,o,u){return u.substr(0,9)==="u_pattern"?new Wn(t,o):new qr(t,o)}}class Gs{constructor(t,o,u,f){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,o,u,f,b){const w=this.paintVertexArray.length,S=this.expression.evaluate(new fn(0),o,{},f,[],b);this.paintVertexArray.resize(t),this._setPaintValue(w,t,S)}updatePaintArray(t,o,u,f){const b=this.expression.evaluate({zoom:0},u,f);this._setPaintValue(t,o,b)}_setPaintValue(t,o,u){if(this.type==="color"){const f=od(u);for(let b=t;b<o;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=t;f<o;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(t,o,u,f,b,w){this.expression=t,this.uniformNames=o.map(S=>`u_${S}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=o.map(S=>({name:`a_${S}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(t,o,u,f,b){const w=this.expression.evaluate(new fn(this.zoom),o,{},f,[],b),S=this.expression.evaluate(new fn(this.zoom+1),o,{},f,[],b),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,w,S)}updatePaintArray(t,o,u,f){const b=this.expression.evaluate({zoom:this.zoom},u,f),w=this.expression.evaluate({zoom:this.zoom+1},u,f);this._setPaintValue(t,o,b,w)}_setPaintValue(t,o,u,f){if(this.type==="color"){const b=od(u),w=od(f);for(let S=t;S<o;S++)this.paintVertexArray.emplace(S,b[0],b[1],w[0],w[1])}else{for(let b=t;b<o;b++)this.paintVertexArray.emplace(b,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o){const u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,f=dn(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,o,u){return new qr(t,o)}}class Hs{constructor(t,o,u,f,b,w){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=f,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(t,o,u){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(t,o,u,f,b){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],b)}_setPaintValues(t,o,u,f){if(!f||!u)return;const{min:b,mid:w,max:S}=u,M=f[b],A=f[w],D=f[S];if(M&&A&&D)for(let B=t;B<o;B++)this.zoomInPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],A.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],A.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Tr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Tr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sd{constructor(t,o,u){this.binders={},this._buffers=[];const f=[];for(const b in t.paint._values){if(!u(b))continue;const w=t.paint.get(b);if(!(w instanceof ws&&Vs(w.property.specification)))continue;const S=ad(b,t.type),M=w.value,A=w.property.specification.type,D=w.property.useIntegerZoom,B=w.property.specification["property-type"],V=B==="cross-faded"||B==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=V?new oc(M.value,S):new Jc(M.value,S,A),f.push(`/u_${b}`);else if(M.kind==="source"||V){const H=ld(b,A,"source");this.binders[b]=V?new Hs(M,A,D,o,H,t.id):new Gs(M,S,A,H),f.push(`/a_${b}`)}else{const H=ld(b,A,"composite");this.binders[b]=new Sr(M,S,A,D,o,H),f.push(`/z_${b}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof Gs||o instanceof Sr?o.maxValue:0}populatePaintArrays(t,o,u,f,b){for(const w in this.binders){const S=this.binders[w];(S instanceof Gs||S instanceof Sr||S instanceof Hs)&&S.populatePaintArray(t,o,u,f,b)}}setConstantPatternPositions(t,o){for(const u in this.binders){const f=this.binders[u];f instanceof oc&&f.setConstantPatternPositions(t,o)}}updatePaintArrays(t,o,u,f,b){let w=!1;for(const S in t){const M=o.getPositions(S);for(const A of M){const D=u.feature(A.index);for(const B in this.binders){const V=this.binders[B];if((V instanceof Gs||V instanceof Sr||V instanceof Hs)&&V.expression.isStateDependent===!0){const H=f.paint.get(B);V.expression=H.value,V.updatePaintArray(A.start,A.end,D,t[S],b),w=!0}}}}return w}defines(){const t=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Jc||u instanceof oc)&&t.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Gs||u instanceof Sr)for(let f=0;f<u.paintVertexAttributes.length;f++)t.push(u.paintVertexAttributes[f].name);else if(u instanceof Hs)for(let f=0;f<Tr.members.length;f++)t.push(Tr.members[f].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Jc||u instanceof oc||u instanceof Sr)for(const f of u.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,o){const u=[];for(const f in this.binders){const b=this.binders[f];if(b instanceof Jc||b instanceof oc||b instanceof Sr){for(const w of b.uniformNames)if(o[w]){const S=b.getBinding(t,o[w],w);u.push({name:w,property:f,binding:S})}}}return u}setUniforms(t,o,u,f){for(const{name:b,property:w,binding:S}of o)this.binders[w].setUniform(S,f,u.get(w),b)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){const u=this.binders[o];if(t&&u instanceof Hs){const f=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof Gs||u instanceof Sr)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const o in this.binders){const u=this.binders[o];(u instanceof Gs||u instanceof Sr||u instanceof Hs)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof Gs||o instanceof Sr||o instanceof Hs)&&o.destroy()}}}class Ra{constructor(t,o,u=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new sd(f,o,u);this.needsUpload=!1,this._featureMap=new Ko,this._bufferOffset=0}populatePaintArrays(t,o,u,f,b,w){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,f,b,w);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,u,f){for(const b of u)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(t,this._featureMap,o,b,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ad(s,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}function ld(s,t,o){const u={color:{source:Kc,composite:Z},number:{source:I,composite:Kc}},f=function(b){return{"line-pattern":{source:kt,composite:kt},"fill-pattern":{source:kt,composite:kt},"fill-extrusion-pattern":{source:kt,composite:kt}}[b]}(s);return f&&f[o]||u[t][o]}Mt("ConstantBinder",Jc),Mt("CrossFadedConstantBinder",oc),Mt("SourceExpressionBinder",Gs),Mt("CrossFadedCompositeBinder",Hs),Mt("CompositeExpressionBinder",Sr),Mt("ProgramConfiguration",sd,{omit:["_buffers"]}),Mt("ProgramConfigurationSet",Ra);const Qc=Math.pow(2,14)-1,uv=-Qc-1;function eu(s){const t=Jt/s.extent,o=s.loadGeometry();for(let u=0;u<o.length;u++){const f=o[u];for(let b=0;b<f.length;b++){const w=f[b],S=Math.round(w.x*t),M=Math.round(w.y*t);w.x=dn(S,uv,Qc),w.y=dn(M,uv,Qc),(S<w.x||S>w.x+1||M<w.y||M>w.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function tu(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?eu(s):[]}}const hv=-32768;function DT(s,t,o,u,f){s.emplaceBack(hv+8*t+u,hv+8*o+f)}class $m{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new nn,this.segments=new Di,this.programConfigurations=new Ra(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u){const f=this.layers[0],b=[];let w=null,S=!1,M=f.type==="heatmap";if(f.type==="circle"){const D=f;w=D.layout.get("circle-sort-key"),S=!w.isConstant(),M=M||D.paint.get("circle-pitch-alignment")==="map"}const A=M?o.subdivisionGranularity.circle:1;for(const{feature:D,id:B,index:V,sourceLayerIndex:H}of t){const W=this.layers[0]._featureFilter.needGeometry,Y=tu(D,W);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom,{globalState:this.globalState}),Y,u))continue;const re=S?w.evaluate(Y,{},u):void 0,le={id:B,properties:D.properties,type:D.type,sourceLayerIndex:H,index:V,geometry:W?Y.geometry:eu(D),patterns:{},sortKey:re};b.push(le)}S&&b.sort((D,B)=>D.sortKey-B.sortKey);for(const D of b){const{geometry:B,index:V,sourceLayerIndex:H}=D,W=t[V].feature;this.addFeature(D,B,V,u,A),o.featureIndex.insert(W,B,V,H,this.index)}}update(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,u,f,b=1){let w;switch(b){case 1:w=[0,7];break;case 3:w=[0,2,5,7];break;case 5:w=[0,1,3,4,6,7];break;case 7:w=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const S=w.length;for(const M of o)for(const A of M){const D=A.x,B=A.y;if(D<0||D>=Jt||B<0||B>=Jt)continue;const V=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,t.sortKey),H=V.vertexLength;for(let W=0;W<S;W++)for(let Y=0;Y<S;Y++)DT(this.layoutVertexArray,D,B,w[Y],w[W]);for(let W=0;W<S-1;W++)for(let Y=0;Y<S-1;Y++){const re=H+W*S+Y,le=H+(W+1)*S+Y;this.indexArray.emplaceBack(re,le+1,re+1),this.indexArray.emplaceBack(re,le,le+1)}V.vertexLength+=S*S,V.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},f)}}function dv(s,t){for(let o=0;o<s.length;o++)if(th(t,s[o]))return!0;for(let o=0;o<t.length;o++)if(th(s,t[o]))return!0;return!!Vm(s,t)}function OT(s,t,o){return!!th(s,t)||!!Zm(t,s,o)}function pv(s,t){if(s.length===1)return mv(t,s[0]);for(let o=0;o<t.length;o++){const u=t[o];for(let f=0;f<u.length;f++)if(th(s,u[f]))return!0}for(let o=0;o<s.length;o++)if(mv(t,s[o]))return!0;for(let o=0;o<t.length;o++)if(Vm(s,t[o]))return!0;return!1}function FT(s,t,o){if(s.length>1){if(Vm(s,t))return!0;for(let u=0;u<t.length;u++)if(Zm(t[u],s,o))return!0}for(let u=0;u<s.length;u++)if(Zm(s[u],t,o))return!0;return!1}function Vm(s,t){if(s.length===0||t.length===0)return!1;for(let o=0;o<s.length-1;o++){const u=s[o],f=s[o+1];for(let b=0;b<t.length-1;b++)if(BT(u,f,t[b],t[b+1]))return!0}return!1}function BT(s,t,o,u){return xt(s,o,u)!==xt(t,o,u)&&xt(s,t,o)!==xt(s,t,u)}function Zm(s,t,o){const u=o*o;if(t.length===1)return s.distSqr(t[0])<u;for(let f=1;f<t.length;f++)if(fv(s,t[f-1],t[f])<u)return!0;return!1}function fv(s,t,o){const u=t.distSqr(o);if(u===0)return s.distSqr(t);const f=((s.x-t.x)*(o.x-t.x)+(s.y-t.y)*(o.y-t.y))/u;return s.distSqr(f<0?t:f>1?o:o.sub(t)._mult(f)._add(t))}function mv(s,t){let o,u,f,b=!1;for(let w=0;w<s.length;w++){o=s[w];for(let S=0,M=o.length-1;S<o.length;M=S++)u=o[S],f=o[M],u.y>t.y!=f.y>t.y&&t.x<(f.x-u.x)*(t.y-u.y)/(f.y-u.y)+u.x&&(b=!b)}return b}function th(s,t){let o=!1;for(let u=0,f=s.length-1;u<s.length;f=u++){const b=s[u],w=s[f];b.y>t.y!=w.y>t.y&&t.x<(w.x-b.x)*(t.y-b.y)/(w.y-b.y)+b.x&&(o=!o)}return o}function NT(s,t,o){const u=o[0],f=o[2];if(s.x<u.x&&t.x<u.x||s.x>f.x&&t.x>f.x||s.y<u.y&&t.y<u.y||s.y>f.y&&t.y>f.y)return!1;const b=xt(s,t,o[0]);return b!==xt(s,t,o[1])||b!==xt(s,t,o[2])||b!==xt(s,t,o[3])}function cd(s,t,o){const u=t.paint.get(s).value;return u.kind==="constant"?u.value:o.programConfigurations.get(t.id).getMaxValue(s)}function Fp(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Bp(s,t,o,u,f){if(!t[0]&&!t[1])return s;const b=te.convert(t)._mult(f);o==="viewport"&&b._rotate(-u);const w=[];for(let S=0;S<s.length;S++)w.push(s[S].sub(b));return w}let gv,_v;Mt("CircleBucket",$m,{omit:["layers"]});var jT={get paint(){return _v=_v||new Zr({"circle-radius":new Xt(Se.paint_circle["circle-radius"]),"circle-color":new Xt(Se.paint_circle["circle-color"]),"circle-blur":new Xt(Se.paint_circle["circle-blur"]),"circle-opacity":new Xt(Se.paint_circle["circle-opacity"]),"circle-translate":new Rt(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(Se.paint_circle["circle-stroke-opacity"])})},get layout(){return gv=gv||new Zr({"circle-sort-key":new Xt(Se.layout_circle["circle-sort-key"])})}};class UT extends br{constructor(t){super(t,jT)}createBucket(t){return new $m(t)}queryRadius(t){const o=t;return cd("circle-radius",this,o)+cd("circle-stroke-width",this,o)+Fp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:o,featureState:u,geometry:f,transform:b,pixelsToTileUnits:w,unwrappedTileID:S,getElevation:M}){const A=Bp(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,w),D=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u),B=this.paint.get("circle-pitch-alignment")==="map",V=B?A:function(W,Y,re,le){return W.map(Me=>yv(Me,Y,re,le))}(A,b,S,M),H=B?D*w:D;for(const W of f)for(const Y of W){const re=B?Y:yv(Y,b,S,M);let le=H;const Me=b.projectTileCoordinates(Y.x,Y.y,S,M).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Me/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=b.cameraToCenterDistance/Me),OT(V,re,le))return!0}return!1}}function yv(s,t,o,u){const f=t.projectTileCoordinates(s.x,s.y,o,u).point;return new te((.5*f.x+.5)*t.width,(.5*-f.y+.5)*t.height)}class vv extends $m{}let xv;Mt("HeatmapBucket",vv,{omit:["layers"]});var $T={get paint(){return xv=xv||new Zr({"heatmap-radius":new Xt(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wc(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(Se.paint_heatmap["heatmap-opacity"])})}};function qm(s,{width:t,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*o*u)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*o*u}`)}else f=new Uint8Array(t*o*u);return s.width=t,s.height=o,s.data=f,s}function bv(s,{width:t,height:o},u){if(t===s.width&&o===s.height)return;const f=qm({},{width:t,height:o},u);Gm(s,f,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,t),height:Math.min(s.height,o)},u),s.width=t,s.height=o,s.data=f.data}function Gm(s,t,o,u,f,b){if(f.width===0||f.height===0)return t;if(f.width>s.width||f.height>s.height||o.x>s.width-f.width||o.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||u.x>t.width-f.width||u.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,S=t.data;if(w===S)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<f.height;M++){const A=((o.y+M)*s.width+o.x)*b,D=((u.y+M)*t.width+u.x)*b;for(let B=0;B<f.width*b;B++)S[D+B]=w[A+B]}return t}class ud{constructor(t,o){qm(this,t,1,o)}resize(t){bv(this,t,1)}clone(){return new ud({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,u,f,b){Gm(t,o,u,f,b,1)}}class fo{constructor(t,o){qm(this,t,4,o)}resize(t){bv(this,t,4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new fo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,u,f,b){Gm(t,o,u,f,b,4)}setPixel(t,o,u){const f=4*(t*this.width+o);this.data[f+0]=Math.round(255*u.r/u.a),this.data[f+1]=Math.round(255*u.g/u.a),this.data[f+2]=Math.round(255*u.b/u.a),this.data[f+3]=Math.round(255*u.a)}}function wv(s){const t={},o=s.resolution||256,u=s.clips?s.clips.length:1,f=s.image||new fo({width:o,height:u});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const b=(w,S,M)=>{t[s.evaluationKey]=M;const A=s.expression.evaluate(t);f.setPixel(w/4/o,S/4,A)};if(s.clips)for(let w=0,S=0;w<u;++w,S+=4*o)for(let M=0,A=0;M<o;M++,A+=4){const D=M/(o-1),{start:B,end:V}=s.clips[w];b(S,A,B*(1-D)+V*D)}else for(let w=0,S=0;w<o;w++,S+=4)b(0,S,w/(o-1));return f}Mt("AlphaImage",ud),Mt("RGBAImage",fo);const Hm="big-fb";class VT extends br{createBucket(t){return new vv(t)}constructor(t){super(t,$T),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hm)&&this.heatmapFbos.delete(Hm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Tv;var ZT={get paint(){return Tv=Tv||new Zr({"hillshade-illumination-direction":new Rt(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Rt(Se.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Rt(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(Se.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Rt(Se.paint_hillshade["hillshade-method"])})}};class qT extends br{constructor(t){super(t,ZT),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,u=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const b=Math.max(t.length,o.length,u.length,f.length);t=t.concat(Array(b-t.length).fill(t.at(-1))),o=o.concat(Array(b-o.length).fill(o.at(-1))),u=u.concat(Array(b-u.length).fill(u.at(-1))),f=f.concat(Array(b-f.length).fill(f.at(-1)));const w=o.map(yi);return{directionRadians:t.map(yi),altitudeRadians:w,shadowColor:f,highlightColor:u}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Sv;var GT={get paint(){return Sv=Sv||new Zr({"color-relief-opacity":new Rt(Se["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Wc(Se["paint_color-relief"]["color-relief-color"])})}};class Wm{constructor(t,o,u,f){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,f)}update(t,o,u){const{width:f,height:b}=t,w=!(this.size&&this.size[0]===f&&this.size[1]===b||u),{context:S}=this,{gl:M}=S;if(this.useMipmap=!!(o&&o.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!o||o.premultiply!==!1)),w)this.size=[f,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||dt(t)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,f,b,0,this.format,M.UNSIGNED_BYTE,t.data);else{const{x:A,y:D}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||dt(t)?M.texSubImage2D(M.TEXTURE_2D,0,A,D,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,A,D,f,b,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D),S.pixelStoreUnpackFlipY.setDefault(),S.pixelStoreUnpack.setDefault(),S.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,o,u){const{context:f}=this,{gl:b}=f;b.bindTexture(b.TEXTURE_2D,this.texture),u!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Pv{constructor(t,o,u,f=1,b=1,w=1,S=0){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void nt(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const M=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=b,this.blueFactor=w,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<M;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(M,A)]=this.data[this._idx(M-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,M)]=this.data[this._idx(A,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<M;A++)for(let D=0;D<M;D++){const B=this.get(A,D);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(t,o){const u=new Uint8Array(this.data.buffer),f=4*this._idx(t,o);return this.unpack(u[f],u[f+1],u[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}unpack(t,o,u){return t*this.redFactor+o*this.greenFactor+u*this.blueFactor-this.baseShift}pack(t){return Cv(t,this.getUnpackVector())}getPixels(){return new fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,b=o*this.dim+this.dim,w=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:f=b-1;break;case 1:b=f+1}switch(u){case-1:w=S-1;break;case 1:S=w+1}const M=-o*this.dim,A=-u*this.dim;for(let D=w;D<S;D++)for(let B=f;B<b;B++)this.data[this._idx(B,D)]=t.data[this._idx(B+M,D+A)]}}function Cv(s,t){const o=t[0],u=t[1],f=t[2],b=t[3],w=Math.min(o,u,f),S=Math.round((s+b)/w);return{r:Math.floor(S*w/o)%256,g:Math.floor(S*w/u)%256,b:Math.floor(S*w/f)%256}}Mt("DEMData",Pv);class HT extends br{constructor(t){super(t,GT)}_createColorRamp(t){const o={elevationStops:[],colorStops:[]},u=this._transitionablePaint._values["color-relief-color"].value.expression;if(u instanceof z&&u._styleExpression.expression instanceof nr){this.colorRampExpression=u;const w=u._styleExpression.expression;o.elevationStops=w.labels,o.colorStops=[];for(const S of o.elevationStops)o.colorStops.push(w.evaluate({globals:{elevation:S}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[bi.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=t)return o;const f={elevationStops:[],colorStops:[]},b=(o.elevationStops.length-1)/(t-1);for(let w=0;w<o.elevationStops.length-.5;w+=b)f.elevationStops.push(o.elevationStops[Math.round(w)]),f.colorStops.push(o.colorStops[Math.round(w)]);return nt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,o,u){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(o),b=new fo({width:f.colorStops.length,height:1}),w=new fo({width:f.colorStops.length,height:1});for(let S=0;S<f.elevationStops.length;S++){const M=Cv(f.elevationStops[S],u);w.setPixel(0,S,new bi(M.r/255,M.g/255,M.b/255,1)),b.setPixel(0,S,f.colorStops[S])}return this.colorRampTextures={elevationTexture:new Wm(t,w,t.gl.RGBA),colorTexture:new Wm(t,b,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const WT=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:KT}=WT;function Km(s,t,o){const u=o.patternDependencies;let f=!1;for(const b of t){const w=b.paint.get(`${s}-pattern`);w.isConstant()||(f=!0);const S=w.constantOr(null);S&&(f=!0,u[S.to]=!0,u[S.from]=!0)}return f}function Xm(s,t,o,u,f){const b=f.patternDependencies;for(const w of t){const S=w.paint.get(`${s}-pattern`).value;if(S.kind!=="constant"){let M=S.evaluate({zoom:u-1},o,{},f.availableImages),A=S.evaluate({zoom:u},o,{},f.availableImages),D=S.evaluate({zoom:u+1},o,{},f.availableImages);M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,D=D&&D.name?D.name:D,b[M]=!0,b[A]=!0,b[D]=!0,o.patterns[w.id]={min:M,mid:A,max:D}}}return o}function Mv(s,t,o,u,f){let b;if(f===function(w,S,M,A){let D=0;for(let B=S,V=M-A;B<M;B+=A)D+=(w[V]-w[B])*(w[B+1]+w[V+1]),V=B;return D}(s,t,o,u)>0)for(let w=t;w<o;w+=u)b=Lv(w/u|0,s[w],s[w+1],b);else for(let w=o-u;w>=t;w-=u)b=Lv(w/u|0,s[w],s[w+1],b);return b&&ih(b,b.next)&&(fd(b),b=b.next),b}function iu(s,t){if(!s)return s;t||(t=s);let o,u=s;do if(o=!1,u.steiner||!ih(u,u.next)&&Bn(u.prev,u,u.next)!==0)u=u.next;else{if(fd(u),u=t=u.prev,u===u.next)break;o=!0}while(o||u!==t);return t}function hd(s,t,o,u,f,b,w){if(!s)return;!w&&b&&function(M,A,D,B){let V=M;do V.z===0&&(V.z=Ym(V.x,V.y,A,D,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==M);V.prevZ.nextZ=null,V.prevZ=null,function(H){let W,Y=1;do{let re,le=H;H=null;let Me=null;for(W=0;le;){W++;let me=le,G=0;for(let ge=0;ge<Y&&(G++,me=me.nextZ,me);ge++);let ne=Y;for(;G>0||ne>0&&me;)G!==0&&(ne===0||!me||le.z<=me.z)?(re=le,le=le.nextZ,G--):(re=me,me=me.nextZ,ne--),Me?Me.nextZ=re:H=re,re.prevZ=Me,Me=re;le=me}Me.nextZ=null,Y*=2}while(W>1)}(V)}(s,u,f,b);let S=s;for(;s.prev!==s.next;){const M=s.prev,A=s.next;if(b?YT(s,u,f,b):XT(s))t.push(M.i,s.i,A.i),fd(s),s=A.next,S=A.next;else if((s=A)===S){w?w===1?hd(s=JT(iu(s),t),t,o,u,f,b,2):w===2&&QT(s,t,o,u,f,b):hd(iu(s),t,o,u,f,b,1);break}}}function XT(s){const t=s.prev,o=s,u=s.next;if(Bn(t,o,u)>=0)return!1;const f=t.x,b=o.x,w=u.x,S=t.y,M=o.y,A=u.y,D=Math.min(f,b,w),B=Math.min(S,M,A),V=Math.max(f,b,w),H=Math.max(S,M,A);let W=u.next;for(;W!==t;){if(W.x>=D&&W.x<=V&&W.y>=B&&W.y<=H&&dd(f,S,b,M,w,A,W.x,W.y)&&Bn(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function YT(s,t,o,u){const f=s.prev,b=s,w=s.next;if(Bn(f,b,w)>=0)return!1;const S=f.x,M=b.x,A=w.x,D=f.y,B=b.y,V=w.y,H=Math.min(S,M,A),W=Math.min(D,B,V),Y=Math.max(S,M,A),re=Math.max(D,B,V),le=Ym(H,W,t,o,u),Me=Ym(Y,re,t,o,u);let me=s.prevZ,G=s.nextZ;for(;me&&me.z>=le&&G&&G.z<=Me;){if(me.x>=H&&me.x<=Y&&me.y>=W&&me.y<=re&&me!==f&&me!==w&&dd(S,D,M,B,A,V,me.x,me.y)&&Bn(me.prev,me,me.next)>=0||(me=me.prevZ,G.x>=H&&G.x<=Y&&G.y>=W&&G.y<=re&&G!==f&&G!==w&&dd(S,D,M,B,A,V,G.x,G.y)&&Bn(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;me&&me.z>=le;){if(me.x>=H&&me.x<=Y&&me.y>=W&&me.y<=re&&me!==f&&me!==w&&dd(S,D,M,B,A,V,me.x,me.y)&&Bn(me.prev,me,me.next)>=0)return!1;me=me.prevZ}for(;G&&G.z<=Me;){if(G.x>=H&&G.x<=Y&&G.y>=W&&G.y<=re&&G!==f&&G!==w&&dd(S,D,M,B,A,V,G.x,G.y)&&Bn(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function JT(s,t){let o=s;do{const u=o.prev,f=o.next.next;!ih(u,f)&&Iv(u,o,o.next,f)&&pd(u,f)&&pd(f,u)&&(t.push(u.i,o.i,f.i),fd(o),fd(o.next),o=s=f),o=o.next}while(o!==s);return iu(o)}function QT(s,t,o,u,f,b){let w=s;do{let S=w.next.next;for(;S!==w.prev;){if(w.i!==S.i&&rS(w,S)){let M=Av(w,S);return w=iu(w,w.next),M=iu(M,M.next),hd(w,t,o,u,f,b,0),void hd(M,t,o,u,f,b,0)}S=S.next}w=w.next}while(w!==s)}function eS(s,t){let o=s.x-t.x;return o===0&&(o=s.y-t.y,o===0)&&(o=(s.next.y-s.y)/(s.next.x-s.x)-(t.next.y-t.y)/(t.next.x-t.x)),o}function tS(s,t){const o=function(f,b){let w=b;const S=f.x,M=f.y;let A,D=-1/0;if(ih(f,w))return w;do{if(ih(f,w.next))return w.next;if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){const Y=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(Y<=S&&Y>D&&(D=Y,A=w.x<w.next.x?w:w.next,Y===S))return A}w=w.next}while(w!==b);if(!A)return null;const B=A,V=A.x,H=A.y;let W=1/0;w=A;do{if(S>=w.x&&w.x>=V&&S!==w.x&&Ev(M<H?S:D,M,V,H,M<H?D:S,M,w.x,w.y)){const Y=Math.abs(M-w.y)/(S-w.x);pd(w,f)&&(Y<W||Y===W&&(w.x>A.x||w.x===A.x&&iS(A,w)))&&(A=w,W=Y)}w=w.next}while(w!==B);return A}(s,t);if(!o)return t;const u=Av(o,s);return iu(u,u.next),iu(o,o.next)}function iS(s,t){return Bn(s.prev,s,t.prev)<0&&Bn(t.next,s,s.next)<0}function Ym(s,t,o,u,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-o)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function nS(s){let t=s,o=s;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==s);return o}function Ev(s,t,o,u,f,b,w,S){return(f-w)*(t-S)>=(s-w)*(b-S)&&(s-w)*(u-S)>=(o-w)*(t-S)&&(o-w)*(b-S)>=(f-w)*(u-S)}function dd(s,t,o,u,f,b,w,S){return!(s===w&&t===S)&&Ev(s,t,o,u,f,b,w,S)}function rS(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(o,u){let f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&Iv(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(s,t)&&(pd(s,t)&&pd(t,s)&&function(o,u){let f=o,b=!1;const w=(o.x+u.x)/2,S=(o.y+u.y)/2;do f.y>S!=f.next.y>S&&f.next.y!==f.y&&w<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next;while(f!==o);return b}(s,t)&&(Bn(s.prev,s,t.prev)||Bn(s,t.prev,t))||ih(s,t)&&Bn(s.prev,s,s.next)>0&&Bn(t.prev,t,t.next)>0)}function Bn(s,t,o){return(t.y-s.y)*(o.x-t.x)-(t.x-s.x)*(o.y-t.y)}function ih(s,t){return s.x===t.x&&s.y===t.y}function Iv(s,t,o,u){const f=jp(Bn(s,t,o)),b=jp(Bn(s,t,u)),w=jp(Bn(o,u,s)),S=jp(Bn(o,u,t));return f!==b&&w!==S||!(f!==0||!Np(s,o,t))||!(b!==0||!Np(s,u,t))||!(w!==0||!Np(o,s,u))||!(S!==0||!Np(o,t,u))}function Np(s,t,o){return t.x<=Math.max(s.x,o.x)&&t.x>=Math.min(s.x,o.x)&&t.y<=Math.max(s.y,o.y)&&t.y>=Math.min(s.y,o.y)}function jp(s){return s>0?1:s<0?-1:0}function pd(s,t){return Bn(s.prev,s,s.next)<0?Bn(s,t,s.next)>=0&&Bn(s,s.prev,t)>=0:Bn(s,t,s.prev)<0||Bn(s,s.next,t)<0}function Av(s,t){const o=Jm(s.i,s.x,s.y),u=Jm(t.i,t.x,t.y),f=s.next,b=t.prev;return s.next=t,t.prev=s,o.next=f,f.prev=o,u.next=o,o.prev=u,b.next=u,u.prev=b,u}function Lv(s,t,o,u){const f=Jm(s,t,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function fd(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Jm(s,t,o){return{i:s,x:t,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class nh{constructor(t,o){if(o>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=o}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Up{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Up.noSubdivision=new Up({fill:new nh(0,0),line:new nh(0,0),tile:new nh(0,0),stencil:new nh(0,0),circle:1}),Mt("SubdivisionGranularityExpression",nh),Mt("SubdivisionGranularitySetting",Up);const rh=-32768,md=32767;class oS{constructor(t,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Jt/t,this._canonical=o}_getKey(t,o){return(t+=32768)<<16|o+32768}_vertexToIndex(t,o){if(t<-32768||o<-32768||t>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const u=0|Math.round(t),f=0|Math.round(o),b=this._getKey(u,f);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const w=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,w),this._vertexBuffer.push(u,f),w}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(f,b){const w=[];for(let S=0;S<b.length;S+=3){const M=b[S],A=b[S+1],D=b[S+2],B=f[2*M],V=f[2*M+1];(f[2*A]-B)*(f[2*D+1]-V)-(f[2*A+1]-V)*(f[2*D]-B)>0?(w.push(M),w.push(D),w.push(A)):(w.push(M),w.push(A),w.push(D))}return w}(this._vertexBuffer,t);const o=[],u=t.length;for(let f=0;f<u;f+=3){const b=[t[f+0],t[f+1],t[f+2]],w=[this._vertexBuffer[2*t[f+0]+0],this._vertexBuffer[2*t[f+0]+1],this._vertexBuffer[2*t[f+1]+0],this._vertexBuffer[2*t[f+1]+1],this._vertexBuffer[2*t[f+2]+0],this._vertexBuffer[2*t[f+2]+1]];let S=1/0,M=1/0,A=-1/0,D=-1/0;for(let Y=0;Y<3;Y++){const re=w[2*Y],le=w[2*Y+1];S=Math.min(S,re),A=Math.max(A,re),M=Math.min(M,le),D=Math.max(D,le)}if(S===A||M===D)continue;const B=Math.floor(S/this._granularityCellSize),V=Math.ceil(A/this._granularityCellSize),H=Math.floor(M/this._granularityCellSize),W=Math.ceil(D/this._granularityCellSize);if(B!==V||H!==W)for(let Y=H;Y<W;Y++){const re=this._scanlineGenerateVertexRingForCellRow(Y,w,b);sS(this._vertexBuffer,re,o)}else o.push(...b)}return o}_scanlineGenerateVertexRingForCellRow(t,o,u){const f=t*this._granularityCellSize,b=f+this._granularityCellSize,w=[];for(let S=0;S<3;S++){const M=o[2*S],A=o[2*S+1],D=o[2*(S+1)%6],B=o[(2*(S+1)+1)%6],V=o[2*(S+2)%6],H=o[(2*(S+2)+1)%6],W=D-M,Y=B-A,re=W===0,le=Y===0,Me=(f-A)/Y,me=(b-A)/Y,G=Math.min(Me,me),ne=Math.max(Me,me);if(!le&&(G>=1||ne<=0)||le&&(A<f||A>b)){B>=f&&B<=b&&w.push(u[(S+1)%3]);continue}!le&&G>0&&w.push(this._vertexToIndex(M+W*G,A+Y*G));const ge=M+W*Math.max(G,0),Ne=M+W*Math.min(ne,1);re||this._generateIntraEdgeVertices(w,M,A,D,B,ge,Ne),!le&&ne<1&&w.push(this._vertexToIndex(M+W*ne,A+Y*ne)),(le||B>=f&&B<=b)&&w.push(u[(S+1)%3]),!le&&(B<=f||B>=b)&&this._generateInterEdgeVertices(w,M,A,D,B,V,H,Ne,f,b)}return w}_generateIntraEdgeVertices(t,o,u,f,b,w,S){const M=f-o,A=b-u,D=A===0,B=D?Math.min(o,f):Math.min(w,S),V=D?Math.max(o,f):Math.max(w,S),H=Math.floor(B/this._granularityCellSize)+1,W=Math.ceil(V/this._granularityCellSize)-1;if(D?o<f:w<S)for(let Y=H;Y<=W;Y++){const re=Y*this._granularityCellSize;t.push(this._vertexToIndex(re,u+A*(re-o)/M))}else for(let Y=W;Y>=H;Y--){const re=Y*this._granularityCellSize;t.push(this._vertexToIndex(re,u+A*(re-o)/M))}}_generateInterEdgeVertices(t,o,u,f,b,w,S,M,A,D){const B=b-u,V=w-f,H=S-b,W=(A-b)/H,Y=(D-b)/H,re=Math.min(W,Y),le=Math.max(W,Y),Me=f+V*re;let me=Math.floor(Math.min(Me,M)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Me,M)/this._granularityCellSize)-1,ne=M<Me;const ge=H===0;if(ge&&(S===A||S===D))return;if(ge||re>=1||le<=0){const it=u-S,Ze=w+(o-w)*Math.min((A-S)/it,(D-S)/it);me=Math.floor(Math.min(Ze,M)/this._granularityCellSize)+1,G=Math.ceil(Math.max(Ze,M)/this._granularityCellSize)-1,ne=M<Ze}const Ne=B>0?D:A;if(ne)for(let it=me;it<=G;it++)t.push(this._vertexToIndex(it*this._granularityCellSize,Ne));else for(let it=G;it>=me;it--)t.push(this._vertexToIndex(it*this._granularityCellSize,Ne))}_generateOutline(t){const o=[];for(const u of t){const f=nu(u,this._granularity,!0),b=this._pointArrayToIndices(f),w=[];for(let S=1;S<b.length;S++)w.push(b[S-1]),w.push(b[S]);o.push(w)}return o}_handlePoles(t){let o=!1,u=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(u=!0)),(o||u)&&this._fillPoles(t,o,u)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let o=0;o<t.length;o+=2){const u=t[o+1];u===rh&&(t[o+1]=-32767),u===md&&(t[o+1]=32766)}}_generatePoleQuad(t,o,u,f,b,w){f>b!=(w===rh)?(t.push(o),t.push(u),t.push(this._vertexToIndex(f,w)),t.push(u),t.push(this._vertexToIndex(b,w)),t.push(this._vertexToIndex(f,w))):(t.push(u),t.push(o),t.push(this._vertexToIndex(f,w)),t.push(this._vertexToIndex(b,w)),t.push(u),t.push(this._vertexToIndex(f,w)))}_fillPoles(t,o,u){const f=this._vertexBuffer,b=Jt,w=t.length;for(let S=2;S<w;S+=3){const M=t[S-2],A=t[S-1],D=t[S],B=f[2*M],V=f[2*M+1],H=f[2*A],W=f[2*A+1],Y=f[2*D],re=f[2*D+1];o&&(V===0&&W===0&&this._generatePoleQuad(t,M,A,B,H,rh),W===0&&re===0&&this._generatePoleQuad(t,A,D,H,Y,rh),re===0&&V===0&&this._generatePoleQuad(t,D,M,Y,B,rh)),u&&(V===b&&W===b&&this._generatePoleQuad(t,M,A,B,H,md),W===b&&re===b&&this._generatePoleQuad(t,A,D,H,Y,md),re===b&&V===b&&this._generatePoleQuad(t,D,M,Y,B,md))}}_initializeVertices(t){for(let o=0;o<t.length;o+=2)this._vertexToIndex(t[o],t[o+1])}subdividePolygonInternal(t,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:u,holeIndices:f}=function(S){const M=[],A=[];for(const D of S)if(D.length!==0){D!==S[0]&&M.push(A.length/2);for(let B=0;B<D.length;B++)A.push(D[B].x),A.push(D[B].y)}return{flattened:A,holeIndices:M}}(t);let b;this._initializeVertices(u);try{const S=function(A,D,B=2){const V=D&&D.length,H=V?D[0]*B:A.length;let W=Mv(A,0,H,B,!0);const Y=[];if(!W||W.next===W.prev)return Y;let re,le,Me;if(V&&(W=function(me,G,ne,ge){const Ne=[];for(let it=0,Ze=G.length;it<Ze;it++){const We=Mv(me,G[it]*ge,it<Ze-1?G[it+1]*ge:me.length,ge,!1);We===We.next&&(We.steiner=!0),Ne.push(nS(We))}Ne.sort(eS);for(let it=0;it<Ne.length;it++)ne=tS(Ne[it],ne);return ne}(A,D,W,B)),A.length>80*B){re=1/0,le=1/0;let me=-1/0,G=-1/0;for(let ne=B;ne<H;ne+=B){const ge=A[ne],Ne=A[ne+1];ge<re&&(re=ge),Ne<le&&(le=Ne),ge>me&&(me=ge),Ne>G&&(G=Ne)}Me=Math.max(me-re,G-le),Me=Me!==0?32767/Me:0}return hd(W,Y,B,re,le,Me,0),Y}(u,f),M=this._convertIndices(u,S);b=this._subdivideTrianglesScanline(M)}catch(S){console.error(S)}let w=[];return o&&(w=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:w}}_convertIndices(t,o){const u=[];for(let f=0;f<o.length;f++)u.push(this._vertexToIndex(t[2*o[f]],t[2*o[f]+1]));return u}_pointArrayToIndices(t){const o=[];for(let u=0;u<t.length;u++){const f=t[u];o.push(this._vertexToIndex(f.x,f.y))}return o}}function kv(s,t,o,u=!0){return new oS(o,t).subdividePolygonInternal(s,u)}function nu(s,t,o=!1){if(!s||s.length<1)return[];if(s.length<2)return[];const u=s[0],f=s[s.length-1],b=o&&(u.x!==f.x||u.y!==f.y);if(t<2)return b?[...s,s[0]]:[...s];const w=Math.floor(Jt/t),S=[];S.push(new te(s[0].x,s[0].y));const M=s.length,A=b?M:M-1;for(let D=0;D<A;D++){const B=s[D],V=D<M-1?s[D+1]:s[0],H=B.x,W=B.y,Y=V.x,re=V.y,le=H!==Y,Me=W!==re;if(!le&&!Me)continue;const me=Y-H,G=re-W,ne=Math.abs(me),ge=Math.abs(G);let Ne=H,it=W;for(;;){const We=me>0?(Math.floor(Ne/w)+1)*w:(Math.ceil(Ne/w)-1)*w,ut=G>0?(Math.floor(it/w)+1)*w:(Math.ceil(it/w)-1)*w,ot=Math.abs(Ne-We),pt=Math.abs(it-ut),Xe=Math.abs(Ne-Y),zt=Math.abs(it-re),Gt=le?ot/ne:Number.POSITIVE_INFINITY,Zt=Me?pt/ge:Number.POSITIVE_INFINITY;if((Xe<=ot||!le)&&(zt<=pt||!Me))break;if(Gt<Zt&&le||!Me){Ne=We,it+=G*Gt;const Ot=new te(Ne,Math.round(it));S[S.length-1].x===Ot.x&&S[S.length-1].y===Ot.y||S.push(Ot)}else{Ne+=me*Zt,it=ut;const Ot=new te(Math.round(Ne),it);S[S.length-1].x===Ot.x&&S[S.length-1].y===Ot.y||S.push(Ot)}}const Ze=new te(Y,re);S[S.length-1].x===Ze.x&&S[S.length-1].y===Ze.y||S.push(Ze)}return S}function sS(s,t,o){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let u=0,f=s[2*t[0]];for(let M=1;M<t.length;M++){const A=s[2*t[M]];A<f&&(f=A,u=M)}const b=t.length;let w=u,S=(w+1)%b;for(;;){const M=w-1>=0?w-1:b-1,A=(S+1)%b,D=s[2*t[M]],B=s[2*t[A]],V=s[2*t[w]],H=s[2*t[w]+1],W=s[2*t[S]+1];let Y=!1;if(D<B)Y=!0;else if(D>B)Y=!1;else{const re=W-H,le=-(s[2*t[S]]-V),Me=H<W?1:-1;((D-V)*re+(s[2*t[M]+1]-H)*le)*Me>((B-V)*re+(s[2*t[A]+1]-H)*le)*Me&&(Y=!0)}if(Y){const re=t[M],le=t[w],Me=t[S];re!==le&&re!==Me&&le!==Me&&o.push(Me,le,re),w--,w<0&&(w=b-1)}else{const re=t[A],le=t[w],Me=t[S];re!==le&&re!==Me&&le!==Me&&o.push(Me,le,re),S++,S>=b&&(S=0)}if(M===A)break}}function zv(s,t,o,u,f,b,w,S,M){const A=f.length/2,D=w&&S&&M;if(A<Di.MAX_VERTEX_ARRAY_LENGTH){const B=t.prepareSegment(A,o,u),V=B.vertexLength;for(let Y=0;Y<b.length;Y+=3)u.emplaceBack(V+b[Y],V+b[Y+1],V+b[Y+2]);let H,W;B.vertexLength+=A,B.primitiveLength+=b.length/3,D&&(W=w.prepareSegment(A,o,S),H=W.vertexLength,W.vertexLength+=A);for(let Y=0;Y<f.length;Y+=2)s(f[Y],f[Y+1]);if(D)for(let Y=0;Y<M.length;Y++){const re=M[Y];for(let le=1;le<re.length;le+=2)S.emplaceBack(H+re[le-1],H+re[le]);W.primitiveLength+=re.length/2}}else(function(B,V,H,W,Y,re){const le=[];for(let ge=0;ge<W.length/2;ge++)le.push(-1);const Me={count:0};let me=0,G=B.getOrCreateLatestSegment(V,H),ne=G.vertexLength;for(let ge=2;ge<Y.length;ge+=3){const Ne=Y[ge-2],it=Y[ge-1],Ze=Y[ge];let We=le[Ne]<me,ut=le[it]<me,ot=le[Ze]<me;G.vertexLength+((We?1:0)+(ut?1:0)+(ot?1:0))>Di.MAX_VERTEX_ARRAY_LENGTH&&(G=B.createNewSegment(V,H),me=Me.count,We=!0,ut=!0,ot=!0,ne=0);const pt=gd(le,W,re,Me,Ne,We,G),Xe=gd(le,W,re,Me,it,ut,G),zt=gd(le,W,re,Me,Ze,ot,G);H.emplaceBack(ne+pt-me,ne+Xe-me,ne+zt-me),G.primitiveLength++}})(t,o,u,f,b,s),D&&function(B,V,H,W,Y,re){const le=[];for(let ge=0;ge<W.length/2;ge++)le.push(-1);const Me={count:0};let me=0,G=B.getOrCreateLatestSegment(V,H),ne=G.vertexLength;for(let ge=0;ge<Y.length;ge++){const Ne=Y[ge];for(let it=1;it<Y[ge].length;it+=2){const Ze=Ne[it-1],We=Ne[it];let ut=le[Ze]<me,ot=le[We]<me;G.vertexLength+((ut?1:0)+(ot?1:0))>Di.MAX_VERTEX_ARRAY_LENGTH&&(G=B.createNewSegment(V,H),me=Me.count,ut=!0,ot=!0,ne=0);const pt=gd(le,W,re,Me,Ze,ut,G),Xe=gd(le,W,re,Me,We,ot,G);H.emplaceBack(ne+pt-me,ne+Xe-me),G.primitiveLength++}}}(w,o,S,f,M,s),t.forceNewSegmentOnNextPrepare(),w?.forceNewSegmentOnNextPrepare()}function gd(s,t,o,u,f,b,w){if(b){const S=u.count;return o(t[2*f],t[2*f+1]),s[f]=u.count,u.count++,w.vertexLength++,S}return s[f]}class Qm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ve,this.indexArray=new nn,this.indexArray2=new Qi,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Di,this.segments2=new Di,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u){this.hasPattern=Km("fill",this.layers,o);const f=this.layers[0].layout.get("fill-sort-key"),b=!f.isConstant(),w=[];for(const{feature:S,id:M,index:A,sourceLayerIndex:D}of t){const B=this.layers[0]._featureFilter.needGeometry,V=tu(S,B);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom,{globalState:this.globalState}),V,u))continue;const H=b?f.evaluate(V,{},u,o.availableImages):void 0,W={id:M,properties:S.properties,type:S.type,sourceLayerIndex:D,index:A,geometry:B?V.geometry:eu(S),patterns:{},sortKey:H};w.push(W)}b&&w.sort((S,M)=>S.sortKey-M.sortKey);for(const S of w){const{geometry:M,index:A,sourceLayerIndex:D}=S;if(this.hasPattern){const B=Xm("fill",this.layers,S,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(S,M,A,u,{},o.subdivisionGranularity);o.featureIndex.insert(t[A].feature,M,A,D,this.index)}}update(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)}addFeatures(t,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,KT),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,u,f,b,w){for(const S of io(o,500)){const M=kv(S,f,w.fill.getGranularityForZoomLevel(f.z)),A=this.layoutVertexArray;zv((D,B)=>{A.emplaceBack(D,B)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,b,f)}}let Rv,Dv;Mt("FillBucket",Qm,{omit:["layers","patternFeatures"]});var aS={get paint(){return Dv=Dv||new Zr({"fill-antialias":new Rt(Se.paint_fill["fill-antialias"]),"fill-opacity":new Xt(Se.paint_fill["fill-opacity"]),"fill-color":new Xt(Se.paint_fill["fill-color"]),"fill-outline-color":new Xt(Se.paint_fill["fill-outline-color"]),"fill-translate":new Rt(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ju(Se.paint_fill["fill-pattern"])})},get layout(){return Rv=Rv||new Zr({"fill-sort-key":new Xt(Se.layout_fill["fill-sort-key"])})}};class lS extends br{constructor(t){super(t,aS)}recalculate(t,o){super.recalculate(t,o);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Qm(t)}queryRadius(){return Fp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:o,transform:u,pixelsToTileUnits:f}){return pv(Bp(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-u.bearingInRadians,f),o)}isTileClipped(){return!0}}const cS=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),uS=Cn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:hS}=cS;var eg,Ov,tg,Fv,ig,Bv,Nv,$p={};function jv(){if(Ov)return eg;Ov=1;var s=$();function t(f,b,w,S,M){this.properties={},this.extent=w,this.type=0,this._pbf=f,this._geometry=-1,this._keys=S,this._values=M,f.readFields(o,this,b)}function o(f,b,w){f==1?b.id=w.readVarint():f==2?function(S,M){for(var A=S.readVarint()+S.pos;S.pos<A;){var D=M._keys[S.readVarint()],B=M._values[S.readVarint()];M.properties[D]=B}}(w,b):f==3?b.type=w.readVarint():f==4&&(b._geometry=w.pos)}function u(f){for(var b,w,S=0,M=0,A=f.length,D=A-1;M<A;D=M++)S+=((w=f[D]).x-(b=f[M]).x)*(b.y+w.y);return S}return eg=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var b,w=f.readVarint()+f.pos,S=1,M=0,A=0,D=0,B=[];f.pos<w;){if(M<=0){var V=f.readVarint();S=7&V,M=V>>3}if(M--,S===1||S===2)A+=f.readSVarint(),D+=f.readSVarint(),S===1&&(b&&B.push(b),b=[]),b.push(new s(A,D));else{if(S!==7)throw new Error("unknown command "+S);b&&b.push(b[0].clone())}}return b&&B.push(b),B},t.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var b=f.readVarint()+f.pos,w=1,S=0,M=0,A=0,D=1/0,B=-1/0,V=1/0,H=-1/0;f.pos<b;){if(S<=0){var W=f.readVarint();w=7&W,S=W>>3}if(S--,w===1||w===2)(M+=f.readSVarint())<D&&(D=M),M>B&&(B=M),(A+=f.readSVarint())<V&&(V=A),A>H&&(H=A);else if(w!==7)throw new Error("unknown command "+w)}return[D,V,B,H]},t.prototype.toGeoJSON=function(f,b,w){var S,M,A=this.extent*Math.pow(2,w),D=this.extent*f,B=this.extent*b,V=this.loadGeometry(),H=t.types[this.type];function W(le){for(var Me=0;Me<le.length;Me++){var me=le[Me];le[Me]=[360*(me.x+D)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(me.y+B)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(S=0;S<V.length;S++)Y[S]=V[S][0];W(V=Y);break;case 2:for(S=0;S<V.length;S++)W(V[S]);break;case 3:for(V=function(le){var Me=le.length;if(Me<=1)return[le];for(var me,G,ne=[],ge=0;ge<Me;ge++){var Ne=u(le[ge]);Ne!==0&&(G===void 0&&(G=Ne<0),G===Ne<0?(me&&ne.push(me),me=[le[ge]]):me.push(le[ge]))}return me&&ne.push(me),ne}(V),S=0;S<V.length;S++)for(M=0;M<V[S].length;M++)W(V[S][M])}V.length===1?V=V[0]:H="Multi"+H;var re={type:"Feature",geometry:{type:H,coordinates:V},properties:this.properties};return"id"in this&&(re.id=this.id),re},eg}function Uv(){if(Fv)return tg;Fv=1;var s=jv();function t(u,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,f),this.length=this._features.length}function o(u,f,b){u===15?f.version=b.readVarint():u===1?f.name=b.readString():u===5?f.extent=b.readVarint():u===2?f._features.push(b.pos):u===3?f._keys.push(b.readString()):u===4&&f._values.push(function(w){for(var S=null,M=w.readVarint()+w.pos;w.pos<M;){var A=w.readVarint()>>3;S=A===1?w.readString():A===2?w.readFloat():A===3?w.readDouble():A===4?w.readVarint64():A===5?w.readVarint():A===6?w.readSVarint():A===7?w.readBoolean():null}return S}(b))}return tg=t,t.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var f=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,f,this.extent,this._keys,this._values)},tg}function $v(){return Nv||(Nv=1,$p.VectorTile=function(){if(Bv)return ig;Bv=1;var s=Uv();function t(o,u,f){if(o===3){var b=new s(f,f.readVarint()+f.pos);b.length&&(u[b.name]=b)}}return ig=function(o,u){this.layers=o.readFields(t,{},u)},ig}(),$p.VectorTileFeature=jv(),$p.VectorTileLayer=Uv()),$p}var _d=E($v());const dS=_d.VectorTileFeature.types,ng=Math.pow(2,13);function yd(s,t,o,u,f,b,w,S){s.emplaceBack(t,o,2*Math.floor(u*ng)+w,f*ng*2,b*ng*2,Math.round(S))}class rg{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vt,this.centroidVertexArray=new De,this.indexArray=new nn,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Di,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u){this.features=[],this.hasPattern=Km("fill-extrusion",this.layers,o);for(const{feature:f,id:b,index:w,sourceLayerIndex:S}of t){const M=this.layers[0]._featureFilter.needGeometry,A=tu(f,M);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom,{globalState:this.globalState}),A,u))continue;const D={id:b,sourceLayerIndex:S,index:w,geometry:M?A.geometry:eu(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Xm("fill-extrusion",this.layers,D,this.zoom,o)):this.addFeature(D,D.geometry,w,u,{},o.subdivisionGranularity),o.featureIndex.insert(f,D.geometry,w,S,this.index,!0)}}addFeatures(t,o,u){for(const f of this.features){const{geometry:b}=f;this.addFeature(f,b,f.index,o,u,t.subdivisionGranularity)}}update(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hS),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,uS.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,o,u,f,b,w){for(const S of io(o,500)){const M={x:0,y:0,sampleCount:0},A=this.layoutVertexArray.length;this.processPolygon(M,f,t,S,w);const D=this.layoutVertexArray.length-A,B=Math.floor(M.x/M.sampleCount),V=Math.floor(M.y/M.sampleCount);for(let H=0;H<D;H++)this.centroidVertexArray.emplaceBack(B,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,b,f)}processPolygon(t,o,u,f,b){if(f.length<1||Vv(f[0]))return;for(const B of f)B.length!==0&&pS(t,B);const w={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=b.fill.getGranularityForZoomLevel(o.z),M=dS[u.type]==="Polygon";for(const B of f){if(B.length===0||Vv(B))continue;const V=nu(B,S,M);this._generateSideFaces(V,w)}if(!M)return;const A=kv(f,o,S,!1),D=this.layoutVertexArray;zv((B,V)=>{yd(D,B,V,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles)}_generateSideFaces(t,o){let u=0;for(let f=1;f<t.length;f++){const b=t[f],w=t[f-1];if(fS(b,w))continue;o.segment.vertexLength+4>Di.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=b.sub(w)._perp()._unit(),M=w.dist(b);u+M>32768&&(u=0),yd(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,0,u),yd(this.layoutVertexArray,b.x,b.y,S.x,S.y,0,1,u),u+=M,yd(this.layoutVertexArray,w.x,w.y,S.x,S.y,0,0,u),yd(this.layoutVertexArray,w.x,w.y,S.x,S.y,0,1,u);const A=o.segment.vertexLength;this.indexArray.emplaceBack(A,A+2,A+1),this.indexArray.emplaceBack(A+1,A+2,A+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function pS(s,t){for(let o=0;o<t.length;o++){const u=t[o];o===t.length-1&&t[0].x===u.x&&t[0].y===u.y||(s.x+=u.x,s.y+=u.y,s.sampleCount++)}}function fS(s,t){return s.x===t.x&&(s.x<0||s.x>Jt)||s.y===t.y&&(s.y<0||s.y>Jt)}function Vv(s){return s.every(t=>t.x<0)||s.every(t=>t.x>Jt)||s.every(t=>t.y<0)||s.every(t=>t.y>Jt)}let Zv;Mt("FillExtrusionBucket",rg,{omit:["layers","features"]});var mS={get paint(){return Zv=Zv||new Zr({"fill-extrusion-opacity":new Rt(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ju(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xt(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rt(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gS extends br{constructor(t){super(t,mS)}createBucket(t){return new rg(t)}queryRadius(){return Fp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:o,featureState:u,geometry:f,transform:b,pixelsToTileUnits:w,pixelPosMatrix:S}){const M=Bp(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,w),A=this.paint.get("fill-extrusion-height").evaluate(o,u),D=this.paint.get("fill-extrusion-base").evaluate(o,u),B=function(H,W){const Y=[];for(const re of H){const le=[re.x,re.y,0,1];ri(le,le,W),Y.push(new te(le[0]/le[3],le[1]/le[3]))}return Y}(M,S),V=function(H,W,Y,re){const le=[],Me=[],me=re[8]*W,G=re[9]*W,ne=re[10]*W,ge=re[11]*W,Ne=re[8]*Y,it=re[9]*Y,Ze=re[10]*Y,We=re[11]*Y;for(const ut of H){const ot=[],pt=[];for(const Xe of ut){const zt=Xe.x,Gt=Xe.y,Zt=re[0]*zt+re[4]*Gt+re[12],Ot=re[1]*zt+re[5]*Gt+re[13],Li=re[2]*zt+re[6]*Gt+re[14],Mn=re[3]*zt+re[7]*Gt+re[15],Kn=Li+ne,Dr=Mn+ge,Yo=Zt+Ne,mo=Ot+it,Pr=Li+Ze,xn=Mn+We,lr=new te((Zt+me)/Dr,(Ot+G)/Dr);lr.z=Kn/Dr,ot.push(lr);const Cr=new te(Yo/xn,mo/xn);Cr.z=Pr/xn,pt.push(Cr)}le.push(ot),Me.push(pt)}return[le,Me]}(f,D,A,S);return function(H,W,Y){let re=1/0;pv(Y,W)&&(re=qv(Y,W[0]));for(let le=0;le<W.length;le++){const Me=W[le],me=H[le];for(let G=0;G<Me.length-1;G++){const ne=Me[G],ge=[ne,Me[G+1],me[G+1],me[G],ne];dv(Y,ge)&&(re=Math.min(re,qv(Y,ge)))}}return re!==1/0&&re}(V[0],V[1],B)}}function vd(s,t){return s.x*t.x+s.y*t.y}function qv(s,t){if(s.length===1){let o=0;const u=t[o++];let f;for(;!f||u.equals(f);)if(f=t[o++],!f)return 1/0;for(;o<t.length;o++){const b=t[o],w=s[0],S=f.sub(u),M=b.sub(u),A=w.sub(u),D=vd(S,S),B=vd(S,M),V=vd(M,M),H=vd(A,S),W=vd(A,M),Y=D*V-B*B,re=(V*H-B*W)/Y,le=(D*W-B*H)/Y,Me=u.z*(1-re-le)+f.z*re+b.z*le;if(isFinite(Me))return Me}return 1/0}{let o=1/0;for(const u of t)o=Math.min(o,u.z);return o}}const _S=Cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:yS}=_S,vS=Cn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xS}=vS,bS=_d.VectorTileFeature.types,wS=Math.cos(Math.PI/180*37.5),Gv=Math.pow(2,14)/.5;class og{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new gt,this.layoutVertexArray2=new rt,this.indexArray=new nn,this.programConfigurations=new Ra(t.layers,t.zoom),this.segments=new Di,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u){this.hasPattern=Km("line",this.layers,o);const f=this.layers[0].layout.get("line-sort-key"),b=!f.isConstant(),w=[];for(const{feature:S,id:M,index:A,sourceLayerIndex:D}of t){const B=this.layers[0]._featureFilter.needGeometry,V=tu(S,B);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom,{globalState:this.globalState}),V,u))continue;const H=b?f.evaluate(V,{},u):void 0,W={id:M,properties:S.properties,type:S.type,sourceLayerIndex:D,index:A,geometry:B?V.geometry:eu(S),patterns:{},sortKey:H};w.push(W)}b&&w.sort((S,M)=>S.sortKey-M.sortKey);for(const S of w){const{geometry:M,index:A,sourceLayerIndex:D}=S;if(this.hasPattern){const B=Xm("line",this.layers,S,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(S,M,A,u,{},o.subdivisionGranularity);o.featureIndex.insert(t[A].feature,M,A,D,this.index)}}update(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)}addFeatures(t,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,xS)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yS),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,u,f,b,w){const S=this.layers[0].layout,M=S.get("line-join").evaluate(t,{}),A=S.get("line-cap"),D=S.get("line-miter-limit"),B=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const V of o)this.addLine(V,t,M,A,D,B,f,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,b,f)}addLine(t,o,u,f,b,w,S,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=nu(t,S?M.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<t.length-1;me++)this.totalDistance+=t[me].dist(t[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=bS[o.type]==="Polygon";let D=t.length;for(;D>=2&&t[D-1].equals(t[D-2]);)D--;let B=0;for(;B<D-1&&t[B].equals(t[B+1]);)B++;if(D<(A?3:2))return;u==="bevel"&&(b=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,H=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let W,Y,re,le,Me;this.e1=this.e2=-1,A&&(W=t[D-2],Me=t[B].sub(W)._unit()._perp());for(let me=B;me<D;me++){if(re=me===D-1?A?t[B+1]:void 0:t[me+1],re&&t[me].equals(re))continue;Me&&(le=Me),W&&(Y=W),W=t[me],Me=re?re.sub(W)._unit()._perp():le,le=le||Me;let G=le.add(Me);G.x===0&&G.y===0||G._unit();const ne=le.x*Me.x+le.y*Me.y,ge=G.x*Me.x+G.y*Me.y,Ne=ge!==0?1/ge:1/0,it=2*Math.sqrt(2-2*ge),Ze=ge<wS&&Y&&re,We=le.x*Me.y-le.y*Me.x>0;if(Ze&&me>B){const pt=W.dist(Y);if(pt>2*V){const Xe=W.sub(W.sub(Y)._mult(V/pt)._round());this.updateDistance(Y,Xe),this.addCurrentVertex(Xe,le,0,0,H),Y=Xe}}const ut=Y&&re;let ot=ut?u:A?"butt":f;if(ut&&ot==="round"&&(Ne<w?ot="miter":Ne<=2&&(ot="fakeround")),ot==="miter"&&Ne>b&&(ot="bevel"),ot==="bevel"&&(Ne>2&&(ot="flipbevel"),Ne<b&&(ot="miter")),Y&&this.updateDistance(Y,W),ot==="miter")G._mult(Ne),this.addCurrentVertex(W,G,0,0,H);else if(ot==="flipbevel"){if(Ne>100)G=Me.mult(-1);else{const pt=Ne*le.add(Me).mag()/le.sub(Me).mag();G._perp()._mult(pt*(We?-1:1))}this.addCurrentVertex(W,G,0,0,H),this.addCurrentVertex(W,G.mult(-1),0,0,H)}else if(ot==="bevel"||ot==="fakeround"){const pt=-Math.sqrt(Ne*Ne-1),Xe=We?pt:0,zt=We?0:pt;if(Y&&this.addCurrentVertex(W,le,Xe,zt,H),ot==="fakeround"){const Gt=Math.round(180*it/Math.PI/20);for(let Zt=1;Zt<Gt;Zt++){let Ot=Zt/Gt;if(Ot!==.5){const Mn=Ot-.5;Ot+=Ot*Mn*(Ot-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Mn*Mn+(.848013+ne*(.215638*ne-1.06021)))}const Li=Me.sub(le)._mult(Ot)._add(le)._unit()._mult(We?-1:1);this.addHalfVertex(W,Li.x,Li.y,!1,We,0,H)}}re&&this.addCurrentVertex(W,Me,-Xe,-zt,H)}else if(ot==="butt")this.addCurrentVertex(W,G,0,0,H);else if(ot==="square"){const pt=Y?1:-1;this.addCurrentVertex(W,G,pt,pt,H)}else ot==="round"&&(Y&&(this.addCurrentVertex(W,le,0,0,H),this.addCurrentVertex(W,le,1,1,H,!0)),re&&(this.addCurrentVertex(W,Me,-1,-1,H,!0),this.addCurrentVertex(W,Me,0,0,H)));if(Ze&&me<D-1){const pt=W.dist(re);if(pt>2*V){const Xe=W.add(re.sub(W)._mult(V/pt)._round());this.updateDistance(W,Xe),this.addCurrentVertex(Xe,Me,0,0,H),W=Xe}}}}addCurrentVertex(t,o,u,f,b,w=!1){const S=o.y*f-o.x,M=-o.y-o.x*f;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,w,!1,u,b),this.addHalfVertex(t,S,M,w,!0,-f,b),this.distance>Gv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,o,u,f,b,w))}addHalfVertex({x:t,y:o},u,f,b,w,S,M){const A=.5*(this.lineClips?this.scaledDistance*(Gv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(b?1:0),(o<<1)+(w?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,D,this.e2),M.primitiveLength++),w?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}let Hv,Wv;Mt("LineBucket",og,{omit:["layers","patternFeatures"]});var Kv={get paint(){return Wv=Wv||new Zr({"line-opacity":new Xt(Se.paint_line["line-opacity"]),"line-color":new Xt(Se.paint_line["line-color"]),"line-translate":new Rt(Se.paint_line["line-translate"]),"line-translate-anchor":new Rt(Se.paint_line["line-translate-anchor"]),"line-width":new Xt(Se.paint_line["line-width"]),"line-gap-width":new Xt(Se.paint_line["line-gap-width"]),"line-offset":new Xt(Se.paint_line["line-offset"]),"line-blur":new Xt(Se.paint_line["line-blur"]),"line-dasharray":new td(Se.paint_line["line-dasharray"]),"line-pattern":new Ju(Se.paint_line["line-pattern"]),"line-gradient":new Wc(Se.paint_line["line-gradient"])})},get layout(){return Hv=Hv||new Zr({"line-cap":new Rt(Se.layout_line["line-cap"]),"line-join":new Xt(Se.layout_line["line-join"]),"line-miter-limit":new Rt(Se.layout_line["line-miter-limit"]),"line-round-limit":new Rt(Se.layout_line["line-round-limit"]),"line-sort-key":new Xt(Se.layout_line["line-sort-key"])})}};class TS extends Xt{possiblyEvaluate(t,o){return o=new fn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(t,o)}evaluate(t,o,u,f){return o=er({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(t,o,u,f)}}let Vp;class SS extends br{constructor(t){super(t,Kv),this.gradientVersion=0,Vp||(Vp=new TS(Kv.paint.properties["line-width"].specification),Vp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(u){return u._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof pa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,o){super.recalculate(t,o),this.paint._values["line-floorwidth"]=Vp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new og(t)}queryRadius(t){const o=t,u=Xv(cd("line-width",this,o),cd("line-gap-width",this,o)),f=cd("line-offset",this,o);return u/2+Math.abs(f)+Fp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:o,featureState:u,geometry:f,transform:b,pixelsToTileUnits:w}){const S=Bp(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,w),M=w/2*Xv(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),A=this.paint.get("line-offset").evaluate(o,u);return A&&(f=function(D,B){const V=[];for(let H=0;H<D.length;H++){const W=D[H],Y=[];for(let re=0;re<W.length;re++){const le=W[re-1],Me=W[re],me=W[re+1],G=re===0?new te(0,0):Me.sub(le)._unit()._perp(),ne=re===W.length-1?new te(0,0):me.sub(Me)._unit()._perp(),ge=G._add(ne)._unit(),Ne=ge.x*ne.x+ge.y*ne.y;Ne!==0&&ge._mult(1/Ne),Y.push(ge._mult(B)._add(Me))}V.push(Y)}return V}(f,A*w)),function(D,B,V){for(let H=0;H<B.length;H++){const W=B[H];if(D.length>=3){for(let Y=0;Y<W.length;Y++)if(th(D,W[Y]))return!0}if(FT(D,W,V))return!0}return!1}(S,f,M)}isTileClipped(){return!0}}function Xv(s,t){return t>0?t+2*s:s}const PS=Cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),CS=Cn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const MS=Cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Cn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yv=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ES=Cn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function IS(s,t,o){return s.sections.forEach(u=>{u.text=function(f,b,w){const S=b.layout.get("text-transform").evaluate(w,{});return S==="uppercase"?f=f.toLocaleUpperCase():S==="lowercase"&&(f=f.toLocaleLowerCase()),Ma.applyArabicShaping&&(f=Ma.applyArabicShaping(f)),f}(u.text,t,o)}),s}Cn([{name:"triangle",components:3,type:"Uint16"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Cn([{type:"Float32",name:"offsetX"}]),Cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Cn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Jv,sg,Qv,ar=24,ag={};function AS(){return Jv||(Jv=1,ag.read=function(s,t,o,u,f){var b,w,S=8*f-u-1,M=(1<<S)-1,A=M>>1,D=-7,B=o?f-1:0,V=o?-1:1,H=s[t+B];for(B+=V,b=H&(1<<-D)-1,H>>=-D,D+=S;D>0;b=256*b+s[t+B],B+=V,D-=8);for(w=b&(1<<-D)-1,b>>=-D,D+=u;D>0;w=256*w+s[t+B],B+=V,D-=8);if(b===0)b=1-A;else{if(b===M)return w?NaN:1/0*(H?-1:1);w+=Math.pow(2,u),b-=A}return(H?-1:1)*w*Math.pow(2,b-u)},ag.write=function(s,t,o,u,f,b){var w,S,M,A=8*b-f-1,D=(1<<A)-1,B=D>>1,V=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=u?0:b-1,W=u?1:-1,Y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(S=isNaN(t)?1:0,w=D):(w=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-w))<1&&(w--,M*=2),(t+=w+B>=1?V/M:V*Math.pow(2,1-B))*M>=2&&(w++,M/=2),w+B>=D?(S=0,w=D):w+B>=1?(S=(t*M-1)*Math.pow(2,f),w+=B):(S=t*Math.pow(2,B-1)*Math.pow(2,f),w=0));f>=8;s[o+H]=255&S,H+=W,S/=256,f-=8);for(w=w<<f|S,A+=f;A>0;s[o+H]=255&w,H+=W,w/=256,A-=8);s[o+H-W]|=128*Y}),ag}function e0(){if(Qv)return sg;Qv=1,sg=t;var s=AS();function t(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var o=4294967296,u=1/o,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function b(G){return G.type===t.Bytes?G.readVarint()+G.pos:G.pos+1}function w(G,ne,ge){return ge?4294967296*ne+(G>>>0):4294967296*(ne>>>0)+(G>>>0)}function S(G,ne,ge){var Ne=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));ge.realloc(Ne);for(var it=ge.pos-1;it>=G;it--)ge.buf[it+Ne]=ge.buf[it]}function M(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeVarint(G[ge])}function A(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeSVarint(G[ge])}function D(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeFloat(G[ge])}function B(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeDouble(G[ge])}function V(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeBoolean(G[ge])}function H(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeFixed32(G[ge])}function W(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeSFixed32(G[ge])}function Y(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeFixed64(G[ge])}function re(G,ne){for(var ge=0;ge<G.length;ge++)ne.writeSFixed64(G[ge])}function le(G,ne){return(G[ne]|G[ne+1]<<8|G[ne+2]<<16)+16777216*G[ne+3]}function Me(G,ne,ge){G[ge]=ne,G[ge+1]=ne>>>8,G[ge+2]=ne>>>16,G[ge+3]=ne>>>24}function me(G,ne){return(G[ne]|G[ne+1]<<8|G[ne+2]<<16)+(G[ne+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(G,ne,ge){for(ge=ge||this.length;this.pos<ge;){var Ne=this.readVarint(),it=Ne>>3,Ze=this.pos;this.type=7&Ne,G(it,ne,this),this.pos===Ze&&this.skip(Ne)}return ne},readMessage:function(G,ne){return this.readFields(G,ne,this.readVarint()+this.pos)},readFixed32:function(){var G=le(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=me(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=le(this.buf,this.pos)+le(this.buf,this.pos+4)*o;return this.pos+=8,G},readSFixed64:function(){var G=le(this.buf,this.pos)+me(this.buf,this.pos+4)*o;return this.pos+=8,G},readFloat:function(){var G=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var ne,ge,Ne=this.buf;return ne=127&(ge=Ne[this.pos++]),ge<128?ne:(ne|=(127&(ge=Ne[this.pos++]))<<7,ge<128?ne:(ne|=(127&(ge=Ne[this.pos++]))<<14,ge<128?ne:(ne|=(127&(ge=Ne[this.pos++]))<<21,ge<128?ne:function(it,Ze,We){var ut,ot,pt=We.buf;if(ut=(112&(ot=pt[We.pos++]))>>4,ot<128||(ut|=(127&(ot=pt[We.pos++]))<<3,ot<128)||(ut|=(127&(ot=pt[We.pos++]))<<10,ot<128)||(ut|=(127&(ot=pt[We.pos++]))<<17,ot<128)||(ut|=(127&(ot=pt[We.pos++]))<<24,ot<128)||(ut|=(1&(ot=pt[We.pos++]))<<31,ot<128))return w(it,ut,Ze);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(ge=Ne[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,ne=this.pos;return this.pos=G,G-ne>=12&&f?function(ge,Ne,it){return f.decode(ge.subarray(Ne,it))}(this.buf,ne,G):function(ge,Ne,it){for(var Ze="",We=Ne;We<it;){var ut,ot,pt,Xe=ge[We],zt=null,Gt=Xe>239?4:Xe>223?3:Xe>191?2:1;if(We+Gt>it)break;Gt===1?Xe<128&&(zt=Xe):Gt===2?(192&(ut=ge[We+1]))==128&&(zt=(31&Xe)<<6|63&ut)<=127&&(zt=null):Gt===3?(ot=ge[We+2],(192&(ut=ge[We+1]))==128&&(192&ot)==128&&((zt=(15&Xe)<<12|(63&ut)<<6|63&ot)<=2047||zt>=55296&&zt<=57343)&&(zt=null)):Gt===4&&(ot=ge[We+2],pt=ge[We+3],(192&(ut=ge[We+1]))==128&&(192&ot)==128&&(192&pt)==128&&((zt=(15&Xe)<<18|(63&ut)<<12|(63&ot)<<6|63&pt)<=65535||zt>=1114112)&&(zt=null)),zt===null?(zt=65533,Gt=1):zt>65535&&(zt-=65536,Ze+=String.fromCharCode(zt>>>10&1023|55296),zt=56320|1023&zt),Ze+=String.fromCharCode(zt),We+=Gt}return Ze}(this.buf,ne,G)},readBytes:function(){var G=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,G);return this.pos=G,ne},readPackedVarint:function(G,ne){if(this.type!==t.Bytes)return G.push(this.readVarint(ne));var ge=b(this);for(G=G||[];this.pos<ge;)G.push(this.readVarint(ne));return G},readPackedSVarint:function(G){if(this.type!==t.Bytes)return G.push(this.readSVarint());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==t.Bytes)return G.push(this.readBoolean());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==t.Bytes)return G.push(this.readFloat());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==t.Bytes)return G.push(this.readDouble());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed32());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed32());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readFixed64());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==t.Bytes)return G.push(this.readSFixed64());var ne=b(this);for(G=G||[];this.pos<ne;)G.push(this.readSFixed64());return G},skip:function(G){var ne=7&G;if(ne===t.Varint)for(;this.buf[this.pos++]>127;);else if(ne===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===t.Fixed32)this.pos+=4;else{if(ne!==t.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function(G,ne){this.writeVarint(G<<3|ne)},realloc:function(G){for(var ne=this.length||16;ne<this.pos+G;)ne*=2;if(ne!==this.length){var ge=new Uint8Array(ne);ge.set(this.buf),this.buf=ge,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Me(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Me(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Me(this.buf,-1&G,this.pos),Me(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Me(this.buf,-1&G,this.pos),Me(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(ne,ge){var Ne,it;if(ne>=0?(Ne=ne%4294967296|0,it=ne/4294967296|0):(it=~(-ne/4294967296),4294967295^(Ne=~(-ne%4294967296))?Ne=Ne+1|0:(Ne=0,it=it+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ge.realloc(10),function(Ze,We,ut){ut.buf[ut.pos++]=127&Ze|128,Ze>>>=7,ut.buf[ut.pos++]=127&Ze|128,Ze>>>=7,ut.buf[ut.pos++]=127&Ze|128,Ze>>>=7,ut.buf[ut.pos++]=127&Ze|128,ut.buf[ut.pos]=127&(Ze>>>=7)}(Ne,0,ge),function(Ze,We){var ut=(7&Ze)<<4;We.buf[We.pos++]|=ut|((Ze>>>=3)?128:0),Ze&&(We.buf[We.pos++]=127&Ze|((Ze>>>=7)?128:0),Ze&&(We.buf[We.pos++]=127&Ze|((Ze>>>=7)?128:0),Ze&&(We.buf[We.pos++]=127&Ze|((Ze>>>=7)?128:0),Ze&&(We.buf[We.pos++]=127&Ze|((Ze>>>=7)?128:0),Ze&&(We.buf[We.pos++]=127&Ze)))))}(it,ge)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var ne=this.pos;this.pos=function(Ne,it,Ze){for(var We,ut,ot=0;ot<it.length;ot++){if((We=it.charCodeAt(ot))>55295&&We<57344){if(!ut){We>56319||ot+1===it.length?(Ne[Ze++]=239,Ne[Ze++]=191,Ne[Ze++]=189):ut=We;continue}if(We<56320){Ne[Ze++]=239,Ne[Ze++]=191,Ne[Ze++]=189,ut=We;continue}We=ut-55296<<10|We-56320|65536,ut=null}else ut&&(Ne[Ze++]=239,Ne[Ze++]=191,Ne[Ze++]=189,ut=null);We<128?Ne[Ze++]=We:(We<2048?Ne[Ze++]=We>>6|192:(We<65536?Ne[Ze++]=We>>12|224:(Ne[Ze++]=We>>18|240,Ne[Ze++]=We>>12&63|128),Ne[Ze++]=We>>6&63|128),Ne[Ze++]=63&We|128)}return Ze}(this.buf,G,this.pos);var ge=this.pos-ne;ge>=128&&S(ne,ge,this),this.pos=ne-1,this.writeVarint(ge),this.pos+=ge},writeFloat:function(G){this.realloc(4),s.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),s.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var ne=G.length;this.writeVarint(ne),this.realloc(ne);for(var ge=0;ge<ne;ge++)this.buf[this.pos++]=G[ge]},writeRawMessage:function(G,ne){this.pos++;var ge=this.pos;G(ne,this);var Ne=this.pos-ge;Ne>=128&&S(ge,Ne,this),this.pos=ge-1,this.writeVarint(Ne),this.pos+=Ne},writeMessage:function(G,ne,ge){this.writeTag(G,t.Bytes),this.writeRawMessage(ne,ge)},writePackedVarint:function(G,ne){ne.length&&this.writeMessage(G,M,ne)},writePackedSVarint:function(G,ne){ne.length&&this.writeMessage(G,A,ne)},writePackedBoolean:function(G,ne){ne.length&&this.writeMessage(G,V,ne)},writePackedFloat:function(G,ne){ne.length&&this.writeMessage(G,D,ne)},writePackedDouble:function(G,ne){ne.length&&this.writeMessage(G,B,ne)},writePackedFixed32:function(G,ne){ne.length&&this.writeMessage(G,H,ne)},writePackedSFixed32:function(G,ne){ne.length&&this.writeMessage(G,W,ne)},writePackedFixed64:function(G,ne){ne.length&&this.writeMessage(G,Y,ne)},writePackedSFixed64:function(G,ne){ne.length&&this.writeMessage(G,re,ne)},writeBytesField:function(G,ne){this.writeTag(G,t.Bytes),this.writeBytes(ne)},writeFixed32Field:function(G,ne){this.writeTag(G,t.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(G,ne){this.writeTag(G,t.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(G,ne){this.writeTag(G,t.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(G,ne){this.writeTag(G,t.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(G,ne){this.writeTag(G,t.Varint),this.writeVarint(ne)},writeSVarintField:function(G,ne){this.writeTag(G,t.Varint),this.writeSVarint(ne)},writeStringField:function(G,ne){this.writeTag(G,t.Bytes),this.writeString(ne)},writeFloatField:function(G,ne){this.writeTag(G,t.Fixed32),this.writeFloat(ne)},writeDoubleField:function(G,ne){this.writeTag(G,t.Fixed64),this.writeDouble(ne)},writeBooleanField:function(G,ne){this.writeVarintField(G,!!ne)}},sg}var sc,lg=E(e0());function LS(s,t,o){s===1&&o.readMessage(kS,t)}function kS(s,t,o){if(s===3){const{id:u,bitmap:f,width:b,height:w,left:S,top:M,advance:A}=o.readMessage(zS,{});t.push({id:u,bitmap:new ud({width:b+6,height:w+6},f),metrics:{width:b,height:w,left:S,top:M,advance:A}})}}function zS(s,t,o){s===1?t.id=o.readVarint():s===2?t.bitmap=o.readBytes():s===3?t.width=o.readVarint():s===4?t.height=o.readVarint():s===5?t.left=o.readSVarint():s===6?t.top=o.readSVarint():s===7&&(t.advance=o.readVarint())}function t0(s){let t=0,o=0;for(const w of s)t+=w.w*w.h,o=Math.max(o,w.w);s.sort((w,S)=>S.h-w.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let f=0,b=0;for(const w of s)for(let S=u.length-1;S>=0;S--){const M=u[S];if(!(w.w>M.w||w.h>M.h)){if(w.x=M.x,w.y=M.y,b=Math.max(b,w.y+w.h),f=Math.max(f,w.x+w.w),w.w===M.w&&w.h===M.h){const A=u.pop();S<u.length&&(u[S]=A)}else w.h===M.h?(M.x+=w.w,M.w-=w.w):w.w===M.w?(M.y+=w.h,M.h-=w.h):(u.push({x:M.x+w.w,y:M.y,w:M.w-w.w,h:w.h}),M.y+=w.h,M.h-=w.h);break}}return{w:f,h:b,fill:t/(f*b)||0}}class cg{constructor(t,{pixelRatio:o,version:u,stretchX:f,stretchY:b,content:w,textFitWidth:S,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=f,this.stretchY=b,this.content=w,this.version=u,this.textFitWidth=S,this.textFitHeight=M}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class i0{constructor(t,o){const u={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(t,u,b),this.addImages(o,f,b);const{w,h:S}=t0(b),M=new fo({width:w||1,height:S||1});for(const A in t){const D=t[A],B=u[A].paddedRect;fo.copy(D.data,M,{x:0,y:0},{x:B.x+1,y:B.y+1},D.data)}for(const A in o){const D=o[A],B=f[A].paddedRect,V=B.x+1,H=B.y+1,W=D.data.width,Y=D.data.height;fo.copy(D.data,M,{x:0,y:0},{x:V,y:H},D.data),fo.copy(D.data,M,{x:0,y:Y-1},{x:V,y:H-1},{width:W,height:1}),fo.copy(D.data,M,{x:0,y:0},{x:V,y:H+Y},{width:W,height:1}),fo.copy(D.data,M,{x:W-1,y:0},{x:V-1,y:H},{width:1,height:Y}),fo.copy(D.data,M,{x:0,y:0},{x:V+W,y:H},{width:1,height:Y})}this.image=M,this.iconPositions=u,this.patternPositions=f}addImages(t,o,u){for(const f in t){const b=t[f],w={x:0,y:0,w:b.data.width+2,h:b.data.height+2};u.push(w),o[f]=new cg(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,o){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)}patchUpdatedImage(t,o,u){if(!t||!o||t.version===o.version)return;t.version=o.version;const[f,b]=t.tl;u.update(o.data,void 0,{x:f,y:b})}}Mt("ImagePosition",cg),Mt("ImageAtlas",i0),g.an=void 0,(sc=g.an||(g.an={}))[sc.none=0]="none",sc[sc.horizontal=1]="horizontal",sc[sc.vertical=2]="vertical",sc[sc.horizontalOnly=3]="horizontalOnly";class bd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,o,u){const f=new bd;return f.scale=t||1,f.fontStack=o,f.verticalAlign=u||"bottom",f}static forImage(t,o){const u=new bd;return u.imageName=t,u.verticalAlign=o||"bottom",u}}class oh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const u=new oh;for(let f=0;f<t.sections.length;f++){const b=t.sections[f];b.image?u.addImageSection(b):u.addTextSection(b,o)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let o="";for(let u=0;u<t.length;u++){const f=t.charCodeAt(u+1)||null,b=t.charCodeAt(u-1)||null;o+=f&&Jh(f)&&!xd[t[u+1]]||b&&Jh(b)&&!xd[t[u-1]]||!xd[t[u]]?t[u]:xd[t[u]]}return o}(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&qp[this.text.charCodeAt(u)];u++)t++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&qp[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const u=new oh;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}getMaxImageSize(t){let o=0,u=0;for(let f=0;f<this.length();f++){const b=this.getSection(f);if(b.imageName){const w=t[b.imageName];if(!w)continue;const S=w.displaySize;o=Math.max(o,S[0]),u=Math.max(u,S[1])}}return{maxImageWidth:o,maxImageHeight:u}}addTextSection(t,o){this.text+=t.text,this.sections.push(bd.forText(t.scale,t.fontStack||o,t.verticalAlign));const u=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(u)}addImageSection(t){const o=t.image?t.image.name:"";if(o.length===0)return void nt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(bd.forImage(o,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zp(s,t,o,u,f,b,w,S,M,A,D,B,V,H,W){const Y=oh.fromFeature(s,f);let re;B===g.an.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:Me}=Ma;if(le&&Y.sections.length===1){re=[];const ne=le(Y.toString(),ug(Y,A,b,t,u,H));for(const ge of ne){const Ne=new oh;Ne.text=ge,Ne.sections=Y.sections;for(let it=0;it<ge.length;it++)Ne.sectionIndex.push(0);re.push(Ne)}}else if(Me){re=[];const ne=Me(Y.text,Y.sectionIndex,ug(Y,A,b,t,u,H));for(const ge of ne){const Ne=new oh;Ne.text=ge[0],Ne.sectionIndex=ge[1],Ne.sections=Y.sections,re.push(Ne)}}else re=function(ne,ge){const Ne=[],it=ne.text;let Ze=0;for(const We of ge)Ne.push(ne.substring(Ze,We)),Ze=We;return Ze<it.length&&Ne.push(ne.substring(Ze,it.length)),Ne}(Y,ug(Y,A,b,t,u,H));const me=[],G={positionedLines:me,text:Y.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(ne,ge,Ne,it,Ze,We,ut,ot,pt,Xe,zt,Gt){let Zt=0,Ot=0,Li=0,Mn=0;const Kn=ot==="right"?1:ot==="left"?0:.5,Dr=ar/Gt;let Yo=0;for(const xn of Ze){xn.trim();const lr=xn.getMaxScale(),Cr={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Yo]=Cr;const Mr=Cr.positionedGlyphs;let oo=0;if(!xn.length()){Ot+=We,++Yo;continue}const Jo=FS(it,xn,Dr);for(let go=0;go<xn.length();go++){const Xn=xn.getSection(go),ur=xn.getSectionIndex(go),hr=xn.getCharCode(go),Vn=BS(pt,zt,hr);let hn;if(Xn.imageName){if(ne.iconsInText=!0,Xn.scale=Xn.scale*Dr,hn=jS(Xn,Vn,lr,Jo,it),!hn)continue;oo=Math.max(oo,hn.imageOffset)}else if(hn=NS(Xn,hr,Vn,Jo,ge,Ne),!hn)continue;const{rect:Ws,metrics:ch,baselineOffset:Ks}=hn;Mr.push({glyph:hr,imageName:Xn.imageName,x:Zt,y:Ot+Ks+-17,vertical:Vn,scale:Xn.scale,fontStack:Xn.fontStack,sectionIndex:ur,metrics:ch,rect:Ws}),Vn?(ne.verticalizable=!0,Zt+=(Xn.imageName?ch.advance:ar)*Xn.scale+Xe):Zt+=ch.advance*Xn.scale+Xe}Mr.length!==0&&(Li=Math.max(Zt-Xe,Li),US(Mr,0,Mr.length-1,Kn)),Zt=0,Cr.lineOffset=Math.max(oo,(lr-1)*ar);const cr=We*lr+oo;Ot+=cr,Mn=Math.max(cr,Mn),++Yo}const{horizontalAlign:mo,verticalAlign:Pr}=hg(ut);(function(xn,lr,Cr,Mr,oo,Jo,cr,go,Xn){const ur=(lr-Cr)*oo;let hr=0;hr=Jo!==cr?-go*Mr- -17:-Mr*Xn*cr+.5*cr;for(const Vn of xn)for(const hn of Vn.positionedGlyphs)hn.x+=ur,hn.y+=hr})(ne.positionedLines,Kn,mo,Pr,Li,Mn,We,Ot,Ze.length),ne.top+=-Pr*Ot,ne.bottom=ne.top+Ot,ne.left+=-mo*Li,ne.right=ne.left+Li}(G,t,o,u,re,w,S,M,B,A,V,W),!function(ne){for(const ge of ne)if(ge.positionedGlyphs.length!==0)return!1;return!0}(me)&&G}const qp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},RS={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},DS={40:!0};function n0(s,t,o,u,f,b){if(t.imageName){const w=u[t.imageName];return w?w.displaySize[0]*t.scale*ar/b+f:0}{const w=o[t.fontStack],S=w&&w[s];return S?S.metrics.advance*t.scale+f:0}}function r0(s,t,o,u){const f=Math.pow(s-t,2);return u?s<t?f/2:2*f:f+Math.abs(o)*o}function OS(s,t,o){let u=0;return s===10&&(u-=1e4),o&&(u+=150),s!==40&&s!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function o0(s,t,o,u,f,b){let w=null,S=r0(t,o,f,b);for(const M of u){const A=r0(t-M.x,o,f,b)+M.badness;A<=S&&(w=M,S=A)}return{index:s,x:t,priorBreak:w,badness:S}}function s0(s){return s?s0(s.priorBreak).concat(s.index):[]}function ug(s,t,o,u,f,b){if(!s)return[];const w=[],S=function(B,V,H,W,Y,re){let le=0;for(let Me=0;Me<B.length();Me++){const me=B.getSection(Me);le+=n0(B.getCharCode(Me),me,W,Y,V,re)}return le/Math.max(1,Math.ceil(le/H))}(s,t,o,u,f,b),M=s.text.indexOf("​")>=0;let A=0;for(let B=0;B<s.length();B++){const V=s.getSection(B),H=s.getCharCode(B);if(qp[H]||(A+=n0(H,V,u,f,t,b)),B<s.length()-1){const W=!((D=H)<11904)&&(!!Ci["CJK Compatibility Forms"](D)||!!Ci["CJK Compatibility"](D)||!!Ci["CJK Strokes"](D)||!!Ci["CJK Symbols and Punctuation"](D)||!!Ci["Enclosed CJK Letters and Months"](D)||!!Ci["Halfwidth and Fullwidth Forms"](D)||!!Ci["Ideographic Description Characters"](D)||!!Ci["Vertical Forms"](D)||Yh.test(String.fromCodePoint(D)));(RS[H]||W||V.imageName||B!==s.length()-2&&DS[s.getCharCode(B+1)])&&w.push(o0(B+1,A,S,w,OS(H,s.getCharCode(B+1),W&&M),!1))}}var D;return s0(o0(s.length(),A,S,w,0,!0))}function hg(s){let t=.5,o=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function FS(s,t,o){const u=t.getMaxScale()*ar,{maxImageWidth:f,maxImageHeight:b}=t.getMaxImageSize(s),w=Math.max(u,b*o);return{verticalLineContentWidth:Math.max(u,f*o),horizontalLineContentHeight:w}}function a0(s){switch(s){case"top":return 0;case"center":return .5;default:return 1}}function BS(s,t,o){return!(s===g.an.horizontal||!t&&!Ku(o)||t&&(qp[o]||(u=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(u)))));var u}function NS(s,t,o,u,f,b){const w=b[s.fontStack],S=function(A,D,B,V){if(A&&A.rect)return A;const H=D[B.fontStack],W=H&&H[V];return W?{rect:null,metrics:W.metrics}:null}(w&&w[t],f,s,t);if(S===null)return null;let M;if(o)M=u.verticalLineContentWidth-s.scale*ar;else{const A=a0(s.verticalAlign);M=(u.horizontalLineContentHeight-s.scale*ar)*A}return{rect:S.rect,metrics:S.metrics,baselineOffset:M}}function jS(s,t,o,u,f){const b=f[s.imageName];if(!b)return null;const w=b.paddedRect,S=b.displaySize,M={width:S[0],height:S[1],left:1,top:-3,advance:t?S[1]:S[0]};let A;if(t)A=u.verticalLineContentWidth-S[1]*s.scale;else{const D=a0(s.verticalAlign);A=(u.horizontalLineContentHeight-S[1]*s.scale)*D}return{rect:w,metrics:M,baselineOffset:A,imageOffset:(t?S[0]:S[1])*s.scale-ar*o}}function US(s,t,o,u){if(u===0)return;const f=s[o],b=(s[o].x+f.metrics.advance*f.scale)*u;for(let w=t;w<=o;w++)s[w].x-=b}function $S(s,t,o){const{horizontalAlign:u,verticalAlign:f}=hg(o),b=t[0]-s.displaySize[0]*u,w=t[1]-s.displaySize[1]*f;return{image:s,top:w,bottom:w+s.displaySize[1],left:b,right:b+s.displaySize[0]}}function l0(s){var t,o;let u=s.left,f=s.top,b=s.right-u,w=s.bottom-f;const S=(t=s.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(o=s.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",A=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(M==="proportional"){if(S==="stretchOnly"&&b/w<A||S==="proportional"){const D=Math.ceil(w*A);u*=D/b,b=D}}else if(S==="proportional"&&M==="stretchOnly"&&A!==0&&b/w>A){const D=Math.ceil(b/A);f*=D/w,w=D}return{x1:u,y1:f,x2:u+b,y2:f+w}}function c0(s,t,o,u,f,b){const w=s.image;let S;if(w.content){const re=w.content,le=w.pixelRatio||1;S=[re[0]/le,re[1]/le,w.displaySize[0]-re[2]/le,w.displaySize[1]-re[3]/le]}const M=t.left*b,A=t.right*b;let D,B,V,H;o==="width"||o==="both"?(H=f[0]+M-u[3],B=f[0]+A+u[1]):(H=f[0]+(M+A-w.displaySize[0])/2,B=H+w.displaySize[0]);const W=t.top*b,Y=t.bottom*b;return o==="height"||o==="both"?(D=f[1]+W-u[0],V=f[1]+Y+u[2]):(D=f[1]+(W+Y-w.displaySize[1])/2,V=D+w.displaySize[1]),{image:w,top:D,right:B,bottom:V,left:H,collisionPadding:S}}const bl=128,ac=32640;function u0(s,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new fn(s+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=o;let b=0;for(;b<u.length&&u[b]<=s;)b++;b=Math.max(0,b-1);let w=b;for(;w<u.length&&u[w]<s+1;)w++;w=Math.min(u.length-1,w);const S=u[b],M=u[w];return o.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:M,minSize:o.evaluate(new fn(S)),maxSize:o.evaluate(new fn(M)),interpolationType:f}}}function dg(s,t,o){let u="never";const f=s.get(t);return f?u=f:s.get(o)&&(u="always"),u}const VS=_d.VectorTileFeature.types,ZS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gp(s,t,o,u,f,b,w,S,M,A,D,B,V){const H=S?Math.min(ac,Math.round(S[0])):0,W=S?Math.min(ac,Math.round(S[1])):0;s.emplaceBack(t,o,Math.round(32*u),Math.round(32*f),b,w,(H<<1)+(M?1:0),W,16*A,16*D,256*B,256*V)}function pg(s,t,o){s.emplaceBack(t.x,t.y,o),s.emplaceBack(t.x,t.y,o),s.emplaceBack(t.x,t.y,o),s.emplaceBack(t.x,t.y,o)}function qS(s){for(const t of s.sections)if(Qh(t.text))return!0;return!1}class fg{constructor(t){this.layoutVertexArray=new gi,this.indexArray=new nn,this.programConfigurations=t,this.segments=new Di,this.dynamicLayoutVertexArray=new Vi,this.opacityVertexArray=new yn,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,o,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,PS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,CS.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ZS,!0),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Mt("SymbolBuffers",fg);class mg{constructor(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Di,this.collisionVertexArray=new vn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,MS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Mt("CollisionBuffers",mg);class sh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(w=>w.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=u0(this.zoom,o["text-size"]),this.iconSizeData=u0(this.zoom,o["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),b=u.get("symbol-z-order");this.canOverlap=dg(u,"text-overlap","text-allow-overlap")!=="never"||dg(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(w=>g.an[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=t.sourceID}createArrays(){this.text=new fg(new Ra(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new fg(new Ra(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new de,this.lineVertexArray=new _e,this.symbolInstances=new fe,this.textAnchorOffsets=new pe}calculateGlyphDependencies(t,o,u,f,b){for(let w=0;w<t.length;w++)if(o[t.charCodeAt(w)]=!0,(u||f)&&b){const S=xd[t.charAt(w)];S&&(o[S.charCodeAt(0)]=!0)}}populate(t,o,u){const f=this.layers[0],b=f.layout,w=b.get("text-font"),S=b.get("text-field"),M=b.get("icon-image"),A=(S.value.kind!=="constant"||S.value.value instanceof cn&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,B=b.get("symbol-sort-key");if(this.features=[],!A&&!D)return;const V=o.iconDependencies,H=o.glyphDependencies,W=o.availableImages,Y=new fn(this.zoom,{globalState:this.globalState});for(const{feature:re,id:le,index:Me,sourceLayerIndex:me}of t){const G=f._featureFilter.needGeometry,ne=tu(re,G);if(!f._featureFilter.filter(Y,ne,u))continue;let ge,Ne;if(G||(ne.geometry=eu(re)),A){const Ze=f.getValueAndResolveTokens("text-field",ne,u,W),We=cn.factory(Ze),ut=this.hasRTLText=this.hasRTLText||qS(We);(!ut||Ma.getRTLTextPluginStatus()==="unavailable"||ut&&Ma.isParsed())&&(ge=IS(We,f,ne))}if(D){const Ze=f.getValueAndResolveTokens("icon-image",ne,u,W);Ne=Ze instanceof tr?Ze:tr.fromString(Ze)}if(!ge&&!Ne)continue;const it=this.sortFeaturesByKey?B.evaluate(ne,{},u):void 0;if(this.features.push({id:le,text:ge,icon:Ne,index:Me,sourceLayerIndex:me,geometry:ne.geometry,properties:re.properties,type:VS[re.type],sortKey:it}),Ne&&(V[Ne.name]=!0),ge){const Ze=w.evaluate(ne,{},u).join(","),We=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.an.vertical)>=0;for(const ut of ge.sections)if(ut.image)V[ut.image.name]=!0;else{const ot=Xh(ge.toString()),pt=ut.fontStack||Ze,Xe=H[pt]=H[pt]||{};this.calculateGlyphDependencies(ut.text,Xe,We,this.allowVerticalPlacement,ot)}}}b.get("symbol-placement")==="line"&&(this.features=function(re){const le={},Me={},me=[];let G=0;function ne(Ze){me.push(re[Ze]),G++}function ge(Ze,We,ut){const ot=Me[Ze];return delete Me[Ze],Me[We]=ot,me[ot].geometry[0].pop(),me[ot].geometry[0]=me[ot].geometry[0].concat(ut[0]),ot}function Ne(Ze,We,ut){const ot=le[We];return delete le[We],le[Ze]=ot,me[ot].geometry[0].shift(),me[ot].geometry[0]=ut[0].concat(me[ot].geometry[0]),ot}function it(Ze,We,ut){const ot=ut?We[0][We[0].length-1]:We[0][0];return`${Ze}:${ot.x}:${ot.y}`}for(let Ze=0;Ze<re.length;Ze++){const We=re[Ze],ut=We.geometry,ot=We.text?We.text.toString():null;if(!ot){ne(Ze);continue}const pt=it(ot,ut),Xe=it(ot,ut,!0);if(pt in Me&&Xe in le&&Me[pt]!==le[Xe]){const zt=Ne(pt,Xe,ut),Gt=ge(pt,Xe,me[zt].geometry);delete le[pt],delete Me[Xe],Me[it(ot,me[Gt].geometry,!0)]=Gt,me[zt].geometry=null}else pt in Me?ge(pt,Xe,ut):Xe in le?Ne(pt,Xe,ut):(ne(Ze),le[pt]=G-1,Me[Xe]=G-1)}return me.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,le)=>re.sortKey-le.sortKey)}update(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const u=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(o[t.segment+1]),b=t.dist(o[t.segment]);const w={};for(let S=t.segment+1;S<o.length;S++)w[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:f},S<o.length-1&&(f+=o[S+1].dist(o[S]));for(let S=t.segment||0;S>=0;S--)w[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:b},S>0&&(b+=o[S-1].dist(o[S]));for(let S=0;S<o.length;S++){const M=w[S];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,o,u,f,b,w,S,M,A,D,B,V){const H=t.indexArray,W=t.layoutVertexArray,Y=t.segments.prepareSegment(4*o.length,W,H,this.canOverlap?w.sortKey:void 0),re=this.glyphOffsetArray.length,le=Y.vertexLength,Me=this.allowVerticalPlacement&&S===g.an.vertical?Math.PI/2:0,me=w.text&&w.text.sections;for(let G=0;G<o.length;G++){const{tl:ne,tr:ge,bl:Ne,br:it,tex:Ze,pixelOffsetTL:We,pixelOffsetBR:ut,minFontScaleX:ot,minFontScaleY:pt,glyphOffset:Xe,isSDF:zt,sectionIndex:Gt}=o[G],Zt=Y.vertexLength,Ot=Xe[1];Gp(W,M.x,M.y,ne.x,Ot+ne.y,Ze.x,Ze.y,u,zt,We.x,We.y,ot,pt),Gp(W,M.x,M.y,ge.x,Ot+ge.y,Ze.x+Ze.w,Ze.y,u,zt,ut.x,We.y,ot,pt),Gp(W,M.x,M.y,Ne.x,Ot+Ne.y,Ze.x,Ze.y+Ze.h,u,zt,We.x,ut.y,ot,pt),Gp(W,M.x,M.y,it.x,Ot+it.y,Ze.x+Ze.w,Ze.y+Ze.h,u,zt,ut.x,ut.y,ot,pt),pg(t.dynamicLayoutVertexArray,M,Me),H.emplaceBack(Zt,Zt+2,Zt+1),H.emplaceBack(Zt+1,Zt+2,Zt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),G!==o.length-1&&Gt===o[G+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,w,w.index,{},V,me&&me[Gt])}t.placedSymbolArray.emplaceBack(M.x,M.y,re,this.glyphOffsetArray.length-re,le,A,D,M.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],S,0,!1,0,B)}_addCollisionDebugVertex(t,o,u,f,b,w){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,f,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(t,o,u,f,b,w,S){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),A=M.vertexLength,D=b.layoutVertexArray,B=b.collisionVertexArray,V=S.anchorX,H=S.anchorY;this._addCollisionDebugVertex(D,B,w,V,H,new te(t,o)),this._addCollisionDebugVertex(D,B,w,V,H,new te(u,o)),this._addCollisionDebugVertex(D,B,w,V,H,new te(u,f)),this._addCollisionDebugVertex(D,B,w,V,H,new te(t,f)),M.vertexLength+=4;const W=b.indexArray;W.emplaceBack(A,A+1),W.emplaceBack(A+1,A+2),W.emplaceBack(A+2,A+3),W.emplaceBack(A+3,A),M.primitiveLength+=4}addDebugCollisionBoxes(t,o,u,f){for(let b=t;b<o;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,f?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mg(Ji,Yv.members,Qi),this.iconCollisionBox=new mg(Ji,Yv.members,Qi);for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(t,o,u,f,b,w,S,M,A){const D={};for(let B=o;B<u;B++){const V=t.get(B);D.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},D.textFeatureIndex=V.featureIndex;break}for(let B=f;B<b;B++){const V=t.get(B);D.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},D.verticalTextFeatureIndex=V.featureIndex;break}for(let B=w;B<S;B++){const V=t.get(B);D.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},D.iconFeatureIndex=V.featureIndex;break}for(let B=M;B<A;B++){const V=t.get(B);D.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},D.verticalIconFeatureIndex=V.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,o){const u=t.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let b=u.vertexStartIndex;b<f;b+=4)t.indexArray.emplaceBack(b,b+2,b+1),t.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),u=Math.cos(t),f=[],b=[],w=[];for(let S=0;S<this.symbolInstances.length;++S){w.push(S);const M=this.symbolInstances.get(S);f.push(0|Math.round(o*M.anchorX+u*M.anchorY)),b.push(M.featureIndex)}return w.sort((S,M)=>f[S]-f[M]||b[M]-b[S]),w}addToSortKeyRanges(t,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,b,w)=>{f>=0&&w.indexOf(f)===b&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let h0,d0;Mt("SymbolBucket",sh,{omit:["layers","collisionBoxArray","features","compareText"]}),sh.MAX_GLYPHS=65535,sh.addDynamicAttributes=pg;var gg={get paint(){return d0=d0||new Zr({"icon-opacity":new Xt(Se.paint_symbol["icon-opacity"]),"icon-color":new Xt(Se.paint_symbol["icon-color"]),"icon-halo-color":new Xt(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(Se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Xt(Se.paint_symbol["text-opacity"]),"text-color":new Xt(Se.paint_symbol["text-color"],{runtimeType:Br,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Xt(Se.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(Se.paint_symbol["text-halo-blur"]),"text-translate":new Rt(Se.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(Se.paint_symbol["text-translate-anchor"])})},get layout(){return h0=h0||new Zr({"symbol-placement":new Rt(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(Se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rt(Se.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Rt(Se.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Rt(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(Se.layout_symbol["icon-size"]),"icon-text-fit":new Rt(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rt(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(Se.layout_symbol["icon-image"]),"icon-rotate":new Xt(Se.layout_symbol["icon-rotate"]),"icon-padding":new Xt(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(Se.layout_symbol["icon-offset"]),"icon-anchor":new Xt(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(Se.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(Se.layout_symbol["text-field"]),"text-font":new Xt(Se.layout_symbol["text-font"]),"text-size":new Xt(Se.layout_symbol["text-size"]),"text-max-width":new Xt(Se.layout_symbol["text-max-width"]),"text-line-height":new Rt(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(Se.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(Se.layout_symbol["text-justify"]),"text-radial-offset":new Xt(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(Se.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Xt(Se.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Xt(Se.layout_symbol["text-anchor"]),"text-max-angle":new Rt(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(Se.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(Se.layout_symbol["text-rotate"]),"text-padding":new Rt(Se.layout_symbol["text-padding"]),"text-keep-upright":new Rt(Se.layout_symbol["text-keep-upright"]),"text-transform":new Xt(Se.layout_symbol["text-transform"]),"text-offset":new Xt(Se.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(Se.layout_symbol["text-allow-overlap"]),"text-overlap":new Rt(Se.layout_symbol["text-overlap"]),"text-ignore-placement":new Rt(Se.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(Se.layout_symbol["text-optional"])})}};class p0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ls,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt("FormatSectionOverride",p0,{omit:["defaultValue"]});class Hp extends br{constructor(t){super(t,gg)}recalculate(t,o){if(super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const b of u)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,o,u,f){const b=this.layout.get(t).evaluate(o,{},u,f),w=this._unevaluatedLayout._values[t];return w.isDataDriven()||y(w.value)||!b?b:function(S,M){return M.replace(/{([^{}]+)}/g,(A,D)=>S&&D in S?String(S[D]):"")}(o.properties,b)}createBucket(t){return new sh(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of gg.paint.overridableProperties){if(!Hp.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),u=new p0(o),f=new c(u,o.property.specification);let b=null;b=o.value.kind==="constant"||o.value.kind==="source"?new z("source",f):new U("composite",f,o.value.zoomStops),this.paint._values[t]=new ws(o.property,b,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&Hp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const u=t.get("text-field"),f=gg.paint.properties[o];let b=!1;const w=S=>{for(const M of S)if(f.overrides&&f.overrides.hasOverride(M))return void(b=!0)};if(u.value.kind==="constant"&&u.value.value instanceof cn)w(u.value.value.sections);else if(u.value.kind==="source"){const S=A=>{b||(A instanceof gr&&Kt(A.value)===So?w(A.value.sections):A instanceof rr?w(A.sections):A.eachChild(S))},M=u.value;M._styleExpression&&S(M._styleExpression.expression)}return b}}let f0;var GS={get paint(){return f0=f0||new Zr({"background-color":new Rt(Se.paint_background["background-color"]),"background-pattern":new td(Se.paint_background["background-pattern"]),"background-opacity":new Rt(Se.paint_background["background-opacity"])})}};class HS extends br{constructor(t){super(t,GS)}}let m0;var WS={get paint(){return m0=m0||new Zr({"raster-opacity":new Rt(Se.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rt(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(Se.paint_raster["raster-saturation"]),"raster-contrast":new Rt(Se.paint_raster["raster-contrast"]),"raster-resampling":new Rt(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(Se.paint_raster["raster-fade-duration"])})}};class KS extends br{constructor(t){super(t,WS)}}class XS extends br{constructor(t){super(t,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class YS{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const JS={once:!0},_g=63710088e-1;class lc{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new lc(Fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,u=this.lat*o,f=t.lat*o,b=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((t.lng-this.lng)*o);return _g*Math.acos(Math.min(b,1))}static convert(t){if(t instanceof lc)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new lc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new lc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const g0=2*Math.PI*_g;function _0(s){return g0*Math.cos(s*Math.PI/180)}function y0(s){return(180+s)/360}function v0(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function x0(s,t){return s/_0(t)}function yg(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function b0(s,t){return s*_0(yg(t))}class wd{constructor(t,o,u=0){this.x=+t,this.y=+o,this.z=+u}static fromLngLat(t,o=0){const u=lc.convert(t);return new wd(y0(u.lng),v0(u.lat),x0(o,u.lat))}toLngLat(){return new lc(360*this.x-180,yg(this.y))}toAltitude(){return b0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g0*(t=yg(this.y),1/Math.cos(t*Math.PI/180));var t}}function w0(s,t,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[s*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class vg{constructor(t,o,u){if(!function(f,b,w){return!(f<0||f>25||w<0||w>=Math.pow(2,f)||b<0||b>=Math.pow(2,f))}(t,o,u))throw new Error(`x=${o}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=o,this.y=u,this.key=ah(0,t,t,o,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o,u){const f=(w=this.y,S=this.z,M=w0(256*(b=this.x),256*(w=Math.pow(2,S)-w-1),S),A=w0(256*(b+1),256*(w+1),S),M[0]+","+M[1]+","+A[0]+","+A[1]);var b,w,S,M,A;const D=function(B,V,H){let W,Y="";for(let re=B;re>0;re--)W=1<<re-1,Y+=(V&W?1:0)+(H&W?2:0);return Y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const o=this.z-t.z;return o>0&&t.x===this.x>>o&&t.y===this.y>>o}getTilePoint(t){const o=Math.pow(2,this.z);return new te((t.x*o-this.x)*Jt,(t.y*o-this.y)*Jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class T0{constructor(t,o){this.wrap=t,this.canonical=o,this.key=ah(t,o.z,o.z,o.x,o.y)}}class Xo{constructor(t,o,u,f,b){if(this.terrainRttPosMatrix32f=null,t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=o,this.canonical=new vg(u,+f,+b),this.key=ah(o,t,u,f,b)}clone(){return new Xo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-t;return t>this.canonical.z?ah(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):ah(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Xo(o,this.wrap,o,u,f),new Xo(o,this.wrap,o,u+1,f),new Xo(o,this.wrap,o,u,f+1),new Xo(o,this.wrap,o,u+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new T0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new wd(t.x-this.wrap,t.y))}}function ah(s,t,o,u,f){(s*=2)<0&&(s=-1*s-1);const b=1<<o;return(b*b*s+b*f+u).toString(36)+o.toString(36)+t.toString(36)}Mt("CanonicalTileID",vg),Mt("OverscaledTileID",Xo,{omit:["terrainRttPosMatrix32f"]});class ru{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const o=new ru;return o.extend(t(new te(this.minX,this.minY))),o.extend(t(new te(this.maxX,this.minY))),o.extend(t(new te(this.minX,this.maxY))),o.extend(t(new te(this.maxX,this.maxY))),o}static fromPoints(t){const o=new ru;for(const u of t)o.extend(u);return o}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class S0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class P0{constructor(t,o,u,f,b){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=f,this.properties=t.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t}}class C0{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ic(Jt,16,0),this.grid3D=new ic(Jt,16,0),this.featureIndexArray=new $e,this.promoteId=o}insert(t,o,u,f,b,w){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,b);const M=w?this.grid3D:this.grid;for(let A=0;A<o.length;A++){const D=o[A],B=[1/0,1/0,-1/0,-1/0];for(let V=0;V<D.length;V++){const H=D[V];B[0]=Math.min(B[0],H.x),B[1]=Math.min(B[1],H.y),B[2]=Math.max(B[2],H.x),B[3]=Math.max(B[3],H.y)}B[0]<Jt&&B[1]<Jt&&B[2]>=0&&B[3]>=0&&M.insert(S,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new _d.VectorTile(new lg(this.rawTileData)).layers,this.sourceLayerCoder=new S0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,o,u,f){this.loadVTLayers();const b=t.params,w=Jt/t.tileSize/t.scale,S=Ht(b.filter),M=t.queryGeometry,A=t.queryPadding*w,D=ru.fromPoints(M),B=this.grid.query(D.minX-A,D.minY-A,D.maxX+A,D.maxY+A),V=ru.fromPoints(t.cameraQueryGeometry).expandBy(A),H=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,(re,le,Me,me)=>function(G,ne,ge,Ne,it){for(const We of G)if(ne<=We.x&&ge<=We.y&&Ne>=We.x&&it>=We.y)return!0;const Ze=[new te(ne,ge),new te(ne,it),new te(Ne,it),new te(Ne,ge)];if(G.length>2){for(const We of Ze)if(th(G,We))return!0}for(let We=0;We<G.length-1;We++)if(NT(G[We],G[We+1],Ze))return!0;return!1}(t.cameraQueryGeometry,re-A,le-A,Me+A,me+A));for(const re of H)B.push(re);B.sort(QS);const W={};let Y;for(let re=0;re<B.length;re++){const le=B[re];if(le===Y)continue;Y=le;const Me=this.featureIndexArray.get(le);let me=null;this.loadMatchingFeature(W,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,S,b.layers,b.availableImages,o,u,f,(G,ne,ge)=>(me||(me=eu(G)),ne.queryIntersectsFeature({queryGeometry:M,feature:G,featureState:ge,geometry:me,zoom:this.z,transform:t.transform,pixelsToTileUnits:w,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return W}loadMatchingFeature(t,o,u,f,b,w,S,M,A,D,B){const V=this.bucketLayerIDs[o];if(w&&!V.some(re=>w.has(re)))return;const H=this.sourceLayerCoder.decode(u),W=this.vtLayers[H].feature(f);if(b.needGeometry){const re=tu(W,!0);if(!b.filter(new fn(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!b.filter(new fn(this.tileID.overscaledZ),W))return;const Y=this.getId(W,H);for(let re=0;re<V.length;re++){const le=V[re];if(w&&!w.has(le))continue;const Me=M[le];if(!Me)continue;let me={};Y&&D&&(me=D.getState(Me.sourceLayer||"_geojsonTileLayer",Y));const G=er({},A[le]);G.paint=M0(G.paint,Me.paint,W,me,S),G.layout=M0(G.layout,Me.layout,W,me,S);const ne=!B||B(W,Me,me);if(!ne)continue;const ge=new P0(W,this.z,this.x,this.y,Y);ge.layer=G;let Ne=t[le];Ne===void 0&&(Ne=t[le]=[]),Ne.push({featureIndex:f,feature:ge,intersectionZ:ne})}}lookupSymbolFeatures(t,o,u,f,b,w,S,M){const A={};this.loadVTLayers();const D=Ht(b);for(const B of t)this.loadMatchingFeature(A,u,f,B,D,w,S,M,o);return A}hasLayer(t){for(const o of this.bucketLayerIDs)for(const u of o)if(t===u)return!0;return!1}getId(t,o){var u;let f=t.id;return this.promoteId&&(f=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((u=t.properties)===null||u===void 0)&&u.cluster)&&this.promoteId&&(f=Number(t.properties.cluster_id))),f}}function M0(s,t,o,u,f){return Pe(s,(b,w)=>{const S=t instanceof Yu?t.get(w):null;return S&&S.evaluate?S.evaluate(o,u,f):S})}function QS(s,t){return t-s}function E0(s,t,o,u,f){const b=[];for(let w=0;w<s.length;w++){const S=s[w];let M;for(let A=0;A<S.length-1;A++){let D=S[A],B=S[A+1];D.x<t&&B.x<t||(D.x<t?D=new te(t,D.y+(t-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x<t&&(B=new te(t,D.y+(t-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y<o&&B.y<o||(D.y<o?D=new te(D.x+(o-D.y)/(B.y-D.y)*(B.x-D.x),o)._round():B.y<o&&(B=new te(D.x+(o-D.y)/(B.y-D.y)*(B.x-D.x),o)._round()),D.x>=u&&B.x>=u||(D.x>=u?D=new te(u,D.y+(u-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x>=u&&(B=new te(u,D.y+(u-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y>=f&&B.y>=f||(D.y>=f?D=new te(D.x+(f-D.y)/(B.y-D.y)*(B.x-D.x),f)._round():B.y>=f&&(B=new te(D.x+(f-D.y)/(B.y-D.y)*(B.x-D.x),f)._round()),M&&D.equals(M[M.length-1])||(M=[D],b.push(M)),M.push(B)))))}}return b}Mt("FeatureIndex",C0,{omit:["rawTileData","sourceLayerCoder"]});class cc extends te{constructor(t,o,u,f){super(t,o),this.angle=u,f!==void 0&&(this.segment=f)}clone(){return new cc(this.x,this.y,this.angle,this.segment)}}function I0(s,t,o,u,f){if(t.segment===void 0||o===0)return!0;let b=t,w=t.segment+1,S=0;for(;S>-o/2;){if(w--,w<0)return!1;S-=s[w].dist(b),b=s[w]}S+=s[w].dist(s[w+1]),w++;const M=[];let A=0;for(;S<o/2;){const D=s[w],B=s[w+1];if(!B)return!1;let V=s[w-1].angleTo(D)-D.angleTo(B);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:S,angleDelta:V}),A+=V;S-M[0].distance>u;)A-=M.shift().angleDelta;if(A>f)return!1;w++,S+=D.dist(B)}return!0}function A0(s){let t=0;for(let o=0;o<s.length-1;o++)t+=s[o].dist(s[o+1]);return t}function L0(s,t,o){return s?.6*t*o:0}function k0(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function eP(s,t,o,u,f,b){const w=L0(o,f,b),S=k0(o,u)*b;let M=0;const A=A0(s)/2;for(let D=0;D<s.length-1;D++){const B=s[D],V=s[D+1],H=B.dist(V);if(M+H>A){const W=(A-M)/H,Y=$r.number(B.x,V.x,W),re=$r.number(B.y,V.y,W),le=new cc(Y,re,V.angleTo(B),D);return le._round(),!w||I0(s,le,S,w,t)?le:void 0}M+=H}}function tP(s,t,o,u,f,b,w,S,M){const A=L0(u,b,w),D=k0(u,f),B=D*w,V=s[0].x===0||s[0].x===M||s[0].y===0||s[0].y===M;return t-B<t/4&&(t=B+t/4),z0(s,V?t/2*S%t:(D/2+2*b)*w*S%t,t,A,o,B,V,!1,M)}function z0(s,t,o,u,f,b,w,S,M){const A=b/2,D=A0(s);let B=0,V=t-o,H=[];for(let W=0;W<s.length-1;W++){const Y=s[W],re=s[W+1],le=Y.dist(re),Me=re.angleTo(Y);for(;V+o<B+le;){V+=o;const me=(V-B)/le,G=$r.number(Y.x,re.x,me),ne=$r.number(Y.y,re.y,me);if(G>=0&&G<M&&ne>=0&&ne<M&&V-A>=0&&V+A<=D){const ge=new cc(G,ne,Me,W);ge._round(),u&&!I0(s,ge,b,u,f)||H.push(ge)}}B+=le}return S||H.length||w||(H=z0(s,B/2,o,u,f,b,w,!0,M)),H}function R0(s,t,o,u){const f=[],b=s.image,w=b.pixelRatio,S=b.paddedRect.w-2,M=b.paddedRect.h-2;let A={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const D=b.stretchX||[[0,S]],B=b.stretchY||[[0,M]],V=(Xe,zt)=>Xe+zt[1]-zt[0],H=D.reduce(V,0),W=B.reduce(V,0),Y=S-H,re=M-W;let le=0,Me=H,me=0,G=W,ne=0,ge=Y,Ne=0,it=re;if(b.content&&u){const Xe=b.content,zt=Xe[2]-Xe[0],Gt=Xe[3]-Xe[1];(b.textFitWidth||b.textFitHeight)&&(A=l0(s)),le=Wp(D,0,Xe[0]),me=Wp(B,0,Xe[1]),Me=Wp(D,Xe[0],Xe[2]),G=Wp(B,Xe[1],Xe[3]),ne=Xe[0]-le,Ne=Xe[1]-me,ge=zt-Me,it=Gt-G}const Ze=A.x1,We=A.y1,ut=A.x2-Ze,ot=A.y2-We,pt=(Xe,zt,Gt,Zt)=>{const Ot=Kp(Xe.stretch-le,Me,ut,Ze),Li=Xp(Xe.fixed-ne,ge,Xe.stretch,H),Mn=Kp(zt.stretch-me,G,ot,We),Kn=Xp(zt.fixed-Ne,it,zt.stretch,W),Dr=Kp(Gt.stretch-le,Me,ut,Ze),Yo=Xp(Gt.fixed-ne,ge,Gt.stretch,H),mo=Kp(Zt.stretch-me,G,ot,We),Pr=Xp(Zt.fixed-Ne,it,Zt.stretch,W),xn=new te(Ot,Mn),lr=new te(Dr,Mn),Cr=new te(Dr,mo),Mr=new te(Ot,mo),oo=new te(Li/w,Kn/w),Jo=new te(Yo/w,Pr/w),cr=t*Math.PI/180;if(cr){const ur=Math.sin(cr),hr=Math.cos(cr),Vn=[hr,-ur,ur,hr];xn._matMult(Vn),lr._matMult(Vn),Mr._matMult(Vn),Cr._matMult(Vn)}const go=Xe.stretch+Xe.fixed,Xn=zt.stretch+zt.fixed;return{tl:xn,tr:lr,bl:Mr,br:Cr,tex:{x:b.paddedRect.x+1+go,y:b.paddedRect.y+1+Xn,w:Gt.stretch+Gt.fixed-go,h:Zt.stretch+Zt.fixed-Xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:oo,pixelOffsetBR:Jo,minFontScaleX:ge/w/ut,minFontScaleY:it/w/ot,isSDF:o}};if(u&&(b.stretchX||b.stretchY)){const Xe=D0(D,Y,H),zt=D0(B,re,W);for(let Gt=0;Gt<Xe.length-1;Gt++){const Zt=Xe[Gt],Ot=Xe[Gt+1];for(let Li=0;Li<zt.length-1;Li++)f.push(pt(Zt,zt[Li],Ot,zt[Li+1]))}}else f.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:M+1}));return f}function Wp(s,t,o){let u=0;for(const f of s)u+=Math.max(t,Math.min(o,f[1]))-Math.max(t,Math.min(o,f[0]));return u}function D0(s,t,o){const u=[{fixed:-1,stretch:0}];for(const[f,b]of s){const w=u[u.length-1];u.push({fixed:f-w.stretch,stretch:w.stretch}),u.push({fixed:f-w.stretch,stretch:w.stretch+(b-f)})}return u.push({fixed:t+1,stretch:o}),u}function Kp(s,t,o,u){return s/t*o+u}function Xp(s,t,o,u){return s-t*o/u}Mt("Anchor",cc);class Yp{constructor(t,o,u,f,b,w,S,M,A,D){var B;if(this.boxStartIndex=t.length,A){let V=w.top,H=w.bottom;const W=w.collisionPadding;W&&(V-=W[1],H+=W[3]);let Y=H-V;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const V=!((B=w.image)===null||B===void 0)&&B.content&&(w.image.textFitWidth||w.image.textFitHeight)?l0(w):{x1:w.left,y1:w.top,x2:w.right,y2:w.bottom};V.y1=V.y1*S-M[0],V.y2=V.y2*S+M[2],V.x1=V.x1*S-M[3],V.x2=V.x2*S+M[1];const H=w.collisionPadding;if(H&&(V.x1-=H[0]*S,V.y1-=H[1]*S,V.x2+=H[2]*S,V.y2+=H[3]*S),D){const W=new te(V.x1,V.y1),Y=new te(V.x2,V.y1),re=new te(V.x1,V.y2),le=new te(V.x2,V.y2),Me=D*Math.PI/180;W._rotate(Me),Y._rotate(Me),re._rotate(Me),le._rotate(Me),V.x1=Math.min(W.x,Y.x,re.x,le.x),V.x2=Math.max(W.x,Y.x,re.x,le.x),V.y1=Math.min(W.y,Y.y,re.y,le.y),V.y2=Math.max(W.y,Y.y,re.y,le.y)}t.emplaceBack(o.x,o.y,V.x1,V.y1,V.x2,V.y2,u,f,b)}this.boxEndIndex=t.length}}class iP{constructor(t=[],o=(u,f)=>u<f?-1:u>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:u}=this,f=o[t];for(;t>0;){const b=t-1>>1,w=o[b];if(u(f,w)>=0)break;o[t]=w,t=b}o[t]=f}_down(t){const{data:o,compare:u}=this,f=this.length>>1,b=o[t];for(;t<f;){let w=1+(t<<1);const S=w+1;if(S<this.length&&u(o[S],o[w])<0&&(w=S),u(o[w],b)>=0)break;o[t]=o[w],t=w}o[t]=b}}function nP(s,t=1,o=!1){const u=ru.fromPoints(s[0]),f=Math.min(u.width(),u.height());let b=f/2;const w=new iP([],rP),{minX:S,minY:M,maxX:A,maxY:D}=u;if(f===0)return new te(S,M);for(let H=S;H<A;H+=f)for(let W=M;W<D;W+=f)w.push(new lh(H+b,W+b,b,s));let B=function(H){let W=0,Y=0,re=0;const le=H[0];for(let Me=0,me=le.length,G=me-1;Me<me;G=Me++){const ne=le[Me],ge=le[G],Ne=ne.x*ge.y-ge.x*ne.y;Y+=(ne.x+ge.x)*Ne,re+=(ne.y+ge.y)*Ne,W+=3*Ne}return new lh(Y/W,re/W,0,H)}(s),V=w.length;for(;w.length;){const H=w.pop();(H.d>B.d||!B.d)&&(B=H,o&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,V)),H.max-B.d<=t||(b=H.h/2,w.push(new lh(H.p.x-b,H.p.y-b,b,s)),w.push(new lh(H.p.x+b,H.p.y-b,b,s)),w.push(new lh(H.p.x-b,H.p.y+b,b,s)),w.push(new lh(H.p.x+b,H.p.y+b,b,s)),V+=4)}return o&&(console.log(`num probes: ${V}`),console.log(`best distance: ${B.d}`)),B.p}function rP(s,t){return t.max-s.max}function lh(s,t,o,u){this.p=new te(s,t),this.h=o,this.d=function(f,b){let w=!1,S=1/0;for(let M=0;M<b.length;M++){const A=b[M];for(let D=0,B=A.length,V=B-1;D<B;V=D++){const H=A[D],W=A[V];H.y>f.y!=W.y>f.y&&f.x<(W.x-H.x)*(f.y-H.y)/(W.y-H.y)+H.x&&(w=!w),S=Math.min(S,fv(f,H,W))}}return(w?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}var Rr;g.aD=void 0,(Rr=g.aD||(g.aD={}))[Rr.center=1]="center",Rr[Rr.left=2]="left",Rr[Rr.right=3]="right",Rr[Rr.top=4]="top",Rr[Rr.bottom=5]="bottom",Rr[Rr["top-left"]=6]="top-left",Rr[Rr["top-right"]=7]="top-right",Rr[Rr["bottom-left"]=8]="bottom-left",Rr[Rr["bottom-right"]=9]="bottom-right";const xg=Number.POSITIVE_INFINITY;function O0(s,t){return t[1]!==xg?function(o,u,f){let b=0,w=0;switch(u=Math.abs(u),f=Math.abs(f),o){case"top-right":case"top-left":case"top":w=f-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-f}switch(o){case"top-right":case"bottom-right":case"right":b=-u;break;case"top-left":case"bottom-left":case"left":b=u}return[b,w]}(s,t[0],t[1]):function(o,u){let f=0,b=0;u<0&&(u=0);const w=u/Math.SQRT2;switch(o){case"top-right":case"top-left":b=w-7;break;case"bottom-right":case"bottom-left":b=7-w;break;case"bottom":b=7-u;break;case"top":b=u-7}switch(o){case"top-right":case"bottom-right":f=-w;break;case"top-left":case"bottom-left":f=w;break;case"left":f=u;break;case"right":f=-u}return[f,b]}(s,t[0])}function F0(s,t,o){var u;const f=s.layout,b=(u=f.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},o);if(b){const S=b.values,M=[];for(let A=0;A<S.length;A+=2){const D=M[A]=S[A],B=S[A+1].map(V=>V*ar);D.startsWith("top")?B[1]-=7:D.startsWith("bottom")&&(B[1]+=7),M[A+1]=B}return new di(M)}const w=f.get("text-variable-anchor");if(w){let S;S=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},o)*ar,xg]:f.get("text-offset").evaluate(t,{},o).map(A=>A*ar);const M=[];for(const A of w)M.push(A,O0(A,S));return new di(M)}return null}function bg(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function oP(s,t,o,u,f,b,w,S,M,A,D,B){let V=b.textMaxSize.evaluate(t,{});V===void 0&&(V=w);const H=s.layers[0].layout,W=H.get("icon-offset").evaluate(t,{},D),Y=N0(o.horizontal),re=w/24,le=s.tilePixelRatio*re,Me=s.tilePixelRatio*V/24,me=s.tilePixelRatio*S,G=s.tilePixelRatio*H.get("symbol-spacing"),ne=H.get("text-padding")*s.tilePixelRatio,ge=function(Gt,Zt,Ot,Li=1){const Mn=Gt.get("icon-padding").evaluate(Zt,{},Ot),Kn=Mn&&Mn.values;return[Kn[0]*Li,Kn[1]*Li,Kn[2]*Li,Kn[3]*Li]}(H,t,D,s.tilePixelRatio),Ne=H.get("text-max-angle")/180*Math.PI,it=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",Ze=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",We=H.get("symbol-placement"),ut=G/2,ot=H.get("icon-text-fit");let pt;u&&ot!=="none"&&(s.allowVerticalPlacement&&o.vertical&&(pt=c0(u,o.vertical,ot,H.get("icon-text-fit-padding"),W,re)),Y&&(u=c0(u,Y,ot,H.get("icon-text-fit-padding"),W,re)));const Xe=D?B.line.getGranularityForZoomLevel(D.z):1,zt=(Gt,Zt)=>{Zt.x<0||Zt.x>=Jt||Zt.y<0||Zt.y>=Jt||function(Ot,Li,Mn,Kn,Dr,Yo,mo,Pr,xn,lr,Cr,Mr,oo,Jo,cr,go,Xn,ur,hr,Vn,hn,Ws,ch,Ks,lP){const uh=Ot.addToLineVertexArray(Li,Mn);let ou,hh,dh,ph,V0=0,Z0=0,q0=0,G0=0,Ig=-1,Ag=-1;const wl={};let H0=ro("");if(Ot.allowVerticalPlacement&&Kn.vertical){const Gr=Pr.layout.get("text-rotate").evaluate(hn,{},Ks)+90;dh=new Yp(xn,Li,lr,Cr,Mr,Kn.vertical,oo,Jo,cr,Gr),mo&&(ph=new Yp(xn,Li,lr,Cr,Mr,mo,Xn,ur,cr,Gr))}if(Dr){const Gr=Pr.layout.get("icon-rotate").evaluate(hn,{}),Qo=Pr.layout.get("icon-text-fit")!=="none",su=R0(Dr,Gr,ch,Qo),Ys=mo?R0(mo,Gr,ch,Qo):void 0;hh=new Yp(xn,Li,lr,Cr,Mr,Dr,Xn,ur,!1,Gr),V0=4*su.length;const au=Ot.iconSizeData;let Da=null;au.kind==="source"?(Da=[bl*Pr.layout.get("icon-size").evaluate(hn,{})],Da[0]>ac&&nt(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):au.kind==="composite"&&(Da=[bl*Ws.compositeIconSizes[0].evaluate(hn,{},Ks),bl*Ws.compositeIconSizes[1].evaluate(hn,{},Ks)],(Da[0]>ac||Da[1]>ac)&&nt(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,su,Da,Vn,hr,hn,g.an.none,Li,uh.lineStartIndex,uh.lineLength,-1,Ks),Ig=Ot.icon.placedSymbolArray.length-1,Ys&&(Z0=4*Ys.length,Ot.addSymbols(Ot.icon,Ys,Da,Vn,hr,hn,g.an.vertical,Li,uh.lineStartIndex,uh.lineLength,-1,Ks),Ag=Ot.icon.placedSymbolArray.length-1)}const W0=Object.keys(Kn.horizontal);for(const Gr of W0){const Qo=Kn.horizontal[Gr];if(!ou){H0=ro(Qo.text);const Ys=Pr.layout.get("text-rotate").evaluate(hn,{},Ks);ou=new Yp(xn,Li,lr,Cr,Mr,Qo,oo,Jo,cr,Ys)}const su=Qo.positionedLines.length===1;if(q0+=B0(Ot,Li,Qo,Yo,Pr,cr,hn,go,uh,Kn.vertical?g.an.horizontal:g.an.horizontalOnly,su?W0:[Gr],wl,Ig,Ws,Ks),su)break}Kn.vertical&&(G0+=B0(Ot,Li,Kn.vertical,Yo,Pr,cr,hn,go,uh,g.an.vertical,["vertical"],wl,Ag,Ws,Ks));const cP=ou?ou.boxStartIndex:Ot.collisionBoxArray.length,uP=ou?ou.boxEndIndex:Ot.collisionBoxArray.length,hP=dh?dh.boxStartIndex:Ot.collisionBoxArray.length,dP=dh?dh.boxEndIndex:Ot.collisionBoxArray.length,pP=hh?hh.boxStartIndex:Ot.collisionBoxArray.length,fP=hh?hh.boxEndIndex:Ot.collisionBoxArray.length,mP=ph?ph.boxStartIndex:Ot.collisionBoxArray.length,gP=ph?ph.boxEndIndex:Ot.collisionBoxArray.length;let Xs=-1;const Qp=(Gr,Qo)=>Gr&&Gr.circleDiameter?Math.max(Gr.circleDiameter,Qo):Qo;Xs=Qp(ou,Xs),Xs=Qp(dh,Xs),Xs=Qp(hh,Xs),Xs=Qp(ph,Xs);const K0=Xs>-1?1:0;K0&&(Xs*=lP/ar),Ot.glyphOffsetArray.length>=sh.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hn.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,hn.sortKey);const _P=F0(Pr,hn,Ks),[yP,vP]=function(Gr,Qo){const su=Gr.length,Ys=Qo?.values;if(Ys?.length>0)for(let au=0;au<Ys.length;au+=2){const Da=Ys[au+1];Gr.emplaceBack(g.aD[Ys[au]],Da[0],Da[1])}return[su,Gr.length]}(Ot.textAnchorOffsets,_P);Ot.symbolInstances.emplaceBack(Li.x,Li.y,wl.right>=0?wl.right:-1,wl.center>=0?wl.center:-1,wl.left>=0?wl.left:-1,wl.vertical||-1,Ig,Ag,H0,cP,uP,hP,dP,pP,fP,mP,gP,lr,q0,G0,V0,Z0,K0,0,oo,Xs,yP,vP)}(s,Zt,Gt,o,u,f,pt,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,le,[ne,ne,ne,ne],it,M,me,ge,Ze,W,t,b,A,D,w)};if(We==="line")for(const Gt of E0(t.geometry,0,0,Jt,Jt)){const Zt=nu(Gt,Xe),Ot=tP(Zt,G,Ne,o.vertical||Y,u,24,Me,s.overscaling,Jt);for(const Li of Ot)Y&&sP(s,Y.text,ut,Li)||zt(Zt,Li)}else if(We==="line-center"){for(const Gt of t.geometry)if(Gt.length>1){const Zt=nu(Gt,Xe),Ot=eP(Zt,Ne,o.vertical||Y,u,24,Me);Ot&&zt(Zt,Ot)}}else if(t.type==="Polygon")for(const Gt of io(t.geometry,0)){const Zt=nP(Gt,16);zt(nu(Gt[0],Xe,!0),new cc(Zt.x,Zt.y,0))}else if(t.type==="LineString")for(const Gt of t.geometry){const Zt=nu(Gt,Xe);zt(Zt,new cc(Zt[0].x,Zt[0].y,0))}else if(t.type==="Point")for(const Gt of t.geometry)for(const Zt of Gt)zt([Zt],new cc(Zt.x,Zt.y,0))}function B0(s,t,o,u,f,b,w,S,M,A,D,B,V,H,W){const Y=function(Me,me,G,ne,ge,Ne,it,Ze){const We=ne.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,ut=[];for(const ot of me.positionedLines)for(const pt of ot.positionedGlyphs){if(!pt.rect)continue;const Xe=pt.rect||{};let zt=4,Gt=!0,Zt=1,Ot=0;const Li=(ge||Ze)&&pt.vertical,Mn=pt.metrics.advance*pt.scale/2;if(Ze&&me.verticalizable&&(Ot=ot.lineOffset/2-(pt.imageName?-(ar-pt.metrics.width*pt.scale)/2:(pt.scale-1)*ar)),pt.imageName){const ur=it[pt.imageName];Gt=ur.sdf,Zt=ur.pixelRatio,zt=1/Zt}const Kn=ge?[pt.x+Mn,pt.y]:[0,0];let Dr=ge?[0,0]:[pt.x+Mn+G[0],pt.y+G[1]-Ot],Yo=[0,0];Li&&(Yo=Dr,Dr=[0,0]);const mo=pt.metrics.isDoubleResolution?2:1,Pr=(pt.metrics.left-zt)*pt.scale-Mn+Dr[0],xn=(-pt.metrics.top-zt)*pt.scale+Dr[1],lr=Pr+Xe.w/mo*pt.scale/Zt,Cr=xn+Xe.h/mo*pt.scale/Zt,Mr=new te(Pr,xn),oo=new te(lr,xn),Jo=new te(Pr,Cr),cr=new te(lr,Cr);if(Li){const ur=new te(-Mn,Mn- -17),hr=-Math.PI/2,Vn=12-Mn,hn=new te(22-Vn,-(pt.imageName?Vn:0)),Ws=new te(...Yo);Mr._rotateAround(hr,ur)._add(hn)._add(Ws),oo._rotateAround(hr,ur)._add(hn)._add(Ws),Jo._rotateAround(hr,ur)._add(hn)._add(Ws),cr._rotateAround(hr,ur)._add(hn)._add(Ws)}if(We){const ur=Math.sin(We),hr=Math.cos(We),Vn=[hr,-ur,ur,hr];Mr._matMult(Vn),oo._matMult(Vn),Jo._matMult(Vn),cr._matMult(Vn)}const go=new te(0,0),Xn=new te(0,0);ut.push({tl:Mr,tr:oo,bl:Jo,br:cr,tex:Xe,writingMode:me.writingMode,glyphOffset:Kn,sectionIndex:pt.sectionIndex,isSDF:Gt,pixelOffsetTL:go,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}return ut}(0,o,S,f,b,w,u,s.allowVerticalPlacement),re=s.textSizeData;let le=null;re.kind==="source"?(le=[bl*f.layout.get("text-size").evaluate(w,{})],le[0]>ac&&nt(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):re.kind==="composite"&&(le=[bl*H.compositeTextSizes[0].evaluate(w,{},W),bl*H.compositeTextSizes[1].evaluate(w,{},W)],(le[0]>ac||le[1]>ac)&&nt(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,Y,le,S,b,w,A,t,M.lineStartIndex,M.lineLength,V,W);for(const Me of D)B[Me]=s.text.placedSymbolArray.length-1;return 4*Y.length}function N0(s){for(const t in s)return s[t];return null}function sP(s,t,o,u){const f=s.compareText;if(t in f){const b=f[t];for(let w=b.length-1;w>=0;w--)if(u.dist(b[w])<o)return!0}else f[t]=[];return f[t].push(u),!1}const j0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(t,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const b=j0[15&u];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(t,2,1),[S]=new Uint32Array(t,4,1);return new wg(S,w,b,t)}constructor(t,o=64,u=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const b=j0.indexOf(this.ArrayType),w=2*t*this.ArrayType.BYTES_PER_ELEMENT,S=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-S%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+w+S+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=t)}add(t,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=o,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Tg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:S}=this,M=[0,b.length-1,0],A=[];for(;M.length;){const D=M.pop()||0,B=M.pop()||0,V=M.pop()||0;if(B-V<=S){for(let re=V;re<=B;re++){const le=w[2*re],Me=w[2*re+1];le>=t&&le<=u&&Me>=o&&Me<=f&&A.push(b[re])}continue}const H=V+B>>1,W=w[2*H],Y=w[2*H+1];W>=t&&W<=u&&Y>=o&&Y<=f&&A.push(b[H]),(D===0?t<=W:o<=Y)&&(M.push(V),M.push(H-1),M.push(1-D)),(D===0?u>=W:f>=Y)&&(M.push(H+1),M.push(B),M.push(1-D))}return A}within(t,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:w}=this,S=[0,f.length-1,0],M=[],A=u*u;for(;S.length;){const D=S.pop()||0,B=S.pop()||0,V=S.pop()||0;if(B-V<=w){for(let re=V;re<=B;re++)$0(b[2*re],b[2*re+1],t,o)<=A&&M.push(f[re]);continue}const H=V+B>>1,W=b[2*H],Y=b[2*H+1];$0(W,Y,t,o)<=A&&M.push(f[H]),(D===0?t-u<=W:o-u<=Y)&&(S.push(V),S.push(H-1),S.push(1-D)),(D===0?t+u>=W:o+u>=Y)&&(S.push(H+1),S.push(B),S.push(1-D))}return M}}function Tg(s,t,o,u,f,b){if(f-u<=o)return;const w=u+f>>1;U0(s,t,w,u,f,b),Tg(s,t,o,u,w-1,1-b),Tg(s,t,o,w+1,f,1-b)}function U0(s,t,o,u,f,b){for(;f>u;){if(f-u>600){const A=f-u+1,D=o-u+1,B=Math.log(A),V=.5*Math.exp(2*B/3),H=.5*Math.sqrt(B*V*(A-V)/A)*(D-A/2<0?-1:1);U0(s,t,o,Math.max(u,Math.floor(o-D*V/A+H)),Math.min(f,Math.floor(o+(A-D)*V/A+H)),b)}const w=t[2*o+b];let S=u,M=f;for(Td(s,t,u,o),t[2*f+b]>w&&Td(s,t,u,f);S<M;){for(Td(s,t,S,M),S++,M--;t[2*S+b]<w;)S++;for(;t[2*M+b]>w;)M--}t[2*u+b]===w?Td(s,t,u,M):(M++,Td(s,t,M,f)),M<=o&&(u=M+1),o<=M&&(f=M-1)}}function Td(s,t,o,u){Sg(s,o,u),Sg(t,2*o,2*u),Sg(t,2*o+1,2*u+1)}function Sg(s,t,o){const u=s[t];s[t]=s[o],s[o]=u}function $0(s,t,o,u){const f=s-o,b=t-u;return f*f+b*b}var Pg;g.cw=void 0,(Pg=g.cw||(g.cw={})).create="create",Pg.load="load",Pg.fullLoad="fullLoad";let Jp=null,Sd=[];const Cg=1e3/60,Mg="loadTime",Eg="fullLoadTime",aP={mark(s){performance.mark(s)},frame(s){const t=s;Jp!=null&&Sd.push(t-Jp),Jp=t},clearMetrics(){Jp=null,Sd=[],performance.clearMeasures(Mg),performance.clearMeasures(Eg);for(const s in g.cw)performance.clearMarks(g.cw[s])},getPerformanceMetrics(){performance.measure(Mg,g.cw.create,g.cw.load),performance.measure(Eg,g.cw.create,g.cw.fullLoad);const s=performance.getEntriesByName(Mg)[0].duration,t=performance.getEntriesByName(Eg)[0].duration,o=Sd.length,u=1/(Sd.reduce((b,w)=>b+w,0)/o/1e3),f=Sd.filter(b=>b>Cg).reduce((b,w)=>b+(w-Cg)/Cg,0);return{loadTime:s,fullLoadTime:t,fps:u,percentDroppedFrames:f/(o+f)*100,totalFrames:o}}};g.$=Jt,g.A=ke,g.B=function([s,t,o]){return t+=90,t*=Math.PI/180,o*=Math.PI/180,{x:s*Math.cos(t)*Math.sin(o),y:s*Math.sin(t)*Math.sin(o),z:s*Math.cos(o)}},g.C=$r,g.D=Rt,g.E=Je,g.F=fn,g.G=Hu,g.H=function(s){if(wt==null){const t=s.navigator?s.navigator.userAgent:null;wt=!!s.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return wt},g.I=cg,g.J=class{constructor(s,t){this.target=s,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new YS(()=>this.process()),this.subscription=si(this.target,"message",o=>this.receive(o),!1),this.globalScope=_t(self)?s:window}registerMessageHandler(s,t){this.messageHandlers[s]=t}sendAsync(s,t){return new Promise((o,u)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=t?si(t.signal,"abort",()=>{b?.unsubscribe(),delete this.resolveRejects[f];const M={id:f,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},JS):null;this.resolveRejects[f]={resolve:M=>{b?.unsubscribe(),o(M)},reject:M=>{b?.unsubscribe(),u(M)}};const w=[],S=Object.assign(Object.assign({},s),{id:f,sourceMapId:this.mapId,origin:location.origin,data:qc(s.data,w)});this.target.postMessage(S,{transfer:w})})}receive(s){const t=s.data,o=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[o];const u=this.abortControllers[o];return delete this.abortControllers[o],void(u&&u.abort())}if(_t(self)||t.mustQueue)return this.tasks[o]=t,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,t)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),t=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(s,t)}processTask(s,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[s];return delete this.resolveRejects[s],f?void(t.error?f.reject(nc(t.error)):f.resolve(nc(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=nc(t.data),u=new AbortController;this.abortControllers[s]=u;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,o,u);this.completeTask(s,null,f)}catch(f){this.completeTask(s,f)}})}completeTask(s,t,o){const u=[];delete this.abortControllers[s];const f={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?qc(t):null,data:qc(o,u)};this.target.postMessage(f,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.K=ie,g.L=function(){var s=new ke(16);return ke!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},g.M=function(s,t,o){var u,f,b,w,S,M,A,D,B,V,H,W,Y=o[0],re=o[1],le=o[2];return t===s?(s[12]=t[0]*Y+t[4]*re+t[8]*le+t[12],s[13]=t[1]*Y+t[5]*re+t[9]*le+t[13],s[14]=t[2]*Y+t[6]*re+t[10]*le+t[14],s[15]=t[3]*Y+t[7]*re+t[11]*le+t[15]):(f=t[1],b=t[2],w=t[3],S=t[4],M=t[5],A=t[6],D=t[7],B=t[8],V=t[9],H=t[10],W=t[11],s[0]=u=t[0],s[1]=f,s[2]=b,s[3]=w,s[4]=S,s[5]=M,s[6]=A,s[7]=D,s[8]=B,s[9]=V,s[10]=H,s[11]=W,s[12]=u*Y+S*re+B*le+t[12],s[13]=f*Y+M*re+V*le+t[13],s[14]=b*Y+A*re+H*le+t[14],s[15]=w*Y+D*re+W*le+t[15]),s},g.N=function(s,t,o){var u=o[0],f=o[1],b=o[2];return s[0]=t[0]*u,s[1]=t[1]*u,s[2]=t[2]*u,s[3]=t[3]*u,s[4]=t[4]*f,s[5]=t[5]*f,s[6]=t[6]*f,s[7]=t[7]*f,s[8]=t[8]*b,s[9]=t[9]*b,s[10]=t[10]*b,s[11]=t[11]*b,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},g.O=function(s,t,o){var u=t[0],f=t[1],b=t[2],w=t[3],S=t[4],M=t[5],A=t[6],D=t[7],B=t[8],V=t[9],H=t[10],W=t[11],Y=t[12],re=t[13],le=t[14],Me=t[15],me=o[0],G=o[1],ne=o[2],ge=o[3];return s[0]=me*u+G*S+ne*B+ge*Y,s[1]=me*f+G*M+ne*V+ge*re,s[2]=me*b+G*A+ne*H+ge*le,s[3]=me*w+G*D+ne*W+ge*Me,s[4]=(me=o[4])*u+(G=o[5])*S+(ne=o[6])*B+(ge=o[7])*Y,s[5]=me*f+G*M+ne*V+ge*re,s[6]=me*b+G*A+ne*H+ge*le,s[7]=me*w+G*D+ne*W+ge*Me,s[8]=(me=o[8])*u+(G=o[9])*S+(ne=o[10])*B+(ge=o[11])*Y,s[9]=me*f+G*M+ne*V+ge*re,s[10]=me*b+G*A+ne*H+ge*le,s[11]=me*w+G*D+ne*W+ge*Me,s[12]=(me=o[12])*u+(G=o[13])*S+(ne=o[14])*B+(ge=o[15])*Y,s[13]=me*f+G*M+ne*V+ge*re,s[14]=me*b+G*A+ne*H+ge*le,s[15]=me*w+G*D+ne*W+ge*Me,s},g.P=te,g.Q=function(s,t){const o={};for(let u=0;u<t.length;u++){const f=t[u];f in s&&(o[f]=s[f])}return o},g.R=fo,g.S=lc,g.T=Wm,g.U=v0,g.V=y0,g.W=Fe,g.X=xe,g.Y=Pt,g.Z=Xo,g._=l,g.a=J,g.a$=function(s,t,o){return s[0]=t[0]*o,s[1]=t[1]*o,s[2]=t[2]*o,s[3]=t[3]*o,s},g.a0=wd,g.a1=ru,g.a2=25,g.a3=vg,g.a4=s=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(o=>{t.onloadstart=()=>{o(t)};for(const u of s){const f=window.document.createElement("source");je(u)||(t.crossOrigin="Anonymous"),f.src=u,t.appendChild(f)}})},g.a5=ft,g.a6=function(){return ye++},g.a7=se,g.a8=sh,g.a9=Ht,g.aA=ar,g.aB=Xi,g.aC=function(s,t,o,u,f=!1){if(!o[0]&&!o[1])return[0,0];const b=f?u==="map"?-s.bearingInRadians:0:u==="viewport"?s.bearingInRadians:0;if(b){const w=Math.sin(b),S=Math.cos(b);o=[o[0]*S-o[1]*w,o[0]*w+o[1]*S]}return[f?o[0]:Xi(t,o[0],s.zoom),f?o[1]:Xi(t,o[1],s.zoom)]},g.aE=dg,g.aF=bg,g.aG=hg,g.aH=wg,g.aI=Cn,g.aJ=Up,g.aK=De,g.aL=Di,g.aM=nn,g.aN=Fr,g.aO=vi,g.aP=b0,g.aQ=Et,g.aR=lt,g.aS=function(s){var t=new ke(3);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t},g.aT=function(s,t,o){return s[0]=t[0]-o[0],s[1]=t[1]-o[1],s[2]=t[2]-o[2],s},g.aU=function(s,t){var o=t[0],u=t[1],f=t[2],b=o*o+u*u+f*f;return b>0&&(b=1/Math.sqrt(b)),s[0]=t[0]*b,s[1]=t[1]*b,s[2]=t[2]*b,s},g.aV=jt,g.aW=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]},g.aX=function(s,t,o){return s[0]=t[0]*o[0],s[1]=t[1]*o[1],s[2]=t[2]*o[2],s[3]=t[3]*o[3],s},g.aY=ht,g.aZ=function(s,t,o){const u=t[0]*o[0]+t[1]*o[1]+t[2]*o[2];return u===0?null:(-(s[0]*o[0]+s[1]*o[1]+s[2]*o[2])-o[3])/u},g.a_=ni,g.aa=tu,g.ab=P0,g.ac=function(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,b)=>{const w=f||b;return t[u]=!w||w.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t},g.ad=yi,g.ae=function(s){return Math.pow(2,s)},g.af=tt,g.ag=dn,g.ah=85.051129,g.ai=x0,g.aj=function(s){return Math.log(s)/Math.LN2},g.ak=function(s){var t=s[0],o=s[1];return t*t+o*o},g.al=function(s,t){const o=[];for(const u in s)u in t||o.push(u);return o},g.am=function(s,t){let o=0,u=0;if(s.kind==="constant")u=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:f,minZoom:b,maxZoom:w}=s,S=f?dn(nr.interpolationFactor(f,t,b,w),0,1):0;s.kind==="camera"?u=$r.number(s.minSize,s.maxSize,S):o=S}return{uSizeT:o,uSize:u}},g.ao=function(s,{uSize:t,uSizeT:o},{lowerSize:u,upperSize:f}){return s.kind==="source"?u/bl:s.kind==="composite"?$r.number(u/bl,f/bl,o):t},g.ap=function(s,t){var o=t[0],u=t[1],f=t[2],b=t[3],w=t[4],S=t[5],M=t[6],A=t[7],D=t[8],B=t[9],V=t[10],H=t[11],W=t[12],Y=t[13],re=t[14],le=t[15],Me=o*S-u*w,me=o*M-f*w,G=o*A-b*w,ne=u*M-f*S,ge=u*A-b*S,Ne=f*A-b*M,it=D*Y-B*W,Ze=D*re-V*W,We=D*le-H*W,ut=B*re-V*Y,ot=B*le-H*Y,pt=V*le-H*re,Xe=Me*pt-me*ot+G*ut+ne*We-ge*Ze+Ne*it;return Xe?(s[0]=(S*pt-M*ot+A*ut)*(Xe=1/Xe),s[1]=(f*ot-u*pt-b*ut)*Xe,s[2]=(Y*Ne-re*ge+le*ne)*Xe,s[3]=(V*ge-B*Ne-H*ne)*Xe,s[4]=(M*We-w*pt-A*Ze)*Xe,s[5]=(o*pt-f*We+b*Ze)*Xe,s[6]=(re*G-W*Ne-le*me)*Xe,s[7]=(D*Ne-V*G+H*me)*Xe,s[8]=(w*ot-S*We+A*it)*Xe,s[9]=(u*We-o*ot-b*it)*Xe,s[10]=(W*ge-Y*G+le*Me)*Xe,s[11]=(B*G-D*ge-H*Me)*Xe,s[12]=(S*Ze-w*ut-M*it)*Xe,s[13]=(o*ut-u*Ze+f*it)*Xe,s[14]=(Y*me-W*ne-re*Me)*Xe,s[15]=(D*ne-B*me+V*Me)*Xe,s):null},g.aq=Yt,g.ar=function(s){return Math.hypot(s[0],s[1])},g.as=function(s){return s[0]=0,s[1]=0,s},g.at=function(s,t,o){return s[0]=t[0]*o,s[1]=t[1]*o,s},g.au=pg,g.av=ri,g.aw=function(s,t,o,u){const f=t.y-s.y,b=t.x-s.x,w=u.y-o.y,S=u.x-o.x,M=w*b-S*f;if(M===0)return null;const A=(S*(s.y-o.y)-w*(s.x-o.x))/M;return new te(s.x+A*b,s.y+A*f)},g.ax=E0,g.ay=dv,g.az=function(s){let t=1/0,o=1/0,u=-1/0,f=-1/0;for(const b of s)t=Math.min(t,b.x),o=Math.min(o,b.y),u=Math.max(u,b.x),f=Math.max(f,b.y);return[t,o,u,f]},g.b=dt,g.b$=ES,g.b0=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]},g.b1=T0,g.b2=ah,g.b3=function(s,t,o,u,f){var b,w=1/Math.tan(t/2);return s[0]=w/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,f!=null&&f!==1/0?(s[10]=(f+u)*(b=1/(u-f)),s[14]=2*f*u*b):(s[10]=-1,s[14]=-2*u),s},g.b4=function(s){var t=new ke(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},g.b5=function(s,t,o){var u=Math.sin(o),f=Math.cos(o),b=t[0],w=t[1],S=t[2],M=t[3],A=t[4],D=t[5],B=t[6],V=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=b*f+A*u,s[1]=w*f+D*u,s[2]=S*f+B*u,s[3]=M*f+V*u,s[4]=A*f-b*u,s[5]=D*f-w*u,s[6]=B*f-S*u,s[7]=V*f-M*u,s},g.b6=function(s,t,o){var u=Math.sin(o),f=Math.cos(o),b=t[4],w=t[5],S=t[6],M=t[7],A=t[8],D=t[9],B=t[10],V=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=b*f+A*u,s[5]=w*f+D*u,s[6]=S*f+B*u,s[7]=M*f+V*u,s[8]=A*f-b*u,s[9]=D*f-w*u,s[10]=B*f-S*u,s[11]=V*f-M*u,s},g.b7=function(){const s=new Float32Array(16);return tt(s),s},g.b8=function(){const s=new Float64Array(16);return tt(s),s},g.b9=function(){return new Float64Array(16)},g.bA=function(s){return s[0]=0,s[1]=0,s[2]=0,s},g.bB=function(s,t,o,u){const f=Math.sqrt(s*s+t*t),b=Math.sqrt(o*o+u*u);s/=f,t/=f,o/=b,u/=b;const w=Math.acos(s*o+t*u);return-t*o+s*u>0?w:-w},g.bC=function(s,t){const o=ji(s,2*Math.PI),u=ji(t,2*Math.PI);return Math.min(Math.abs(o-u),Math.abs(o-u+2*Math.PI),Math.abs(o-u-2*Math.PI))},g.bD=function(){const s={},t=Se.$version;for(const o in Se.$root){const u=Se.$root[o];if(u.required){let f=null;f=o==="version"?t:u.type==="array"?[]:{},f!=null&&(s[o]=f)}}return s},g.bE=Kh,g.bF=Te,g.bG=function s(t,o){if(Array.isArray(t)){if(!Array.isArray(o)||t.length!==o.length)return!1;for(let u=0;u<t.length;u++)if(!s(t[u],o[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&o!==null){if(typeof o!="object"||Object.keys(t).length!==Object.keys(o).length)return!1;for(const u in t)if(!s(t[u],o[u]))return!1;return!0}return t===o},g.bH=function(s){s=s.slice();const t=Object.create(null);for(let o=0;o<s.length;o++)t[s[o].id]=s[o];for(let o=0;o<s.length;o++)"ref"in s[o]&&(s[o]=Wt(s[o],t[s[o].ref]));return s},g.bI=function(s){if(s.type==="custom")return new XS(s);switch(s.type){case"background":return new HS(s);case"circle":return new UT(s);case"color-relief":return new HT(s);case"fill":return new lS(s);case"fill-extrusion":return new gS(s);case"heatmap":return new VT(s);case"hillshade":return new qT(s);case"line":return new SS(s);case"raster":return new KS(s);case"symbol":return new Hp(s)}},g.bJ=ct,g.bK=function(s,t){if(!s)return[{command:"setStyle",args:[t]}];let o=[];try{if(!Ct(s.version,t.version))return[{command:"setStyle",args:[t]}];Ct(s.center,t.center)||o.push({command:"setCenter",args:[t.center]}),Ct(s.state,t.state)||o.push({command:"setGlobalState",args:[t.state]}),Ct(s.centerAltitude,t.centerAltitude)||o.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Ct(s.zoom,t.zoom)||o.push({command:"setZoom",args:[t.zoom]}),Ct(s.bearing,t.bearing)||o.push({command:"setBearing",args:[t.bearing]}),Ct(s.pitch,t.pitch)||o.push({command:"setPitch",args:[t.pitch]}),Ct(s.roll,t.roll)||o.push({command:"setRoll",args:[t.roll]}),Ct(s.sprite,t.sprite)||o.push({command:"setSprite",args:[t.sprite]}),Ct(s.glyphs,t.glyphs)||o.push({command:"setGlyphs",args:[t.glyphs]}),Ct(s.transition,t.transition)||o.push({command:"setTransition",args:[t.transition]}),Ct(s.light,t.light)||o.push({command:"setLight",args:[t.light]}),Ct(s.terrain,t.terrain)||o.push({command:"setTerrain",args:[t.terrain]}),Ct(s.sky,t.sky)||o.push({command:"setSky",args:[t.sky]}),Ct(s.projection,t.projection)||o.push({command:"setProjection",args:[t.projection]});const u={},f=[];(function(w,S,M,A){let D;for(D in S=S||{},w=w||{})Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(S,D)||Yi(D,M,A));for(D in S)Object.prototype.hasOwnProperty.call(S,D)&&(Object.prototype.hasOwnProperty.call(w,D)?Ct(w[D],S[D])||(w[D].type==="geojson"&&S[D].type==="geojson"&&Oi(w,S,D)?Bt(M,{command:"setGeoJSONSourceData",args:[D,S[D].data]}):Ui(D,S,M,A)):ei(D,S,M))})(s.sources,t.sources,f,u);const b=[];s.layers&&s.layers.forEach(w=>{"source"in w&&u[w.source]?o.push({command:"removeLayer",args:[w.id]}):b.push(w)}),o=o.concat(f),function(w,S,M){S=S||[];const A=(w=w||[]).map(yt),D=S.map(yt),B=w.reduce(Fn,{}),V=S.reduce(Fn,{}),H=A.slice(),W=Object.create(null);let Y,re,le,Me,me;for(let G=0,ne=0;G<A.length;G++)Y=A[G],Object.prototype.hasOwnProperty.call(V,Y)?ne++:(Bt(M,{command:"removeLayer",args:[Y]}),H.splice(H.indexOf(Y,ne),1));for(let G=0,ne=0;G<D.length;G++)Y=D[D.length-1-G],H[H.length-1-G]!==Y&&(Object.prototype.hasOwnProperty.call(B,Y)?(Bt(M,{command:"removeLayer",args:[Y]}),H.splice(H.lastIndexOf(Y,H.length-ne),1)):ne++,Me=H[H.length-G],Bt(M,{command:"addLayer",args:[V[Y],Me]}),H.splice(H.length-G,0,Y),W[Y]=!0);for(let G=0;G<D.length;G++)if(Y=D[G],re=B[Y],le=V[Y],!W[Y]&&!Ct(re,le))if(Ct(re.source,le.source)&&Ct(re["source-layer"],le["source-layer"])&&Ct(re.type,le.type)){for(me in Nt(re.layout,le.layout,M,Y,null,"setLayoutProperty"),Nt(re.paint,le.paint,M,Y,null,"setPaintProperty"),Ct(re.filter,le.filter)||Bt(M,{command:"setFilter",args:[Y,le.filter]}),Ct(re.minzoom,le.minzoom)&&Ct(re.maxzoom,le.maxzoom)||Bt(M,{command:"setLayerZoomRange",args:[Y,le.minzoom,le.maxzoom]}),re)Object.prototype.hasOwnProperty.call(re,me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&(me.indexOf("paint.")===0?Nt(re[me],le[me],M,Y,me.slice(6),"setPaintProperty"):Ct(re[me],le[me])||Bt(M,{command:"setLayerProperty",args:[Y,me,le[me]]}));for(me in le)Object.prototype.hasOwnProperty.call(le,me)&&!Object.prototype.hasOwnProperty.call(re,me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&(me.indexOf("paint.")===0?Nt(re[me],le[me],M,Y,me.slice(6),"setPaintProperty"):Ct(re[me],le[me])||Bt(M,{command:"setLayerProperty",args:[Y,me,le[me]]}))}else Bt(M,{command:"removeLayer",args:[Y]}),Me=H[H.lastIndexOf(Y)+1],Bt(M,{command:"addLayer",args:[le,Me]})}(b,t.layers,o)}catch(u){console.warn("Unable to compute style diff:",u),o=[{command:"setStyle",args:[t]}]}return o},g.bL=function(s){const t=[],o=s.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},g.bM=Pe,g.bN=Ke,g.bO=class extends un{constructor(s,t){super(s,t),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},g.bP=Op,g.bQ=class extends un{constructor(s,t){super(s,t),this.current=Um}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let t=1;t<16;t++)if(s[t]!==this.current[t]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},g.bR=Wn,g.bS=class extends un{constructor(s,t){super(s,t),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},g.bT=class extends un{constructor(s,t){super(s,t),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},g.bU=Qe,g.bV=function(s,t){var o=Math.sin(t),u=Math.cos(t);return s[0]=u,s[1]=o,s[2]=0,s[3]=-o,s[4]=u,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},g.bW=function(s,t,o){var u=t[0],f=t[1],b=t[2];return s[0]=u*o[0]+f*o[3]+b*o[6],s[1]=u*o[1]+f*o[4]+b*o[7],s[2]=u*o[2]+f*o[5]+b*o[8],s},g.bX=function(s,t,o,u,f,b,w){var S=1/(t-o),M=1/(u-f),A=1/(b-w);return s[0]=-2*S,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(t+o)*S,s[13]=(f+u)*M,s[14]=(w+b)*A,s[15]=1,s},g.bY=class extends un{constructor(s,t){super(s,t),this.current=new Array}set(s){if(s!=this.current){this.current=s;const t=new Float32Array(4*s.length);for(let o=0;o<s.length;o++)t[4*o]=s[o].r,t[4*o+1]=s[o].g,t[4*o+2]=s[o].b,t[4*o+3]=s[o].a;this.gl.uniform4fv(this.location,t)}}},g.bZ=class extends un{constructor(s,t){super(s,t),this.current=new Array}set(s){if(s!=this.current){this.current=s;const t=new Float32Array(s);this.gl.uniform1fv(this.location,t)}}},g.b_=class extends h{},g.ba=function(s,t,o){const u=new Float64Array(4);return pr(u,s,t-90,o),u},g.bb=function(s,t,o,u){var f,b,w,S,M,A=t[0],D=t[1],B=t[2],V=t[3],H=o[0],W=o[1],Y=o[2],re=o[3];return(b=A*H+D*W+B*Y+V*re)<0&&(b=-b,H=-H,W=-W,Y=-Y,re=-re),1-b>be?(f=Math.acos(b),w=Math.sin(f),S=Math.sin((1-u)*f)/w,M=Math.sin(u*f)/w):(S=1-u,M=u),s[0]=S*A+M*H,s[1]=S*D+M*W,s[2]=S*B+M*Y,s[3]=S*V+M*re,s},g.bc=function(s){const t=new Float64Array(9);var o,u,f,b,w,S,M,A,D,B,V,H,W,Y,re,le,Me,me;B=(f=(u=s)[0])*(M=f+f),V=(b=u[1])*M,W=(w=u[2])*M,Y=w*(A=b+b),le=(S=u[3])*M,Me=S*A,me=S*(D=w+w),(o=t)[0]=1-(H=b*A)-(re=w*D),o[3]=V-me,o[6]=W+Me,o[1]=V+me,o[4]=1-B-re,o[7]=Y-le,o[2]=W-Me,o[5]=Y+le,o[8]=1-B-H;const G=vi(-Math.asin(dn(t[2],-1,1)));let ne,ge;return Math.hypot(t[5],t[8])<.001?(ne=0,ge=-vi(Math.atan2(t[3],t[4]))):(ne=vi(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ge=vi(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ne,pitch:G+90,bearing:ge}},g.bd=function(s,t){return s.roll==t.roll&&s.pitch==t.pitch&&s.bearing==t.bearing},g.be=bi,g.bf=qr,g.bg=rh,g.bh=md,g.bi=nh,g.bj=Ai,g.bk=oi,g.bl=ti,g.bm=function(s,t,o,u,f){return Ai(u,f,dn((s-t)/(o-t),0,1))},g.bn=ji,g.bo=function(){return new Float64Array(3)},g.bp=function(s,t,o,u){return s[0]=t[0]+o[0]*u,s[1]=t[1]+o[1]*u,s[2]=t[2]+o[2]*u,s},g.bq=pr,g.br=function(s,t,o){var u=o[0],f=o[1],b=o[2],w=t[0],S=t[1],M=t[2],A=f*M-b*S,D=b*w-u*M,B=u*S-f*w,V=f*B-b*D,H=b*A-u*B,W=u*D-f*A,Y=2*o[3];return D*=Y,B*=Y,H*=2,W*=2,s[0]=w+(A*=Y)+(V*=2),s[1]=S+D+H,s[2]=M+B+W,s},g.bs=function(s,t,o){const u=(f=[s[0],s[1],s[2],t[0],t[1],t[2],o[0],o[1],o[2]])[0]*((D=f[8])*(w=f[4])-(S=f[5])*(A=f[7]))+f[1]*(-D*(b=f[3])+S*(M=f[6]))+f[2]*(A*b-w*M);var f,b,w,S,M,A,D;if(u===0)return null;const B=jt([],[t[0],t[1],t[2]],[o[0],o[1],o[2]]),V=jt([],[o[0],o[1],o[2]],[s[0],s[1],s[2]]),H=jt([],[s[0],s[1],s[2]],[t[0],t[1],t[2]]),W=Et([],B,-s[3]);return lt(W,W,Et([],V,-t[3])),lt(W,W,Et([],H,-o[3])),Et(W,W,1/u),W},g.bt=_g,g.bu=function(){return new Float64Array(4)},g.bv=function(s,t,o,u){var f=[],b=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],b[0]=f[0]*Math.cos(u)-f[1]*Math.sin(u),b[1]=f[0]*Math.sin(u)+f[1]*Math.cos(u),b[2]=f[2],s[0]=b[0]+o[0],s[1]=b[1]+o[1],s[2]=b[2]+o[2],s},g.bw=function(s,t,o,u){var f=[],b=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],b[0]=f[0],b[1]=f[1]*Math.cos(u)-f[2]*Math.sin(u),b[2]=f[1]*Math.sin(u)+f[2]*Math.cos(u),s[0]=b[0]+o[0],s[1]=b[1]+o[1],s[2]=b[2]+o[2],s},g.bx=function(s,t,o,u){var f=[],b=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],b[0]=f[2]*Math.sin(u)+f[0]*Math.cos(u),b[1]=f[1],b[2]=f[2]*Math.cos(u)-f[0]*Math.sin(u),s[0]=b[0]+o[0],s[1]=b[1]+o[1],s[2]=b[2]+o[2],s},g.by=function(s,t,o){var u=Math.sin(o),f=Math.cos(o),b=t[0],w=t[1],S=t[2],M=t[3],A=t[8],D=t[9],B=t[10],V=t[11];return t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=b*f-A*u,s[1]=w*f-D*u,s[2]=S*f-B*u,s[3]=M*f-V*u,s[8]=b*u+A*f,s[9]=w*u+D*f,s[10]=S*u+B*f,s[11]=M*u+V*f,s},g.bz=function(s,t){const o=ji(s,360),u=ji(t,360),f=u-o,b=u>o?f-360:f+360;return Math.abs(f)<Math.abs(b)?f:b},g.c=Ee,g.c0=class extends x{},g.c1=Hm,g.c2=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},g.c3=wv,g.c4=function(s,t,o){var u=t[0],f=t[1],b=t[2],w=o[3]*u+o[7]*f+o[11]*b+o[15];return s[0]=(o[0]*u+o[4]*f+o[8]*b+o[12])/(w=w||1),s[1]=(o[1]*u+o[5]*f+o[9]*b+o[13])/w,s[2]=(o[2]*u+o[6]*f+o[10]*b+o[14])/w,s},g.c5=class extends id{},g.c6=class extends N{},g.c7=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]&&s[4]===t[4]&&s[5]===t[5]&&s[6]===t[6]&&s[7]===t[7]&&s[8]===t[8]&&s[9]===t[9]&&s[10]===t[10]&&s[11]===t[11]&&s[12]===t[12]&&s[13]===t[13]&&s[14]===t[14]&&s[15]===t[15]},g.c8=function(s,t){var o=s[0],u=s[1],f=s[2],b=s[3],w=s[4],S=s[5],M=s[6],A=s[7],D=s[8],B=s[9],V=s[10],H=s[11],W=s[12],Y=s[13],re=s[14],le=s[15],Me=t[0],me=t[1],G=t[2],ne=t[3],ge=t[4],Ne=t[5],it=t[6],Ze=t[7],We=t[8],ut=t[9],ot=t[10],pt=t[11],Xe=t[12],zt=t[13],Gt=t[14],Zt=t[15];return Math.abs(o-Me)<=be*Math.max(1,Math.abs(o),Math.abs(Me))&&Math.abs(u-me)<=be*Math.max(1,Math.abs(u),Math.abs(me))&&Math.abs(f-G)<=be*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(b-ne)<=be*Math.max(1,Math.abs(b),Math.abs(ne))&&Math.abs(w-ge)<=be*Math.max(1,Math.abs(w),Math.abs(ge))&&Math.abs(S-Ne)<=be*Math.max(1,Math.abs(S),Math.abs(Ne))&&Math.abs(M-it)<=be*Math.max(1,Math.abs(M),Math.abs(it))&&Math.abs(A-Ze)<=be*Math.max(1,Math.abs(A),Math.abs(Ze))&&Math.abs(D-We)<=be*Math.max(1,Math.abs(D),Math.abs(We))&&Math.abs(B-ut)<=be*Math.max(1,Math.abs(B),Math.abs(ut))&&Math.abs(V-ot)<=be*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(H-pt)<=be*Math.max(1,Math.abs(H),Math.abs(pt))&&Math.abs(W-Xe)<=be*Math.max(1,Math.abs(W),Math.abs(Xe))&&Math.abs(Y-zt)<=be*Math.max(1,Math.abs(Y),Math.abs(zt))&&Math.abs(re-Gt)<=be*Math.max(1,Math.abs(re),Math.abs(Gt))&&Math.abs(le-Zt)<=be*Math.max(1,Math.abs(le),Math.abs(Zt))},g.c9=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},g.cA=function(s){delete J.REGISTERED_PROTOCOLS[s]},g.cB=function(s,t){const o={};for(let f=0;f<s.length;f++){const b=t&&t[s[f].id]||Xl(s[f]);t&&(t[s[f].id]=b);let w=o[b];w||(w=o[b]=[]),w.push(s[f])}const u=[];for(const f in o)u.push(o[f]);return u},g.cC=Mt,g.cD=S0,g.cE=C0,g.cF=i0,g.cG=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Jt/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const t=s.bucket.layers[0],o=t.layout,u=t._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new fn(s.bucket.zoom+1),s.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new fn(s.bucket.zoom+1),s.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new fn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:D}=s.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new fn(A),s.canonical),u["text-size"].possiblyEvaluate(new fn(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:D}=s.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new fn(A),s.canonical),u["icon-size"].possiblyEvaluate(new fn(D),s.canonical)]}const b=o.get("text-line-height")*ar,w=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",S=o.get("text-keep-upright"),M=o.get("text-size");for(const A of s.bucket.features){const D=o.get("text-font").evaluate(A,{},s.canonical).join(","),B=M.evaluate(A,{},s.canonical),V=f.layoutTextSize.evaluate(A,{},s.canonical),H=f.layoutIconSize.evaluate(A,{},s.canonical),W={horizontal:{},vertical:void 0},Y=A.text;let re,le=[0,0];if(Y){const G=Y.toString(),ne=o.get("text-letter-spacing").evaluate(A,{},s.canonical)*ar,ge=Ip(G)?ne:0,Ne=o.get("text-anchor").evaluate(A,{},s.canonical),it=F0(t,A,s.canonical);if(!it){const ot=o.get("text-radial-offset").evaluate(A,{},s.canonical);le=ot?O0(Ne,[ot*ar,xg]):o.get("text-offset").evaluate(A,{},s.canonical).map(pt=>pt*ar)}let Ze=w?"center":o.get("text-justify").evaluate(A,{},s.canonical);const We=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(A,{},s.canonical)*ar:1/0,ut=()=>{s.bucket.allowVerticalPlacement&&Xh(G)&&(W.vertical=Zp(Y,s.glyphMap,s.glyphPositions,s.imagePositions,D,We,b,Ne,"left",ge,le,g.an.vertical,!0,V,B))};if(!w&&it){const ot=new Set;if(Ze==="auto")for(let Xe=0;Xe<it.values.length;Xe+=2)ot.add(bg(it.values[Xe]));else ot.add(Ze);let pt=!1;for(const Xe of ot)if(!W.horizontal[Xe])if(pt)W.horizontal[Xe]=W.horizontal[0];else{const zt=Zp(Y,s.glyphMap,s.glyphPositions,s.imagePositions,D,We,b,"center",Xe,ge,le,g.an.horizontal,!1,V,B);zt&&(W.horizontal[Xe]=zt,pt=zt.positionedLines.length===1)}ut()}else{Ze==="auto"&&(Ze=bg(Ne));const ot=Zp(Y,s.glyphMap,s.glyphPositions,s.imagePositions,D,We,b,Ne,Ze,ge,le,g.an.horizontal,!1,V,B);ot&&(W.horizontal[Ze]=ot),ut(),Xh(G)&&w&&S&&(W.vertical=Zp(Y,s.glyphMap,s.glyphPositions,s.imagePositions,D,We,b,Ne,Ze,ge,le,g.an.vertical,!1,V,B))}}let Me=!1;if(A.icon&&A.icon.name){const G=s.imageMap[A.icon.name];G&&(re=$S(s.imagePositions[A.icon.name],o.get("icon-offset").evaluate(A,{},s.canonical),o.get("icon-anchor").evaluate(A,{},s.canonical)),Me=!!G.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Me:s.bucket.sdfIcons!==Me&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(G.pixelRatio!==s.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const me=N0(W.horizontal)||W.vertical;s.bucket.iconsInText=!!me&&me.iconsInText,(me||re)&&oP(s.bucket,A,W,re,s.imageMap,f,V,H,le,Me,s.canonical,s.subdivisionGranularity)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},g.cH=og,g.cI=Qm,g.cJ=rg,g.cK=_d,g.cL=lg,g.cM=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},g.cN=function(s,t,o,u,f){return l(this,void 0,void 0,function*(){if(xe())try{return yield Pt(s,t,o,u,f)}catch{}return function(b,w,S,M,A){const D=b.width,B=b.height;Ft&&Qt||(Ft=new OffscreenCanvas(D,B),Qt=Ft.getContext("2d",{willReadFrequently:!0})),Ft.width=D,Ft.height=B,Qt.drawImage(b,0,0,D,B);const V=Qt.getImageData(w,S,M,A);return Qt.clearRect(0,0,D,B),V.data}(s,t,o,u,f)})},g.cO=Pv,g.cP=E,g.cQ=$,g.cR=$v,g.cS=e0,g.cT=P,g.cU=Ma,g.ca=s=>s.type==="symbol",g.cb=s=>s.type==="circle",g.cc=s=>s.type==="heatmap",g.cd=s=>s.type==="line",g.ce=s=>s.type==="fill",g.cf=s=>s.type==="fill-extrusion",g.cg=s=>s.type==="hillshade",g.ch=s=>s.type==="color-relief",g.ci=s=>s.type==="raster",g.cj=s=>s.type==="background",g.ck=s=>s.type==="custom",g.cl=On,g.cm=function(s,t,o){const u=pi(t.x-o.x,t.y-o.y),f=pi(s.x-o.x,s.y-o.y);var b,w;return vi(Math.atan2(u[0]*f[1]-u[1]*f[0],(b=u)[0]*(w=f)[0]+b[1]*w[1]))},g.cn=fr,g.co=function(s,t){return An[t]&&(s instanceof MouseEvent||s instanceof WheelEvent)},g.cp=function(s,t){return In[t]&&"touches"in s},g.cq=function(s){return In[s]||An[s]},g.cr=function(s,t,o){var u=t[0],f=t[1];return s[0]=o[0]*u+o[4]*f+o[12],s[1]=o[1]*u+o[5]*f+o[13],s},g.cs=function(s,t){const{x:o,y:u}=wd.fromLngLat(t);return!(s<0||s>25||u<0||u>=1||o<0||o>=1)},g.ct=function(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},g.cu=class extends Ia{},g.cv=aP,g.cx=function(s){return s.message===wn},g.cy=he,g.cz=function(s,t){J.REGISTERED_PROTOCOLS[s]=t},g.d=je,g.e=er,g.f=s=>l(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(t)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),g.g=Q,g.h=s=>new Promise((t,o)=>{const u=new Image;u.onload=()=>{t(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=$t})},u.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(s)],{type:"image/png"});u.src=s.byteLength?URL.createObjectURL(f):$t}),g.i=_t,g.j=(s,t)=>Le(er(s,{type:"json"}),t),g.k=Re,g.l=qe,g.m=Le,g.n=(s,t)=>Le(er(s,{type:"arrayBuffer"}),t),g.o=function(s){return new lg(s).readFields(LS,[])},g.p=t0,g.q=ud,g.r=Zr,g.s=si,g.t=ed,g.u=Ci,g.v=Se,g.w=nt,g.x=Dm,g.y=Vc,g.z=tc}),m("worker",["./shared"],function(g){class l{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,Q){for(const he of J){this._layerConfigs[he.id]=he;const Te=this._layers[he.id]=g.bI(he);Te._featureFilter=g.a9(Te.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Q)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ie=g.cB(Object.values(this._layerConfigs),this.keyCache);for(const he of ie){const Te=he.map(Re=>this._layers[Re.id]),Le=Te[0];if(Le.visibility==="none")continue;const je=Le.source||"";let Ie=this.familiesBySource[je];Ie||(Ie=this.familiesBySource[je]={});const He=Le.sourceLayer||"_geojsonTileLayer";let qe=Ie[He];qe||(qe=Ie[He]=[]),qe.push(Te)}}}class E{constructor(J){const Q={},ie=[];for(const je in J){const Ie=J[je],He=Q[je]={};for(const qe in Ie){const Re=Ie[+qe];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Je={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};ie.push(Je),He[qe]={rect:Je,metrics:Re.metrics}}}const{w:he,h:Te}=g.p(ie),Le=new g.q({width:he||1,height:Te||1});for(const je in J){const Ie=J[je];for(const He in Ie){const qe=Ie[+He];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Re=Q[je][He].rect;g.q.copy(qe.bitmap,Le,{x:0,y:0},{x:Re.x+1,y:Re.y+1},qe.bitmap)}}this.image=Le,this.positions=Q}}g.cC("GlyphAtlas",E);class k{constructor(J){this.tileID=new g.Z(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[],this.globalState=J.globalState}parse(J,Q,ie,he,Te){return g._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new g.a7;const Le=new g.cD(Object.keys(J.layers).sort()),je=new g.cE(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Ie={},He={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie,subdivisionGranularity:Te},qe=Q.familiesBySource[this.source];for(const Nt in qe){const yt=J.layers[Nt];if(!yt)continue;yt.version===1&&g.w(`Vector tile source "${this.source}" layer "${Nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=Le.encode(Nt),ft=[];for(let Un=0;Un<yt.length;Un++){const ln=yt.feature(Un),wo=je.getId(ln,Nt);ft.push({feature:ln,id:wo,index:Un,sourceLayerIndex:Fn})}for(const Un of qe[Nt]){const ln=Un[0];ln.source!==this.source&&g.w(`layer.source = ${ln.source} does not equal this.source = ${this.source}`),ln.minzoom&&this.zoom<Math.floor(ln.minzoom)||ln.maxzoom&&this.zoom>=ln.maxzoom||ln.visibility!=="none"&&(O(Un,this.zoom,ie),(Ie[ln.id]=ln.createBucket({index:je.bucketLayerIDs.length,layers:Un,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source,globalState:this.globalState})).populate(ft,He,this.tileID.canonical),je.bucketLayerIDs.push(Un.map(wo=>wo.id)))}}const Re=g.bM(He.glyphDependencies,Nt=>Object.keys(Nt).map(Number));this.inFlightDependencies.forEach(Nt=>Nt?.abort()),this.inFlightDependencies=[];let Je=Promise.resolve({});if(Object.keys(Re).length){const Nt=new AbortController;this.inFlightDependencies.push(Nt),Je=he.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},Nt)}const Se=Object.keys(He.iconDependencies);let Tt=Promise.resolve({});if(Se.length){const Nt=new AbortController;this.inFlightDependencies.push(Nt),Tt=he.sendAsync({type:"GI",data:{icons:Se,source:this.source,tileID:this.tileID,type:"icons"}},Nt)}const Wt=Object.keys(He.patternDependencies);let Ct=Promise.resolve({});if(Wt.length){const Nt=new AbortController;this.inFlightDependencies.push(Nt),Ct=he.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"patterns"}},Nt)}const[Bt,ei,Yi]=yield Promise.all([Je,Tt,Ct]),Ui=new E(Bt),Oi=new g.cF(ei,Yi);for(const Nt in Ie){const yt=Ie[Nt];yt instanceof g.a8?(O(yt.layers,this.zoom,ie),g.cG({bucket:yt,glyphMap:Bt,glyphPositions:Ui.positions,imageMap:ei,imagePositions:Oi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:He.subdivisionGranularity})):yt.hasPattern&&(yt instanceof g.cH||yt instanceof g.cI||yt instanceof g.cJ)&&(O(yt.layers,this.zoom,ie),yt.addFeatures(He,this.tileID.canonical,Oi.patternPositions))}return this.status="done",{buckets:Object.values(Ie).filter(Nt=>!Nt.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ui.image,imageAtlas:Oi,glyphMap:this.returnDependencies?Bt:null,iconMap:this.returnDependencies?ei:null,glyphPositions:this.returnDependencies?Ui.positions:null}})}}function O(Ee,J,Q){const ie=new g.F(J);for(const he of Ee)he.recalculate(ie,Q)}class ${constructor(J,Q,ie){this.actor=J,this.layerIndex=Q,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,Q){return g._(this,void 0,void 0,function*(){const ie=yield g.n(J.request,Q);try{return{vectorTile:new g.cK.VectorTile(new g.cL(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(he){const Te=new Uint8Array(ie.data);let Le=`Unable to parse the tile at ${J.request.url}, `;throw Le+=Te[0]===31&&Te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.message}`,new Error(Le)}})}loadTile(J){return g._(this,void 0,void 0,function*(){const Q=J.uid,ie=!!(J&&J.request&&J.request.collectResourceTiming)&&new g.cM(J.request),he=new k(J);this.loading[Q]=he;const Te=new AbortController;he.abort=Te;try{const Le=yield this.loadVectorTile(J,Te);if(delete this.loading[Q],!Le)return null;const je=Le.rawData,Ie={};Le.expires&&(Ie.expires=Le.expires),Le.cacheControl&&(Ie.cacheControl=Le.cacheControl);const He={};if(ie){const Re=ie.finish();Re&&(He.resourceTiming=JSON.parse(JSON.stringify(Re)))}he.vectorTile=Le.vectorTile;const qe=he.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);this.loaded[Q]=he,this.fetching[Q]={rawTileData:je,cacheControl:Ie,resourceTiming:He};try{const Re=yield qe;return g.e({rawTileData:je.slice(0)},Re,Ie,He)}finally{delete this.fetching[Q]}}catch(Le){throw delete this.loading[Q],he.status="done",this.loaded[Q]=he,Le}})}reloadTile(J){return g._(this,void 0,void 0,function*(){const Q=J.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[Q];if(ie.showCollisionBoxes=J.showCollisionBoxes,ie.globalState=J.globalState,ie.status==="parsing"){const he=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);let Te;if(this.fetching[Q]){const{rawTileData:Le,cacheControl:je,resourceTiming:Ie}=this.fetching[Q];delete this.fetching[Q],Te=g.e({rawTileData:Le.slice(0)},he,je,Ie)}else Te=he;return Te}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity)})}abortTile(J){return g._(this,void 0,void 0,function*(){const Q=this.loading,ie=J.uid;Q&&Q[ie]&&Q[ie].abort&&(Q[ie].abort.abort(),delete Q[ie])})}removeTile(J){return g._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class X{constructor(){this.loaded={}}loadTile(J){return g._(this,void 0,void 0,function*(){const{uid:Q,encoding:ie,rawImageData:he,redFactor:Te,greenFactor:Le,blueFactor:je,baseShift:Ie}=J,He=he.width+2,qe=he.height+2,Re=g.b(he)?new g.R({width:He,height:qe},yield g.cN(he,-1,-1,He,qe)):he,Je=new g.cO(Q,Re,ie,Te,Le,je,Ie);return this.loaded=this.loaded||{},this.loaded[Q]=Je,Je})}removeTile(J){const Q=this.loaded,ie=J.uid;Q&&Q[ie]&&delete Q[ie]}}var q,te,ce=function(){if(te)return q;function Ee(Q,ie){if(Q.length!==0){J(Q[0],ie);for(var he=1;he<Q.length;he++)J(Q[he],!ie)}}function J(Q,ie){for(var he=0,Te=0,Le=0,je=Q.length,Ie=je-1;Le<je;Ie=Le++){var He=(Q[Le][0]-Q[Ie][0])*(Q[Ie][1]+Q[Le][1]),qe=he+He;Te+=Math.abs(he)>=Math.abs(He)?he-qe+He:He-qe+he,he=qe}he+Te>=0!=!!ie&&Q.reverse()}return te=1,q=function Q(ie,he){var Te,Le=ie&&ie.type;if(Le==="FeatureCollection")for(Te=0;Te<ie.features.length;Te++)Q(ie.features[Te],he);else if(Le==="GeometryCollection")for(Te=0;Te<ie.geometries.length;Te++)Q(ie.geometries[Te],he);else if(Le==="Feature")Q(ie.geometry,he);else if(Le==="Polygon")Ee(ie.coordinates,he);else if(Le==="MultiPolygon")for(Te=0;Te<ie.coordinates.length;Te++)Ee(ie.coordinates[Te],he);return ie}}(),Ce=g.cP(ce);const ze=g.cK.VectorTileFeature.prototype.toGeoJSON;class Ue{constructor(J){this._feature=J,this.extent=g.$,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const Q of this._feature.geometry)J.push([new g.P(Q[0],Q[1])]);return J}{const J=[];for(const Q of this._feature.geometry){const ie=[];for(const he of Q)ie.push(new g.P(he[0],he[1]));J.push(ie)}return J}}toGeoJSON(J,Q,ie){return ze.call(this,J,Q,ie)}}class Fe{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.$,this.length=J.length,this._features=J}feature(J){return new Ue(this._features[J])}}var xe,be,ke,Qe={exports:{}},tt=function(){if(ke)return Qe.exports;ke=1;var Ee=g.cS(),J=function(){if(be)return xe;be=1;var qe=g.cQ(),Re=g.cR().VectorTileFeature;function Je(Tt,Wt){this.options=Wt||{},this.features=Tt,this.length=Tt.length}function Se(Tt,Wt){this.id=typeof Tt.id=="number"?Tt.id:void 0,this.type=Tt.type,this.rawGeometry=Tt.type===1?[Tt.geometry]:Tt.geometry,this.properties=Tt.tags,this.extent=Wt||4096}return xe=Je,Je.prototype.feature=function(Tt){return new Se(this.features[Tt],this.options.extent)},Se.prototype.loadGeometry=function(){var Tt=this.rawGeometry;this.geometry=[];for(var Wt=0;Wt<Tt.length;Wt++){for(var Ct=Tt[Wt],Bt=[],ei=0;ei<Ct.length;ei++)Bt.push(new qe(Ct[ei][0],Ct[ei][1]));this.geometry.push(Bt)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Tt=this.geometry,Wt=1/0,Ct=-1/0,Bt=1/0,ei=-1/0,Yi=0;Yi<Tt.length;Yi++)for(var Ui=Tt[Yi],Oi=0;Oi<Ui.length;Oi++){var Nt=Ui[Oi];Wt=Math.min(Wt,Nt.x),Ct=Math.max(Ct,Nt.x),Bt=Math.min(Bt,Nt.y),ei=Math.max(ei,Nt.y)}return[Wt,Bt,Ct,ei]},Se.prototype.toGeoJSON=Re.prototype.toGeoJSON,xe}();function Q(qe){var Re=new Ee;return function(Je,Se){for(var Tt in Je.layers)Se.writeMessage(3,ie,Je.layers[Tt])}(qe,Re),Re.finish()}function ie(qe,Re){var Je;Re.writeVarintField(15,qe.version||1),Re.writeStringField(1,qe.name||""),Re.writeVarintField(5,qe.extent||4096);var Se={keys:[],values:[],keycache:{},valuecache:{}};for(Je=0;Je<qe.length;Je++)Se.feature=qe.feature(Je),Re.writeMessage(2,he,Se);var Tt=Se.keys;for(Je=0;Je<Tt.length;Je++)Re.writeStringField(3,Tt[Je]);var Wt=Se.values;for(Je=0;Je<Wt.length;Je++)Re.writeMessage(4,He,Wt[Je])}function he(qe,Re){var Je=qe.feature;Je.id!==void 0&&Re.writeVarintField(1,Je.id),Re.writeMessage(2,Te,qe),Re.writeVarintField(3,Je.type),Re.writeMessage(4,Ie,Je)}function Te(qe,Re){var Je=qe.feature,Se=qe.keys,Tt=qe.values,Wt=qe.keycache,Ct=qe.valuecache;for(var Bt in Je.properties){var ei=Je.properties[Bt],Yi=Wt[Bt];if(ei!==null){Yi===void 0&&(Se.push(Bt),Wt[Bt]=Yi=Se.length-1),Re.writeVarint(Yi);var Ui=typeof ei;Ui!=="string"&&Ui!=="boolean"&&Ui!=="number"&&(ei=JSON.stringify(ei));var Oi=Ui+":"+ei,Nt=Ct[Oi];Nt===void 0&&(Tt.push(ei),Ct[Oi]=Nt=Tt.length-1),Re.writeVarint(Nt)}}}function Le(qe,Re){return(Re<<3)+(7&qe)}function je(qe){return qe<<1^qe>>31}function Ie(qe,Re){for(var Je=qe.loadGeometry(),Se=qe.type,Tt=0,Wt=0,Ct=Je.length,Bt=0;Bt<Ct;Bt++){var ei=Je[Bt],Yi=1;Se===1&&(Yi=ei.length),Re.writeVarint(Le(1,Yi));for(var Ui=Se===3?ei.length-1:ei.length,Oi=0;Oi<Ui;Oi++){Oi===1&&Se!==1&&Re.writeVarint(Le(2,Ui-1));var Nt=ei[Oi].x-Tt,yt=ei[Oi].y-Wt;Re.writeVarint(je(Nt)),Re.writeVarint(je(yt)),Tt+=Nt,Wt+=yt}Se===3&&Re.writeVarint(Le(7,1))}}function He(qe,Re){var Je=typeof qe;Je==="string"?Re.writeStringField(1,qe):Je==="boolean"?Re.writeBooleanField(7,qe):Je==="number"&&(qe%1!=0?Re.writeDoubleField(3,qe):qe<0?Re.writeSVarintField(6,qe):Re.writeVarintField(5,qe))}return Qe.exports=Q,Qe.exports.fromVectorTileJs=Q,Qe.exports.fromGeojsonVt=function(qe,Re){Re=Re||{};var Je={};for(var Se in qe)Je[Se]=new J(qe[Se].features,Re),Je[Se].name=Se,Je[Se].version=Re.version,Je[Se].extent=Re.extent;return Q({layers:Je})},Qe.exports.GeoJSONWrapper=J,Qe.exports}(),et=g.cP(tt);const ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},At=Math.fround||(lt=new Float32Array(1),Ee=>(lt[0]=+Ee,lt[0]));var lt;class Et{constructor(J){this.options=Object.assign(Object.create(ht),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:Q,minZoom:ie,maxZoom:he}=this.options;Q&&console.time("total time");const Te=`prepare ${J.length} points`;Q&&console.time(Te),this.points=J;const Le=[];for(let Ie=0;Ie<J.length;Ie++){const He=J[Ie];if(!He.geometry)continue;const[qe,Re]=He.geometry.coordinates,Je=At(ni(qe)),Se=At(ri(Re));Le.push(Je,Se,1/0,Ie,-1,1),this.options.reduce&&Le.push(0)}let je=this.trees[he+1]=this._createTree(Le);Q&&console.timeEnd(Te);for(let Ie=he;Ie>=ie;Ie--){const He=+Date.now();je=this.trees[Ie]=this._createTree(this._cluster(je,Ie)),Q&&console.log("z%d: %d clusters in %dms",Ie,je.numItems,+Date.now()-He)}return Q&&console.timeEnd("total time"),this}getClusters(J,Q){let ie=((J[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,J[1]));let Te=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ie=-180,Te=180;else if(ie>Te){const Re=this.getClusters([ie,he,180,Le],Q),Je=this.getClusters([-180,he,Te,Le],Q);return Re.concat(Je)}const je=this.trees[this._limitZoom(Q)],Ie=je.range(ni(ie),ri(Le),ni(Te),ri(he)),He=je.data,qe=[];for(const Re of Ie){const Je=this.stride*Re;qe.push(He[Je+5]>1?jt(He,Je,this.clusterProps):this.points[He[Je+3]])}return qe}getChildren(J){const Q=this._getOriginId(J),ie=this._getOriginZoom(J),he="No cluster with the specified id.",Te=this.trees[ie];if(!Te)throw new Error(he);const Le=Te.data;if(Q*this.stride>=Le.length)throw new Error(he);const je=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Ie=Te.within(Le[Q*this.stride],Le[Q*this.stride+1],je),He=[];for(const qe of Ie){const Re=qe*this.stride;Le[Re+4]===J&&He.push(Le[Re+5]>1?jt(Le,Re,this.clusterProps):this.points[Le[Re+3]])}if(He.length===0)throw new Error(he);return He}getLeaves(J,Q,ie){const he=[];return this._appendLeaves(he,J,Q=Q||10,ie=ie||0,0),he}getTile(J,Q,ie){const he=this.trees[this._limitZoom(J)],Te=Math.pow(2,J),{extent:Le,radius:je}=this.options,Ie=je/Le,He=(ie-Ie)/Te,qe=(ie+1+Ie)/Te,Re={features:[]};return this._addTileFeatures(he.range((Q-Ie)/Te,He,(Q+1+Ie)/Te,qe),he.data,Q,ie,Te,Re),Q===0&&this._addTileFeatures(he.range(1-Ie/Te,He,1,qe),he.data,Te,ie,Te,Re),Q===Te-1&&this._addTileFeatures(he.range(0,He,Ie/Te,qe),he.data,-1,ie,Te,Re),Re.features.length?Re:null}getClusterExpansionZoom(J){let Q=this._getOriginZoom(J)-1;for(;Q<=this.options.maxZoom;){const ie=this.getChildren(J);if(Q++,ie.length!==1)break;J=ie[0].properties.cluster_id}return Q}_appendLeaves(J,Q,ie,he,Te){const Le=this.getChildren(Q);for(const je of Le){const Ie=je.properties;if(Ie&&Ie.cluster?Te+Ie.point_count<=he?Te+=Ie.point_count:Te=this._appendLeaves(J,Ie.cluster_id,ie,he,Te):Te<he?Te++:J.push(je),J.length===ie)break}return Te}_createTree(J){const Q=new g.aH(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<J.length;ie+=this.stride)Q.add(J[ie],J[ie+1]);return Q.finish(),Q.data=J,Q}_addTileFeatures(J,Q,ie,he,Te,Le){for(const je of J){const Ie=je*this.stride,He=Q[Ie+5]>1;let qe,Re,Je;if(He)qe=Ni(Q,Ie,this.clusterProps),Re=Q[Ie],Je=Q[Ie+1];else{const Wt=this.points[Q[Ie+3]];qe=Wt.properties;const[Ct,Bt]=Wt.geometry.coordinates;Re=ni(Ct),Je=ri(Bt)}const Se={type:1,geometry:[[Math.round(this.options.extent*(Re*Te-ie)),Math.round(this.options.extent*(Je*Te-he))]],tags:qe};let Tt;Tt=He||this.options.generateId?Q[Ie+3]:this.points[Q[Ie+3]].id,Tt!==void 0&&(Se.id=Tt),Le.features.push(Se)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,Q){const{radius:ie,extent:he,reduce:Te,minPoints:Le}=this.options,je=ie/(he*Math.pow(2,Q)),Ie=J.data,He=[],qe=this.stride;for(let Re=0;Re<Ie.length;Re+=qe){if(Ie[Re+2]<=Q)continue;Ie[Re+2]=Q;const Je=Ie[Re],Se=Ie[Re+1],Tt=J.within(Ie[Re],Ie[Re+1],je),Wt=Ie[Re+5];let Ct=Wt;for(const Bt of Tt){const ei=Bt*qe;Ie[ei+2]>Q&&(Ct+=Ie[ei+5])}if(Ct>Wt&&Ct>=Le){let Bt,ei=Je*Wt,Yi=Se*Wt,Ui=-1;const Oi=(Re/qe<<5)+(Q+1)+this.points.length;for(const Nt of Tt){const yt=Nt*qe;if(Ie[yt+2]<=Q)continue;Ie[yt+2]=Q;const Fn=Ie[yt+5];ei+=Ie[yt]*Fn,Yi+=Ie[yt+1]*Fn,Ie[yt+4]=Oi,Te&&(Bt||(Bt=this._map(Ie,Re,!0),Ui=this.clusterProps.length,this.clusterProps.push(Bt)),Te(Bt,this._map(Ie,yt)))}Ie[Re+4]=Oi,He.push(ei/Ct,Yi/Ct,1/0,Oi,-1,Ct),Te&&He.push(Ui)}else{for(let Bt=0;Bt<qe;Bt++)He.push(Ie[Re+Bt]);if(Ct>1)for(const Bt of Tt){const ei=Bt*qe;if(!(Ie[ei+2]<=Q)){Ie[ei+2]=Q;for(let Yi=0;Yi<qe;Yi++)He.push(Ie[ei+Yi])}}}}return He}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,Q,ie){if(J[Q+5]>1){const Le=this.clusterProps[J[Q+6]];return ie?Object.assign({},Le):Le}const he=this.points[J[Q+3]].properties,Te=this.options.map(he);return ie&&Te===he?Object.assign({},Te):Te}}function jt(Ee,J,Q){return{type:"Feature",id:Ee[J+3],properties:Ni(Ee,J,Q),geometry:{type:"Point",coordinates:[(ie=Ee[J],360*(ie-.5)),It(Ee[J+1])]}};var ie}function Ni(Ee,J,Q){const ie=Ee[J+5],he=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Te=Ee[J+6],Le=Te===-1?{}:Object.assign({},Q[Te]);return Object.assign(Le,{cluster:!0,cluster_id:Ee[J+3],point_count:ie,point_count_abbreviated:he})}function ni(Ee){return Ee/360+.5}function ri(Ee){const J=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function It(Ee){const J=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function pr(Ee,J,Q,ie){let he=ie;const Te=J+(Q-J>>1);let Le,je=Q-J;const Ie=Ee[J],He=Ee[J+1],qe=Ee[Q],Re=Ee[Q+1];for(let Je=J+3;Je<Q;Je+=3){const Se=Yt(Ee[Je],Ee[Je+1],Ie,He,qe,Re);if(Se>he)Le=Je,he=Se;else if(Se===he){const Tt=Math.abs(Je-Te);Tt<je&&(Le=Je,je=Tt)}}he>ie&&(Le-J>3&&pr(Ee,J,Le,ie),Ee[Le+2]=he,Q-Le>3&&pr(Ee,Le,Q,ie))}function Yt(Ee,J,Q,ie,he,Te){let Le=he-Q,je=Te-ie;if(Le!==0||je!==0){const Ie=((Ee-Q)*Le+(J-ie)*je)/(Le*Le+je*je);Ie>1?(Q=he,ie=Te):Ie>0&&(Q+=Le*Ie,ie+=je*Ie)}return Le=Ee-Q,je=J-ie,Le*Le+je*je}function pi(Ee,J,Q,ie){const he={id:Ee??null,type:J,geometry:Q,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")Jt(he,Q);else if(J==="Polygon")Jt(he,Q[0]);else if(J==="MultiLineString")for(const Te of Q)Jt(he,Te);else if(J==="MultiPolygon")for(const Te of Q)Jt(he,Te[0]);return he}function Jt(Ee,J){for(let Q=0;Q<J.length;Q+=3)Ee.minX=Math.min(Ee.minX,J[Q]),Ee.minY=Math.min(Ee.minY,J[Q+1]),Ee.maxX=Math.max(Ee.maxX,J[Q]),Ee.maxY=Math.max(Ee.maxY,J[Q+1])}function Xi(Ee,J,Q,ie){if(!J.geometry)return;const he=J.geometry.coordinates;if(he&&he.length===0)return;const Te=J.geometry.type,Le=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let je=[],Ie=J.id;if(Q.promoteId?Ie=J.properties[Q.promoteId]:Q.generateId&&(Ie=ie||0),Te==="Point")ji(he,je);else if(Te==="MultiPoint")for(const He of he)ji(He,je);else if(Te==="LineString")Ai(he,je,Le,!1);else if(Te==="MultiLineString"){if(Q.lineMetrics){for(const He of he)je=[],Ai(He,je,Le,!1),Ee.push(pi(Ie,"LineString",je,J.properties));return}oi(he,je,Le,!1)}else if(Te==="Polygon")oi(he,je,Le,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(const He of J.geometry.geometries)Xi(Ee,{id:Ie,geometry:He,properties:J.properties},Q,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of he){const qe=[];oi(He,qe,Le,!0),je.push(qe)}}Ee.push(pi(Ie,Te,je,J.properties))}function ji(Ee,J){J.push(On(Ee[0]),fr(Ee[1]),0)}function Ai(Ee,J,Q,ie){let he,Te,Le=0;for(let Ie=0;Ie<Ee.length;Ie++){const He=On(Ee[Ie][0]),qe=fr(Ee[Ie][1]);J.push(He,qe,0),Ie>0&&(Le+=ie?(he*qe-He*Te)/2:Math.sqrt(Math.pow(He-he,2)+Math.pow(qe-Te,2))),he=He,Te=qe}const je=J.length-3;J[2]=1,pr(J,0,je,Q),J[je+2]=1,J.size=Math.abs(Le),J.start=0,J.end=J.size}function oi(Ee,J,Q,ie){for(let he=0;he<Ee.length;he++){const Te=[];Ai(Ee[he],Te,Q,ie),J.push(Te)}}function On(Ee){return Ee/360+.5}function fr(Ee){const J=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return Q<0?0:Q>1?1:Q}function dn(Ee,J,Q,ie,he,Te,Le,je){if(ie/=J,Te>=(Q/=J)&&Le<ie)return Ee;if(Le<Q||Te>=ie)return null;const Ie=[];for(const He of Ee){const qe=He.geometry;let Re=He.type;const Je=he===0?He.minX:He.minY,Se=he===0?He.maxX:He.maxY;if(Je>=Q&&Se<ie){Ie.push(He);continue}if(Se<Q||Je>=ie)continue;let Tt=[];if(Re==="Point"||Re==="MultiPoint")Fr(qe,Tt,Q,ie,he);else if(Re==="LineString")er(qe,Tt,Q,ie,he,!1,je.lineMetrics);else if(Re==="MultiLineString")Pe(qe,Tt,Q,ie,he,!1);else if(Re==="Polygon")Pe(qe,Tt,Q,ie,he,!0);else if(Re==="MultiPolygon")for(const Wt of qe){const Ct=[];Pe(Wt,Ct,Q,ie,he,!0),Ct.length&&Tt.push(Ct)}if(Tt.length){if(je.lineMetrics&&Re==="LineString"){for(const Wt of Tt)Ie.push(pi(He.id,Re,Wt,He.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(Tt.length===1?(Re="LineString",Tt=Tt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=Tt.length===3?"Point":"MultiPoint"),Ie.push(pi(He.id,Re,Tt,He.tags))}}return Ie.length?Ie:null}function Fr(Ee,J,Q,ie,he){for(let Te=0;Te<Ee.length;Te+=3){const Le=Ee[Te+he];Le>=Q&&Le<=ie&&Ke(J,Ee[Te],Ee[Te+1],Ee[Te+2])}}function er(Ee,J,Q,ie,he,Te,Le){let je=ye(Ee);const Ie=he===0?ct:at;let He,qe,Re=Ee.start;for(let Ct=0;Ct<Ee.length-3;Ct+=3){const Bt=Ee[Ct],ei=Ee[Ct+1],Yi=Ee[Ct+2],Ui=Ee[Ct+3],Oi=Ee[Ct+4],Nt=he===0?Bt:ei,yt=he===0?Ui:Oi;let Fn=!1;Le&&(He=Math.sqrt(Math.pow(Bt-Ui,2)+Math.pow(ei-Oi,2))),Nt<Q?yt>Q&&(qe=Ie(je,Bt,ei,Ui,Oi,Q),Le&&(je.start=Re+He*qe)):Nt>ie?yt<ie&&(qe=Ie(je,Bt,ei,Ui,Oi,ie),Le&&(je.start=Re+He*qe)):Ke(je,Bt,ei,Yi),yt<Q&&Nt>=Q&&(qe=Ie(je,Bt,ei,Ui,Oi,Q),Fn=!0),yt>ie&&Nt<=ie&&(qe=Ie(je,Bt,ei,Ui,Oi,ie),Fn=!0),!Te&&Fn&&(Le&&(je.end=Re+He*qe),J.push(je),je=ye(Ee)),Le&&(Re+=He)}let Je=Ee.length-3;const Se=Ee[Je],Tt=Ee[Je+1],Wt=he===0?Se:Tt;Wt>=Q&&Wt<=ie&&Ke(je,Se,Tt,Ee[Je+2]),Je=je.length-3,Te&&Je>=3&&(je[Je]!==je[0]||je[Je+1]!==je[1])&&Ke(je,je[0],je[1],je[2]),je.length&&J.push(je)}function ye(Ee){const J=[];return J.size=Ee.size,J.start=Ee.start,J.end=Ee.end,J}function Pe(Ee,J,Q,ie,he,Te){for(const Le of Ee)er(Le,J,Q,ie,he,Te,!1)}function Ke(Ee,J,Q,ie){Ee.push(J,Q,ie)}function ct(Ee,J,Q,ie,he,Te){const Le=(Te-J)/(ie-J);return Ke(Ee,Te,Q+(he-Q)*Le,1),Le}function at(Ee,J,Q,ie,he,Te){const Le=(Te-Q)/(he-Q);return Ke(Ee,J+(ie-J)*Le,Te,1),Le}function nt(Ee,J){const Q=[];for(let ie=0;ie<Ee.length;ie++){const he=Ee[ie],Te=he.type;let Le;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Le=xt(he.geometry,J);else if(Te==="MultiLineString"||Te==="Polygon"){Le=[];for(const je of he.geometry)Le.push(xt(je,J))}else if(Te==="MultiPolygon"){Le=[];for(const je of he.geometry){const Ie=[];for(const He of je)Ie.push(xt(He,J));Le.push(Ie)}}Q.push(pi(he.id,Te,Le,he.tags))}return Q}function xt(Ee,J){const Q=[];Q.size=Ee.size,Ee.start!==void 0&&(Q.start=Ee.start,Q.end=Ee.end);for(let ie=0;ie<Ee.length;ie+=3)Q.push(Ee[ie]+J,Ee[ie+1],Ee[ie+2]);return Q}function _t(Ee,J){if(Ee.transformed)return Ee;const Q=1<<Ee.z,ie=Ee.x,he=Ee.y;for(const Te of Ee.features){const Le=Te.geometry,je=Te.type;if(Te.geometry=[],je===1)for(let Ie=0;Ie<Le.length;Ie+=2)Te.geometry.push(wt(Le[Ie],Le[Ie+1],J,Q,ie,he));else for(let Ie=0;Ie<Le.length;Ie++){const He=[];for(let qe=0;qe<Le[Ie].length;qe+=2)He.push(wt(Le[Ie][qe],Le[Ie][qe+1],J,Q,ie,he));Te.geometry.push(He)}}return Ee.transformed=!0,Ee}function wt(Ee,J,Q,ie,he,Te){return[Math.round(Q*(Ee*ie-he)),Math.round(Q*(J*ie-Te))]}function dt(Ee,J,Q,ie,he){const Te=J===he.maxZoom?0:he.tolerance/((1<<J)*he.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:Q,y:ie,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const je of Ee)$t(Le,je,Te,he);return Le}function $t(Ee,J,Q,ie){const he=J.geometry,Te=J.type,Le=[];if(Ee.minX=Math.min(Ee.minX,J.minX),Ee.minY=Math.min(Ee.minY,J.minY),Ee.maxX=Math.max(Ee.maxX,J.maxX),Ee.maxY=Math.max(Ee.maxY,J.maxY),Te==="Point"||Te==="MultiPoint")for(let je=0;je<he.length;je+=3)Le.push(he[je],he[je+1]),Ee.numPoints++,Ee.numSimplified++;else if(Te==="LineString")Pt(Le,he,Ee,Q,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(let je=0;je<he.length;je++)Pt(Le,he[je],Ee,Q,Te==="Polygon",je===0);else if(Te==="MultiPolygon")for(let je=0;je<he.length;je++){const Ie=he[je];for(let He=0;He<Ie.length;He++)Pt(Le,Ie[He],Ee,Q,!0,He===0)}if(Le.length){let je=J.tags||null;if(Te==="LineString"&&ie.lineMetrics){je={};for(const He in J.tags)je[He]=J.tags[He];je.mapbox_clip_start=he.start/he.size,je.mapbox_clip_end=he.end/he.size}const Ie={geometry:Le,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:je};J.id!==null&&(Ie.id=J.id),Ee.features.push(Ie)}}function Pt(Ee,J,Q,ie,he,Te){const Le=ie*ie;if(ie>0&&J.size<(he?Le:ie))return void(Q.numPoints+=J.length/3);const je=[];for(let Ie=0;Ie<J.length;Ie+=3)(ie===0||J[Ie+2]>Le)&&(Q.numSimplified++,je.push(J[Ie],J[Ie+1])),Q.numPoints++;he&&function(Ie,He){let qe=0;for(let Re=0,Je=Ie.length,Se=Je-2;Re<Je;Se=Re,Re+=2)qe+=(Ie[Re]-Ie[Se])*(Ie[Re+1]+Ie[Se+1]);if(qe>0===He)for(let Re=0,Je=Ie.length;Re<Je/2;Re+=2){const Se=Ie[Re],Tt=Ie[Re+1];Ie[Re]=Ie[Je-2-Re],Ie[Re+1]=Ie[Je-1-Re],Ie[Je-2-Re]=Se,Ie[Je-1-Re]=Tt}}(je,Te),Ee.push(je)}const Ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qt{constructor(J,Q){const ie=(Q=this.options=function(Te,Le){for(const je in Le)Te[je]=Le[je];return Te}(Object.create(Ft),Q)).debug;if(ie&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(Te,Le){const je=[];if(Te.type==="FeatureCollection")for(let Ie=0;Ie<Te.features.length;Ie++)Xi(je,Te.features[Ie],Le,Ie);else Xi(je,Te.type==="Feature"?Te:{geometry:Te},Le);return je}(J,Q);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(Te,Le){const je=Le.buffer/Le.extent;let Ie=Te;const He=dn(Te,1,-1-je,je,0,-1,2,Le),qe=dn(Te,1,1-je,2+je,0,-1,2,Le);return(He||qe)&&(Ie=dn(Te,1,-je,1+je,0,-1,2,Le)||[],He&&(Ie=nt(He,1).concat(Ie)),qe&&(Ie=Ie.concat(nt(qe,-1)))),Ie}(he,Q),he.length&&this.splitTile(he,0,0,0),ie&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,Q,ie,he,Te,Le,je){const Ie=[J,Q,ie,he],He=this.options,qe=He.debug;for(;Ie.length;){he=Ie.pop(),ie=Ie.pop(),Q=Ie.pop(),J=Ie.pop();const Re=1<<Q,Je=si(Q,ie,he);let Se=this.tiles[Je];if(!Se&&(qe>1&&console.time("creation"),Se=this.tiles[Je]=dt(J,Q,ie,he,He),this.tileCoords.push({z:Q,x:ie,y:he}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ie,he,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));const Fn=`z${Q}`;this.stats[Fn]=(this.stats[Fn]||0)+1,this.total++}if(Se.source=J,Te==null){if(Q===He.indexMaxZoom||Se.numPoints<=He.indexMaxPoints)continue}else{if(Q===He.maxZoom||Q===Te)continue;if(Te!=null){const Fn=Te-Q;if(ie!==Le>>Fn||he!==je>>Fn)continue}}if(Se.source=null,J.length===0)continue;qe>1&&console.time("clipping");const Tt=.5*He.buffer/He.extent,Wt=.5-Tt,Ct=.5+Tt,Bt=1+Tt;let ei=null,Yi=null,Ui=null,Oi=null,Nt=dn(J,Re,ie-Tt,ie+Ct,0,Se.minX,Se.maxX,He),yt=dn(J,Re,ie+Wt,ie+Bt,0,Se.minX,Se.maxX,He);J=null,Nt&&(ei=dn(Nt,Re,he-Tt,he+Ct,1,Se.minY,Se.maxY,He),Yi=dn(Nt,Re,he+Wt,he+Bt,1,Se.minY,Se.maxY,He),Nt=null),yt&&(Ui=dn(yt,Re,he-Tt,he+Ct,1,Se.minY,Se.maxY,He),Oi=dn(yt,Re,he+Wt,he+Bt,1,Se.minY,Se.maxY,He),yt=null),qe>1&&console.timeEnd("clipping"),Ie.push(ei||[],Q+1,2*ie,2*he),Ie.push(Yi||[],Q+1,2*ie,2*he+1),Ie.push(Ui||[],Q+1,2*ie+1,2*he),Ie.push(Oi||[],Q+1,2*ie+1,2*he+1)}}getTile(J,Q,ie){J=+J,Q=+Q,ie=+ie;const he=this.options,{extent:Te,debug:Le}=he;if(J<0||J>24)return null;const je=1<<J,Ie=si(J,Q=Q+je&je-1,ie);if(this.tiles[Ie])return _t(this.tiles[Ie],Te);Le>1&&console.log("drilling down to z%d-%d-%d",J,Q,ie);let He,qe=J,Re=Q,Je=ie;for(;!He&&qe>0;)qe--,Re>>=1,Je>>=1,He=this.tiles[si(qe,Re,Je)];return He&&He.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",qe,Re,Je),console.time("drilling down")),this.splitTile(He.source,qe,Re,Je,J,Q,ie),Le>1&&console.timeEnd("drilling down"),this.tiles[Ie]?_t(this.tiles[Ie],Te):null):null}}function si(Ee,J,Q){return 32*((1<<Ee)*Q+J)+Ee}function yi(Ee,J){return J?Ee.properties[J]:Ee.id}function vi(Ee,J){if(Ee==null)return!0;if(Ee.type==="Feature")return yi(Ee,J)!=null;if(Ee.type==="FeatureCollection"){const Q=new Set;for(const ie of Ee.features){const he=yi(ie,J);if(he==null||Q.has(he))return!1;Q.add(he)}return!0}return!1}function In(Ee,J){const Q=new Map;if(Ee!=null)if(Ee.type==="Feature")Q.set(yi(Ee,J),Ee);else for(const ie of Ee.features)Q.set(yi(ie,J),ie);return Q}class An extends ${constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,Q){return g._(this,void 0,void 0,function*(){const ie=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!he)return null;const Te=new Fe(he.features);let Le=et(Te);return Le.byteOffset===0&&Le.byteLength===Le.buffer.byteLength||(Le=new Uint8Array(Le)),{vectorTile:Te,rawData:Le.buffer}})}loadData(J){return g._(this,void 0,void 0,function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const ie=!!(J&&J.request&&J.request.collectResourceTiming)&&new g.cM(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new Et(function({superclusterOptions:Le,clusterProperties:je}){if(!je||!Le)return Le;const Ie={},He={},qe={accumulated:null,zoom:0},Re={properties:null},Je=Object.keys(je);for(const Se of Je){const[Tt,Wt]=je[Se],Ct=g.cT(Wt),Bt=g.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",Se]]:Tt);Ie[Se]=Ct.value,He[Se]=Bt.value}return Le.map=Se=>{Re.properties=Se;const Tt={};for(const Wt of Je)Tt[Wt]=Ie[Wt].evaluate(qe,Re);return Tt},Le.reduce=(Se,Tt)=>{Re.properties=Tt;for(const Wt of Je)qe.accumulated=Se[Wt],Se[Wt]=He[Wt].evaluate(qe,Re)},Le}(J)).load((yield this._pendingData).features):(he=yield this._pendingData,new Qt(he,J.geojsonVtOptions)),this.loaded={};const Te={};if(ie){const Le=ie.finish();Le&&(Te.resourceTiming={},Te.resourceTiming[J.source]=JSON.parse(JSON.stringify(Le)))}return Te}catch(Te){if(delete this._pendingRequest,g.cx(Te))return{abandoned:!0};throw Te}var he})}getData(){return g._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const Q=this.loaded;return Q&&Q[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,Q){return g._(this,void 0,void 0,function*(){let ie=yield this.loadGeoJSON(J,Q);if(delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(Ce(ie,!0),J.filter){const he=g.cT(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(Le=>he.value.evaluate({zoom:0},Le))}}return ie})}loadGeoJSON(J,Q){return g._(this,void 0,void 0,function*(){const{promoteId:ie}=J;if(J.request){const he=yield g.j(J.request,Q);return this._dataUpdateable=vi(he.data,ie)?In(he.data,ie):void 0,he.data}if(typeof J.data=="string")try{const he=JSON.parse(J.data);return this._dataUpdateable=vi(he,ie)?In(he,ie):void 0,he}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(he,Te,Le){var je,Ie,He,qe;if(Te.removeAll&&he.clear(),Te.remove)for(const Re of Te.remove)he.delete(Re);if(Te.add)for(const Re of Te.add){const Je=yi(Re,Le);Je!=null&&he.set(Je,Re)}if(Te.update)for(const Re of Te.update){let Je=he.get(Re.id);if(Je==null)continue;const Se=!Re.removeAllProperties&&(((je=Re.removeProperties)===null||je===void 0?void 0:je.length)>0||((Ie=Re.addOrUpdateProperties)===null||Ie===void 0?void 0:Ie.length)>0);if((Re.newGeometry||Re.removeAllProperties||Se)&&(Je=Object.assign({},Je),he.set(Re.id,Je),Se&&(Je.properties=Object.assign({},Je.properties))),Re.newGeometry&&(Je.geometry=Re.newGeometry),Re.removeAllProperties)Je.properties={};else if(((He=Re.removeProperties)===null||He===void 0?void 0:He.length)>0)for(const Tt of Re.removeProperties)Object.prototype.hasOwnProperty.call(Je.properties,Tt)&&delete Je.properties[Tt];if(((qe=Re.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:Tt,value:Wt}of Re.addOrUpdateProperties)Je.properties[Tt]=Wt}}(this._dataUpdateable,J.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return g._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class wn{constructor(J){this.self=J,this.actor=new g.J(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Q,ie)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=ie},this.self.addProtocol=g.cz,this.self.removeProtocol=g.cA,this.self.registerRTLTextPlugin=Q=>{g.cU.setMethods(Q)},this.actor.registerMessageHandler("LDT",(Q,ie)=>this._getDEMWorkerSource(Q,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RDT",(Q,ie)=>g._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Q,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("GCEZ",(Q,ie)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("GCC",(Q,ie)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("GCL",(Q,ie)=>g._(this,void 0,void 0,function*(){return this._getWorkerSource(Q,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("LD",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("GD",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).getData()),this.actor.registerMessageHandler("LT",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RT",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("AT",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("RMT",(Q,ie)=>this._getWorkerSource(Q,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("RS",(Q,ie)=>g._(this,void 0,void 0,function*(){if(!this.workerSources[Q]||!this.workerSources[Q][ie.type]||!this.workerSources[Q][ie.type][ie.source])return;const he=this.workerSources[Q][ie.type][ie.source];delete this.workerSources[Q][ie.type][ie.source],he.removeSource!==void 0&&he.removeSource(ie)})),this.actor.registerMessageHandler("RM",Q=>g._(this,void 0,void 0,function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q]})),this.actor.registerMessageHandler("SR",(Q,ie)=>g._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("SRPS",(Q,ie)=>this._syncRTLPluginState(Q,ie)),this.actor.registerMessageHandler("IS",(Q,ie)=>g._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("SI",(Q,ie)=>this._setImages(Q,ie)),this.actor.registerMessageHandler("UL",(Q,ie)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(Q).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("SL",(Q,ie)=>g._(this,void 0,void 0,function*(){this._getLayerIndex(Q).replace(ie)}))}_setImages(J,Q){return g._(this,void 0,void 0,function*(){this.availableImages[J]=Q;for(const ie in this.workerSources[J]){const he=this.workerSources[J][ie];for(const Te in he)he[Te].availableImages=Q}})}_syncRTLPluginState(J,Q){return g._(this,void 0,void 0,function*(){return yield g.cU.syncState(Q,this.self.importScripts)})}_getAvailableImages(J){let Q=this.availableImages[J];return Q||(Q=[]),Q}_getLayerIndex(J){let Q=this.layerIndexes[J];return Q||(Q=this.layerIndexes[J]=new l),Q}_getWorkerSource(J,Q,ie){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Q]||(this.workerSources[J][Q]={}),!this.workerSources[J][Q][ie]){const he={sendAsync:(Te,Le)=>(Te.targetMapId=J,this.actor.sendAsync(Te,Le))};switch(Q){case"vector":this.workerSources[J][Q][ie]=new $(he,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][Q][ie]=new An(he,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][Q][ie]=new this.externalWorkerSourceTypes[Q](he,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][Q][ie]}_getDEMWorkerSource(J,Q){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][Q]||(this.demWorkerSources[J][Q]=new X),this.demWorkerSources[J][Q]}}return g.i(self)&&(self.worker=new wn(self)),wn}),m("index",["exports","./shared"],function(g,l){var E="5.6.1";function k(){var v=new l.A(4);return l.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let O,$;const X={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(v,e,r){const h=requestAnimationFrame(x=>{p(),e(x)}),{unsubscribe:p}=l.s(v.signal,"abort",()=>{p(),cancelAnimationFrame(h),r(l.c())},!1)},frameAsync(v){return new Promise((e,r)=>{this.frame(v,e,r)})},getImageData(v,e=0){return this.getImageCanvasContext(v).getImageData(-e,-e,v.width+2*e,v.height+2*e)},getImageCanvasContext(v){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=v.width,e.height=v.height,r.drawImage(v,0,0,v.width,v.height),r},resolveURL:v=>(O||(O=document.createElement("a")),O.href=v,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&($==null&&($=matchMedia("(prefers-reduced-motion: reduce)")),$.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in q.docStyle)return e[r];return e[0]}static create(e,r,h){const p=window.document.createElement(e);return r!==void 0&&(p.className=r),h&&h.appendChild(p),p}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,r){e.style[q.transformProp]=r}static addEventListener(e,r,h,p={}){e.addEventListener(r,h,"passive"in p?p:p.capture)}static removeEventListener(e,r,h,p={}){e.removeEventListener(r,h,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,h){const p=r.boundingClientRect;return new l.P((h.clientX-p.left)/r.x-e.clientLeft,(h.clientY-p.top)/r.y-e.clientTop)}static mousePos(e,r){const h=q.getScale(e);return q.getPoint(e,h,r)}static touchPos(e,r){const h=[],p=q.getScale(e);for(let x=0;x<r.length;x++)h.push(q.getPoint(e,p,r[x]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=r.querySelectorAll("script");for(const p of h)p.remove();return q.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const h=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const h of r)q.removeAttributes(h),q.clean(h)}static removeAttributes(e){for(const{name:r,value:h}of e.attributes)q.isPossiblyDangerous(r,h)&&e.removeAttribute(r)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const te={supported:!1,testSupport:function(v){!ze&&Ce&&(Ue?Fe(v):ce=v)}};let ce,Ce,ze=!1,Ue=!1;function Fe(v){const e=v.createTexture();v.bindTexture(v.TEXTURE_2D,e);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Ce),v.isContextLost())return;te.supported=!0}catch{}v.deleteTexture(e),ze=!0}var xe;typeof document<"u"&&(Ce=document.createElement("img"),Ce.onload=()=>{ce&&Fe(ce),ce=null,Ue=!0},Ce.onerror=()=>{ze=!0,ce=null},Ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let e,r,h,p;v.resetRequestQueue=()=>{e=[],r=0,h=0,p={}},v.addThrottleControl=I=>{const R=h++;return p[R]=I,R},v.removeThrottleControl=I=>{delete p[I],T()},v.getImage=(I,R,F=!0)=>new Promise((j,N)=>{te.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),l.e(I,{type:"image"}),e.push({abortController:R,requestParameters:I,supportImageRefresh:F,state:"queued",onError:Z=>{N(Z)},onSuccess:Z=>{j(Z)}}),T()});const x=I=>l._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:R,supportImageRefresh:F,onError:j,onSuccess:N,abortController:Z}=I,K=F===!1&&!l.i(self)&&!l.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((ae,ue)=>ae&&ue==="accept",!0));r++;const se=K?C(R,Z):l.m(R,Z);try{const ae=yield se;delete I.abortController,I.state="completed",ae.data instanceof HTMLImageElement||l.b(ae.data)?N(ae):ae.data&&N({data:yield(oe=ae.data,typeof createImageBitmap=="function"?l.f(oe):l.h(oe)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete I.abortController,j(ae)}finally{r--,T()}var oe}),T=()=>{const I=(()=>{for(const R of Object.keys(p))if(p[R]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=r;R<I&&e.length>0;R++){const F=e.shift();F.abortController.signal.aborted?R--:x(F)}},C=(I,R)=>new Promise((F,j)=>{const N=new Image,Z=I.url,K=I.credentials;K&&K==="include"?N.crossOrigin="use-credentials":(K&&K==="same-origin"||!l.d(Z))&&(N.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{N.src="",j(l.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,F({data:N})},N.onerror=()=>{N.onerror=N.onload=null,R.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=Z})}(xe||(xe={})),xe.resetRequestQueue();class be{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ke(v){const e=[];if(typeof v=="string")e.push({id:"default",url:v});else if(v&&v.length>0){const r=[];for(const{id:h,url:p}of v){const x=`${h}${p}`;r.indexOf(x)===-1&&(r.push(x),e.push({id:h,url:p}))}}return e}function Qe(v,e,r){try{const h=new URL(v);return h.pathname+=`${e}${r}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function tt(v){const{userImage:e}=v;return!!(e&&e.render&&e.render())&&(v.data.replace(new Uint8Array(e.data.buffer)),!0)}class et extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:h}of this.requestors)h(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const h=r.spriteData;r.data=new l.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let h=!0;const p=r.data||r.spriteData;return this._validateStretch(r.stretchX,p&&p.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(r.stretchY,p&&p.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(r.content,r)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,r){if(!e)return!0;let h=0;for(const p of e){if(p[0]<h||p[1]<p[0]||r<p[1])return!1;h=p[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const h=r.spriteData,p=h&&h.width||r.data.width,x=h&&h.height||r.data.height;return!(e[0]<0||p<e[0]||e[1]<0||x<e[1]||e[2]<0||p<e[2]||e[3]<0||x<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,h=!0){const p=this.getImage(e);if(h&&(p.data.width!==r.data.width||p.data.height!==r.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=p.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,h)=>{let p=!0;if(!this.isLoaded())for(const x of e)this.images[x]||(p=!1);this.isLoaded()||p?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const h of e){let p=this.getImage(h);p||(this.fire(new l.l("styleimagemissing",{id:h})),p=this.getImage(h)),p?r[h]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:l.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],h=this.getImage(e);if(!h)return null;if(r&&r.position.version===h.version)return r.position;if(r)r.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},x=new l.I(p,h);this.patterns[e]={bin:p,position:x}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const x in this.patterns)e.push(this.patterns[x].bin);const{w:r,h}=l.p(e),p=this.atlasImage;p.resize({width:r||1,height:h||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],C=T.x+1,I=T.y+1,R=this.getImage(x).data,F=R.width,j=R.height;l.R.copy(R,p,{x:0,y:0},{x:C,y:I},{width:F,height:j}),l.R.copy(R,p,{x:0,y:j-1},{x:C,y:I-1},{width:F,height:1}),l.R.copy(R,p,{x:0,y:0},{x:C,y:I+j},{width:F,height:1}),l.R.copy(R,p,{x:F-1,y:0},{x:C-1,y:I},{width:1,height:j}),l.R.copy(R,p,{x:0,y:0},{x:C+F,y:I},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const h=this.getImage(r);h||l.w(`Image with ID: "${r}" was not found`),tt(h)&&this.updateImage(r,h)}}}const ht=1e20;function At(v,e,r,h,p,x,T,C,I){for(let R=e;R<e+h;R++)lt(v,r*x+R,x,p,T,C,I);for(let R=r;R<r+p;R++)lt(v,R*x+e,1,h,T,C,I)}function lt(v,e,r,h,p,x,T){x[0]=0,T[0]=-ht,T[1]=ht,p[0]=v[e];for(let C=1,I=0,R=0;C<h;C++){p[C]=v[e+C*r];const F=C*C;do{const j=x[I];R=(p[C]-p[j]+F-j*j)/(C-j)/2}while(R<=T[I]&&--I>-1);I++,x[I]=C,T[I]=R,T[I+1]=ht}for(let C=0,I=0;C<h;C++){for(;T[I+1]<C;)I++;const R=x[I],F=C-R;v[e+C*r]=p[R]+F*F}}class Et{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,function*(){const r=[];for(const x in e)for(const T of e[x])r.push(this._getAndCacheGlyphsPromise(x,T));const h=yield Promise.all(r),p={};for(const{stack:x,id:T,glyph:C}of h)p[x]||(p[x]={}),p[x][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return p})}_getAndCacheGlyphsPromise(e,r){return l._(this,void 0,void 0,function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=h.glyphs[r];if(p!==void 0)return{stack:e,id:r,glyph:p};if(p=this._tinySDF(h,e,r),p)return h.glyphs[r]=p,{stack:e,id:r,glyph:p};const x=Math.floor(r/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[x])return{stack:e,id:r,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[x]){const C=Et.loadGlyphRange(e,x,this.url,this.requestManager);h.requests[x]=C}const T=yield h.requests[x];for(const C in T)this._doesCharSupportLocalGlyph(+C)||(h.glyphs[+C]=T[+C]);return h.ranges[x]=!0,{stack:e,id:r,glyph:T[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,h){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let x=e.tinySDF;if(!x){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),x=e.tinySDF=new Et.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:C})}const T=x.draw(String.fromCharCode(h));return{id:h,bitmap:new l.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}Et.loadGlyphRange=function(v,e,r,h){return l._(this,void 0,void 0,function*(){const p=256*e,x=p+255,T=h.transformRequest(r.replace("{fontstack}",v).replace("{range}",`${p}-${x}`),"Glyphs"),C=yield l.n(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${x}`);const I={};for(const R of l.o(C.data))I[R.id]=R;return I})},Et.TinySDF=class{constructor({fontSize:v=24,buffer:e=3,radius:r=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:T="normal"}={}){this.buffer=e,this.cutoff=h,this.radius=r;const C=this.size=v+4*e,I=this._createCanvas(C),R=this.ctx=I.getContext("2d",{willReadFrequently:!0});R.font=`${T} ${x} ${v}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(v){const e=document.createElement("canvas");return e.width=e.height=v,e}draw(v){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(v),T=Math.ceil(r),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),I=Math.min(this.size-this.buffer,T+Math.ceil(h)),R=C+2*this.buffer,F=I+2*this.buffer,j=Math.max(R*F,0),N=new Uint8ClampedArray(j),Z={data:N,width:R,height:F,glyphWidth:C,glyphHeight:I,glyphTop:T,glyphLeft:0,glyphAdvance:e};if(C===0||I===0)return Z;const{ctx:K,buffer:se,gridInner:oe,gridOuter:ae}=this;K.clearRect(se,se,C,I),K.fillText(v,se,se+T);const ue=K.getImageData(se,se,C,I);ae.fill(ht,0,j),oe.fill(0,0,j);for(let fe=0;fe<I;fe++)for(let de=0;de<C;de++){const _e=ue.data[4*(fe*C+de)+3]/255;if(_e===0)continue;const we=(fe+se)*R+de+se;if(_e===1)ae[we]=0,oe[we]=ht;else{const pe=.5-_e;ae[we]=pe>0?pe*pe:0,oe[we]=pe<0?pe*pe:0}}At(ae,0,0,R,F,R,this.f,this.v,this.z),At(oe,se,se,C,I,R,this.f,this.v,this.z);for(let fe=0;fe<j;fe++){const de=Math.sqrt(ae[fe])-Math.sqrt(oe[fe]);N[fe]=Math.round(255-255*(de/this.radius+this.cutoff))}return Z}};class jt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,r){return l.B(e.expression.evaluate(r))}interpolate(e,r,h){return{x:l.C.number(e.x,r.x,h),y:l.C.number(e.y,r.y,h),z:l.C.number(e.z,r.z,h)}}}let Ni;class ni extends l.E{constructor(e){super(),Ni=Ni||new l.r({anchor:new l.D(l.v.light.anchor),position:new jt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.t(Ni),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(l.x,e,r))for(const h in e){const p=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,h){return(!h||h.validate!==!1)&&l.y(this,e.call(l.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const ri=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class It extends l.E{constructor(e){super(),this._transitionable=new l.t(ri),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0))}setSky(e,r={}){if(!this._validate(l.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const h in e){const p=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),p):this._transitionable.setValue(h,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,h={}){return h?.validate!==!1&&l.y(this,e.call(l.z,l.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class pr{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const h=e.join(",")+String(r);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,r)),this.dashEntry[h]}getDashRanges(e,r,h){const p=[];let x=e.length%2==1?-e[e.length-1]*h:0,T=e[0]*h,C=!0;p.push({left:x,right:T,isDash:C,zeroLength:e[0]===0});let I=e[0];for(let R=1;R<e.length;R++){C=!C;const F=e[R];x=I*h,I+=F,T=I*h,p.push({left:x,right:T,isDash:C,zeroLength:F===0})}return p}addRoundDash(e,r,h){const p=r/2;for(let x=-h;x<=h;x++){const T=this.width*(this.nextRow+h+x);let C=0,I=e[C];for(let R=0;R<this.width;R++){R/I.right>1&&(I=e[++C]);const F=Math.abs(R-I.left),j=Math.abs(R-I.right),N=Math.min(F,j);let Z;const K=x/h*(p+1);if(I.isDash){const se=p-Math.abs(K);Z=Math.sqrt(N*N+se*se)}else Z=p-Math.sqrt(N*N+K*K);this.data[T+R]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e){for(let C=e.length-1;C>=0;--C){const I=e[C],R=e[C+1];I.zeroLength?e.splice(C,1):R&&R.isDash===I.isDash&&(R.left=I.left,e.splice(C,1))}const r=e[0],h=e[e.length-1];r.isDash===h.isDash&&(r.left=h.left-this.width,h.right=r.right+this.width);const p=this.width*this.nextRow;let x=0,T=e[x];for(let C=0;C<this.width;C++){C/T.right>1&&(T=e[++x]);const I=Math.abs(C-T.left),R=Math.abs(C-T.right),F=Math.min(I,R);this.data[p+C]=Math.max(0,Math.min(255,(T.isDash?F:-F)+128))}}addDash(e,r){const h=r?7:0,p=2*h+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let C=0;C<e.length;C++)x+=e[C];if(x!==0){const C=this.width/x,I=this.getDashRanges(e,this.width,C);r?this.addRoundDash(I,C,h):this.addRegularDash(I)}const T={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:x};return this.nextRow+=p,this.dirty=!0,T}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Yt="maplibre_preloaded_worker_pool";class pi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<pi.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const Jt=Math.floor(X.hardwareConcurrency/2);let Xi,ji;function Ai(){return Xi||(Xi=new pi),Xi}pi.workerCount=l.H(globalThis)?Math.max(Math.min(Jt,3),1):1;class oi{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const h=this.workerPool.acquire(r);for(let p=0;p<h.length;p++){const x=new l.J(h[p],r);x.name=`Worker ${p}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const h=[];for(const p of this.actors)h.push(p.sendAsync({type:e,data:r}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const h of this.actors)h.registerMessageHandler(e,r)}}function On(){return ji||(ji=new oi(Ai(),l.K),ji.registerMessageHandler("GR",(v,e,r)=>l.m(e,r))),ji}function fr(v,e){const r=l.L();return l.M(r,r,[1,1,0]),l.N(r,r,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?l.O(r,r,v.calculatePosMatrix(e.toUnwrapped())):r}function dn(v,e,r,h,p,x,T){var C;const I=function(N,Z,K){if(N)for(const se of N){const oe=Z[se];if(oe&&oe.source===K&&oe.type==="fill-extrusion")return!0}else for(const se in Z){const oe=Z[se];if(oe.source===K&&oe.type==="fill-extrusion")return!0}return!1}((C=p?.layers)!==null&&C!==void 0?C:null,e,v.id),R=x.maxPitchScaleFactor(),F=v.tilesIn(h,R,I);F.sort(Fr);const j=[];for(const N of F)j.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(e,r,v._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,p,x,R,fr(v.transform,N.tileID),T?(Z,K)=>T(N.tileID,Z,K):void 0)});return function(N,Z){for(const K in N)for(const se of N[K])er(se,Z);return N}(function(N){const Z={},K={};for(const se of N){const oe=se.queryResults,ae=se.wrappedTileID,ue=K[ae]=K[ae]||{};for(const fe in oe){const de=oe[fe],_e=ue[fe]=ue[fe]||{},we=Z[fe]=Z[fe]||[];for(const pe of de)_e[pe.featureIndex]||(_e[pe.featureIndex]=!0,we.push(pe))}}return Z}(j),v)}function Fr(v,e){const r=v.tileID,h=e.tileID;return r.overscaledZ-h.overscaledZ||r.canonical.y-h.canonical.y||r.wrap-h.wrap||r.canonical.x-h.canonical.x}function er(v,e){const r=v.feature,h=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=h}function ye(v,e,r){return l._(this,void 0,void 0,function*(){let h=v;if(v.url?h=(yield l.j(e.transformRequest(v.url,"Source"),r)).data:yield X.frameAsync(r),!h)return null;const p=l.Q(l.e(h,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(p.vectorLayerIds=h.vector_layers.map(x=>x.id)),p})}class Pe{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}extend(e){const r=this._sw,h=this._ne;let p,x;if(e instanceof l.S)p=e,x=e;else{if(!(e instanceof Pe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pe.convert(e)):this.extend(l.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.S.convert(e)):this;if(p=e._sw,x=e._ne,!p||!x)return this}return r||h?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new l.S(p.lng,p.lat),this._ne=new l.S(x.lng,x.lat)),this}getCenter(){return new l.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.S(this.getWest(),this.getNorth())}getSouthEast(){return new l.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:h}=l.S.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(e){return e instanceof Pe?e:e&&new Pe(e)}static fromLngLat(e,r=0){const h=360*r/40075017,p=h/Math.cos(Math.PI/180*e.lat);return new Pe(new l.S(e.lng-p,e.lat-h),new l.S(e.lng+p,e.lat+h))}adjustAntiMeridian(){const e=new l.S(this._sw.lng,this._sw.lat),r=new l.S(this._ne.lng,this._ne.lat);return new Pe(e,e.lng>r.lng?new l.S(r.lng+360,r.lat):r)}}class Ke{constructor(e,r,h){this.bounds=Pe.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),h=Math.floor(l.V(this.bounds.getWest())*r),p=Math.floor(l.U(this.bounds.getNorth())*r),x=Math.ceil(l.V(this.bounds.getEast())*r),T=Math.ceil(l.U(this.bounds.getSouth())*r);return e.x>=h&&e.x<x&&e.y>=p&&e.y<T}}class ct extends l.E{constructor(e,r,h,p){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.Q(r,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ye(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new Ke(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};h.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((x,T)=>{e.reloadPromise={resolve:x,reject:T}})}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const x=yield e.actor.sendAsync({type:p,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,x)}catch(x){if(delete e.abortController,e.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class at extends l.E{constructor(e,r,h,p){super(),this.id=e,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},r),l.e(this,l.Q(r,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield ye(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(l.e(this,r),r.bounds&&(this.tileBounds=new Ke(r.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new l.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const h=yield xe.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const p=this.map.painter.context,x=p.gl,T=h.data;e.texture=this.map.painter.getTileTexture(T.width),e.texture?e.texture.update(T,{useMipmap:!0}):(e.texture=new l.T(p,T,x.RGBA,{useMipmap:!0}),e.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class nt extends at{constructor(e,r,h,p){super(e,r,h,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield xe.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const x=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const T=l.b(x)&&l.W()?x:yield this.readImageNow(x),C={type:this.type,uid:e.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:C});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}})}readImageNow(e){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.X()){const r=e.width+2,h=e.height+2;try{return new l.R({width:r,height:h},yield l.Y(e,-1,-1,r,h))}catch{}}return X.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,h=Math.pow(2,r.z),p=(r.x-1+h)%h,x=r.x===0?e.wrap-1:e.wrap,T=(r.x+1+h)%h,C=r.x+1===h?e.wrap+1:e.wrap,I={};return I[new l.Z(e.overscaledZ,x,r.z,p,r.y).key]={backfilled:!1},I[new l.Z(e.overscaledZ,C,r.z,T,r.y).key]={backfilled:!1},r.y>0&&(I[new l.Z(e.overscaledZ,x,r.z,p,r.y-1).key]={backfilled:!1},I[new l.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new l.Z(e.overscaledZ,C,r.z,T,r.y-1).key]={backfilled:!1}),r.y+1<h&&(I[new l.Z(e.overscaledZ,x,r.z,p,r.y+1).key]={backfilled:!1},I[new l.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new l.Z(e.overscaledZ,C,r.z,T,r.y+1).key]={backfilled:!1}),I}unloadTile(e){return l._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class xt extends l.E{constructor(e,r,h,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(p),this._data=r.data,this._options=l.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:l.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:l.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.$/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return l._(this,void 0,void 0,function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(r=>r.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return l._(this,void 0,void 0,function*(){const e=new Pe,r=yield this.getData();let h;switch(r.type){case"FeatureCollection":h=r.features.map(p=>this.getCoordinatesFromGeometry(p.geometry)).flat(1/0);break;case"Feature":h=this.getCoordinatesFromGeometry(r.geometry);break;default:h=this.getCoordinatesFromGeometry(r)}if(h.length==0)return e;for(let p=0;p<h.length-1;p+=2)e.extend([h[p],h[p+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:h}})}_updateWorkerData(e){return l._(this,void 0,void 0,function*(){const r=l.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(X.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));let p=null;h.resourceTiming&&h.resourceTiming[this.id]&&(p=h.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&l.e(x,{resourceTiming:p}),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(h))}})}loaded(){return this._pendingLoads===0}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:r,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,r==="RT")})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class _t extends l.E{constructor(e,r,h,p){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=r}load(e){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield xe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new l.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(l.a0.fromLngLat);var h;return this.tileID=function(p){const x=l.a1.fromPoints(p),T=x.width(),C=x.height(),I=Math.max(T,C),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),F=Math.pow(2,R);return new l.a3(R,Math.floor((x.minX+x.maxX)/2*F),Math.floor((x.minY+x.maxY)/2*F))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(p=>this.tileID.getTilePoint(p)._round()),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new l.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,h=!0)}h&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:h,maxX:p,maxY:x}=l.a1.fromPoints(e),T={};for(let C=0;C<=l.a2;C++){const I=Math.pow(2,C),R=Math.floor(r*I),F=Math.floor(h*I),j=Math.floor(p*I),N=Math.floor(x*I);T[C]={minTileX:R,minTileY:F,maxTileX:j,maxTileY:N}}return T}}class wt extends _t{constructor(e,r,h,p){super(e,r,h,p),this.roundZoom=!0,this.type="video",this.options=r}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield l.a4(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new l.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new l.k(new l.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,h=!0)}h&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dt extends _t{constructor(e,r,h,p){super(e,r,h,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(T=>typeof T!="number"))||this.fire(new l.k(new l.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a5(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new l.k(new l.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,h=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(r,this.canvas,h.RGBA,{premultiply:!0});let p=!1;for(const x in this.tiles){const T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const $t={},Pt=v=>{switch(v){case"geojson":return xt;case"image":return _t;case"raster":return at;case"raster-dem":return nt;case"vector":return ct;case"video":return wt;case"canvas":return dt}return $t[v]},Ft="RTLPluginLoaded";class Qt extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=On()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,function*(r,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=X.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(Ft))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let si=null;function yi(){return si||(si=new Qt),si}class vi{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a6(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,x){const T={};if(!x)return T;for(const C of p){const I=C.layerIds.map(R=>x.getLayer(R)).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(R=>I.filter(F=>F.id===R)[0]));for(const R of I)T[R.id]=C}}return T}(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const x=this.buckets[p];if(x instanceof l.a8){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const x=this.buckets[p];if(x instanceof l.a8&&x.hasRTLText){this.hasRTLText=!0,yi().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const x=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(p).queryRadius(x))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,h,p,x,T,C,I,R,F,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:x,scale:T,tileSize:this.tileSize,pixelPosMatrix:F,transform:I,params:C,queryPadding:this.queryPadding*R,getElevation:j},e,r,h):{}}querySourceFeatures(e,r){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),x=r&&r.sourceLayer?r.sourceLayer:"",T=p._geojsonTileLayer||p[x];if(!T)return;const C=l.a9(r&&r.filter),{z:I,x:R,y:F}=this.tileID.canonical,j={z:I,x:R,y:F};for(let N=0;N<T.length;N++){const Z=T.feature(N);if(C.needGeometry){const oe=l.aa(Z,!0);if(!C.filter(new l.F(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!C.filter(new l.F(this.tileID.overscaledZ),Z))continue;const K=h.getId(Z,x),se=new l.ab(Z,I,R,F,K);se.tile=j,e.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const h=l.ac(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const x=this.expirationTime-r;x?this.expirationTime=h+Math.max(x,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!r.style.hasLayer(p))continue;const x=this.buckets[p],T=x.layers[0].sourceLayer||"_geojsonTileLayer",C=h[T],I=e[T];if(!C||!I||Object.keys(I).length===0)continue;x.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=r&&r.style&&r.style.getLayer(p);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<X.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=X.now()+e}setDependencies(e,r){const h={};for(const p of r)h[p]=!0;this.dependencies[e]=h}hasDependency(e,r){for(const h of e){const p=this.dependencies[h];if(p){for(const x of r)if(p[x])return!0}}return!1}}class In{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,h){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const x={value:r,timeout:void 0};if(h!==void 0&&(x.timeout=setTimeout(()=>{this.remove(e,x)},h)),this.data[p].push(x),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const h=e.wrapped().key,p=r===void 0?0:this.data[h].indexOf(r),x=this.data[h][p];return this.data[h].splice(p,1),x.timeout&&clearTimeout(x.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const h in this.data)for(const p of this.data[h])e(p.value)||r.push(p);for(const h of r)this.remove(h.value.tileID,h)}}class An{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,h){const p=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},l.e(this.stateChanges[e][p],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(const x in this.state[e])x!==p&&(this.deletedStates[e][x]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const x in this.state[e][p])h[x]||(this.deletedStates[e][p][x]=null)}else for(const x in h)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][x]===null&&delete this.deletedStates[e][p][x]}removeFeatureState(e,r,h){if(this.deletedStates[e]===null)return;const p=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&r!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][h]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(h in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][h]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,r){const h=String(r),p=l.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const x=this.deletedStates[e][r];if(x===null)return{};for(const T in x)delete p[T]}return p}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const x={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),l.e(this.state[p][T],this.stateChanges[p][T]),x[T]=this.state[p][T];h[p]=x}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const x={};if(this.deletedStates[p]===null)for(const T in this.state[p])x[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const C of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][C];x[T]=this.state[p][T]}h[p]=h[p]||{},l.e(h[p],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in e)e[p].setFeatureState(h,r)}}const wn=89.25;function Ee(v,e){const r=l.ag(e.lat,-l.ah,l.ah);return new l.P(l.V(e.lng)*v,l.U(r)*v)}function J(v,e){return new l.a0(e.x/v,e.y/v).toLngLat()}function Q(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(l.ad(90-v.pitch)),Math.tan(l.ad(wn-v.pitch)))}function ie(v,e){const r=v.canonical,h=e/l.ae(r.z),p=r.x+Math.pow(2,r.z)*v.wrap,x=l.af(new Float64Array(16));return l.M(x,x,[p*h,r.y*h,0]),l.N(x,x,[h/l.$,h/l.$,1]),x}function he(v,e,r,h,p){const x=l.a0.fromLngLat(v,e),T=p*l.ai(1,v.lat),C=T*Math.cos(l.ad(r)),I=Math.sqrt(T*T-C*C),R=I*Math.sin(l.ad(-h)),F=I*Math.cos(l.ad(-h));return new l.a0(x.x+R,x.y+F,x.z+C)}function Te(v,e,r){const h=e.intersectsFrustum(v);if(!r||h===0)return h;const p=e.intersectsPlane(r);return p===0?0:h===2&&p===2?2:1}function Le(v,e,r){let h=0;const p=(r-e)/10;for(let x=0;x<10;x++)h+=p*Math.pow(Math.cos(e+(x+.5)/10*(r-e)),v);return h}function je(v,e){return function(r,h,p,x,T){const C=2*((v-1)/l.aj(Math.cos(l.ad(wn-T))/Math.cos(l.ad(wn)))-1),I=Math.acos(p/x),R=2*Le(C-1,0,l.ad(T/2)),F=Math.min(l.ad(wn),I+l.ad(T/2)),j=Le(C-1,Math.min(F,I-l.ad(T/2)),F),N=Math.atan(h/p),Z=Math.hypot(h,p);let K=r;return K+=l.aj(x/Z/Math.max(.5,Math.cos(l.ad(T/2)))),K+=C*l.aj(Math.cos(N))/2,K-=l.aj(Math.max(1,j/R/e))/2,K}}const Ie=je(9.314,3);function He(v,e){const r=(e.roundZoom?Math.round:Math.floor)(v.zoom+l.aj(v.tileSize/e.tileSize));return Math.max(0,r)}function qe(v,e){const r=v.getCameraFrustum(),h=v.getClippingPlane(),p=v.screenPointToMercatorCoordinate(v.getCameraPoint()),x=l.a0.fromLngLat(v.center,v.elevation);p.z=x.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const T=v.getCoveringTilesDetailsProvider(),C=T.allowVariableZoom(v,e),I=He(v,e),R=e.minzoom||0,F=e.maxzoom!==void 0?e.maxzoom:v.maxZoom,j=Math.min(Math.max(0,I),F),N=Math.pow(2,j),Z=[N*p.x,N*p.y,0],K=[N*x.x,N*x.y,0],se=Math.hypot(x.x-p.x,x.y-p.y),oe=Math.abs(x.z-p.z),ae=Math.hypot(se,oe),ue=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),fe=[],de=[];if(v.renderWorldCopies&&T.allowWorldCopies())for(let _e=1;_e<=3;_e++)fe.push(ue(-_e)),fe.push(ue(_e));for(fe.push(ue(0));fe.length>0;){const _e=fe.pop(),we=_e.x,pe=_e.y;let Ae=_e.fullyVisible;const $e={x:we,y:pe,z:_e.zoom},De=T.getTileBoundingVolume($e,_e.wrap,v.elevation,e);if(!Ae){const gt=Te(r,De,h);if(gt===0)continue;Ae=gt===2}const Be=T.distanceToTile2d(p.x,p.y,$e,De);let Ve=I;C&&(Ve=(e.calculateTileZoom||Ie)(v.zoom+l.aj(v.tileSize/e.tileSize),Be,oe,ae,v.fov)),Ve=(e.roundZoom?Math.round:Math.floor)(Ve),Ve=Math.max(0,Ve);const vt=Math.min(Ve,F);if(_e.wrap=T.getWrap(x,$e,_e.wrap),_e.zoom>=vt){if(_e.zoom<R)continue;const gt=j-_e.zoom,rt=Z[0]-.5-(we<<gt),kt=Z[1]-.5-(pe<<gt),gi=e.reparseOverscaled?Math.max(_e.zoom,Ve):_e.zoom;de.push({tileID:new l.Z(_e.zoom===F?gi:_e.zoom,_e.wrap,_e.zoom,we,pe),distanceSq:l.ak([K[0]-.5-we,K[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(rt*rt+kt*kt)})}else for(let gt=0;gt<4;gt++)fe.push({zoom:_e.zoom+1,x:(we<<1)+gt%2,y:(pe<<1)+(gt>>1),wrap:_e.wrap,fullyVisible:Ae})}return de.sort((_e,we)=>_e.distanceSq-we.distanceSq).map(_e=>_e.tileID)}const Re=l.a1.fromPoints([new l.P(0,0),new l.P(l.$,l.$)]);class Je extends l.E{constructor(e,r,h){super(),this.id=e,this.dispatcher=h,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,x,T,C)=>{const I=new(Pt(x.type))(p,x,T,C);if(I.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${I.id}`);return I})(e,r,h,this),this._tiles={},this._cache=new In(0,p=>this._unloadTile(p)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new An,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,h){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,h)}catch(p){e.state="errored",p.status!==404?this._source.fire(new l.k(p,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const h=this._tiles[r];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Se).map(e=>e.key)}getRenderableIds(e){const r=[];for(const h in this._tiles)this._isIdRenderable(h,e)&&r.push(this._tiles[h]);return e?r.sort((h,p)=>{const x=h.tileID,T=p.tileID,C=new l.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians),I=new l.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians);return x.overscaledZ-T.overscaledZ||I.y-C.y||I.x-C.x}).map(h=>h.tileID.key):r.map(h=>h.tileID).sort(Se).map(h=>h.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return l._(this,void 0,void 0,function*(){const h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=r),yield this._loadTile(h,e,r))})}_tileLoaded(e,r,h){e.timeAdded=X.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const x=r[p];if(e.neighboringTiles&&e.neighboringTiles[x]){const T=this.getTileByID(x);h(e,T),h(T,e)}}function h(p,x){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=x.tileID.canonical.x-p.tileID.canonical.x;const C=x.tileID.canonical.y-p.tileID.canonical.y,I=Math.pow(2,p.tileID.canonical.z),R=x.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+I)===1?T+=I:Math.abs(T-I)===1&&(T-=I)),x.dem&&p.dem&&(p.dem.backfillBorder(x.dem,T,C),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,h,p){for(const x in this._tiles){let T=this._tiles[x];if(p[x]||!T.hasData()||T.tileID.overscaledZ<=r||T.tileID.overscaledZ>h)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>r+1;){const R=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[R.key],T&&T.hasData()&&(C=R)}let I=C;for(;I.overscaledZ>r;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]||e[I.canonical.key]){p[C.key]=C;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=r?h:null}for(let h=e.overscaledZ-1;h>=r;h--){const p=e.scaledTo(h),x=this._getLoadedTile(p);if(x)return x}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(r*h*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(x)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const h={};for(const p in this._tiles){const x=this._tiles[p];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+r),h[x.tileID.key]=x}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,r,h,p,x,T){const C={},I={},R=Object.keys(e),F=X.now();for(const j of R){const N=e[j],Z=this._tiles[j];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=F)continue;const K=this.findLoadedParent(N,r),se=this.findLoadedSibling(N),oe=K||se||null;oe&&(this._addTile(oe.tileID),C[oe.tileID.key]=oe.tileID),I[j]=N}this._retainLoadedChildren(I,p,h,e);for(const j in C)e[j]||(this._coveredTiles[j]=!0,e[j]=C[j]);if(T){const j={},N={};for(const Z of x)this._tiles[Z.key].hasData()?j[Z.key]=Z:N[Z.key]=Z;for(const Z in N){const K=N[Z].children(this._source.maxzoom);this._tiles[K[0].key]&&this._tiles[K[1].key]&&this._tiles[K[2].key]&&this._tiles[K[3].key]&&(j[K[0].key]=e[K[0].key]=K[0],j[K[1].key]=e[K[1].key]=K[1],j[K[2].key]=e[K[2].key]=K[2],j[K[3].key]=e[K[3].key]=K[3],delete N[Z])}for(const Z in N){const K=N[Z],se=this.findLoadedParent(K,this._source.minzoom),oe=this.findLoadedSibling(K),ae=se||oe||null;if(ae){j[ae.tileID.key]=e[ae.tileID.key]=ae.tileID;for(const ue in j)j[ue].isChildOf(ae.tileID)&&delete j[ue]}}for(const Z in this._tiles)j[Z]||(this._coveredTiles[Z]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Z(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(h=qe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter(F=>this._source.hasTile(F)))):h=[];const p=He(e,this._source),x=Math.max(p-Je.maxOverzooming,this._source.minzoom),T=Math.max(p+Je.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const j of h)if(j.canonical.z>this._source.minzoom){const N=j.scaledTo(j.canonical.z-1);F[N.key]=N;const Z=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));F[Z.key]=Z}h=h.concat(Object.values(F))}const C=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(h,p);Tt(this._source.type)&&this._updateCoveredAndRetainedTiles(I,x,T,p,h,r);for(const F in I)this._tiles[F].clearFadeHold();const R=l.al(this._tiles,I);for(const F of R){const j=this._tiles[F];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var h;const p={},x={},T=Math.max(r-Je.maxOverzooming,this._source.minzoom),C=Math.max(r+Je.maxUnderzooming,this._source.minzoom),I={};for(const R of e){const F=this._addTile(R);p[R.key]=R,F.hasData()||r<this._source.maxzoom&&(I[R.key]=R)}this._retainLoadedChildren(I,r,C,p);for(const R of e){let F=this._tiles[R.key];if(F.hasData())continue;if(r+1>this._source.maxzoom){const N=R.children(this._source.maxzoom)[0],Z=this.getTile(N);if(Z&&Z.hasData()){p[N.key]=N;continue}}else{const N=R.children(this._source.maxzoom);if(p[N[0].key]&&p[N[1].key]&&p[N[2].key]&&p[N[3].key])continue}let j=F.wasRequested();for(let N=R.overscaledZ-1;N>=T;--N){const Z=R.scaledTo(N);if(x[Z.key])break;if(x[Z.key]=!0,F=this.getTile(Z),!F&&j&&(F=this._addTile(Z)),F){const K=F.hasData();if((K||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||j)&&(p[Z.key]=Z),j=F.wasRequested(),K)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let h,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}r.push(p.key);const x=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;p=x}for(const x of r)this._loadedParentTiles[x]=h}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,h=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=h}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const h=r;return r||(r=new vi(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,h||this._source.fire(new l.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const h=r.getExpiryTimeout();h&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},h))}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some(h=>h.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,h){const p=[],x=this.transform;if(!x)return p;const T=x.getCoveringTilesDetailsProvider().allowWorldCopies(),C=h?x.getCameraQueryGeometry(e):e,I=Z=>x.screenPointToMercatorCoordinate(Z,this.terrain),R=this.transformBbox(e,I,!T),F=this.transformBbox(C,I,!T),j=this.getIds(),N=l.a1.fromPoints(F);for(let Z=0;Z<j.length;Z++){const K=this._tiles[j[Z]];if(K.holdingForFade())continue;const se=T?[K.tileID]:[K.tileID.unwrapTo(-1),K.tileID.unwrapTo(0)],oe=Math.pow(2,x.zoom-K.tileID.overscaledZ),ae=r*K.queryPadding*l.$/K.tileSize/oe;for(const ue of se){const fe=N.map(de=>ue.getTilePoint(new l.a0(de.x,de.y)));if(fe.expandBy(ae),fe.intersects(Re)){const de=R.map(we=>ue.getTilePoint(we)),_e=F.map(we=>ue.getTilePoint(we));p.push({tile:K,tileID:T?ue:ue.unwrapTo(0),queryGeometry:de,cameraQueryGeometry:_e,scale:oe})}}}return p}transformBbox(e,r,h){let p=e.map(r);if(h){const x=l.a1.fromPoints(e);x.shrinkBy(.001*Math.min(x.width(),x.height()));const T=x.map(r);l.a1.fromPoints(p).covers(T)||(p=p.map(C=>C.x>.5?new l.a0(C.x-1,C.y,C.z):C))}return p}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(h=>this._tiles[h].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Tt(this._source.type)){const e=X.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,h){this._state.updateState(e=e||"_geojsonTileLayer",r,h)}removeFeatureState(e,r,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,h)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,h){const p=this._tiles[e];p&&p.setDependencies(r,h)}reloadTilesForDependencies(e,r){for(const h in this._tiles)this._tiles[h].hasDependency(e,r)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(e,r))}}function Se(v,e){const r=Math.abs(2*v.wrap)-+(v.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return v.overscaledZ-e.overscaledZ||h-r||e.canonical.y-v.canonical.y||e.canonical.x-v.canonical.x}function Tt(v){return v==="raster"||v==="image"||v==="video"}Je.maxOverzooming=10,Je.maxUnderzooming=3;class Wt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ag(e,0,1);let r=1,h=this._distances[r];const p=e*this.paddedLength+this.padding;for(;h<p&&r<this._distances.length;)h=this._distances[++r];const x=r-1,T=this._distances[x],C=h-T,I=C>0?(p-T)/C:0;return this.points[x].mult(1-I).add(this.points[r].mult(I))}}function Ct(v,e){let r=!0;return v==="always"||v!=="never"&&e!=="never"||(r=!1),r}class Bt{constructor(e,r,h){const p=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(r/h);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,h,p,x){this._forEachCell(r,h,p,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(x)}insertCircle(e,r,h,p){this._forEachCell(r-p,h-p,r+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(h),this.circles.push(p)}_insertBoxCell(e,r,h,p,x,T){this.boxCells[x].push(T)}_insertCircleCell(e,r,h,p,x,T){this.circleCells[x].push(T)}_query(e,r,h,p,x,T,C){if(h<0||e>this.width||p<0||r>this.height)return[];const I=[];if(e<=0&&r<=0&&this.width<=h&&this.height<=p){if(x)return[{key:null,x1:e,y1:r,x2:h,y2:p}];for(let R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const F=this.circles[3*R],j=this.circles[3*R+1],N=this.circles[3*R+2];I.push({key:this.circleKeys[R],x1:F-N,y1:j-N,x2:F+N,y2:j+N})}}else this._forEachCell(e,r,h,p,this._queryCell,I,{hitTest:x,overlapMode:T,seenUids:{box:{},circle:{}}},C);return I}query(e,r,h,p){return this._query(e,r,h,p,!1,null)}hitTest(e,r,h,p,x,T){return this._query(e,r,h,p,!0,x,T).length>0}hitTestCircle(e,r,h,p,x){const T=e-h,C=e+h,I=r-h,R=r+h;if(C<0||T>this.width||R<0||I>this.height)return!1;const F=[];return this._forEachCell(T,I,C,R,this._queryCellCircle,F,{hitTest:!0,overlapMode:p,circle:{x:e,y:r,radius:h},seenUids:{box:{},circle:{}}},x),F.length>0}_queryCell(e,r,h,p,x,T,C,I){const{seenUids:R,hitTest:F,overlapMode:j}=C,N=this.boxCells[x];if(N!==null){const K=this.bboxes;for(const se of N)if(!R.box[se]){R.box[se]=!0;const oe=4*se,ae=this.boxKeys[se];if(e<=K[oe+2]&&r<=K[oe+3]&&h>=K[oe+0]&&p>=K[oe+1]&&(!I||I(ae))&&(!F||!Ct(j,ae.overlapMode))&&(T.push({key:ae,x1:K[oe],y1:K[oe+1],x2:K[oe+2],y2:K[oe+3]}),F))return!0}}const Z=this.circleCells[x];if(Z!==null){const K=this.circles;for(const se of Z)if(!R.circle[se]){R.circle[se]=!0;const oe=3*se,ae=this.circleKeys[se];if(this._circleAndRectCollide(K[oe],K[oe+1],K[oe+2],e,r,h,p)&&(!I||I(ae))&&(!F||!Ct(j,ae.overlapMode))){const ue=K[oe],fe=K[oe+1],de=K[oe+2];if(T.push({key:ae,x1:ue-de,y1:fe-de,x2:ue+de,y2:fe+de}),F)return!0}}}return!1}_queryCellCircle(e,r,h,p,x,T,C,I){const{circle:R,seenUids:F,overlapMode:j}=C,N=this.boxCells[x];if(N!==null){const K=this.bboxes;for(const se of N)if(!F.box[se]){F.box[se]=!0;const oe=4*se,ae=this.boxKeys[se];if(this._circleAndRectCollide(R.x,R.y,R.radius,K[oe+0],K[oe+1],K[oe+2],K[oe+3])&&(!I||I(ae))&&!Ct(j,ae.overlapMode))return T.push(!0),!0}}const Z=this.circleCells[x];if(Z!==null){const K=this.circles;for(const se of Z)if(!F.circle[se]){F.circle[se]=!0;const oe=3*se,ae=this.circleKeys[se];if(this._circlesCollide(K[oe],K[oe+1],K[oe+2],R.x,R.y,R.radius)&&(!I||I(ae))&&!Ct(j,ae.overlapMode))return T.push(!0),!0}}}_forEachCell(e,r,h,p,x,T,C,I){const R=this._convertToXCellCoord(e),F=this._convertToYCellCoord(r),j=this._convertToXCellCoord(h),N=this._convertToYCellCoord(p);for(let Z=R;Z<=j;Z++)for(let K=F;K<=N;K++)if(x.call(this,e,r,h,p,this.xCellCount*K+Z,T,C,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,h,p,x,T){const C=p-e,I=x-r,R=h+T;return R*R>C*C+I*I}_circleAndRectCollide(e,r,h,p,x,T,C){const I=(T-p)/2,R=Math.abs(e-(p+I));if(R>I+h)return!1;const F=(C-x)/2,j=Math.abs(r-(x+F));if(j>F+h)return!1;if(R<=I||j<=F)return!0;const N=R-I,Z=j-F;return N*N+Z*Z<=h*h}}function ei(v,e,r){const h=l.L();if(!v){const{vecSouth:j,vecEast:N}=Ui(e),Z=k();Z[0]=N[0],Z[1]=N[1],Z[2]=j[0],Z[3]=j[1],p=Z,(F=(T=(x=Z)[0])*(R=x[3])-(I=x[2])*(C=x[1]))&&(p[0]=R*(F=1/F),p[1]=-C*F,p[2]=-I*F,p[3]=T*F),h[0]=Z[0],h[1]=Z[1],h[4]=Z[2],h[5]=Z[3]}var p,x,T,C,I,R,F;return l.N(h,h,[1/r,1/r,1]),h}function Yi(v,e,r,h){if(v){const p=l.L();if(!e){const{vecSouth:x,vecEast:T}=Ui(r);p[0]=T[0],p[1]=T[1],p[4]=x[0],p[5]=x[1]}return l.N(p,p,[h,h,1]),p}return r.pixelsToClipSpaceMatrix}function Ui(v){const e=Math.cos(v.rollInRadians),r=Math.sin(v.rollInRadians),h=Math.cos(v.pitchInRadians),p=Math.cos(v.bearingInRadians),x=Math.sin(v.bearingInRadians),T=l.aq();T[0]=-p*h*r-x*e,T[1]=-x*h*r+p*e;const C=l.ar(T);C<1e-9?l.as(T):l.at(T,T,1/C);const I=l.aq();I[0]=p*h*e-x*r,I[1]=x*h*e+p*r;const R=l.ar(I);return R<1e-9?l.as(I):l.at(I,I,1/R),{vecEast:I,vecSouth:T}}function Oi(v,e,r,h){let p;h?(p=[v,e,h(v,e),1],l.av(p,p,r)):(p=[v,e,0,1],So(p,p,r));const x=p[3];return{point:new l.P(p[0]/x,p[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function Nt(v,e){return .5+v/e*.5}function yt(v,e){return v.x>=-e[0]&&v.x<=e[0]&&v.y>=-e[1]&&v.y<=e[1]}function Fn(v,e,r,h,p,x,T,C,I,R,F,j,N){const Z=r?v.textSizeData:v.iconSizeData,K=l.am(Z,e.transform.zoom),se=[256/e.width*2+1,256/e.height*2+1],oe=r?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;oe.clear();const ae=v.lineVertexArray,ue=r?v.text.placedSymbolArray:v.icon.placedSymbolArray,fe=e.transform.width/e.transform.height;let de=!1;for(let _e=0;_e<ue.length;_e++){const we=ue.get(_e);if(we.hidden||we.writingMode===l.an.vertical&&!de){Bo(we.numGlyphs,oe);continue}de=!1;const pe=new l.P(we.anchorX,we.anchorY),Ae={getElevation:N,pitchedLabelPlaneMatrix:h,lineVertexArray:ae,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:pe,unwrappedTileID:I,width:R,height:F,translation:j},$e=fi(we.anchorX,we.anchorY,Ae);if(!yt($e.point,se)){Bo(we.numGlyphs,oe);continue}const De=Nt(e.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Be=l.ao(Z,K,we),Ve=x?Be*e.transform.getPitchedTextCorrection(we.anchorX,we.anchorY,I)/De:Be*De,vt=ln({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:Ve,flip:!1,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:fe,rotateToLine:C});de=vt.useVertical,(vt.notEnoughRoom||de||vt.needsFlipping&&ln({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:p,symbol:we,fontSize:Ve,flip:!0,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:fe,rotateToLine:C}).notEnoughRoom)&&Bo(we.numGlyphs,oe)}r?v.text.dynamicLayoutVertexBuffer.updateData(oe):v.icon.dynamicLayoutVertexBuffer.updateData(oe)}function ft(v,e,r,h,p,x,T,C){const I=x.glyphStartIndex+x.numGlyphs,R=x.lineStartIndex,F=x.lineStartIndex+x.lineLength,j=e.getoffsetX(x.glyphStartIndex),N=e.getoffsetX(I-1),Z=To(v*j,r,h,p,x.segment,R,F,C,T);if(!Z)return null;const K=To(v*N,r,h,p,x.segment,R,F,C,T);return K?C.projectionCache.anyProjectionOccluded?null:{first:Z,last:K}:null}function Un(v,e,r,h){return v===l.an.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*h?{useVertical:!0}:(v===l.an.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function ln(v){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:h,fontSize:p,flip:x,keepUpright:T,glyphOffsetArray:C,dynamicLayoutVertexArray:I,aspectRatio:R,rotateToLine:F}=v,j=p/24,N=h.lineOffsetX*j,Z=h.lineOffsetY*j;let K;if(h.numGlyphs>1){const se=h.glyphStartIndex+h.numGlyphs,oe=h.lineStartIndex,ae=h.lineStartIndex+h.lineLength,ue=ft(j,C,N,Z,x,h,F,e);if(!ue)return{notEnoughRoom:!0};const fe=ci(ue.first.point.x,ue.first.point.y,e,r),de=ci(ue.last.point.x,ue.last.point.y,e,r);if(T&&!x){const _e=Un(h.writingMode,fe,de,R);if(_e)return _e}K=[ue.first];for(let _e=h.glyphStartIndex+1;_e<se-1;_e++){const we=To(j*C.getoffsetX(_e),N,Z,x,h.segment,oe,ae,e,F);if(!we)return{notEnoughRoom:!0};K.push(we)}K.push(ue.last)}else{if(T&&!x){const oe=mt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ae=h.lineStartIndex+h.segment+1,ue=new l.P(e.lineVertexArray.getx(ae),e.lineVertexArray.gety(ae)),fe=mt(ue.x,ue.y,e),de=fe.signedDistanceFromCamera>0?fe.point:wo(e.tileAnchorPoint,ue,oe,1,e),_e=ci(oe.x,oe.y,e,r),we=ci(de.x,de.y,e,r),pe=Un(h.writingMode,_e,we,R);if(pe)return pe}const se=To(j*C.getoffsetX(h.glyphStartIndex),N,Z,x,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,F);if(!se||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};K=[se]}for(const se of K)l.au(I,se.point,se.angle);return{}}function wo(v,e,r,h,p){const x=v.add(v.sub(e)._unit()),T=mt(x.x,x.y,p).point,C=r.sub(T);return r.add(C._mult(h/C.mag()))}function ls(v,e,r){const h=e.projectionCache;if(h.projections[v])return h.projections[v];const p=new l.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),x=mt(p.x,p.y,e);if(x.signedDistanceFromCamera>0)return h.projections[v]=x.point,h.anyProjectionOccluded=h.anyProjectionOccluded||x.isOccluded,x.point;const T=v-r.direction;return wo(r.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(T),e.lineVertexArray.gety(T)),p,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function mt(v,e,r){const h=v+r.translation[0],p=e+r.translation[1];let x;return r.pitchWithMap?(x=Oi(h,p,r.pitchedLabelPlaneMatrix,r.getElevation),x.isOccluded=!1):(x=r.transform.projectTileCoordinates(h,p,r.unwrappedTileID,r.getElevation),x.point.x=(.5*x.point.x+.5)*r.width,x.point.y=(.5*-x.point.y+.5)*r.height),x}function ci(v,e,r,h){if(r.pitchWithMap){const p=[v,e,0,1];return l.av(p,p,h),r.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],r.unwrappedTileID,r.getElevation).point}return{x:v/r.width*2-1,y:1-e/r.height*2}}function fi(v,e,r){return r.transform.projectTileCoordinates(v,e,r.unwrappedTileID,r.getElevation)}function Br(v,e,r){return v._unit()._perp()._mult(e*r)}function Dl(v,e,r,h,p,x,T,C,I){if(C.projectionCache.offsets[v])return C.projectionCache.offsets[v];const R=r.add(e);if(v+I.direction<h||v+I.direction>=p)return C.projectionCache.offsets[v]=R,R;const F=ls(v+I.direction,C,I),j=Br(F.sub(r),T,I.direction),N=r.add(j),Z=F.add(j);return C.projectionCache.offsets[v]=l.aw(x,R,N,Z)||R,C.projectionCache.offsets[v]}function To(v,e,r,h,p,x,T,C,I){const R=h?v-e:v+e;let F=R>0?1:-1,j=0;h&&(F*=-1,j=Math.PI),F<0&&(j+=Math.PI);let N,Z=F>0?x+p:x+p+1;C.projectionCache.cachedAnchorPoint?N=C.projectionCache.cachedAnchorPoint:(N=mt(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=N);let K,se,oe=N,ae=N,ue=0,fe=0;const de=Math.abs(R),_e=[];let we;for(;ue+fe<=de;){if(Z+=F,Z<x||Z>=T)return null;ue+=fe,ae=oe,se=K;const $e={absOffsetX:de,direction:F,distanceFromAnchor:ue,previousVertex:ae};if(oe=ls(Z,C,$e),r===0)_e.push(ae),we=oe.sub(ae);else{let De;const Be=oe.sub(ae);De=Be.mag()===0?Br(ls(Z+F,C,$e).sub(oe),r,F):Br(Be,r,F),se||(se=ae.add(De)),K=Dl(Z,De,oe,x,T,se,r,C,$e),_e.push(se),we=K.sub(se)}fe=we.mag()}const pe=we._mult((de-ue)/fe)._add(se||ae),Ae=j+Math.atan2(oe.y-ae.y,oe.x-ae.x);return _e.push(pe),{point:pe,angle:I?Ae:0,path:_e}}const ui=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bo(v,e){for(let r=0;r<v;r++){const h=e.length;e.resize(h+4),e.float32.set(ui,3*h)}}function So(v,e,r){const h=e[0],p=e[1];return v[0]=r[0]*h+r[4]*p+r[12],v[1]=r[1]*h+r[5]*p+r[13],v[3]=r[3]*h+r[7]*p+r[15],v}const Tn=100;class Ka{constructor(e,r=new Bt(e.width+200,e.height+200,25),h=new Bt(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Tn,this.screenBottomBoundary=e.height+Tn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,h,p,x,T,C,I,R,F,j,N){const Z=this.projectAndGetPerspectiveRatio(e.anchorPointX+I[0],e.anchorPointY+I[1],x,F,N),K=h*Z.perspectiveRatio;let se;if(T||C)se=this._projectCollisionBox(e,K,p,x,T,C,I,Z,F,j,N);else{const we=Z.x+(j?j.x*K:0),pe=Z.y+(j?j.y*K:0);se={allPointsOccluded:!1,box:[we+e.x1*K,pe+e.y1*K,we+e.x2*K,pe+e.y2*K]}}const[oe,ae,ue,fe]=se.box,de=T?se.allPointsOccluded:Z.isOccluded;let _e=de;return _e||(_e=Z.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(oe,ae,ue,fe)),_e||r!=="always"&&this.grid.hitTest(oe,ae,ue,fe,r,R)?{box:[oe,ae,ue,fe],placeable:!1,offscreen:!1,occluded:de}:{box:[oe,ae,ue,fe],placeable:!0,offscreen:this.isOffscreen(oe,ae,ue,fe),occluded:de}}placeCollisionCircles(e,r,h,p,x,T,C,I,R,F,j,N,Z,K){const se=[],oe=new l.P(r.anchorX,r.anchorY),ae=this.getPerspectiveRatio(oe.x,oe.y,T,K),ue=(R?x*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,T)/ae:x*ae)/l.aA,fe={getElevation:K,pitchedLabelPlaneMatrix:C,lineVertexArray:h,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:Z},de=ft(ue,p,r.lineOffsetX*ue,r.lineOffsetY*ue,!1,r,!1,fe);let _e=!1,we=!1,pe=!0;if(de){const Ae=.5*j*ae+N,$e=new l.P(-100,-100),De=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Be=new Wt,Ve=de.first,vt=de.last;let gt=[];for(let gi=Ve.path.length-1;gi>=1;gi--)gt.push(Ve.path[gi]);for(let gi=1;gi<vt.path.length;gi++)gt.push(vt.path[gi]);const rt=2.5*Ae;if(R){const gi=this.projectPathToScreenSpace(gt,fe);gt=gi.some(Vi=>Vi.signedDistanceFromCamera<=0)?[]:gi.map(Vi=>Vi.point)}let kt=[];if(gt.length>0){const gi=gt[0].clone(),Vi=gt[0].clone();for(let yn=1;yn<gt.length;yn++)gi.x=Math.min(gi.x,gt[yn].x),gi.y=Math.min(gi.y,gt[yn].y),Vi.x=Math.max(Vi.x,gt[yn].x),Vi.y=Math.max(Vi.y,gt[yn].y);kt=gi.x>=$e.x&&Vi.x<=De.x&&gi.y>=$e.y&&Vi.y<=De.y?[gt]:Vi.x<$e.x||gi.x>De.x||Vi.y<$e.y||gi.y>De.y?[]:l.ax([gt],$e.x,$e.y,De.x,De.y)}for(const gi of kt){Be.reset(gi,.25*Ae);let Vi=0;Vi=Be.length<=.5*Ae?1:Math.ceil(Be.paddedLength/rt)+1;for(let yn=0;yn<Vi;yn++){const Ji=yn/Math.max(Vi-1,1),vn=Be.lerp(Ji),nn=vn.x+Tn,Qi=vn.y+Tn;se.push(nn,Qi,Ae,0);const rn=nn-Ae,wr=Qi-Ae,Di=nn+Ae,sr=Qi+Ae;if(pe=pe&&this.isOffscreen(rn,wr,Di,sr),we=we||this.isInsideGrid(rn,wr,Di,sr),e!=="always"&&this.grid.hitTestCircle(nn,Qi,Ae,e,F)&&(_e=!0,!I))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!I&&_e||!we||ae<this.perspectiveRatioCutoff?[]:se,offscreen:pe,collisionDetected:_e}}projectPathToScreenSpace(e,r){const h=function(p,x){const T=l.L();return l.ap(T,x.pitchedLabelPlaneMatrix),p.map(C=>{const I=Oi(C.x,C.y,T,x.getElevation),R=x.transform.projectTileCoordinates(I.point.x,I.point.y,x.unwrappedTileID,x.getElevation);return R.point.x=(.5*R.point.x+.5)*x.width,R.point.y=(.5*-R.point.y+.5)*x.height,R})}(e,r);return function(p){let x=0,T=0,C=0,I=0;for(let R=0;R<p.length;R++)p[R].isOccluded?(C=R+1,I=0):(I++,I>T&&(T=I,x=C));return p.slice(x,x+T)}(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],h=new l.a1;for(const j of e){const N=new l.P(j.x+Tn,j.y+Tn);h.extend(N),r.push(N)}const{minX:p,minY:x,maxX:T,maxY:C}=h,I=this.grid.query(p,x,T,C).concat(this.ignoredGrid.query(p,x,T,C)),R={},F={};for(const j of I){const N=j.key;if(R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]={}),R[N.bucketInstanceId][N.featureIndex])continue;const Z=[new l.P(j.x1,j.y1),new l.P(j.x2,j.y1),new l.P(j.x2,j.y2),new l.P(j.x1,j.y2)];l.ay(r,Z)&&(R[N.bucketInstanceId][N.featureIndex]=!0,F[N.bucketInstanceId]===void 0&&(F[N.bucketInstanceId]=[]),F[N.bucketInstanceId].push(N.featureIndex))}return F}insertCollisionBox(e,r,h,p,x,T){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:T,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,h,p,x,T){const C=h?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:x,collisionGroupID:T,overlapMode:r};for(let R=0;R<e.length;R+=4)C.insertCircle(I,e[R],e[R+1],e[R+2])}projectAndGetPerspectiveRatio(e,r,h,p,x){if(x){let T;p?(T=[e,r,p(e,r),1],l.av(T,T,x)):(T=[e,r,0,1],So(T,T,x));const C=T[3];return{x:(T[0]/C+1)/2*this.transform.width+Tn,y:(-T[1]/C+1)/2*this.transform.height+Tn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const T=this.transform.projectTileCoordinates(e,r,h,p);return{x:(T.point.x+1)/2*this.transform.width+Tn,y:(1-T.point.y)/2*this.transform.height+Tn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,h,p){const x=this.transform.projectTileCoordinates(e,r,h,p);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(e,r,h,p){return h<Tn||e>=this.screenRightBoundary||p<Tn||r>this.screenBottomBoundary}isInsideGrid(e,r,h,p){return h>=0&&e<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=l.af([]);return l.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,h,p,x,T,C,I,R,F,j){let N=1,Z=0,K=0,se=1;const oe=e.anchorPointX+C[0],ae=e.anchorPointY+C[1];if(T&&!x){const gt=this.projectAndGetPerspectiveRatio(oe+1,ae,p,R,j),rt=gt.x-I.x,kt=Math.atan((gt.y-I.y)/rt)+(rt<0?Math.PI:0),gi=Math.sin(kt),Vi=Math.cos(kt);N=Vi,Z=gi,K=-gi,se=Vi}else if(!T&&x){const gt=Ui(this.transform);N=gt.vecEast[0],Z=gt.vecEast[1],K=gt.vecSouth[0],se=gt.vecSouth[1]}let ue=I.x,fe=I.y,de=r;x&&(ue=oe,fe=ae,de=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),de*=this.transform.getPitchedTextCorrection(oe,ae,p),F||(de*=l.ag(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),F&&(ue+=N*F.x*de+K*F.y*de,fe+=Z*F.x*de+se*F.y*de);const _e=e.x1*de,we=e.x2*de,pe=(_e+we)/2,Ae=e.y1*de,$e=e.y2*de,De=(Ae+$e)/2,Be=[{offsetX:_e,offsetY:Ae},{offsetX:pe,offsetY:Ae},{offsetX:we,offsetY:Ae},{offsetX:we,offsetY:De},{offsetX:we,offsetY:$e},{offsetX:pe,offsetY:$e},{offsetX:_e,offsetY:$e},{offsetX:_e,offsetY:De}];let Ve=[];for(const{offsetX:gt,offsetY:rt}of Be)Ve.push(new l.P(ue+N*gt+K*rt,fe+Z*gt+se*rt));let vt=!1;if(x){const gt=Ve.map(rt=>this.projectAndGetPerspectiveRatio(rt.x,rt.y,p,R,j));vt=gt.some(rt=>!rt.isOccluded),Ve=gt.map(rt=>new l.P(rt.x,rt.y))}else vt=!0;return{box:l.az(Ve),allPointsOccluded:!vt}}}class Xa{constructor(e,r,h,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class No{constructor(e,r,h,p,x){this.text=new Xa(e?e.text:null,r,h,x),this.icon=new Xa(e?e.icon:null,r,p,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ya{constructor(e,r,h){this.text=e,this.icon=r,this.skipFade=h}}class mr{constructor(e,r,h,p,x){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=x}}class Ki{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:h=>h.collisionGroupID===r}}return this.collisionGroups[e]}}function Cc(v,e,r,h,p){const{horizontalAlign:x,verticalAlign:T}=l.aG(v);return new l.P(-(x-.5)*e+h[0]*p,-(T-.5)*r+h[1]*p)}class la{constructor(e,r,h,p,x){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new Ka(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Ki(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(h,p)=>r.getElevation(e,h,p):null}getBucketParts(e,r,h,p){const x=h.getBucket(r),T=h.latestFeatureIndex;if(!x||!T||r.id!==x.layerIds[0])return;const C=h.collisionBoxArray,I=x.layers[0].layout,R=x.layers[0].paint,F=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),j=h.tileSize/l.$,N=h.tileID.toUnwrapped(),Z=I.get("text-rotation-alignment")==="map",K=l.aB(h,1,this.transform.zoom),se=l.aC(this.collisionIndex.transform,h,R.get("text-translate"),R.get("text-translate-anchor")),oe=l.aC(this.collisionIndex.transform,h,R.get("icon-translate"),R.get("icon-translate-anchor")),ae=ei(Z,this.transform,K);this.retainedQueryData[x.bucketInstanceId]=new mr(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,h.tileID);const ue={bucket:x,layout:I,translationText:se,translationIcon:oe,unwrappedTileID:N,pitchedLabelPlaneMatrix:ae,scale:F,textPixelRatio:j,holdingForFade:h.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.am(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(p)for(const fe of x.sortKeyRanges){const{sortKey:de,symbolInstanceStart:_e,symbolInstanceEnd:we}=fe;e.push({sortKey:de,symbolInstanceStart:_e,symbolInstanceEnd:we,parameters:ue})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(e,r,h,p,x,T,C,I,R,F,j,N,Z,K,se,oe,ae,ue,fe,de){const _e=l.aD[e.textAnchor],we=[e.textOffset0,e.textOffset1],pe=Cc(_e,h,p,we,x),Ae=this.collisionIndex.placeCollisionBox(r,N,I,R,F,C,T,oe,j.predicate,fe,pe,de);if((!ue||this.collisionIndex.placeCollisionBox(ue,N,I,R,F,C,T,ae,j.predicate,fe,pe,de).placeable)&&Ae.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&($e=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:we,width:h,height:p,anchor:_e,textBoxScale:x,prevAnchor:$e},this.markUsedJustification(K,_e,Z,se),K.allowVerticalPlacement&&(this.markUsedOrientation(K,se,Z),this.placedOrientations[Z.crossTileID]=se),{shift:pe,placedGlyphBoxes:Ae}}}placeLayerBucketPart(e,r,h){const{bucket:p,layout:x,translationText:T,translationIcon:C,unwrappedTileID:I,pitchedLabelPlaneMatrix:R,textPixelRatio:F,holdingForFade:j,collisionBoxArray:N,partiallyEvaluatedTextSize:Z,collisionGroup:K}=e.parameters,se=x.get("text-optional"),oe=x.get("icon-optional"),ae=l.aE(x,"text-overlap","text-allow-overlap"),ue=ae==="always",fe=l.aE(x,"icon-overlap","icon-allow-overlap"),de=fe==="always",_e=x.get("text-rotation-alignment")==="map",we=x.get("text-pitch-alignment")==="map",pe=x.get("icon-text-fit")!=="none",Ae=x.get("symbol-z-order")==="viewport-y",$e=ue&&(de||!p.hasIconData()||oe),De=de&&(ue||!p.hasTextData()||se);!p.collisionArrays&&N&&p.deserializeCollisionBoxes(N);const Be=this.retainedQueryData[p.bucketInstanceId].tileID,Ve=this._getTerrainElevationFunc(Be),vt=this.transform.getFastPathSimpleProjectionMatrix(Be),gt=(rt,kt,gi)=>{var Vi,yn;if(r[rt.crossTileID])return;if(j)return void(this.placements[rt.crossTileID]=new Ya(!1,!1,!1));let Ji=!1,vn=!1,nn=!0,Qi=null,rn={box:null,placeable:!1,offscreen:null,occluded:!1},wr={placeable:!1},Di=null,sr=null,Tr=null,Aa=0,La=0,ka=0;kt.textFeatureIndex?Aa=kt.textFeatureIndex:rt.useRuntimeCollisionCircles&&(Aa=rt.featureIndex),kt.verticalTextFeatureIndex&&(La=kt.verticalTextFeatureIndex);const Ts=kt.textBox;if(Ts){const ro=zn=>{let un=l.an.horizontal;if(p.allowVerticalPlacement&&!zn&&this.prevPlacement){const qr=this.prevPlacement.placedOrientations[rt.crossTileID];qr&&(this.placedOrientations[rt.crossTileID]=qr,un=qr,this.markUsedOrientation(p,un,rt))}return un},Ko=(zn,un)=>{if(p.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const qr of p.writingModes)if(qr===l.an.vertical?(rn=un(),wr=rn):rn=zn(),rn&&rn.placeable)break}else rn=zn()},za=rt.textAnchorOffsetStartIndex,xl=rt.textAnchorOffsetEndIndex;if(xl===za){const zn=(un,qr)=>{const Wn=this.collisionIndex.placeCollisionBox(un,ae,F,Be,I,we,_e,T,K.predicate,Ve,void 0,vt);return Wn&&Wn.placeable&&(this.markUsedOrientation(p,qr,rt),this.placedOrientations[rt.crossTileID]=qr),Wn};Ko(()=>zn(Ts,l.an.horizontal),()=>{const un=kt.verticalTextBox;return p.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&un?zn(un,l.an.vertical):{box:null,offscreen:null}}),ro(rn&&rn.placeable)}else{let zn=l.aD[(yn=(Vi=this.prevPlacement)===null||Vi===void 0?void 0:Vi.variableOffsets[rt.crossTileID])===null||yn===void 0?void 0:yn.anchor];const un=(Wn,Op,Um)=>{const od=Wn.x2-Wn.x1,Jc=Wn.y2-Wn.y1,oc=rt.textBoxScale,Gs=pe&&fe==="never"?Op:null;let Sr=null,Hs=ae==="never"?1:2,sd="never";zn&&Hs++;for(let Ra=0;Ra<Hs;Ra++){for(let ad=za;ad<xl;ad++){const ld=p.textAnchorOffsets.get(ad);if(zn&&ld.textAnchor!==zn)continue;const Qc=this.attemptAnchorPlacement(ld,Wn,od,Jc,oc,_e,we,F,Be,I,K,sd,rt,p,Um,T,C,Gs,Ve);if(Qc&&(Sr=Qc.placedGlyphBoxes,Sr&&Sr.placeable))return Ji=!0,Qi=Qc.shift,Sr}zn?zn=null:sd=ae}return h&&!Sr&&(Sr={box:this.collisionIndex.placeCollisionBox(Ts,"always",F,Be,I,we,_e,T,K.predicate,Ve,void 0,vt).box,offscreen:!1,placeable:!1,occluded:!1}),Sr};Ko(()=>un(Ts,kt.iconBox,l.an.horizontal),()=>{const Wn=kt.verticalTextBox;return p.allowVerticalPlacement&&(!rn||!rn.placeable)&&rt.numVerticalGlyphVertices>0&&Wn?un(Wn,kt.verticalIconBox,l.an.vertical):{box:null,occluded:!0,offscreen:null}}),rn&&(Ji=rn.placeable,nn=rn.offscreen);const qr=ro(rn&&rn.placeable);if(!Ji&&this.prevPlacement){const Wn=this.prevPlacement.variableOffsets[rt.crossTileID];Wn&&(this.variableOffsets[rt.crossTileID]=Wn,this.markUsedJustification(p,Wn.anchor,rt,qr))}}}if(Di=rn,Ji=Di&&Di.placeable,nn=Di&&Di.offscreen,rt.useRuntimeCollisionCircles){const ro=p.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex),Ko=l.ao(p.textSizeData,Z,ro),za=x.get("text-padding");sr=this.collisionIndex.placeCollisionCircles(ae,ro,p.lineVertexArray,p.glyphOffsetArray,Ko,I,R,h,we,K.predicate,rt.collisionCircleDiameter,za,T,Ve),sr.circles.length&&sr.collisionDetected&&!h&&l.w("Collisions detected, but collision boxes are not shown"),Ji=ue||sr.circles.length>0&&!sr.collisionDetected,nn=nn&&sr.offscreen}if(kt.iconFeatureIndex&&(ka=kt.iconFeatureIndex),kt.iconBox){const ro=Ko=>this.collisionIndex.placeCollisionBox(Ko,fe,F,Be,I,we,_e,C,K.predicate,Ve,pe&&Qi?Qi:void 0,vt);wr&&wr.placeable&&kt.verticalIconBox?(Tr=ro(kt.verticalIconBox),vn=Tr.placeable):(Tr=ro(kt.iconBox),vn=Tr.placeable),nn=nn&&Tr.offscreen}const Xc=se||rt.numHorizontalGlyphVertices===0&&rt.numVerticalGlyphVertices===0,Yc=oe||rt.numIconVertices===0;Xc||Yc?Yc?Xc||(vn=vn&&Ji):Ji=vn&&Ji:vn=Ji=vn&&Ji;const rc=vn&&Tr.placeable;if(Ji&&Di.placeable&&this.collisionIndex.insertCollisionBox(Di.box,ae,x.get("text-ignore-placement"),p.bucketInstanceId,wr&&wr.placeable&&La?La:Aa,K.ID),rc&&this.collisionIndex.insertCollisionBox(Tr.box,fe,x.get("icon-ignore-placement"),p.bucketInstanceId,ka,K.ID),sr&&Ji&&this.collisionIndex.insertCollisionCircles(sr.circles,ae,x.get("text-ignore-placement"),p.bucketInstanceId,Aa,K.ID),h&&this.storeCollisionData(p.bucketInstanceId,gi,kt,Di,Tr,sr),rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[rt.crossTileID]=new Ya((Ji||$e)&&!Di?.occluded,(vn||De)&&!Tr?.occluded,nn||p.justReloaded),r[rt.crossTileID]=!0};if(Ae){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const rt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let kt=rt.length-1;kt>=0;--kt){const gi=rt[kt];gt(p.symbolInstances.get(gi),p.collisionArrays[gi],gi)}}else for(let rt=e.symbolInstanceStart;rt<e.symbolInstanceEnd;rt++)gt(p.symbolInstances.get(rt),p.collisionArrays[rt],rt);p.justReloaded=!1}storeCollisionData(e,r,h,p,x,T){if(h.textBox||h.iconBox){let C,I;this.collisionBoxArrays.has(e)?C=this.collisionBoxArrays.get(e):(C=new Map,this.collisionBoxArrays.set(e,C)),C.has(r)?I=C.get(r):(I={text:null,icon:null},C.set(r,I)),h.textBox&&(I.text=p.box),h.iconBox&&(I.icon=x.box)}if(T){let C=this.collisionCircleArrays[e];C===void 0&&(C=this.collisionCircleArrays[e]=[]);for(let I=0;I<T.circles.length;I+=4)C.push(T.circles[I+0]-Tn),C.push(T.circles[I+1]-Tn),C.push(T.circles[I+2]),C.push(T.collisionDetected?1:0)}}markUsedJustification(e,r,h,p){let x;x=p===l.an.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[l.aF(r)];const T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(e.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:h.crossTileID)}markUsedOrientation(e,r,h){const p=r===l.an.horizontal||r===l.an.horizontalOnly?r:0,x=r===l.an.vertical?r:0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const C of T)e.text.placedSymbolArray.get(C).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let h=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(e):1,x=r?r.opacities:{},T=r?r.variableOffsets:{},C=r?r.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],F=x[I];F?(this.opacities[I]=new No(F,p,R.text,R.icon),h=h||R.text!==F.text.placed||R.icon!==F.icon.placed):(this.opacities[I]=new No(null,p,R.text,R.icon,R.skipFade),h=h||R.text||R.icon)}for(const I in x){const R=x[I];if(!this.opacities[I]){const F=new No(R,p,!1,!1);F.isHidden()||(this.opacities[I]=F,h=h||R.text.placed||R.icon.placed)}}for(const I in T)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=T[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const h={};for(const p of r){const x=p.getBucket(e);x&&p.latestFeatureIndex&&e.id===x.layerIds[0]&&this.updateBucketOpacities(x,p.tileID,h,p.collisionBoxArray)}}updateBucketOpacities(e,r,h,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const x=e.layers[0],T=x.layout,C=new No(null,0,!1,!1,!0),I=T.get("text-allow-overlap"),R=T.get("icon-allow-overlap"),F=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=T.get("text-rotation-alignment")==="map",N=T.get("text-pitch-alignment")==="map",Z=T.get("icon-text-fit")!=="none",K=new No(null,0,I&&(R||!e.hasIconData()||T.get("icon-optional")),R&&(I||!e.hasTextData()||T.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const se=(ae,ue,fe)=>{for(let de=0;de<ue/4;de++)ae.opacityVertexArray.emplaceBack(fe);ae.hasVisibleVertices=ae.hasVisibleVertices||fe!==Rs},oe=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ae=0;ae<e.symbolInstances.length;ae++){const ue=e.symbolInstances.get(ae),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:de,crossTileID:_e}=ue;let we=this.opacities[_e];h[_e]?we=C:we||(we=K,this.opacities[_e]=we),h[_e]=!0;const pe=ue.numIconVertices>0,Ae=this.placedOrientations[ue.crossTileID],$e=Ae===l.an.vertical,De=Ae===l.an.horizontal||Ae===l.an.horizontalOnly;if(fe>0||de>0){const Ve=gn(we.text);se(e.text,fe,$e?Rs:Ve),se(e.text,de,De?Rs:Ve);const vt=we.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(kt=>{kt>=0&&(e.text.placedSymbolArray.get(kt).hidden=vt||$e?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=vt||De?1:0);const gt=this.variableOffsets[ue.crossTileID];gt&&this.markUsedJustification(e,gt.anchor,ue,Ae);const rt=this.placedOrientations[ue.crossTileID];rt&&(this.markUsedJustification(e,"left",ue,rt),this.markUsedOrientation(e,rt,ue))}if(pe){const Ve=gn(we.icon),vt=!(Z&&ue.verticalPlacedIconSymbolIndex&&$e);ue.placedIconSymbolIndex>=0&&(se(e.icon,ue.numIconVertices,vt?Ve:Rs),e.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=we.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(se(e.icon,ue.numVerticalIconVertices,vt?Rs:Ve),e.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const Be=oe&&oe.has(ae)?oe.get(ae):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ve=e.collisionArrays[ae];if(Ve){let vt=new l.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let gt=!0;if(F){const rt=this.variableOffsets[_e];rt?(vt=Cc(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),j&&vt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):gt=!1}if(Ve.textBox||Ve.verticalTextBox){let rt;Ve.textBox&&(rt=$e),Ve.verticalTextBox&&(rt=De),cs(e.textCollisionBox.collisionVertexArray,we.text.placed,!gt||rt,Be.text,vt.x,vt.y)}}if(Ve.iconBox||Ve.verticalIconBox){const gt=!!(!De&&Ve.verticalIconBox);let rt;Ve.iconBox&&(rt=gt),Ve.verticalIconBox&&(rt=!gt),cs(e.iconCollisionBox.collisionVertexArray,we.icon.placed,rt,Be.icon,Z?vt.x:0,Z?vt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const h=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function cs(v,e,r,h,p,x){h&&h.length!==0||(h=[0,0,0,0]);const T=h[0]-Tn,C=h[1]-Tn,I=h[2]-Tn,R=h[3]-Tn;v.emplaceBack(e?1:0,r?1:0,p||0,x||0,T,C),v.emplaceBack(e?1:0,r?1:0,p||0,x||0,I,C),v.emplaceBack(e?1:0,r?1:0,p||0,x||0,I,R),v.emplaceBack(e?1:0,r?1:0,p||0,x||0,T,R)}const Si=Math.pow(2,25),qi=Math.pow(2,24),Ja=Math.pow(2,17),ks=Math.pow(2,16),zs=Math.pow(2,9),us=Math.pow(2,8),xi=Math.pow(2,1);function gn(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const e=v.placed?1:0,r=Math.floor(127*v.opacity);return r*Si+e*qi+r*Ja+e*ks+r*zs+e*us+r*xi+e}const Rs=0;class Ol{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,h,p,x){const T=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(T,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<T.length;)if(r.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,x())return!0;return!1}}class Nr{constructor(e,r,h,p,x,T,C,I){this.placement=new la(e,r,T,C,I),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(e,r,h){const p=X.now(),x=()=>!this._forceFullPlacement&&X.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=r[e[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Ol(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ca=512/l.$/2;class ua{constructor(e,r,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let x=0;x<r.length;x++){const T=r.get(x),C=T.key,I=p.get(C);I?I.push(T):p.set(C,[T])}for(const[x,T]of p){const C={positions:T.map(I=>({x:Math.floor(I.anchorX*ca),y:Math.floor(I.anchorY*ca)})),crossTileIDs:T.map(I=>I.crossTileID)};if(C.positions.length>128){const I=new l.aH(C.positions.length,16,Uint16Array);for(const{x:R,y:F}of C.positions)I.add(R,F);I.finish(),delete C.positions,C.index=I}this._symbolsByKey[x]=C}}getScaledCoordinates(e,r){const{x:h,y:p,z:x}=this.tileID.canonical,{x:T,y:C,z:I}=r.canonical,R=ca/Math.pow(2,I-x),F=(C*l.$+e.anchorY)*R,j=p*l.$*ca;return{x:Math.floor((T*l.$+e.anchorX)*R-h*l.$*ca),y:Math.floor(F-j)}}findMatches(e,r,h){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let x=0;x<e.length;x++){const T=e.get(x);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const I=this.getScaledCoordinates(T,r);if(C.index){const R=C.index.range(I.x-p,I.y-p,I.x+p,I.y+p).sort();for(const F of R){const j=C.crossTileIDs[F];if(!h[j]){h[j]=!0,T.crossTileID=j;break}}}else if(C.positions)for(let R=0;R<C.positions.length;R++){const F=C.positions[R],j=C.crossTileIDs[R];if(Math.abs(F.x-I.x)<=p&&Math.abs(F.y-I.y)<=p&&!h[j]){h[j]=!0,T.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class jo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const h in this.indexes){const p=this.indexes[h],x={};for(const T in p){const C=p[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+r),x[C.tileID.key]=C}this.indexes[h]=x}this.lng=e}addBucket(e,r,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let x=0;x<r.symbolInstances.length;x++)r.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>e.overscaledZ)for(const C in T){const I=T[C];I.tileID.isChildOf(e)&&I.findMatches(r.symbolInstances,e,p)}else{const C=T[e.scaledTo(Number(x)).key];C&&C.findMatches(r.symbolInstances,e,p)}}for(let x=0;x<r.symbolInstances.length;x++){const T=r.symbolInstances.get(x);T.crossTileID||(T.crossTileID=h.generate(),p[T.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ua(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const h of r.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let r=!1;for(const h in this.indexes){const p=this.indexes[h];for(const x in p)e[p[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[x]),delete p[x],r=!0)}return r}}class Po{constructor(){this.layerIndexes={},this.crossTileIDs=new jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,h){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new Sn);let x=!1;const T={};p.handleWrapJump(h);for(const C of r){const I=C.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(C.tileID,I,this.crossTileIDs)&&(x=!0),T[I.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(e){const r={};e.forEach(h=>{r[h]=!0});for(const h in this.layerIndexes)r[h]||delete this.layerIndexes[h]}}var hs="void main() {fragColor=vec4(1.0);}";const Ar={prelude:mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:mi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:mi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:mi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mi(hs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:mi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:mi(hs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:mi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:mi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:mi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:mi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:mi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:mi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mi(v,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),p=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=x?x.concat(p):p,C={};return{fragmentSource:v=v.replace(r,(I,R,F,j,N)=>(C[N]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${F} ${j} ${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(r,(I,R,F,j,N)=>{const Z=j==="float"?"vec2":"vec4",K=N.match(/color/)?"color":Z;return C[N]?R==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${F} ${Z} a_${N};
out ${F} ${j} ${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${F} ${Z} a_${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = a_${N};
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);
#else
    ${F} ${j} ${N} = u_${N};
#endif
`}),staticAttributes:h,staticUniforms:T}}class jr{constructor(e,r,h){this.vertexBuffer=e,this.indexBuffer=r,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var co=l.aI([{name:"a_pos",type:"Int16",components:2}]);const Uo="#define PROJECTION_MERCATOR",ha="mercator";class Qa{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ha}get shaderDefine(){return Uo}get shaderPreludeCode(){return Ar.projectionMercator}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,h,p,x){if(this._cachedMesh)return this._cachedMesh;const T=new l.aK;T.emplaceBack(0,0),T.emplaceBack(l.$,0),T.emplaceBack(0,l.$),T.emplaceBack(l.$,l.$);const C=e.createVertexBuffer(T,co.members),I=l.aL.simpleSegment(0,0,4,2),R=new l.aM;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const F=e.createIndexBuffer(R);return this._cachedMesh=new jr(C,F,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Lr{constructor(e=0,r=0,h=0,p=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=h,this.right=p}interpolate(e,r,h){return r.top!=null&&e.top!=null&&(this.top=l.C.number(e.top,r.top,h)),r.bottom!=null&&e.bottom!=null&&(this.bottom=l.C.number(e.bottom,r.bottom,h)),r.left!=null&&e.left!=null&&(this.left=l.C.number(e.left,r.left,h)),r.right!=null&&e.right!=null&&(this.right=l.C.number(e.right,r.right,h)),this}getCenter(e,r){const h=l.ag((this.left+e-this.right)/2,0,e),p=l.ag((this.top+r-this.bottom)/2,0,r);return new l.P(h,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Lr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qr(v,e){if(!v.renderWorldCopies||v.lngRange)return;const r=e.lng-v.center.lng;e.lng+=r>180?-360:r<-180?360:0}function bi(v){return Math.max(0,Math.floor(v))}class Ds{constructor(e,r,h,p,x,T){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=T===void 0||!!T,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=x??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=bi(this._zoom),this._scale=l.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Lr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,h){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=bi(this._zoom),this._scale=l.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Lr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=l.aN(e,-180,180)*Math.PI/180;var h,p,x,T,C,I,R,F,j;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=k(),h=this._rotationMatrix,x=-this._bearingInRadians,T=(p=this._rotationMatrix)[0],C=p[1],I=p[2],R=p[3],F=Math.sin(x),j=Math.cos(x),h[0]=T*j+I*F,h[1]=C*j+R*F,h[2]=T*-F+I*j,h[3]=C*-F+R*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=l.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aO(this._fovInRadians)}setFov(e){e=l.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=l.ae(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,h){this._unmodified=!1,this._edgeInsets.interpolate(e,r,h),this._constrain(),this._calcMatrices()}resize(e,r,h=!0){this._width=e,this._height=r,h&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Pe([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-l.ah,l.ah])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:h,minY:p,maxX:x,maxY:T}=l.a1.fromPoints(r).extend(e);return[new l.P(h,p),new l.P(x,p),new l.P(x,T),new l.P(h,T),new l.P(h,p)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:h}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.af(new Float64Array(16));l.N(e,e,[this._width/2,-this._height/2,1]),l.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.af(new Float64Array(16)),l.N(e,e,[1,-1,1]),l.M(e,e,[-1,-1,0]),l.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,h,p){const x=h!==void 0?h:this.bearing,T=p=p!==void 0?p:this.pitch,C=l.a0.fromLngLat(e,r),I=-Math.cos(l.ad(T)),R=Math.sin(l.ad(T)),F=R*Math.sin(l.ad(x)),j=-R*Math.cos(l.ad(x));let N=this.elevation;const Z=r-N;let K;I*Z>=0||Math.abs(I)<.1?(K=1e4,N=r+K*I):K=-Z/I;let se,oe,ae=l.aP(1,C.y),ue=0;do{if(ue+=1,ue>10)break;oe=K/ae,se=new l.a0(C.x+F*oe,C.y+j*oe),ae=1/se.meterInMercatorCoordinateUnits()}while(Math.abs(K-oe*ae)>1e-12);return{center:se.toLngLat(),elevation:N,zoom:l.aj(this.height/2/Math.tan(this.fovInRadians/2)/oe/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=l.ai(1,this.center.lat)*this.worldSize,h=this.cameraToCenterDistance/r,p=l.a0.fromLngLat(this.center,this.elevation),x=he(this.center,this.elevation,this.pitch,this.bearing,h);this._elevation=e;const T=this.calculateCenterFromCameraLngLatAlt(x.toLngLat(),l.aP(x.z,p.y),this.bearing,this.pitch);this._elevation=T.elevation,this._center=T.center,this.setZoom(T.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.ai(1,this.center.lat)*this.worldSize;return he(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/l.$,1/r/l.$]}}class Fl{constructor(e,r){this.min=e,this.max=r,this.center=l.aQ([],l.aR([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],h=l.aS(this.min),p=l.aS(this.max);for(let x=0;x<r.length;x++)h[x]=r[x]?this.min[x]:this.center[x],p[x]=r[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new Fl(h,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let h=0;h<e.planes.length;h++){const p=this.intersectsPlane(e.planes[h]);if(p===0)return 0;p===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],h=e[3];for(let p=0;p<3;p++)e[p]>0?(r+=e[p]*this.min[p],h+=e[p]*this.max[p]):(h+=e[p]*this.min[p],r+=e[p]*this.max[p]);return r>=0?2:h<0?0:1}}class hi{distanceToTile2d(e,r,h,p){const x=p.distanceX([e,r]),T=p.distanceY([e,r]);return Math.hypot(x,T)}getWrap(e,r,h){return h}getTileBoundingVolume(e,r,h,p){var x,T;let C=h,I=h;if(p?.terrain){const F=new l.Z(e.z,r,e.z,e.x,e.y),j=p.terrain.getMinMaxElevation(F);C=(x=j.minElevation)!==null&&x!==void 0?x:h,I=(T=j.maxElevation)!==null&&T!==void 0?T:h}const R=1<<e.z;return new Fl([r+e.x/R,e.y/R,C],[r+(e.x+1)/R,(e.y+1)/R,I])}allowVariableZoom(e,r){const h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,p=l.ag(78.5-h/2,0,60);return!!r.terrain||e.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class cn{constructor(e,r,h){this.points=e,this.planes=r,this.aabb=h}static fromInvProjectionMatrix(e,r=1,h=0,p,x){const T=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,h),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>function(Z,K,se,oe){const ae=l.av([],Z,K),ue=1/ae[3]/se*oe;return l.aX(ae,ae,[ue,ue,1/ae[3],ue])}(N,e,r,C));p&&function(N,Z,K,se){const oe=se?4:0,ae=se?0:4;let ue=0;const fe=[],de=[];for(let pe=0;pe<4;pe++){const Ae=l.aT([],N[pe+ae],N[pe+oe]),$e=l.aY(Ae);l.aQ(Ae,Ae,1/$e),fe.push($e),de.push(Ae)}for(let pe=0;pe<4;pe++){const Ae=l.aZ(N[pe+oe],de[pe],K);ue=Ae!==null&&Ae>=0?Math.max(ue,Ae):Math.max(ue,fe[pe])}const _e=function(pe,Ae){const $e=l.aT([],pe[Ae[0]],pe[Ae[1]]),De=l.aT([],pe[Ae[2]],pe[Ae[1]]),Be=[0,0,0,0];return l.aU(Be,l.aV([],$e,De)),Be[3]=-l.aW(Be,pe[Ae[0]]),Be}(N,Z),we=function(pe,Ae){const $e=l.a_(pe),De=l.a$([],pe,1/$e),Be=l.aT([],Ae,l.aQ([],De,l.aW(Ae,De))),Ve=l.a_(Be);if(Ve>0){const vt=Math.sqrt(1-De[3]*De[3]),gt=l.aQ([],De,-De[3]),rt=l.aR([],gt,l.aQ([],Be,vt/Ve));return l.b0(Ae,rt)}return null}(K,_e);if(we!==null){const pe=we/l.aW(de[0],_e);ue=Math.min(ue,pe)}for(let pe=0;pe<4;pe++){const Ae=Math.min(ue,fe[pe]);N[pe+ae]=[N[pe+oe][0]+de[pe][0]*Ae,N[pe+oe][1]+de[pe][1]*Ae,N[pe+oe][2]+de[pe][2]*Ae,1]}}(I,T[0],p,x);const R=T.map(N=>{const Z=l.aT([],I[N[0]],I[N[1]]),K=l.aT([],I[N[2]],I[N[1]]),se=l.aU([],l.aV([],Z,K)),oe=-l.aW(se,I[N[1]]);return se.concat(oe)}),F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],j=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of I)for(let Z=0;Z<3;Z++)F[Z]=Math.min(F[Z],N[Z]),j[Z]=Math.max(j[Z],N[Z]);return new cn(I,R,new Fl(F,j))}}class li{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,h){return this._helper.interpolatePadding(e,r,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,h=!0){this._helper.resize(e,r,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,h,p,x){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ds({calcMatrices:()=>{this._calcMatrices()},getConstrained:(T,C)=>this.getConstrained(T,C)},e,r,h,p,x),this._coveringTilesDetailsProvider=new hi}clone(){const e=new li;return e.apply(this),e}apply(e,r,h){this._helper.apply(e,r,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new l.b1(0,e)];if(this._helper._renderWorldCopies){const h=this.screenPointToMercatorCoordinate(new l.P(0,0)),p=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),C=Math.floor(Math.min(h.x,p.x,x.x,T.x)),I=Math.floor(Math.max(h.x,p.x,x.x,T.x)),R=1;for(let F=C-R;F<=I+R;F++)F!==0&&r.push(new l.b1(F,e))}return r}getCameraFrustum(){return cn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,r){const h=l.ai(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(r,h),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),T=l.a0.fromLngLat(e),C=new l.a0(T.x-(p.x-x.x),T.y-(p.y-x.y));this.setCenter(C?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(l.a0.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a0.fromLngLat(e))}screenPointToLocation(e,r){var h;return(h=this.screenPointToMercatorCoordinate(e,r))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const h=r.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const h=r||0,p=[e.x,e.y,0,1],x=[e.x,e.y,1,1];l.av(p,p,this._pixelMatrixInverse),l.av(x,x,this._pixelMatrixInverse);const T=p[3],C=x[3],I=p[1]/T,R=x[1]/C,F=p[2]/T,j=x[2]/C,N=F===j?0:(h-F)/(j-F);return new l.a0(l.C.number(p[0]/T,x[0]/C,N)/this.worldSize,l.C.number(I,R,N)/this.worldSize,h)}coordinatePoint(e,r=0,h=this._pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,r,1];return l.av(p,p,h),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Q(this));return new Pe().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-Q(this)}calculatePosMatrix(e,r=!1,h){var p;const x=(p=e.key)!==null&&p!==void 0?p:l.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),T=r?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(x)){const R=T.get(x);return h?R.f32:R.f64}const C=ie(e,this.worldSize);l.O(C,r?this._alignedProjMatrix:this._viewProjMatrix,C);const I={f64:C,f32:new Float32Array(C)};return T.set(x,I),h?I.f32:I.f64}calculateFogMatrix(e){const r=e.key,h=this._fogMatrixCacheF32;if(h.has(r))return h.get(r);const p=ie(e,this.worldSize);return l.O(p,this._fogMatrix,p),h.set(r,new Float32Array(p)),h.get(r)}getConstrained(e,r){r=l.ag(+r,this.minZoom,this.maxZoom);const h={center:new l.S(e.lng,e.lat),zoom:r};let p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&p===null){const fe=179.9999999999;p=[-fe,fe]}const x=this.tileSize*l.ae(h.zoom);let T=0,C=x,I=0,R=x,F=0,j=0;const{x:N,y:Z}=this.size;if(this._helper._latRange){const fe=this._helper._latRange;T=l.U(fe[1])*x,C=l.U(fe[0])*x,C-T<Z&&(F=Z/(C-T))}p&&(I=l.aN(l.V(p[0])*x,0,x),R=l.aN(l.V(p[1])*x,0,x),R<I&&(R+=x),R-I<N&&(j=N/(R-I)));const{x:K,y:se}=Ee(x,e);let oe,ae;const ue=Math.max(j||0,F||0);if(ue){const fe=new l.P(j?(R+I)/2:K,F?(C+T)/2:se);return h.center=J(x,fe).wrap(),h.zoom+=l.aj(ue),h}if(this._helper._latRange){const fe=Z/2;se-fe<T&&(ae=T+fe),se+fe>C&&(ae=C-fe)}if(p){const fe=(I+R)/2;let de=K;this._helper._renderWorldCopies&&(de=l.aN(K,fe-x/2,fe+x/2));const _e=N/2;de-_e<I&&(oe=I+_e),de+_e>R&&(oe=R-_e)}if(oe!==void 0||ae!==void 0){const fe=new l.P(oe??K,ae??se);h.center=J(x,fe).wrap()}return h}calculateCenterFromCameraLngLatAlt(e,r,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,h,p)}_calculateNearFarZIfNeeded(e,r,h){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=e-p*this._helper._pixelPerMeter/Math.cos(r),T=p<0?x:e,C=Math.PI/2+this.pitchInRadians,I=l.ad(this.fov)*(Math.abs(Math.cos(l.ad(this.roll)))*this.height+Math.abs(Math.sin(l.ad(this.roll)))*this.width)/this.height*(.5+h.y/this.height),R=Math.sin(I)*T/Math.sin(l.ag(Math.PI-C-I,.01,Math.PI-.01)),F=Q(this),j=Math.atan(F/this._helper.cameraToCenterDistance),N=l.ad(.75),Z=j>N?2*j*(.5+h.y/(2*F)):N,K=Math.sin(Z)*T/Math.sin(l.ag(Math.PI-C-Z,.01,Math.PI-.01)),se=Math.min(R,K);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*se+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=Ee(this.worldSize,this.center),h=r.x,p=r.y;this._helper._pixelPerMeter=l.ai(1,this.center.lat)*this.worldSize;const x=l.ad(Math.min(this.pitch,wn)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let C;this._calculateNearFarZIfNeeded(T,x,e),C=new Float64Array(16),l.b3(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.ap(this._invProjMatrix,C),C[8]=2*-e.x/this._helper._width,C[9]=2*e.y/this._helper._height,this._projectionMatrix=l.b4(C),l.N(C,C,[1,-1,1]),l.M(C,C,[0,0,-this._helper.cameraToCenterDistance]),l.b5(C,C,-this.rollInRadians),l.b6(C,C,this.pitchInRadians),l.b5(C,C,-this.bearingInRadians),l.M(C,C,[-h,-p,0]),this._mercatorMatrix=l.N([],C,[this.worldSize,this.worldSize,this.worldSize]),l.N(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),l.M(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=l.ap([],C);const I=[0,0,-1,1];l.av(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),l.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.M(this._fogMatrix,this._fogMatrix,[-h,-p,0]),l.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const R=this._helper._width%2/2,F=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),Z=h-Math.round(h)+j*R+N*F,K=p-Math.round(p)+j*F+N*R,se=new Float64Array(C);if(l.M(se,se,[Z>.5?Z-1:Z,K>.5?K-1:K,0]),this._alignedProjMatrix=se,C=l.ap(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.av(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.ai(1,this.center.lat)*this.worldSize;return he(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const h=l.a0.fromLngLat(e),p=[h.x*this.worldSize,h.y*this.worldSize,r,1];return l.av(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(e){const{overscaledTileID:r,aligned:h,applyTerrainMatrix:p}=e,x=this._helper.getMercatorTileCoordinates(r),T=r?this.calculatePosMatrix(r,h,!0):null;let C;return C=r&&r.terrainRttPosMatrix32f&&p?r.terrainRttPosMatrix32f:T||l.b7(),{mainMatrix:C,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,h){return 1}transformLightDirection(e){return l.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,h,p){const x=this.calculatePosMatrix(h);let T;p?(T=[e,r,p(e,r),1],l.av(T,T,x)):(T=[e,r,0,1],So(T,T,x));const C=T[3];return{point:new l.P(T[0]/C,T[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const h=l.a0.fromLngLat(e,r),p=h.meterInMercatorCoordinateUnits(),x=l.b8();return l.M(x,x,[h.x,h.y,h.z]),l.b5(x,x,Math.PI),l.b6(x,x,Math.PI/2),l.N(x,x,[-p,p,p]),x}getProjectionDataForCustomLayer(e=!0){const r=new l.Z(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),p=ie(r,this.worldSize);l.O(p,this._viewProjMatrix,p),h.tileMercatorCoords=[0,0,1,1];const x=[l.$,l.$,this.worldSize/this._helper.pixelsPerMeter],T=l.b9();return l.N(T,p,x),h.fallbackMatrix=T,h.mainMatrix=T,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Gn(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ln(v){if(v.useSlerp)if(v.k<1){const e=l.ba(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),r=l.ba(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),h=new Float64Array(4);l.bb(h,e,r,v.k);const p=l.bc(h);v.tr.setRoll(p.roll),v.tr.setPitch(p.pitch),v.tr.setBearing(p.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(l.C.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(l.C.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(l.C.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function tn(v,e,r,h,p){const x=p.padding,T=Ee(p.worldSize,r.getNorthWest()),C=Ee(p.worldSize,r.getNorthEast()),I=Ee(p.worldSize,r.getSouthEast()),R=Ee(p.worldSize,r.getSouthWest()),F=l.ad(-h),j=T.rotate(F),N=C.rotate(F),Z=I.rotate(F),K=R.rotate(F),se=new l.P(Math.max(j.x,N.x,K.x,Z.x),Math.max(j.y,N.y,K.y,Z.y)),oe=new l.P(Math.min(j.x,N.x,K.x,Z.x),Math.min(j.y,N.y,K.y,Z.y)),ae=se.sub(oe),ue=(p.width-(x.left+x.right+e.left+e.right))/ae.x,fe=(p.height-(x.top+x.bottom+e.top+e.bottom))/ae.y;if(fe<0||ue<0)return void Gn();const de=Math.min(l.aj(p.scale*Math.min(ue,fe)),v.maxZoom),_e=l.P.convert(v.offset),we=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ad(h)),pe=_e.add(we).mult(p.scale/l.ae(de));return{center:J(p.worldSize,T.add(I).div(2).sub(pe)),zoom:de,bearing:h}}class da{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,h){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,r,h,p,x){return tn(e,r,h,p,x)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(l.S.convert(r.center))}handleEaseTo(e,r){const h=e.zoom,p=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},C=r.zoom!==void 0,I=!e.isPaddingEqual(r.padding);let R=!1;const F=C?+r.zoom:e.zoom;let j=e.centerPoint.add(r.offsetAsPoint);const N=e.screenPointToLocation(j),{center:Z,zoom:K}=e.getConstrained(l.S.convert(r.center||N),F??h);Qr(e,Z);const se=Ee(e.worldSize,N),oe=Ee(e.worldSize,Z).sub(se),ae=l.ae(K-h);return R=K!==h,{easeFunc:ue=>{if(R&&e.setZoom(l.C.number(h,K,ue)),l.bd(x,T)||Ln({startEulerAngles:x,endEulerAngles:T,tr:e,k:ue,useSlerp:x.roll!=T.roll}),I&&(e.interpolatePadding(p,r.padding,ue),j=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const fe=l.ae(e.zoom-h),de=K>h?Math.min(2,ae):Math.max(.5,ae),_e=Math.pow(de,1-ue),we=J(e.worldSize,se.add(oe.mult(ue*_e)).mult(fe));e.setLocationAtPoint(e.renderWorldCopies?we.wrap():we,j)}},isZooming:R,elevationCenter:Z}}handleFlyTo(e,r){const h=r.zoom!==void 0,p=e.zoom,x=e.getConstrained(l.S.convert(r.center||r.locationAtOffset),h?+r.zoom:p),T=x.center,C=x.zoom;Qr(e,T);const I=Ee(e.worldSize,r.locationAtOffset),R=Ee(e.worldSize,T).sub(I),F=R.mag(),j=l.ae(C-p);let N;if(r.minZoom!==void 0){const Z=Math.min(+r.minZoom,p,C),K=e.getConstrained(T,Z).zoom;N=l.ae(K-p)}return{easeFunc:(Z,K,se,oe)=>{e.setZoom(Z===1?C:p+l.aj(K));const ae=Z===1?T:J(e.worldSize,I.add(R.mult(se)).mult(K));e.setLocationAtPoint(e.renderWorldCopies?ae.wrap():ae,oe)},scaleOfZoom:j,targetCenter:T,scaleOfMinZoom:N,pixelPathLength:F}}}class di{constructor(e,r,h){this.blendFunction=e,this.blendColor=r,this.mask=h}}di.Replace=[1,0],di.disabled=new di(di.Replace,l.be.transparent,[!1,!1,!1,!1]),di.unblended=new di(di.Replace,l.be.transparent,[!0,!0,!0,!0]),di.alphaBlended=new di([1,771],l.be.transparent,[!0,!0,!0,!0]);const tr=2305;class ti{constructor(e,r,h){this.enable=e,this.mode=r,this.frontFace=h}}ti.disabled=new ti(!1,1029,tr),ti.backCCW=new ti(!0,1029,tr),ti.frontCCW=new ti(!0,1028,tr);class Vt{constructor(e,r,h){this.func=e,this.mask=r,this.range=h}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const Ur=7680;class Kt{constructor(e,r,h,p,x,T){this.test=e,this.ref=r,this.mask=h,this.fail=p,this.depthFail=x,this.pass=T}}Kt.disabled=new Kt({func:519,mask:0},0,0,Ur,Ur,Ur);const ds=new WeakMap;function gr(v){var e;if(ds.has(v))return ds.get(v);{const r=(e=v.getParameter(v.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ds.set(v,r),r}}class Os{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,h=r.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;const p=new l.aK;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const x=new l.aM;x.emplaceBack(0,1,2),this._fullscreenTriangle=new jr(r.createVertexBuffer(p,co.members),r.createIndexBuffer(x),l.aL.simpleSegment(0,0,p.length,x.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(h.TEXTURE1);const T=h.createTexture();h.bindTexture(h.TEXTURE_2D,T),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),gr(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const h=this._cachedRenderContext.context,p=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:l.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,p.TRIANGLES,Vt.disabled,Kt.disabled,di.unblended,ti.disabled,((x,T)=>({u_input:x,u_output_expected:T}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&gr(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const x=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&gr(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Os._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const ir=l.$/128;function Mc(v,e){const r=v.granularity!==void 0?Math.max(v.granularity,1):1,h=r+(v.generateBorders?2:0),p=r+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),x=h+1,T=p+1,C=v.generateBorders?-1:0,I=v.generateBorders||v.extendToNorthPole?-1:0,R=r+(v.generateBorders?1:0),F=r+(v.generateBorders||v.extendToSouthPole?1:0),j=x*T,N=h*p*6,Z=x*T>65536;if(Z&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const K=Z||e==="32bit",se=new Int16Array(2*j);let oe=0;for(let fe=I;fe<=F;fe++)for(let de=C;de<=R;de++){let _e=de/r*l.$;de===-1&&(_e=-ir),de===r+1&&(_e=l.$+ir);let we=fe/r*l.$;fe===-1&&(we=v.extendToNorthPole?l.bg:-ir),fe===r+1&&(we=v.extendToSouthPole?l.bh:l.$+ir),se[oe++]=_e,se[oe++]=we}const ae=K?new Uint32Array(N):new Uint16Array(N);let ue=0;for(let fe=0;fe<p;fe++)for(let de=0;de<h;de++){const _e=de+1+fe*x,we=de+(fe+1)*x,pe=de+1+(fe+1)*x;ae[ue++]=de+fe*x,ae[ue++]=we,ae[ue++]=_e,ae[ue++]=_e,ae[ue++]=we,ae[ue++]=pe}return{vertices:se.buffer.slice(0),indices:ae.buffer.slice(0),uses32bitIndices:K}}const uo=new l.aJ({fill:new l.bi(128,2),line:new l.bi(512,0),tile:new l.bi(128,32),stencil:new l.bi(128,1),circle:3});class zi{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ar.projectionGlobe}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return uo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Os(e));const r=l.U(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(r,h),x=X.now();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=x);const T=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bk(T))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,h,p,x){const T=(x==="stencil"?uo.stencil:uo.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:T,generateBorders:h,extendToNorthPole:r.y===0&&p,extendToSouthPole:r.y===(1<<r.z)-1&&p})}_getMesh(e,r){const h=this._getMeshKey(r);if(h in this._tileMeshCache)return this._tileMeshCache[h];const p=function(x,T){const C=Mc(T,"16bit"),I=l.aK.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),R=l.aM.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new jr(x.createVertexBuffer(I,co.members),x.createIndexBuffer(R),l.aL.simpleSegment(0,0,I.length,R.length))}(e,r);return this._tileMeshCache[h]=p,p}recalculate(e){}hasTransition(){const e=X.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Ru=new l.r({type:new l.D(l.v.projection.type)});class _r extends l.E{constructor(e){super(),this._transitionable=new l.t(Ru),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0)),this._mercatorProjection=new Qa,this._verticalPerspectiveProjection=new zi}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,h,p,x){return this.currentProjection.getMeshFromTileID(e,r,h,p,x)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function $o(v){const e=ps(v.worldSize,v.center.lat);return 2*Math.PI*e}function eo(v,e,r,h,p){const x=1/(1<<p),T=e/l.$*x+h*x,C=l.bn((v/l.$*x+r*x)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,R=Math.cos(I),F=new Float64Array(3);return F[0]=Math.sin(C)*R,F[1]=Math.sin(I),F[2]=Math.cos(C)*R,F}function $n(v){return function(e,r){const h=Math.cos(r),p=new Float64Array(3);return p[0]=Math.sin(e)*h,p[1]=Math.sin(r),p[2]=Math.cos(e)*h,p}(v.lng*Math.PI/180,v.lat*Math.PI/180)}function ps(v,e){return v/(2*Math.PI)/Math.cos(e*Math.PI/180)}function el(v){const e=Math.asin(v[1])/Math.PI*180,r=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(r>1e-6){const h=v[0]/r,p=Math.acos(v[2]/r),x=(h>0?p:-p)/Math.PI*180;return new l.S(l.aN(x,-180,180),e)}return new l.S(0,e)}function Fs(v){return Math.cos(v*Math.PI/180)}function kn(v,e){const r=Fs(v),h=Fs(e);return l.aj(h/r)}function tl(v,e){const r=v.rotate(e.bearingInRadians),h=e.zoom+kn(e.center.lat,0),p=l.bj(1/Fs(e.center.lat),1/Fs(Math.min(Math.abs(e.center.lat),60)),l.bm(h,7,3,0,1)),x=360/$o({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.S(e.center.lng-r.x*x*p,l.ag(e.center.lat+r.y*x,-l.ah,l.ah))}function fs(v){const e=.5*v,r=Math.sin(e),h=Math.cos(e);return Math.log(r+h)-Math.log(h-r)}function pa(v,e,r,h){const p=v.lat+r*h;if(Math.abs(r)>1){const x=(Math.sign(v.lat+r)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,T=Math.abs(v.lat+r)*Math.PI/180,C=fs(x+h*(T-x)),I=fs(x),R=fs(T);return new l.S(v.lng+e*((C-I)/(R-I)),p)}return new l.S(v.lng+e*h,p)}class Co{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,h,p){const x=`${e.z}_${e.x}_${e.y}_${p?.terrain?"t":""}`,T=this._cache.get(x);if(T)return T;const C=this._cachePrevious.get(x);if(C)return this._cache.set(x,C),C;const I=this._boundingVolumeFactory(e,r,h,p);return this._cache.set(x,I),this._hadAnyChanges=!0,I}}class ms{constructor(e,r,h,p){this.min=h,this.max=p,this.points=e,this.planes=r}static fromAabb(e,r){const h=[];for(let p=0;p<8;p++)h.push([1&~p?e[0]:r[0],(p>>1&1)==1?r[1]:e[1],(p>>2&1)==1?r[2]:e[2]]);return new ms(h,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,h){const p=l.bq([],h[0],h[1],h[2]),x=l.br([],[r[0],0,0],p),T=l.br([],[0,r[1],0],p),C=l.br([],[0,0,r[2]],p),I=[...e],R=[...e];for(let j=0;j<8;j++)for(let N=0;N<3;N++){const Z=e[N]+x[N]*(1&~j?-1:1)+T[N]*((j>>1&1)==1?1:-1)+C[N]*((j>>2&1)==1?1:-1);I[N]=Math.min(I[N],Z),R[N]=Math.max(R[N],Z)}const F=[];for(let j=0;j<8;j++){const N=[...e];l.aR(N,N,l.aQ([],x,1&~j?-1:1)),l.aR(N,N,l.aQ([],T,(j>>1&1)==1?1:-1)),l.aR(N,N,l.aQ([],C,(j>>2&1)==1?1:-1)),F.push(N)}return new ms(F,[[...x,-l.aW(x,F[0])],[...T,-l.aW(T,F[0])],[...C,-l.aW(C,F[0])],[-x[0],-x[1],-x[2],-l.aW(x,F[7])],[-T[0],-T[1],-T[2],-l.aW(T,F[7])],[-C[0],-C[1],-C[2],-l.aW(C,F[7])]],I,R)}intersectsFrustum(e){let r=!0;const h=this.points.length,p=this.planes.length,x=e.planes.length,T=e.points.length;for(let C=0;C<x;C++){const I=e.planes[C];let R=0;for(let F=0;F<h;F++){const j=this.points[F];I[0]*j[0]+I[1]*j[1]+I[2]*j[2]+I[3]>=0&&R++}if(R===0)return 0;R<h&&(r=!1)}if(r)return 2;for(let C=0;C<p;C++){const I=this.planes[C];let R=0;for(let F=0;F<T;F++){const j=e.points[F];I[0]*j[0]+I[1]*j[1]+I[2]*j[2]+I[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let h=0;for(let p=0;p<r;p++){const x=this.points[p];e[0]*x[0]+e[1]*x[1]+e[2]*x[2]+e[3]>=0&&h++}return h===r?2:h===0?0:1}}function fa(v,e,r){const h=v-e;return h<0?-h:Math.max(0,h-r)}function Mo(v,e,r,h,p){const x=v-r;let T;return T=x<0?Math.min(-x,1+x-p):x>1?Math.min(Math.max(x-p,0),1-x):0,Math.max(T,fa(e,h,p))}class Du{constructor(){this._boundingVolumeCache=new Co(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,h,p){const x=1<<h.z,T=1/x,C=h.x/x,I=h.y/x;let R=2;return R=Math.min(R,Mo(e,r,C,I,T)),R=Math.min(R,Mo(e,r,C+.5,-I-T,T)),R=Math.min(R,Mo(e,r,C+.5,2-I-T,T)),R}getWrap(e,r,h){const p=1<<r.z,x=1/p,T=r.x/p,C=fa(e.x,T,x),I=fa(e.x,T-1,x),R=fa(e.x,T+1,x),F=Math.min(C,I,R);return F===R?1:F===I?-1:0}allowVariableZoom(e,r){return He(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,h,p){return this._boundingVolumeCache.getTileBoundingVolume(e,r,h,p)}_computeTileBoundingVolume(e,r,h,p){var x,T;let C=h,I=h;if(p?.terrain){const R=new l.Z(e.z,r,e.z,e.x,e.y),F=p.terrain.getMinMaxElevation(R);C=(x=F.minElevation)!==null&&x!==void 0?x:h,I=(T=F.maxElevation)!==null&&T!==void 0?T:h}if(C/=l.bt,I/=l.bt,C+=1,I+=1,e.z<=0)return ms.fromAabb([-I,-I,-I],[I,I,I]);if(e.z===1)return ms.fromAabb([e.x===0?-I:0,e.y===0?0:-I,-I],[e.x===0?0:I,e.y===0?I:0,I]);{const R=[eo(0,0,e.x,e.y,e.z),eo(l.$,0,e.x,e.y,e.z),eo(l.$,l.$,e.x,e.y,e.z),eo(0,l.$,e.x,e.y,e.z)],F=[];for(const Be of R)F.push(l.aQ([],Be,I));if(I!==C)for(const Be of R)F.push(l.aQ([],Be,C));e.y===0&&F.push([0,1,0]),e.y===(1<<e.z)-1&&F.push([0,-1,0]);const j=[1,1,1],N=[-1,-1,-1];for(const Be of F)for(let Ve=0;Ve<3;Ve++)j[Ve]=Math.min(j[Ve],Be[Ve]),N[Ve]=Math.max(N[Ve],Be[Ve]);const Z=eo(l.$/2,l.$/2,e.x,e.y,e.z),K=l.aV([],[0,1,0],Z);l.aU(K,K);const se=l.aV([],Z,K);l.aU(se,se);const oe=l.aV([],R[2],R[1]);l.aU(oe,oe);const ae=l.aV([],R[0],R[3]);l.aU(ae,ae),F.push(l.aQ([],Z,I)),e.y>=(1<<e.z)/2&&F.push(l.aQ([],eo(l.$/2,0,e.x,e.y,e.z),I)),e.y<(1<<e.z)/2&&F.push(l.aQ([],eo(l.$/2,l.$,e.x,e.y,e.z),I));const ue=nr(Z,F),fe=nr(se,F),de=[-Z[0],-Z[1],-Z[2],ue.max],_e=[Z[0],Z[1],Z[2],-ue.min],we=[-se[0],-se[1],-se[2],fe.max],pe=[se[0],se[1],se[2],-fe.min],Ae=[...oe,0],$e=[...ae,0],De=[];return e.y===0?De.push(l.bs($e,Ae,de),l.bs($e,Ae,_e)):De.push(l.bs(we,Ae,de),l.bs(we,Ae,_e),l.bs(we,$e,de),l.bs(we,$e,_e)),e.y===(1<<e.z)-1?De.push(l.bs($e,Ae,de),l.bs($e,Ae,_e)):De.push(l.bs(pe,Ae,de),l.bs(pe,Ae,_e),l.bs(pe,$e,de),l.bs(pe,$e,_e)),new ms(De,[de,_e,we,pe,Ae,$e],j,N)}}}function nr(v,e){let r=1/0,h=-1/0;for(const p of e){const x=l.aW(v,p);r=Math.min(r,x),h=Math.max(h,x)}return{min:r,max:h}}class gs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,h){return this._helper.interpolatePadding(e,r,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bu(),this._projectionMatrix=l.b8(),this._globeViewProjMatrix32f=l.b7(),this._globeViewProjMatrixNoCorrection=l.b8(),this._globeViewProjMatrixNoCorrectionInverted=l.b8(),this._globeProjMatrixInverted=l.b8(),this._cameraPosition=l.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ds({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Du}clone(){const e=new gs;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:h}=e,p=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,h=this.cameraToCenterDistance/e,p=Math.sin(r)*h,x=Math.cos(r)*h+1,T=1/Math.sqrt(p*p+x*x)*1;let C=-p,I=x;const R=Math.sqrt(C*C+I*I);C/=R,I/=R;const F=[0,C,I];l.bv(F,F,[0,0,0],-this.bearingInRadians),l.bw(F,F,[0,0,0],-1*this.center.lat*Math.PI/180),l.bx(F,F,[0,0,0],this.center.lng*Math.PI/180);const j=1/l.aY(F);return l.aQ(F,F,j),[...F,-T*j]}isLocationOccluded(e){return!this.isSurfacePointVisible($n(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,p=Math.cos(h),x=[Math.sin(r)*p,Math.sin(h),Math.cos(r)*p],T=[x[2],0,-x[0]],C=[0,0,0];l.aV(C,T,x),l.aU(T,T),l.aU(C,C);const I=[0,0,0];return l.aU(I,[T[0]*e[0]+C[0]*e[1]+x[0]*e[2],T[1]*e[0]+C[1]*e[1]+x[1]*e[2],T[2]*e[0]+C[2]*e[1]+x[2]*e[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,h){const p=function(C,I,R){const F=1/(1<<R.z);return new l.a0(C/l.$*F+R.x*F,I/l.$*F+R.y*F)}(e,r,h.canonical),x=(T=p.y,[l.bn(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(e,r,h,p){const x=h.canonical,T=eo(e,r,x.x,x.y,x.z),C=1+(p?p(e,r):0)/l.bt,I=[T[0]*C,T[1]*C,T[2]*C,1];l.av(I,I,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,F=R[0]*T[0]+R[1]*T[1]+R[2]*T[2]+R[3]<0;return{point:new l.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:F}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ps(this.worldSize,this.center.lat),r=l.b9(),h=l.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.b3(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;r[8]=2*-p.x/this._helper._width,r[9]=2*p.y/this._helper._height,this._projectionMatrix=l.b4(r),this._globeProjMatrixInverted=l.b9(),l.ap(this._globeProjMatrixInverted,r),l.M(r,r,[0,0,-this.cameraToCenterDistance]),l.b5(r,r,this.rollInRadians),l.b6(r,r,-this.pitchInRadians),l.b5(r,r,this.bearingInRadians),l.M(r,r,[0,0,-e]);const x=l.bo();x[0]=e,x[1]=e,x[2]=e,l.b6(h,r,this.center.lat*Math.PI/180),l.by(h,h,-this.center.lng*Math.PI/180),l.N(h,h,x),this._globeViewProjMatrixNoCorrection=h,l.b6(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.by(r,r,-this.center.lng*Math.PI/180),l.N(r,r,x),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=l.b9(),l.ap(this._globeViewProjMatrixNoCorrectionInverted,h);const T=l.bo();this._cameraPosition=l.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bv(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),l.bw(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),l.bv(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),l.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bw(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),l.bx(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const C=l.b4(this._globeViewProjMatrixNoCorrectionInverted);l.N(C,C,[1,1,-1]),this._cachedFrustum=cn.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const r=l.b9();return l.af(r),r}getVisibleUnwrappedCoordinates(e){return[new l.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const h=$n(e);l.aQ(h,h,1+r/l.bt);const p=l.bu();return l.av(p,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,h=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,r),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,r)],p=[];for(const j of h)p.push(this.unprojectScreenPoint(j));let x=0,T=0,C=0,I=0;const R=this.center;for(const j of p){const N=l.bz(R.lng,j.lng),Z=l.bz(R.lat,j.lat);N<T&&(T=N),N>x&&(x=N),Z<I&&(I=Z),Z>C&&(C=Z)}const F=[R.lng+T,R.lat+I,R.lng+x,R.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(F[3]=90,F[0]=-180,F[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(F[1]=-90,F[0]=-180,F[2]=180),new Pe(F)}getConstrained(e,r){const h=l.ag(e.lat,-l.ah,l.ah),p=l.ag(+r,this.minZoom+kn(0,h),this.maxZoom);return{center:new l.S(e.lng,h),zoom:p}}calculateCenterFromCameraLngLatAlt(e,r,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,h,p)}setLocationAtPoint(e,r){const h=$n(this.unprojectScreenPoint(r)),p=$n(e),x=l.bo();l.bA(x);const T=l.bo();l.bx(T,h,x,-this.center.lng*Math.PI/180),l.bw(T,T,x,this.center.lat*Math.PI/180);const C=p[0]*p[0]+p[2]*p[2],I=T[0]*T[0];if(C<I)return;const R=Math.sqrt(C-I),F=-R,j=l.bB(p[0],p[2],T[0],R),N=l.bB(p[0],p[2],T[0],F),Z=l.bo();l.bx(Z,p,x,-j);const K=l.bB(Z[1],Z[2],T[1],T[2]),se=l.bo();l.bx(se,p,x,-N);const oe=l.bB(se[1],se[2],T[1],T[2]),ae=.5*Math.PI,ue=K>=-ae&&K<=ae,fe=oe>=-ae&&oe<=ae;let de,_e;if(ue&&fe){const $e=this.center.lng*Math.PI/180,De=this.center.lat*Math.PI/180;l.bC(j,$e)+l.bC(K,De)<l.bC(N,$e)+l.bC(oe,De)?(de=j,_e=K):(de=N,_e=oe)}else if(ue)de=j,_e=K;else{if(!fe)return;de=N,_e=oe}const we=de/Math.PI*180,pe=_e/Math.PI*180,Ae=this.center.lat;this.setCenter(new l.S(we,l.ag(pe,-90,90))),this.setZoom(this.zoom+kn(Ae,this.center.lat))}locationToScreenPoint(e,r){const h=$n(e);if(r){const p=r.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aQ(h,h,1+p/l.bt)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){const r=l.bu();return l.av(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new l.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const h=r.pointCoordinate(e);if(h)return h}return l.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var h;return(h=this.screenPointToMercatorCoordinate(e,r))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,r){const h=this._cameraPosition,p=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,p)}getRayDirectionFromPixel(e){const r=l.bu();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,l.av(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const h=l.bo();h[0]=r[0]-this._cameraPosition[0],h[1]=r[1]-this._cameraPosition[1],h[2]=r[2]-this._cameraPosition[2];const p=l.bo();return l.aU(p,h),p}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=l.bu();return l.av(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const h=l.aW(e,r),p=l.bo(),x=l.bo();l.aQ(x,r,h),l.aT(p,e,x);const T=1-l.aW(p,p);if(T<0)return null;const C=l.aW(e,e)-1,I=-h+(h<0?1:-1)*Math.sqrt(T),R=C/I,F=I;return{tMin:Math.min(R,F),tMax:Math.max(R,F)}}unprojectScreenPoint(e){const r=this._cameraPosition,h=this.getRayDirectionFromPixel(e),p=this.rayPlanetIntersection(r,h);if(p){const F=l.bo();l.aR(F,r,[h[0]*p.tMin,h[1]*p.tMin,h[2]*p.tMin]);const j=l.bo();return l.aU(j,F),el(j)}const x=this._cachedClippingPlane,T=x[0]*h[0]+x[1]*h[1]+x[2]*h[2],C=-l.b0(x,r)/T,I=l.bo();if(C>0)l.aR(I,r,[h[0]*C,h[1]*C,h[2]*C]);else{const F=l.bo();l.aR(F,r,[2*h[0],2*h[1],2*h[2]]);const j=l.b0(this._cachedClippingPlane,F);l.aT(I,F,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}const R=function(F){const j=l.bo();return j[0]=F[0]*-F[3],j[1]=F[1]*-F[3],j[2]=F[2]*-F[3],{center:j,radius:Math.sqrt(1-F[3]*F[3])}}(x);return el(function(F,j,N){const Z=l.bo();l.aT(Z,N,F);const K=l.bo();return l.bp(K,F,Z,j/l.a_(Z)),K}(R.center,R.radius,I))}getMatrixForModel(e,r){const h=l.S.convert(e),p=1/l.bt,x=l.b8();return l.by(x,x,h.lng/180*Math.PI),l.b6(x,x,-h.lat/180*Math.PI),l.M(x,x,[0,0,1+r/l.bt]),l.b6(x,x,.5*Math.PI),l.N(x,x,[p,p,p]),x}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new l.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class $r{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,h){return this._helper.interpolatePadding(e,r,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,h=!0){this._helper.resize(e,r,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ds({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new li,this._verticalPerspectiveTransform=new gs}clone(){const e=new $r;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:r.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,h){const p=this._mercatorTransform.getPitchedTextCorrection(e,r,h),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,h);return l.bj(p,x,this._globeness)}projectTileCoordinates(e,r,h,p){return this.currentTransform.projectTileCoordinates(e,r,h,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,h,p)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=r.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class yr{get useGlobeControls(){return!0}handlePanInertia(e,r){const h=tl(e,r);return Math.abs(h.lng-r.center.lng)>180&&(h.lng=r.center.lng+179.5*Math.sign(h.lng-r.center.lng)),{easingCenter:h,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const h=e.around,p=r.screenPointToLocation(h);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const x=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const T=r.zoom-x;if(T===0)return;const C=l.bz(r.center.lng,p.lng),I=C/(Math.abs(C/180)+1),R=l.bz(r.center.lat,p.lat),F=r.getRayDirectionFromPixel(h),j=r.cameraPosition,N=-1*l.aW(j,F),Z=l.bo();l.aR(Z,j,[F[0]*N,F[1]*N,F[2]*N]);const K=l.aY(Z)-1,se=Math.exp(.5*-Math.max(K-.3,0)),oe=ps(r.worldSize,r.center.lat)/Math.min(r.width,r.height),ae=l.bm(oe,.9,.5,1,.25),ue=(1-l.ae(-T))*Math.min(se,ae),fe=r.center.lat,de=r.zoom,_e=new l.S(r.center.lng+I*ue,l.ag(r.center.lat+R*ue,-l.ah,l.ah));r.setLocationAtPoint(p,h);const we=r.center,pe=l.bm(Math.abs(C),45,85,0,1),Ae=l.bm(oe,.75,.35,0,1),$e=Math.pow(Math.max(pe,Ae),.25),De=l.bz(we.lng,_e.lng),Be=l.bz(we.lat,_e.lat);r.setCenter(new l.S(we.lng+De*$e,we.lat+Be*$e).wrap()),r.setZoom(de+kn(fe,r.center.lat))}handleMapControlsPan(e,r,h){if(!e.panDelta)return;const p=r.center.lat,x=r.zoom;r.setCenter(tl(e.panDelta,r).wrap()),r.setZoom(x+kn(p,r.center.lat))}cameraForBoxAndBearing(e,r,h,p,x){const T=tn(e,r,h,p,x),C=r.left/x.width*2-1,I=(x.width-r.right)/x.width*2-1,R=r.top/x.height*-2+1,F=(x.height-r.bottom)/x.height*-2+1,j=l.bz(h.getWest(),h.getEast())<0,N=j?h.getEast():h.getWest(),Z=j?h.getWest():h.getEast(),K=Math.max(h.getNorth(),h.getSouth()),se=Math.min(h.getNorth(),h.getSouth()),oe=N+.5*l.bz(N,Z),ae=K+.5*l.bz(K,se),ue=x.clone();ue.setCenter(T.center),ue.setBearing(T.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(T.zoom);const fe=ue.modelViewProjectionMatrix,de=[$n(h.getNorthWest()),$n(h.getNorthEast()),$n(h.getSouthWest()),$n(h.getSouthEast()),$n(new l.S(Z,ae)),$n(new l.S(N,ae)),$n(new l.S(oe,K)),$n(new l.S(oe,se))],_e=$n(T.center);let we=Number.POSITIVE_INFINITY;for(const pe of de)C<0&&(we=yr.getLesserNonNegativeNonNull(we,yr.solveVectorScale(pe,_e,fe,"x",C))),I>0&&(we=yr.getLesserNonNegativeNonNull(we,yr.solveVectorScale(pe,_e,fe,"x",I))),R>0&&(we=yr.getLesserNonNegativeNonNull(we,yr.solveVectorScale(pe,_e,fe,"y",R))),F<0&&(we=yr.getLesserNonNegativeNonNull(we,yr.solveVectorScale(pe,_e,fe,"y",F)));if(Number.isFinite(we)&&we!==0)return T.zoom=ue.zoom+l.aj(we),T;Gn()}handleJumpToCenterZoom(e,r){const h=e.center.lat,p=e.getConstrained(r.center?l.S.convert(r.center):e.center,e.zoom).center;e.setCenter(p.wrap());const x=r.zoom!==void 0?+r.zoom:e.zoom+kn(h,p.lat);e.zoom!==x&&e.setZoom(x)}handleEaseTo(e,r){const h=e.zoom,p=e.center,x=e.padding,T={roll:e.roll,pitch:e.pitch,bearing:e.bearing},C={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},I=r.zoom!==void 0,R=!e.isPaddingEqual(r.padding);let F=!1;const j=r.center?l.S.convert(r.center):p,N=e.getConstrained(j,h).center;Qr(e,N);const Z=e.clone();Z.setCenter(N),Z.setZoom(I?+r.zoom:h+kn(p.lat,j.lat)),Z.setBearing(r.bearing);const K=new l.P(l.ag(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),l.ag(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));Z.setLocationAtPoint(N,K);const se=(r.offset&&r.offsetAsPoint.mag())>0?Z.center:N,oe=I?+r.zoom:h+kn(p.lat,se.lat),ae=h+kn(p.lat,0),ue=oe+kn(se.lat,0),fe=l.bz(p.lng,se.lng),de=l.bz(p.lat,se.lat),_e=l.ae(ue-ae);return F=oe!==h,{easeFunc:we=>{if(l.bd(T,C)||Ln({startEulerAngles:T,endEulerAngles:C,tr:e,k:we,useSlerp:T.roll!=C.roll}),R&&e.interpolatePadding(x,r.padding,we),r.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const pe=ue>ae?Math.min(2,_e):Math.max(.5,_e),Ae=Math.pow(pe,1-we),$e=pa(p,fe,de,we*Ae);e.setCenter($e.wrap())}if(F){const pe=l.C.number(ae,ue,we)+kn(0,e.center.lat);e.setZoom(pe)}},isZooming:F,elevationCenter:se}}handleFlyTo(e,r){const h=r.zoom!==void 0,p=e.center,x=e.zoom,T=e.padding,C=!e.isPaddingEqual(r.padding),I=e.getConstrained(l.S.convert(r.center||r.locationAtOffset),x).center,R=h?+r.zoom:e.zoom+kn(e.center.lat,I.lat),F=e.clone();F.setCenter(I),F.setZoom(R),F.setBearing(r.bearing);const j=new l.P(l.ag(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),l.ag(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));F.setLocationAtPoint(I,j);const N=F.center;Qr(e,N);const Z=function(de,_e,we){const pe=$n(_e),Ae=$n(we),$e=l.aW(pe,Ae),De=Math.acos($e),Be=$o(de);return De/(2*Math.PI)*Be}(e,p,N),K=x+kn(p.lat,0),se=R+kn(N.lat,0),oe=l.ae(se-K);let ae;if(typeof r.minZoom=="number"){const de=+r.minZoom+kn(N.lat,0),_e=Math.min(de,K,se)+kn(0,N.lat),we=e.getConstrained(N,_e).zoom+kn(N.lat,0);ae=l.ae(we-K)}const ue=l.bz(p.lng,N.lng),fe=l.bz(p.lat,N.lat);return{easeFunc:(de,_e,we,pe)=>{const Ae=pa(p,ue,fe,we);C&&e.interpolatePadding(T,r.padding,de);const $e=de===1?N:Ae;e.setCenter($e.wrap());const De=K+l.aj(_e);e.setZoom(de===1?R:De+kn(0,$e.lat))},scaleOfZoom:oe,targetCenter:N,scaleOfMinZoom:ae,pixelPathLength:Z}}static solveVectorScale(e,r,h,p,x){const T=p==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],C=[h[3],h[7],h[11],h[15]],I=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],R=e[0]*C[0]+e[1]*C[1]+e[2]*C[2],F=r[0]*T[0]+r[1]*T[1]+r[2]*T[2],j=r[0]*C[0]+r[1]*C[1]+r[2]*C[2];return F+x*R===I+x*j||C[3]*(I-F)+T[3]*(j-R)+I*j==F*R?null:(F+T[3]-x*j-x*C[3])/(F-I-x*j+x*R)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Bl{constructor(e){this._globe=e,this._mercatorCameraHelper=new da,this._verticalPerspectiveCameraHelper=new yr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,h){this.currentHelper.handleMapControlsPan(e,r,h)}cameraForBoxAndBearing(e,r,h,p,x){return this.currentHelper.cameraForBoxAndBearing(e,r,h,p,x)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const il=(v,e)=>l.y(v,e&&e.filter(r=>r.identifier!=="source.canvas")),ma=l.bD();class nl extends l.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const h in this.sourceCaches){const p=this.sourceCaches[h].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[h].reload()}},this.map=e,this.dispatcher=new oi(Ai(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,p)=>this.getGlyphs(h,p)),this.dispatcher.registerMessageHandler("GI",(h,p)=>this.getImages(h,p)),this.imageManager=new et,this.imageManager.setEventedParent(this),this.glyphManager=new Et(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new pr(256,512),this.crossTileSymbolIndex=new Po,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",l.bF()),yi().on(Ft,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const p=this.sourceCaches[h.sourceId];if(!p)return;const x=p.getSource();if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}setGlobalStateProperty(e,r){var h,p,x;this._checkLoaded();const T=r===null?(x=(p=(h=this.stylesheet.state)===null||h===void 0?void 0:h[e])===null||p===void 0?void 0:p.default)!==null&&x!==void 0?x:null:r;if(l.bG(T,this._globalState[e]))return this;this._globalState[e]=T;const C=this._findGlobalStateAffectedSources([e]);for(const I in this.sourceCaches)C.has(I)&&(this._reloadSource(I),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const p in e)!l.bG(this._globalState[p],e[p].default)&&(r.push(p),this._globalState[p]=e[p].default);const h=this._findGlobalStateAffectedSources(r);for(const p in this.sourceCaches)h.has(p)&&(this._reloadSource(p),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const r=new Set;for(const h in this._layers){const p=this._layers[h],x=p.getLayoutAffectingGlobalStateRefs();for(const T of e)x.has(T)&&r.add(p.source)}return r}loadURL(e,r={},h){this.fire(new l.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;l.j(p,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,r,h)}).catch(T=>{this._loadStyleRequest=null,T&&!x.signal.aborted&&this.fire(new l.k(T))})}loadJSON(e,r={},h){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,h)}).catch(()=>{})}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(ma,{validate:!1})}_load(e,r,h){var p,x,T;const C=r.transformStyle?r.transformStyle(h,e):e;if(!r.validate||!il(this,l.z(C))){this._loaded=!0,this.stylesheet=C;for(const I in C.sources)this.addSource(I,C.sources[I],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new ni(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new It(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.setGlobalState((T=this.stylesheet.state)!==null&&T!==void 0?T:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){const e=l.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const h=l.bI(r);h.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=h}}_loadSprite(e,r=!1,h=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,T,C,I){return l._(this,void 0,void 0,function*(){const R=ke(x),F=C>1?"@2x":"",j={},N={};for(const{id:Z,url:K}of R){const se=T.transformRequest(Qe(K,F,".json"),"SpriteJSON");j[Z]=l.j(se,I);const oe=T.transformRequest(Qe(K,F,".png"),"SpriteImage");N[Z]=xe.getImage(oe,I)}return yield Promise.all([...Object.values(j),...Object.values(N)]),function(Z,K){return l._(this,void 0,void 0,function*(){const se={};for(const oe in Z){se[oe]={};const ae=X.getImageCanvasContext((yield K[oe]).data),ue=(yield Z[oe]).data;for(const fe in ue){const{width:de,height:_e,x:we,y:pe,sdf:Ae,pixelRatio:$e,stretchX:De,stretchY:Be,content:Ve,textFitWidth:vt,textFitHeight:gt}=ue[fe];se[oe][fe]={data:null,pixelRatio:$e,sdf:Ae,stretchX:De,stretchY:Be,content:Ve,textFitWidth:vt,textFitHeight:gt,spriteData:{width:de,height:_e,x:we,y:pe,context:ae}}}}return se})}(j,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const T in x){this._spritesImagesIds[T]=[];const C=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(I=>!(I in x)):[];for(const I of C)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in x[T]){const R=T==="default"?I:`${T}:${I}`;this._spritesImagesIds[T].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,x[T][I],!1):this.imageManager.addImage(R,x[T][I]),r&&(this._changedImages[R]=!0)}}}).catch(x=>{this._spriteRequest=null,p=x,this.fire(new l.k(p))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),h&&h(p)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const h=e.sourceLayer;if(!h)return;const p=r.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new l.k(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?l.bJ(h):h);const p=[];for(const x of e)if(h[x]){const T=r?l.bJ(h[x]):h[x];p.push(T)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const h of r){const p=this._layers[h];p.type!=="custom"&&(e[h]=p.serialize())}return e}hasTransitions(){var e,r,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(const p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const p=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(p.length||x.length)&&this._updateWorkerLayers(p,x);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const h={};for(const p in this.sourceCaches){const x=this.sourceCaches[p];h[p]=x.used,x.used=!1}for(const p of this._order){const x=this._layers[p];x.recalculate(e,this._availableImages),!x.isHidden(e.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const p in h){const x=this.sourceCaches[p];!!h[p]!=!!x.used&&x.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var h;this._checkLoaded();const p=this.serialize();if(e=r.transformStyle?r.transformStyle(p,e):e,((h=r.validate)===null||h===void 0||h)&&il(this,l.z(e)))return!1;(e=l.bJ(e)).layers=l.bH(e.layers);const x=l.bK(p,e),T=this._getOperationsToPerform(x);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],h=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":r.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":r.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setSky":r.push(()=>this.setSky.apply(this,p.args));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,p.args));break;case"setTransition":r.push(()=>{});break;default:h.push(p.command)}return{operations:r,unimplemented:h}}addImage(e,r){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(l.z.source,`sources.${e}`,r,null,h))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=this.sourceCaches[e]=new Je(e,r,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,h={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new l.k(new Error(`Layer "${p}" already exists on this map.`)));let x;if(e.type==="custom"){if(il(this,l.bL(e)))return;x=l.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=l.bJ(e),e=l.e(e,{source:p})),this._validate(l.z.layer,`layers.${p}`,e,{arrayIndex:-1},h))return;x=l.bI(e),this._validateLayer(x),x.setEventedParent(this,{layer:{id:p}})}const T=r?this._order.indexOf(r):this._order.length;if(r&&T===-1)this.fire(new l.k(new Error(`Cannot add layer "${p}" before non-existing layer "${r}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=x,this._removedLayers[p]&&x.source&&x.type!=="custom"){const C=this._removedLayers[p];delete this._removedLayers[p],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const h=this._order.indexOf(e);this._order.splice(h,1);const p=r?this._order.indexOf(r):this._order.length;r&&p===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,h){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===r&&p.maxzoom===h||(r!=null&&(p.minzoom=r),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,h={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!l.bG(p.filter,r))return r==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(l.z.filter,`layers.${p.id}.filter`,r,null,h)||(p.setFilter(l.bJ(r)),this._updateLayer(p)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.bJ(this.getLayer(e).filter)}setLayoutProperty(e,r,h,p={}){this._checkLoaded();const x=this.getLayer(e);x?l.bG(x.getLayoutProperty(r),h)||(x.setLayoutProperty(r,h,p),this._updateLayer(x)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const h=this.getLayer(e);if(h)return h.getLayoutProperty(r);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,h,p={}){this._checkLoaded();const x=this.getLayer(e);x?l.bG(x.getPaintProperty(r),h)||(x.setPaintProperty(r,h,p)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const h=e.source,p=e.sourceLayer,x=this.sourceCaches[h];if(x===void 0)return void this.fire(new l.k(new Error(`The source '${h}' does not exist in the map's style.`)));const T=x.getSource().type;T==="geojson"&&p?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(p,e.id,r)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const h=e.source,p=this.sourceCaches[h];if(p===void 0)return void this.fire(new l.k(new Error(`The source '${h}' does not exist in the map's style.`)));const x=p.getSource().type,T=x==="vector"?e.sourceLayer:void 0;x!=="vector"||T?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,e.id,r):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,h=e.sourceLayer,p=this.sourceCaches[r];if(p!==void 0)return p.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bM(this.sourceCaches,x=>x.serialize()),r=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,p=this.stylesheet;return l.bN({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:e,layers:r,terrain:h},x=>x!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=T=>this._layers[T].type==="fill-extrusion",h={},p=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(r(C)){h[C]=T;for(const I of e){const R=I[C];if(R)for(const F of R)p.push(F)}}}p.sort((T,C)=>C.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(r(C))for(let I=p.length-1;I>=0;I--){const R=p[I].feature;if(h[R.layer.id]<T)break;x.push(R),p.pop()}else for(const I of e){const R=I[C];if(R)for(const F of R)x.push(F.feature)}}return x}queryRenderedFeatures(e,r,h){r&&r.filter&&this._validate(l.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const p={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of r.layers){const F=this._layers[R];if(!F)return this.fire(new l.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];p[F.source]=!0}}const x=[];r.availableImages=this._availableImages;const T=this._serializedAllLayers(),C=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,I=Object.assign(Object.assign({},r),{layers:C});for(const R in this.sourceCaches)r.layers&&!p[R]||x.push(dn(this.sourceCaches[R],this._layers,T,e,I,h,this.map.terrain?(F,j,N)=>this.map.terrain.getElevation(F,j,N):void 0));return this.placement&&x.push(function(R,F,j,N,Z,K,se){const oe={},ae=K.queryRenderedSymbols(N),ue=[];for(const fe of Object.keys(ae).map(Number))ue.push(se[fe]);ue.sort(Fr);for(const fe of ue){const de=fe.featureIndex.lookupSymbolFeatures(ae[fe.bucketInstanceId],F,fe.bucketIndex,fe.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,R);for(const _e in de){const we=oe[_e]=oe[_e]||[],pe=de[_e];pe.sort((Ae,$e)=>{const De=fe.featureSortOrder;if(De){const Be=De.indexOf(Ae.featureIndex);return De.indexOf($e.featureIndex)-Be}return $e.featureIndex-Ae.featureIndex});for(const Ae of pe)we.push(Ae)}}return function(fe,de,_e){for(const we in fe)for(const pe of fe[we])er(pe,_e[de[we].source]);return fe}(oe,R,j)}(this._layers,T,this.sourceCaches,e,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(e,r){r&&r.filter&&this._validate(l.z.filter,"querySourceFeatures.filter",r.filter,null,r);const h=this.sourceCaches[e];return h?function(p,x){const T=p.getRenderableIds().map(R=>p.getTileByID(R)),C=[],I={};for(let R=0;R<T.length;R++){const F=T[R],j=F.tileID.canonical.key;I[j]||(I[j]=!0,F.querySourceFeatures(C,x))}return C}(h,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const T in e)if(!l.bG(e[T],h[T])){p=!0;break}if(!p)return;const x={now:X.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(x)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const h=this.getSky();let p=!1;if(!e&&!h)return;if(e&&!h)p=!0;else if(!e&&h)p=!0;else for(const T in e)if(!l.bG(e[T],h[T])){p=!0;break}if(!p)return;const x={now:X.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(x)}_setProjectionInternal(e){const r=function(h){if(Array.isArray(h)){const p=new _r({type:h});return{projection:p,transform:new $r,cameraHelper:new Bl(p)}}switch(h){case"mercator":return{projection:new Qa,transform:new li,cameraHelper:new da};case"globe":{const p=new _r({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:p,transform:new $r,cameraHelper:new Bl(p)}}case"vertical-perspective":return{projection:new zi,transform:new gs,cameraHelper:new yr};default:return l.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new Qa,transform:new li,cameraHelper:new da}}}(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const h in this.sourceCaches)this.sourceCaches[h].reload()}_validate(e,r,h,p,x={}){return(!x||x.validate!==!1)&&il(this,e.call(l.z,l.e({key:r,style:this.serialize(),value:h,styleSpec:l.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yi().off(Ft,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const h=this.sourceCaches[r];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,h,p,x=!1){let T=!1,C=!1;const I={};for(const R of this._order){const F=this._layers[R];if(F.type!=="symbol")continue;if(!I[F.source]){const N=this.sourceCaches[F.source];I[F.source]=N.getRenderableIds(!0).map(Z=>N.getTileByID(Z)).sort((Z,K)=>K.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(K.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(F,I[F.source],e.center.lng);T=T||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(X.now(),e.zoom))&&(this.pauseablePlacement=new Nr(e,this.map.terrain,this._order,x,r,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(X.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const R of this._order){const F=this._layers[R];F.type==="symbol"&&this.placement.updateLayerOpacities(F,I[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(X.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return l._(this,void 0,void 0,function*(){const h=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[r.source];return p&&p.setDependencies(r.tileID.key,r.type,r.icons),h})}getGlyphs(e,r){return l._(this,void 0,void 0,function*(){const h=yield this.glyphManager.getGlyphs(r.stacks),p=this.sourceCaches[r.source];return p&&p.setDependencies(r.tileID.key,r.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(l.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,h={},p){this._checkLoaded();const x=[{id:e,url:r}],T=[...ke(this.stylesheet.sprite),...x];this._validate(l.z.sprite,"sprite",T,null,h)||(this.stylesheet.sprite=T,this._loadSprite(x,!0,p))}removeSprite(e){this._checkLoaded();const r=ke(this.stylesheet.sprite);if(r.find(h=>h.id===e)){if(this._spritesImagesIds[e])for(const h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;r.splice(r.findIndex(h=>h.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(e,r={},h){this._checkLoaded(),e&&this._validate(l.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}var Oh=l.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ou{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,h,p,x,T,C,I,R){this.context=e;let F=this.boundPaintVertexBuffers.length!==p.length;for(let j=0;!F&&j<p.length;j++)this.boundPaintVertexBuffers[j]!==p[j]&&(F=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==h||F||this.boundIndexBuffer!==x||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==R?this.freshBind(r,h,p,x,T,C,I,R):(e.bindVertexArray.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),I&&I.bind(),R&&R.bind())}freshBind(e,r,h,p,x,T,C,I){const R=e.numAttributes,F=this.context,j=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=I,r.enableAttributes(j,e);for(const N of h)N.enableAttributes(j,e);T&&T.enableAttributes(j,e),C&&C.enableAttributes(j,e),I&&I.enableAttributes(j,e),r.bind(),r.setVertexAttribPointers(j,e,x);for(const N of h)N.bind(),N.setVertexAttribPointers(j,e,x);T&&(T.bind(),T.setVertexAttribPointers(j,e,x)),p&&p.bind(),C&&(C.bind(),C.setVertexAttribPointers(j,e,x)),I&&(I.bind(),I.setVertexAttribPointers(j,e,x)),F.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Fu=(v,e,r,h,p)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):l.be.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:r?r.calculateFogBlendOpacity(h):0,u_horizon_color:r?r.properties.get("horizon-color"):l.be.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),Nl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Eo(v){const e=[];for(let r=0;r<v.length;r++){if(v[r]===null)continue;const h=v[r].split(" ");e.push(h.pop())}return e}class jl{constructor(e,r,h,p,x,T,C,I,R=[]){const F=e.gl;this.program=F.createProgram();const j=Eo(r.staticAttributes),N=h?h.getBinderAttributes():[],Z=j.concat(N),K=Ar.prelude.staticUniforms?Eo(Ar.prelude.staticUniforms):[],se=C.staticUniforms?Eo(C.staticUniforms):[],oe=r.staticUniforms?Eo(r.staticUniforms):[],ae=h?h.getBinderUniforms():[],ue=K.concat(se).concat(oe).concat(ae),fe=[];for(const De of ue)fe.indexOf(De)<0&&fe.push(De);const de=h?h.defines():[];gr(F)&&de.unshift("#version 300 es"),x&&de.push("#define OVERDRAW_INSPECTOR;"),T&&de.push("#define TERRAIN3D;"),I&&de.push(I),R&&de.push(...R);let _e=de.concat(Ar.prelude.fragmentSource,C.fragmentSource,r.fragmentSource).join(`
`),we=de.concat(Ar.prelude.vertexSource,C.vertexSource,r.vertexSource).join(`
`);gr(F)||(_e=function(De){return De.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(_e),we=function(De){return De.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(we));const pe=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(pe,_e),F.compileShader(pe),!F.getShaderParameter(pe,F.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${F.getShaderInfoLog(pe)}`);F.attachShader(this.program,pe);const Ae=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(Ae,we),F.compileShader(Ae),!F.getShaderParameter(Ae,F.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${F.getShaderInfoLog(Ae)}`);F.attachShader(this.program,Ae),this.attributes={};const $e={};this.numAttributes=Z.length;for(let De=0;De<this.numAttributes;De++)Z[De]&&(F.bindAttribLocation(this.program,De,Z[De]),this.attributes[Z[De]]=De);if(F.linkProgram(this.program),!F.getProgramParameter(this.program,F.LINK_STATUS))throw new Error(`Program failed to link: ${F.getProgramInfoLog(this.program)}`);F.deleteShader(Ae),F.deleteShader(pe);for(let De=0;De<fe.length;De++){const Be=fe[De];if(Be&&!$e[Be]){const Ve=F.getUniformLocation(this.program,Be);Ve&&($e[Be]=Ve)}}this.fixedUniforms=p(e,$e),this.terrainUniforms=((De,Be)=>({u_depth:new l.bO(De,Be.u_depth),u_terrain:new l.bO(De,Be.u_terrain),u_terrain_dim:new l.bf(De,Be.u_terrain_dim),u_terrain_matrix:new l.bQ(De,Be.u_terrain_matrix),u_terrain_unpack:new l.bR(De,Be.u_terrain_unpack),u_terrain_exaggeration:new l.bf(De,Be.u_terrain_exaggeration)}))(e,$e),this.projectionUniforms=((De,Be)=>({u_projection_matrix:new l.bQ(De,Be.u_projection_matrix),u_projection_tile_mercator_coords:new l.bR(De,Be.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bR(De,Be.u_projection_clipping_plane),u_projection_transition:new l.bf(De,Be.u_projection_transition),u_projection_fallback_matrix:new l.bQ(De,Be.u_projection_fallback_matrix)}))(e,$e),this.binderUniforms=h?h.getUniforms(e,$e):[]}draw(e,r,h,p,x,T,C,I,R,F,j,N,Z,K,se,oe,ae,ue,fe){const de=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(p),e.setColorMode(x),e.setCullFace(T),I){e.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,I.depthTexture),e.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,I.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(I[we])}if(R)for(const we in R)this.projectionUniforms[Nl[we]].set(R[we]);if(C)for(const we in this.fixedUniforms)this.fixedUniforms[we].set(C[we]);oe&&oe.setUniforms(e,this.binderUniforms,K,{zoom:se});let _e=0;switch(r){case de.LINES:_e=2;break;case de.TRIANGLES:_e=3;break;case de.LINE_STRIP:_e=1}for(const we of Z.get()){const pe=we.vaos||(we.vaos={});(pe[F]||(pe[F]=new Ou)).bind(e,this,j,oe?oe.getPaintVertexBuffers():[],N,we.vertexOffset,ae,ue,fe),de.drawElements(r,we.primitiveLength*_e,de.UNSIGNED_SHORT,we.primitiveOffset*_e*2)}}}function _s(v,e,r){const h=1/l.aB(r,1,e.transform.tileZoom),p=Math.pow(2,r.tileID.overscaledZ),x=r.tileSize*Math.pow(2,e.transform.tileZoom)/p,T=x*(r.tileID.canonical.x+r.tileID.wrap*p),C=x*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[h,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const rr=(v,e,r,h)=>{const p=v.style.light,x=p.properties.get("position"),T=[x.x,x.y,x.z],C=l.bU();p.properties.get("anchor")==="viewport"&&l.bV(C,v.transform.bearingInRadians),l.bW(T,T,C);const I=v.transform.transformLightDirection(T),R=p.properties.get("color");return{u_lightpos:T,u_lightpos_globe:I,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:h}},Ul=(v,e,r,h,p,x,T)=>l.e(rr(v,e,r,h),_s(x,v,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),rl=(v,e,r,h)=>l.e(_s(e,v,r),{u_fill_translate:h}),Io=(v,e)=>({u_world:v,u_fill_translate:e}),Ec=(v,e,r,h,p)=>l.e(rl(v,e,r,p),{u_world:h}),ol=(v,e,r,h,p)=>{const x=v.transform;let T,C,I=0;if(r.paint.get("circle-pitch-alignment")==="map"){const R=l.aB(e,1,x.zoom);T=!0,C=[R,R],I=R/(l.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*p}else T=!1,C=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:I,u_translate:h}},sl=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),al=v=>({u_viewport_size:[v.width,v.height]}),Ic=(v,e=1)=>({u_color:v,u_overlay:0,u_overlay_scale:e}),ll=(v,e,r,h)=>{const p=l.aB(v,1,e)/(l.$*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:l.aB(v,1,e),u_intensity:r,u_globe_extrude_scale:p}},to=(v,e,r,h)=>{const p=l.L();l.bX(p,0,v.width,v.height,0,0,1);const x=v.context.gl;return{u_matrix:p,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:r,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},ho=(v,e,r)=>{const h=r.paint.get("hillshade-accent-color");let p;switch(r.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const x=r.getIlluminationProperties();for(let T=0;T<x.directionRadians.length;T++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[T]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:Ao(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:h,u_method:p,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},Fh=(v,e)=>{const r=e.stride,h=l.L();return l.bX(h,0,l.$,-l.$,0,0,1),l.M(h,h,[0,-l.$,0]),{u_matrix:h,u_image:1,u_dimension:[r,r],u_zoom:v.overscaledZ,u_unpack:e.getUnpackVector()}};function Ao(v,e){const r=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new l.a0(0,h/r).toLngLat().lat,new l.a0(0,(h+1)/r).toLngLat().lat]}const Bh=(v,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:v.paint.get("color-relief-opacity")}),Vo=(v,e,r,h)=>{const p=v.transform;return{u_translation:kc(v,e,r),u_ratio:h/l.aB(e,1,p.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Ac=(v,e,r,h,p)=>l.e(Vo(v,e,r,h),{u_image:0,u_image_height:p}),ga=(v,e,r,h,p)=>{const x=v.transform,T=_a(e,x);return{u_translation:kc(v,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:h/l.aB(e,1,x.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Lc=(v,e,r,h,p,x)=>{const T=v.lineAtlas,C=_a(e,v.transform),I=r.layout.get("line-cap")==="round",R=T.getDash(p.from,I),F=T.getDash(p.to,I),j=R.width*x.fromScale,N=F.width*x.toScale;return l.e(Vo(v,e,r,h),{u_patternscale_a:[C/j,-R.height/2],u_patternscale_b:[C/N,-F.height/2],u_sdfgamma:T.width/(256*Math.min(j,N)*v.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:F.y,u_mix:x.t})};function _a(v,e){return 1/l.aB(v,1,e.tileZoom)}function kc(v,e,r){return l.aC(v.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const kr=(v,e,r,h,p)=>{return{u_tl_parent:v,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(T=h.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(x=h.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:cl(h.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var x,T};function cl(v){v*=Math.PI/180;const e=Math.sin(v),r=Math.cos(v);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const zc=(v,e,r,h,p,x,T,C,I,R,F,j,N)=>{const Z=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:Z.width/Z.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:I,u_is_text:+F,u_pitch_with_map:+h,u_is_along_line:p,u_is_variable_anchor:x,u_texsize:j,u_texture:0,u_translation:R,u_pitched_scale:N}},ys=(v,e,r,h,p,x,T,C,I,R,F,j,N,Z)=>{const K=T.transform;return l.e(zc(v,e,r,h,p,x,T,C,I,R,F,j,Z),{u_gamma_scale:h?Math.cos(K.pitch*Math.PI/180)*K.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},Nh=(v,e,r,h,p,x,T,C,I,R,F,j,N)=>l.e(ys(v,e,r,h,p,x,T,C,I,R,!0,F,0,N),{u_texsize_icon:j,u_texture_icon:1}),io=(v,e)=>({u_opacity:v,u_color:e}),jh=(v,e,r,h,p)=>l.e(function(x,T,C,I){const R=C.imageManager.getPattern(x.from.toString()),F=C.imageManager.getPattern(x.to.toString()),{width:j,height:N}=C.imageManager.getPixelSize(),Z=Math.pow(2,I.tileID.overscaledZ),K=I.tileSize*Math.pow(2,C.transform.tileZoom)/Z,se=K*(I.tileID.canonical.x+I.tileID.wrap*Z),oe=K*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[j,N],u_mix:T.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/l.aB(I,1,C.transform.tileZoom),u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(r,p,e,h),{u_opacity:v}),Bs=(v,e)=>{},Bu={fillExtrusion:(v,e)=>({u_lightpos:new l.bS(v,e.u_lightpos),u_lightpos_globe:new l.bS(v,e.u_lightpos_globe),u_lightintensity:new l.bf(v,e.u_lightintensity),u_lightcolor:new l.bS(v,e.u_lightcolor),u_vertical_gradient:new l.bf(v,e.u_vertical_gradient),u_opacity:new l.bf(v,e.u_opacity),u_fill_translate:new l.bT(v,e.u_fill_translate)}),fillExtrusionPattern:(v,e)=>({u_lightpos:new l.bS(v,e.u_lightpos),u_lightpos_globe:new l.bS(v,e.u_lightpos_globe),u_lightintensity:new l.bf(v,e.u_lightintensity),u_lightcolor:new l.bS(v,e.u_lightcolor),u_vertical_gradient:new l.bf(v,e.u_vertical_gradient),u_height_factor:new l.bf(v,e.u_height_factor),u_opacity:new l.bf(v,e.u_opacity),u_fill_translate:new l.bT(v,e.u_fill_translate),u_image:new l.bO(v,e.u_image),u_texsize:new l.bT(v,e.u_texsize),u_pixel_coord_upper:new l.bT(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(v,e.u_pixel_coord_lower),u_scale:new l.bS(v,e.u_scale),u_fade:new l.bf(v,e.u_fade)}),fill:(v,e)=>({u_fill_translate:new l.bT(v,e.u_fill_translate)}),fillPattern:(v,e)=>({u_image:new l.bO(v,e.u_image),u_texsize:new l.bT(v,e.u_texsize),u_pixel_coord_upper:new l.bT(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(v,e.u_pixel_coord_lower),u_scale:new l.bS(v,e.u_scale),u_fade:new l.bf(v,e.u_fade),u_fill_translate:new l.bT(v,e.u_fill_translate)}),fillOutline:(v,e)=>({u_world:new l.bT(v,e.u_world),u_fill_translate:new l.bT(v,e.u_fill_translate)}),fillOutlinePattern:(v,e)=>({u_world:new l.bT(v,e.u_world),u_image:new l.bO(v,e.u_image),u_texsize:new l.bT(v,e.u_texsize),u_pixel_coord_upper:new l.bT(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(v,e.u_pixel_coord_lower),u_scale:new l.bS(v,e.u_scale),u_fade:new l.bf(v,e.u_fade),u_fill_translate:new l.bT(v,e.u_fill_translate)}),circle:(v,e)=>({u_camera_to_center_distance:new l.bf(v,e.u_camera_to_center_distance),u_scale_with_map:new l.bO(v,e.u_scale_with_map),u_pitch_with_map:new l.bO(v,e.u_pitch_with_map),u_extrude_scale:new l.bT(v,e.u_extrude_scale),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.bf(v,e.u_globe_extrude_scale),u_translate:new l.bT(v,e.u_translate)}),collisionBox:(v,e)=>({u_pixel_extrude_scale:new l.bT(v,e.u_pixel_extrude_scale)}),collisionCircle:(v,e)=>({u_viewport_size:new l.bT(v,e.u_viewport_size)}),debug:(v,e)=>({u_color:new l.bP(v,e.u_color),u_overlay:new l.bO(v,e.u_overlay),u_overlay_scale:new l.bf(v,e.u_overlay_scale)}),depth:Bs,clippingMask:Bs,heatmap:(v,e)=>({u_extrude_scale:new l.bf(v,e.u_extrude_scale),u_intensity:new l.bf(v,e.u_intensity),u_globe_extrude_scale:new l.bf(v,e.u_globe_extrude_scale)}),heatmapTexture:(v,e)=>({u_matrix:new l.bQ(v,e.u_matrix),u_world:new l.bT(v,e.u_world),u_image:new l.bO(v,e.u_image),u_color_ramp:new l.bO(v,e.u_color_ramp),u_opacity:new l.bf(v,e.u_opacity)}),hillshade:(v,e)=>({u_image:new l.bO(v,e.u_image),u_latrange:new l.bT(v,e.u_latrange),u_exaggeration:new l.bf(v,e.u_exaggeration),u_altitudes:new l.bZ(v,e.u_altitudes),u_azimuths:new l.bZ(v,e.u_azimuths),u_accent:new l.bP(v,e.u_accent),u_method:new l.bO(v,e.u_method),u_shadows:new l.bY(v,e.u_shadows),u_highlights:new l.bY(v,e.u_highlights)}),hillshadePrepare:(v,e)=>({u_matrix:new l.bQ(v,e.u_matrix),u_image:new l.bO(v,e.u_image),u_dimension:new l.bT(v,e.u_dimension),u_zoom:new l.bf(v,e.u_zoom),u_unpack:new l.bR(v,e.u_unpack)}),colorRelief:(v,e)=>({u_image:new l.bO(v,e.u_image),u_unpack:new l.bR(v,e.u_unpack),u_dimension:new l.bT(v,e.u_dimension),u_elevation_stops:new l.bO(v,e.u_elevation_stops),u_color_stops:new l.bO(v,e.u_color_stops),u_color_ramp_size:new l.bO(v,e.u_color_ramp_size),u_opacity:new l.bf(v,e.u_opacity)}),line:(v,e)=>({u_translation:new l.bT(v,e.u_translation),u_ratio:new l.bf(v,e.u_ratio),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(v,e.u_units_to_pixels)}),lineGradient:(v,e)=>({u_translation:new l.bT(v,e.u_translation),u_ratio:new l.bf(v,e.u_ratio),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(v,e.u_units_to_pixels),u_image:new l.bO(v,e.u_image),u_image_height:new l.bf(v,e.u_image_height)}),linePattern:(v,e)=>({u_translation:new l.bT(v,e.u_translation),u_texsize:new l.bT(v,e.u_texsize),u_ratio:new l.bf(v,e.u_ratio),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_image:new l.bO(v,e.u_image),u_units_to_pixels:new l.bT(v,e.u_units_to_pixels),u_scale:new l.bS(v,e.u_scale),u_fade:new l.bf(v,e.u_fade)}),lineSDF:(v,e)=>({u_translation:new l.bT(v,e.u_translation),u_ratio:new l.bf(v,e.u_ratio),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_units_to_pixels:new l.bT(v,e.u_units_to_pixels),u_patternscale_a:new l.bT(v,e.u_patternscale_a),u_patternscale_b:new l.bT(v,e.u_patternscale_b),u_sdfgamma:new l.bf(v,e.u_sdfgamma),u_image:new l.bO(v,e.u_image),u_tex_y_a:new l.bf(v,e.u_tex_y_a),u_tex_y_b:new l.bf(v,e.u_tex_y_b),u_mix:new l.bf(v,e.u_mix)}),raster:(v,e)=>({u_tl_parent:new l.bT(v,e.u_tl_parent),u_scale_parent:new l.bf(v,e.u_scale_parent),u_buffer_scale:new l.bf(v,e.u_buffer_scale),u_fade_t:new l.bf(v,e.u_fade_t),u_opacity:new l.bf(v,e.u_opacity),u_image0:new l.bO(v,e.u_image0),u_image1:new l.bO(v,e.u_image1),u_brightness_low:new l.bf(v,e.u_brightness_low),u_brightness_high:new l.bf(v,e.u_brightness_high),u_saturation_factor:new l.bf(v,e.u_saturation_factor),u_contrast_factor:new l.bf(v,e.u_contrast_factor),u_spin_weights:new l.bS(v,e.u_spin_weights),u_coords_top:new l.bR(v,e.u_coords_top),u_coords_bottom:new l.bR(v,e.u_coords_bottom)}),symbolIcon:(v,e)=>({u_is_size_zoom_constant:new l.bO(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(v,e.u_is_size_feature_constant),u_size_t:new l.bf(v,e.u_size_t),u_size:new l.bf(v,e.u_size),u_camera_to_center_distance:new l.bf(v,e.u_camera_to_center_distance),u_pitch:new l.bf(v,e.u_pitch),u_rotate_symbol:new l.bO(v,e.u_rotate_symbol),u_aspect_ratio:new l.bf(v,e.u_aspect_ratio),u_fade_change:new l.bf(v,e.u_fade_change),u_label_plane_matrix:new l.bQ(v,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(v,e.u_coord_matrix),u_is_text:new l.bO(v,e.u_is_text),u_pitch_with_map:new l.bO(v,e.u_pitch_with_map),u_is_along_line:new l.bO(v,e.u_is_along_line),u_is_variable_anchor:new l.bO(v,e.u_is_variable_anchor),u_texsize:new l.bT(v,e.u_texsize),u_texture:new l.bO(v,e.u_texture),u_translation:new l.bT(v,e.u_translation),u_pitched_scale:new l.bf(v,e.u_pitched_scale)}),symbolSDF:(v,e)=>({u_is_size_zoom_constant:new l.bO(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(v,e.u_is_size_feature_constant),u_size_t:new l.bf(v,e.u_size_t),u_size:new l.bf(v,e.u_size),u_camera_to_center_distance:new l.bf(v,e.u_camera_to_center_distance),u_pitch:new l.bf(v,e.u_pitch),u_rotate_symbol:new l.bO(v,e.u_rotate_symbol),u_aspect_ratio:new l.bf(v,e.u_aspect_ratio),u_fade_change:new l.bf(v,e.u_fade_change),u_label_plane_matrix:new l.bQ(v,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(v,e.u_coord_matrix),u_is_text:new l.bO(v,e.u_is_text),u_pitch_with_map:new l.bO(v,e.u_pitch_with_map),u_is_along_line:new l.bO(v,e.u_is_along_line),u_is_variable_anchor:new l.bO(v,e.u_is_variable_anchor),u_texsize:new l.bT(v,e.u_texsize),u_texture:new l.bO(v,e.u_texture),u_gamma_scale:new l.bf(v,e.u_gamma_scale),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_is_halo:new l.bO(v,e.u_is_halo),u_translation:new l.bT(v,e.u_translation),u_pitched_scale:new l.bf(v,e.u_pitched_scale)}),symbolTextAndIcon:(v,e)=>({u_is_size_zoom_constant:new l.bO(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bO(v,e.u_is_size_feature_constant),u_size_t:new l.bf(v,e.u_size_t),u_size:new l.bf(v,e.u_size),u_camera_to_center_distance:new l.bf(v,e.u_camera_to_center_distance),u_pitch:new l.bf(v,e.u_pitch),u_rotate_symbol:new l.bO(v,e.u_rotate_symbol),u_aspect_ratio:new l.bf(v,e.u_aspect_ratio),u_fade_change:new l.bf(v,e.u_fade_change),u_label_plane_matrix:new l.bQ(v,e.u_label_plane_matrix),u_coord_matrix:new l.bQ(v,e.u_coord_matrix),u_is_text:new l.bO(v,e.u_is_text),u_pitch_with_map:new l.bO(v,e.u_pitch_with_map),u_is_along_line:new l.bO(v,e.u_is_along_line),u_is_variable_anchor:new l.bO(v,e.u_is_variable_anchor),u_texsize:new l.bT(v,e.u_texsize),u_texsize_icon:new l.bT(v,e.u_texsize_icon),u_texture:new l.bO(v,e.u_texture),u_texture_icon:new l.bO(v,e.u_texture_icon),u_gamma_scale:new l.bf(v,e.u_gamma_scale),u_device_pixel_ratio:new l.bf(v,e.u_device_pixel_ratio),u_is_halo:new l.bO(v,e.u_is_halo),u_translation:new l.bT(v,e.u_translation),u_pitched_scale:new l.bf(v,e.u_pitched_scale)}),background:(v,e)=>({u_opacity:new l.bf(v,e.u_opacity),u_color:new l.bP(v,e.u_color)}),backgroundPattern:(v,e)=>({u_opacity:new l.bf(v,e.u_opacity),u_image:new l.bO(v,e.u_image),u_pattern_tl_a:new l.bT(v,e.u_pattern_tl_a),u_pattern_br_a:new l.bT(v,e.u_pattern_br_a),u_pattern_tl_b:new l.bT(v,e.u_pattern_tl_b),u_pattern_br_b:new l.bT(v,e.u_pattern_br_b),u_texsize:new l.bT(v,e.u_texsize),u_mix:new l.bf(v,e.u_mix),u_pattern_size_a:new l.bT(v,e.u_pattern_size_a),u_pattern_size_b:new l.bT(v,e.u_pattern_size_b),u_scale_a:new l.bf(v,e.u_scale_a),u_scale_b:new l.bf(v,e.u_scale_b),u_pixel_coord_upper:new l.bT(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bT(v,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bf(v,e.u_tile_units_to_pixels)}),terrain:(v,e)=>({u_texture:new l.bO(v,e.u_texture),u_ele_delta:new l.bf(v,e.u_ele_delta),u_fog_matrix:new l.bQ(v,e.u_fog_matrix),u_fog_color:new l.bP(v,e.u_fog_color),u_fog_ground_blend:new l.bf(v,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bf(v,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bP(v,e.u_horizon_color),u_horizon_fog_blend:new l.bf(v,e.u_horizon_fog_blend),u_is_globe_mode:new l.bf(v,e.u_is_globe_mode)}),terrainDepth:(v,e)=>({u_ele_delta:new l.bf(v,e.u_ele_delta)}),terrainCoords:(v,e)=>({u_texture:new l.bO(v,e.u_texture),u_terrain_coords_id:new l.bf(v,e.u_terrain_coords_id),u_ele_delta:new l.bf(v,e.u_ele_delta)}),projectionErrorMeasurement:(v,e)=>({u_input:new l.bf(v,e.u_input),u_output_expected:new l.bf(v,e.u_output_expected)}),atmosphere:(v,e)=>({u_sun_pos:new l.bS(v,e.u_sun_pos),u_atmosphere_blend:new l.bf(v,e.u_atmosphere_blend),u_globe_position:new l.bS(v,e.u_globe_position),u_globe_radius:new l.bf(v,e.u_globe_radius),u_inv_proj_matrix:new l.bQ(v,e.u_inv_proj_matrix)}),sky:(v,e)=>({u_sky_color:new l.bP(v,e.u_sky_color),u_horizon_color:new l.bP(v,e.u_horizon_color),u_horizon:new l.bT(v,e.u_horizon),u_horizon_normal:new l.bT(v,e.u_horizon_normal),u_sky_horizon_blend:new l.bf(v,e.u_sky_horizon_blend),u_sky_blend:new l.bf(v,e.u_sky_blend)})};class Lo{constructor(e,r,h){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ul={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $l{constructor(e,r,h,p){this.length=r.length,this.attributes=h,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.context=e;const x=e.gl;this.buffer=x.createBuffer(),e.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let h=0;h<this.attributes.length;h++){const p=r.attributes[this.attributes[h].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,r,h){for(let p=0;p<this.attributes.length;p++){const x=this.attributes[p],T=r.attributes[x.name];T!==void 0&&e.vertexAttribPointer(T,x.components,e[ul[x.type]],!1,this.itemSize,x.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ri{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ns extends Ri{getDefault(){return l.be.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class po extends Ri{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ya extends Ri{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class vs extends Ri{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class va extends Ri{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Vl extends Ri{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Zl extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class js extends Ri{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class xa extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Uh extends Ri{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Nu extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class $h extends Ri{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ju extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Uu extends Ri{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ko extends Ri{getDefault(){return l.be.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class hl extends Ri{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ql extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Us extends Ri{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Gl extends Ri{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Hl extends Ri{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class $s extends Ri{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Zo extends Ri{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ba extends Ri{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Hn extends Ri{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rc extends Ri{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Dc extends Ri{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Oc extends Ri{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class vr extends Ri{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const h=this.gl;gr(h)?h.bindVertexArray(e):(r=h.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class dl extends Ri{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pl extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qo extends Ri{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class wa extends Ri{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class fl extends wa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class zo extends wa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Vs extends wa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Wl="Framebuffer is not complete";class Fc{constructor(e,r,h,p,x){this.context=e,this.width=r,this.height=h;const T=e.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new fl(e,C),p)this.depthAttachment=x?new Vs(e,C):new zo(e,C);else if(x)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(Wl)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class wi{constructor(e){var r,h;if(this.gl=e,this.clearColor=new Ns(this),this.clearDepth=new po(this),this.clearStencil=new ya(this),this.colorMask=new vs(this),this.depthMask=new va(this),this.stencilMask=new Vl(this),this.stencilFunc=new Zl(this),this.stencilOp=new js(this),this.stencilTest=new xa(this),this.depthRange=new Uh(this),this.depthTest=new Nu(this),this.depthFunc=new $h(this),this.blend=new ju(this),this.blendFunc=new Uu(this),this.blendColor=new ko(this),this.blendEquation=new hl(this),this.cullFace=new ql(this),this.cullFaceSide=new Us(this),this.frontFace=new Gl(this),this.program=new Hl(this),this.activeTexture=new $s(this),this.viewport=new Zo(this),this.bindFramebuffer=new ba(this),this.bindRenderbuffer=new Hn(this),this.bindTexture=new Rc(this),this.bindVertexBuffer=new Dc(this),this.bindElementBuffer=new Oc(this),this.bindVertexArray=new vr(this),this.pixelStoreUnpack=new dl(this),this.pixelStoreUnpackPremultiplyAlpha=new pl(this),this.pixelStoreUnpackFlipY=new qo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),gr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:p?.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Lo(this,e,r)}createVertexBuffer(e,r,h){return new $l(this,e,r,h)}createRenderbuffer(e,r,h){const p=this.gl,x=p.createRenderbuffer();return this.bindRenderbuffer.set(x),p.renderbufferStorage(p.RENDERBUFFER,e,r,h),this.bindRenderbuffer.set(null),x}createFramebuffer(e,r,h,p){return new Fc(this,e,r,h,p)}clear({color:e,depth:r,stencil:h}){const p=this.gl;let x=0;e&&(x|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(x|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),h!==void 0&&(x|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(x)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bG(e.blendFunction,di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return gr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return gr(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let xs;function Bc(v,e,r,h,p){const x=v.context,T=v.transform,C=x.gl,I=v.useProgram("collisionBox"),R=[];let F=0,j=0;for(let ae=0;ae<h.length;ae++){const ue=h[ae],fe=e.getTile(ue).getBucket(r);if(!fe)continue;const de=p?fe.textCollisionBox:fe.iconCollisionBox,_e=fe.collisionCircleArray;_e.length>0&&(R.push({circleArray:_e,circleOffset:j,coord:ue}),F+=_e.length/4,j=F),de&&I.draw(x,C.LINES,Vt.disabled,Kt.disabled,v.colorModeForRenderPass(),ti.disabled,sl(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue),T.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,v.transform.zoom,null,null,de.collisionVertexBuffer)}if(!p||!R.length)return;const N=v.useProgram("collisionCircle"),Z=new l.b_;Z.resize(4*F),Z._trim();let K=0;for(const ae of R)for(let ue=0;ue<ae.circleArray.length/4;ue++){const fe=4*ue,de=ae.circleArray[fe+0],_e=ae.circleArray[fe+1],we=ae.circleArray[fe+2],pe=ae.circleArray[fe+3];Z.emplace(K++,de,_e,we,pe,0),Z.emplace(K++,de,_e,we,pe,1),Z.emplace(K++,de,_e,we,pe,2),Z.emplace(K++,de,_e,we,pe,3)}(!xs||xs.length<2*F)&&(xs=function(ae){const ue=2*ae,fe=new l.c0;fe.resize(ue),fe._trim();for(let de=0;de<ue;de++){const _e=6*de;fe.uint16[_e+0]=4*de+0,fe.uint16[_e+1]=4*de+1,fe.uint16[_e+2]=4*de+2,fe.uint16[_e+3]=4*de+2,fe.uint16[_e+4]=4*de+3,fe.uint16[_e+5]=4*de+0}return fe}(F));const se=x.createIndexBuffer(xs,!0),oe=x.createVertexBuffer(Z,l.b$.members,!0);for(const ae of R){const ue=al(v.transform);N.draw(x,C.TRIANGLES,Vt.disabled,Kt.disabled,v.colorModeForRenderPass(),ti.disabled,ue,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ae.coord),null,r.id,oe,se,l.aL.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,v.transform.zoom,null,null,null)}oe.destroy(),se.destroy()}const Nc=l.af(new Float32Array(16));function Ta(v,e,r,h,p,x){const{horizontalAlign:T,verticalAlign:C}=l.aG(v);return new l.P((-(T-.5)*e/p+h[0])*x,(-(C-.5)*r/p+h[1])*x)}function Vh(v,e,r,h,p,x){const T=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let C=h.mult(x);r||(C=C.rotate(-p));const I=T.add(C);return Oi(I.x,I.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const C=mt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(v),I=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return v.add(h.rotate(I))}return v.add(h)}function $u(v,e,r,h,p,x,T,C,I,R,F,j){const N=v.text.placedSymbolArray,Z=v.text.dynamicLayoutVertexArray,K=v.icon.dynamicLayoutVertexArray,se={};Z.clear();for(let oe=0;oe<N.length;oe++){const ae=N.get(oe),ue=ae.hidden||!ae.crossTileID||v.allowVerticalPlacement&&!ae.placedOrientation?null:h[ae.crossTileID];if(ue){const fe=new l.P(ae.anchorX,ae.anchorY),de={getElevation:j,width:p.width,height:p.height,pitchedLabelPlaneMatrix:x,pitchWithMap:r,transform:p,tileAnchorPoint:fe,translation:R,unwrappedTileID:F},_e=r?fi(fe.x,fe.y,de):mt(fe.x,fe.y,de),we=Nt(p.cameraToCenterDistance,_e.signedDistanceFromCamera);let pe=l.ao(v.textSizeData,C,ae)*we/l.aA;r&&(pe*=v.tilePixelRatio/T);const{width:Ae,height:$e,anchor:De,textOffset:Be,textBoxScale:Ve}=ue,vt=Ta(De,Ae,$e,Be,Ve,pe),gt=p.getPitchedTextCorrection(fe.x+R[0],fe.y+R[1],F),rt=Vh(_e.point,de,e,vt,-p.bearingInRadians,gt),kt=v.allowVerticalPlacement&&ae.placedOrientation===l.an.vertical?Math.PI/2:0;for(let gi=0;gi<ae.numGlyphs;gi++)l.au(Z,rt,kt);I&&ae.associatedIconIndex>=0&&(se[ae.associatedIconIndex]={shiftedAnchor:rt,angle:kt})}else Bo(ae.numGlyphs,Z)}if(I){K.clear();const oe=v.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){const ue=oe.get(ae);if(ue.hidden)Bo(ue.numGlyphs,K);else{const fe=se[ae];if(fe)for(let de=0;de<ue.numGlyphs;de++)l.au(K,fe.shiftedAnchor,fe.angle);else Bo(ue.numGlyphs,K)}}v.icon.dynamicLayoutVertexBuffer.updateData(K)}v.text.dynamicLayoutVertexBuffer.updateData(Z)}function jc(v,e,r){return r.iconsInText&&e?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Vu(v,e,r,h,p,x,T,C,I,R,F,j,N){const Z=v.context,K=Z.gl,se=v.transform,oe=C==="map",ae=I==="map",ue=C!=="viewport"&&r.layout.get("symbol-placement")!=="point",fe=oe&&!ae&&!ue,de=!r.layout.get("symbol-sort-key").isConstant();let _e=!1;const we=v.getDepthModeForSublayer(0,Vt.ReadOnly),pe=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ae=[],$e=se.getCircleRadiusCorrection();for(const De of h){const Be=e.getTile(De),Ve=Be.getBucket(r);if(!Ve)continue;const vt=p?Ve.text:Ve.icon;if(!vt||!vt.segments.get().length||!vt.hasVisibleVertices)continue;const gt=vt.programConfigurations.get(r.id),rt=p||Ve.sdfIcons,kt=p?Ve.textSizeData:Ve.iconSizeData,gi=ae||se.pitch!==0,Vi=v.useProgram(jc(rt,p,Ve),gt),yn=l.am(kt,se.zoom),Ji=v.style.map.terrain&&v.style.map.terrain.getTerrainData(De);let vn,nn,Qi,rn,wr=[0,0],Di=null;if(p)nn=Be.glyphAtlasTexture,Qi=K.LINEAR,vn=Be.glyphAtlasTexture.size,Ve.iconsInText&&(wr=Be.imageAtlasTexture.size,Di=Be.imageAtlasTexture,rn=gi||v.options.rotating||v.options.zooming||kt.kind==="composite"||kt.kind==="camera"?K.LINEAR:K.NEAREST);else{const zn=r.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear;nn=Be.imageAtlasTexture,Qi=rt||v.options.rotating||v.options.zooming||zn||gi?K.LINEAR:K.NEAREST,vn=Be.imageAtlasTexture.size}const sr=l.aB(Be,1,v.transform.zoom),Tr=ei(oe,v.transform,sr),Aa=l.L();l.ap(Aa,Tr);const La=Yi(ae,oe,v.transform,sr),ka=l.aC(se,Be,x,T),Ts=se.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Xc=pe&&Ve.hasTextData(),Yc=r.layout.get("icon-text-fit")!=="none"&&Xc&&Ve.hasIconData();if(ue){const zn=v.style.map.terrain?(qr,Wn)=>v.style.map.terrain.getElevation(De,qr,Wn):null,un=r.layout.get("text-rotation-alignment")==="map";Fn(Ve,v,p,Tr,Aa,ae,R,un,De.toUnwrapped(),se.width,se.height,ka,zn)}const rc=p&&pe||Yc,ro=ue||rc?Nc:ae?Tr:v.transform.clipSpaceToPixelsMatrix,Ko=rt&&r.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let za;za=rt?Ve.iconsInText?Nh(kt.kind,yn,fe,ae,ue,rc,v,ro,La,ka,vn,wr,$e):ys(kt.kind,yn,fe,ae,ue,rc,v,ro,La,ka,p,vn,0,$e):zc(kt.kind,yn,fe,ae,ue,rc,v,ro,La,ka,p,vn,$e);const xl={program:Vi,buffers:vt,uniformValues:za,projectionData:Ts,atlasTexture:nn,atlasTextureIcon:Di,atlasInterpolation:Qi,atlasInterpolationIcon:rn,isSDF:rt,hasHalo:Ko};if(de&&Ve.canOverlap){_e=!0;const zn=vt.segments.get();for(const un of zn)Ae.push({segments:new l.aL([un]),sortKey:un.sortKey,state:xl,terrainData:Ji})}else Ae.push({segments:vt.segments,sortKey:0,state:xl,terrainData:Ji})}_e&&Ae.sort((De,Be)=>De.sortKey-Be.sortKey);for(const De of Ae){const Be=De.state;if(Z.activeTexture.set(K.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,K.CLAMP_TO_EDGE),Be.atlasTextureIcon&&(Z.activeTexture.set(K.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Be.isSDF){const Ve=Be.uniformValues;Be.hasHalo&&(Ve.u_is_halo=1,c(Be.buffers,De.segments,r,v,Be.program,we,F,j,Ve,Be.projectionData,De.terrainData)),Ve.u_is_halo=0}c(Be.buffers,De.segments,r,v,Be.program,we,F,j,Be.uniformValues,Be.projectionData,De.terrainData)}}function c(v,e,r,h,p,x,T,C,I,R,F){const j=h.context;p.draw(j,j.gl.TRIANGLES,x,T,C,ti.backCCW,I,F,R,r.id,v.layoutVertexBuffer,v.indexBuffer,e,r.paint,h.transform.zoom,v.programConfigurations.get(r.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function y(v,e,r,h,p){const x=v.context,T=x.gl,C=Kt.disabled,I=new di([T.ONE,T.ONE],l.be.transparent,[!0,!0,!0,!0]),R=e.getBucket(r);if(!R)return;const F=h.key;let j=r.heatmapFbos.get(F);j||(j=z(x,e.tileSize,e.tileSize),r.heatmapFbos.set(F,j)),x.bindFramebuffer.set(j.framebuffer),x.viewport.set([0,0,e.tileSize,e.tileSize]),x.clear({color:l.be.transparent});const N=R.programConfigurations.get(r.id),Z=v.useProgram("heatmap",N,!p),K=v.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=v.style.map.terrain.getTerrainData(h);Z.draw(x,T.TRIANGLES,Vt.disabled,C,I,ti.disabled,ll(e,v.transform.zoom,r.paint.get("heatmap-intensity"),1),se,K,r.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,r.paint,v.transform.zoom,N)}function P(v,e,r,h,p){const x=v.context,T=x.gl,C=v.transform;x.setColorMode(v.colorModeForRenderPass());const I=U(x,e),R=r.key,F=e.heatmapFbos.get(R);if(!F)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1),I.bind(T.LINEAR,T.CLAMP_TO_EDGE);const j=C.getProjectionData({overscaledTileID:r,applyTerrainMatrix:p,applyGlobeMatrix:!h});v.useProgram("heatmapTexture").draw(x,T.TRIANGLES,Vt.disabled,Kt.disabled,v.colorModeForRenderPass(),ti.disabled,to(v,e,0,1),null,j,e.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,e.paint,C.zoom),F.destroy(),e.heatmapFbos.delete(R)}function z(v,e,r){var h,p;const x=v.gl,T=x.createTexture();x.bindTexture(x.TEXTURE_2D,T),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const C=(h=v.HALF_FLOAT)!==null&&h!==void 0?h:x.UNSIGNED_BYTE,I=(p=v.RGBA16F)!==null&&p!==void 0?p:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,I,e,r,0,x.RGBA,C,null);const R=v.createFramebuffer(e,r,!1,!1);return R.colorAttachment.set(T),R}function U(v,e){return e.colorRampTexture||(e.colorRampTexture=new l.T(v,e.colorRamp,v.gl.RGBA)),e.colorRampTexture}function ee(v,e,r,h,p){if(!r||!h||!h.imageAtlas)return;const x=h.imageAtlas.patternPositions;let T=x[r.to.toString()],C=x[r.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const I=p.getPaintProperty(e);T=x[I],C=x[I]}T&&C&&v.setConstantPatternPositions(T,C)}function ve(v,e,r,h,p,x,T,C){const I=v.context.gl,R="fill-pattern",F=r.paint.get(R),j=F&&F.constantOr(1),N=r.getCrossfadeParameters();let Z,K,se,oe,ae;const ue=v.transform,fe=r.paint.get("fill-translate"),de=r.paint.get("fill-translate-anchor");T?(K=j&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=I.LINES):(K=j?"fillPattern":"fill",Z=I.TRIANGLES);const _e=F.constantOr(null);for(const we of h){const pe=e.getTile(we);if(j&&!pe.patternsLoaded())continue;const Ae=pe.getBucket(r);if(!Ae)continue;const $e=Ae.programConfigurations.get(r.id),De=v.useProgram(K,$e),Be=v.style.map.terrain&&v.style.map.terrain.getTerrainData(we);j&&(v.context.activeTexture.set(I.TEXTURE0),pe.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),$e.updatePaintBuffers(N)),ee($e,R,_e,pe,r);const Ve=ue.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),vt=l.aC(ue,pe,fe,de);if(T){oe=Ae.indexBuffer2,ae=Ae.segments2;const rt=[I.drawingBufferWidth,I.drawingBufferHeight];se=K==="fillOutlinePattern"&&j?Ec(v,N,pe,rt,vt):Io(rt,vt)}else oe=Ae.indexBuffer,ae=Ae.segments,se=j?rl(v,N,pe,vt):{u_fill_translate:vt};const gt=v.stencilModeForClipping(we);De.draw(v.context,Z,p,gt,x,ti.backCCW,se,Be,Ve,r.id,Ae.layoutVertexBuffer,oe,ae,r.paint,v.transform.zoom,$e)}}function Oe(v,e,r,h,p,x,T,C){const I=v.context,R=I.gl,F="fill-extrusion-pattern",j=r.paint.get(F),N=j.constantOr(1),Z=r.getCrossfadeParameters(),K=r.paint.get("fill-extrusion-opacity"),se=j.constantOr(null),oe=v.transform;for(const ae of h){const ue=e.getTile(ae),fe=ue.getBucket(r);if(!fe)continue;const de=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ae),_e=fe.programConfigurations.get(r.id),we=v.useProgram(N?"fillExtrusionPattern":"fillExtrusion",_e);N&&(v.context.activeTexture.set(R.TEXTURE0),ue.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),_e.updatePaintBuffers(Z));const pe=oe.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!C,applyTerrainMatrix:!0});ee(_e,F,se,ue,r);const Ae=l.aC(oe,ue,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),$e=r.paint.get("fill-extrusion-vertical-gradient"),De=N?Ul(v,$e,K,Ae,ae,Z,ue):rr(v,$e,K,Ae);we.draw(I,I.gl.TRIANGLES,p,x,T,ti.backCCW,De,de,pe,r.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,r.paint,v.transform.zoom,_e,v.style.map.terrain&&fe.centroidVertexBuffer)}}function Ge(v,e,r,h,p,x,T,C,I){var R;const F=v.style.projection,j=v.context,N=v.transform,Z=j.gl,K=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],se=v.useProgram("hillshade",null,!1,K),oe=!v.options.moving;for(const ae of h){const ue=e.getTile(ae),fe=ue.fbo;if(!fe)continue;const de=F.getMeshFromTileID(j,ae.canonical,C,!0,"raster"),_e=(R=v.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ae);j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,fe.colorAttachment.get());const we=N.getProjectionData({overscaledTileID:ae,aligned:oe,applyGlobeMatrix:!I,applyTerrainMatrix:!0});se.draw(j,Z.TRIANGLES,x,p[ae.overscaledZ],T,ti.backCCW,ho(v,ue,r),_e,we,r.id,de.vertexBuffer,de.indexBuffer,de.segments)}}function st(v,e,r,h,p,x,T,C,I){var R;const F=v.style.projection,j=v.context,N=v.transform,Z=j.gl,K=v.useProgram("colorRelief"),se=!v.options.moving;let oe=!0,ae=0;for(const ue of h){const fe=e.getTile(ue),de=fe.dem;if(oe){const De=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:Be,colorTexture:Ve}=r.getColorRampTextures(j,De,de.getUnpackVector());j.activeTexture.set(Z.TEXTURE1),Be.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),j.activeTexture.set(Z.TEXTURE4),Ve.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),oe=!1,ae=Be.size[0]}if(!de||!de.data)continue;const _e=de.stride,we=de.getPixels();if(j.activeTexture.set(Z.TEXTURE0),j.pixelStoreUnpackPremultiplyAlpha.set(!1),fe.demTexture=fe.demTexture||v.getTileTexture(_e),fe.demTexture){const De=fe.demTexture;De.update(we,{premultiply:!1}),De.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else fe.demTexture=new l.T(j,we,Z.RGBA,{premultiply:!1}),fe.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const pe=F.getMeshFromTileID(j,ue.canonical,C,!0,"raster"),Ae=(R=v.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ue),$e=N.getProjectionData({overscaledTileID:ue,aligned:se,applyGlobeMatrix:!I,applyTerrainMatrix:!0});K.draw(j,Z.TRIANGLES,x,p[ue.overscaledZ],T,ti.backCCW,Bh(r,fe.dem,ae),Ae,$e,r.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}const Lt=[new l.P(0,0),new l.P(l.$,0),new l.P(l.$,l.$),new l.P(0,l.$)];function Ht(v,e,r,h,p,x,T,C,I=!1,R=!1){const F=h[h.length-1].overscaledZ,j=v.context,N=j.gl,Z=v.useProgram("raster"),K=v.transform,se=v.style.projection,oe=v.colorModeForRenderPass(),ae=!v.options.moving;for(const ue of h){const fe=v.getDepthModeForSublayer(ue.overscaledZ-F,r.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,N.LESS),de=e.getTile(ue);de.registerFadeDuration(r.paint.get("raster-fade-duration"));const _e=e.findLoadedParent(ue,0),we=e.findLoadedSibling(ue),pe=Pi(de,_e||we||null,e,r,v.transform,v.style.map.terrain);let Ae,$e;const De=r.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;j.activeTexture.set(N.TEXTURE0),de.texture.bind(De,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(N.TEXTURE1),_e?(_e.texture.bind(De,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Ae=Math.pow(2,_e.tileID.overscaledZ-de.tileID.overscaledZ),$e=[de.tileID.canonical.x*Ae%1,de.tileID.canonical.y*Ae%1]):de.texture.bind(De,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&j.extTextureFilterAnisotropic&&v.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const Be=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue),Ve=K.getProjectionData({overscaledTileID:ue,aligned:ae,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),vt=kr($e||[0,0],Ae||1,pe,r,C),gt=se.getMeshFromTileID(j,ue.canonical,x,T,"raster");Z.draw(j,N.TRIANGLES,fe,p?p[ue.overscaledZ]:Kt.disabled,oe,I?ti.frontCCW:ti.backCCW,vt,Be,Ve,r.id,gt.vertexBuffer,gt.indexBuffer,gt.segments)}}function Pi(v,e,r,h,p,x){const T=h.paint.get("raster-fade-duration");if(!x&&T>0){const C=X.now(),I=(C-v.timeAdded)/T,R=e?(C-e.timeAdded)/T:-1,F=r.getSource(),j=He(p,{tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-j)>Math.abs(v.tileID.overscaledZ-j),Z=N&&v.refreshedUponExpiration?1:l.ag(N?I:1-R,0,1);return v.refreshedUponExpiration&&I>=1&&(v.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const or=new l.be(1,0,0,1),Pn=new l.be(0,1,0,1),zr=new l.be(0,0,1,1),xr=new l.be(1,0,1,1),Zs=new l.be(0,1,1,1);function ml(v,e,r,h){Xl(v,0,e+r/2,v.transform.width,r,h)}function Kl(v,e,r,h){Xl(v,e-r/2,0,r,v.transform.height,h)}function Xl(v,e,r,h,p,x){const T=v.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(e*v.pixelRatio,r*v.pixelRatio,h*v.pixelRatio,p*v.pixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}function Uc(v,e,r){const h=v.context,p=h.gl,x=v.useProgram("debug"),T=Vt.disabled,C=Kt.disabled,I=v.colorModeForRenderPass(),R="$debug",F=v.style.map.terrain&&v.style.map.terrain.getTerrainData(r);h.activeTexture.set(p.TEXTURE0);const j=e.getTileByID(r.key).latestRawTileData,N=Math.floor((j&&j.byteLength||0)/1024),Z=e.getTile(r).tileSize,K=512/Math.min(Z,512)*(r.overscaledZ/v.transform.zoom)*.5;let se=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(se+=` => ${r.overscaledZ}`),function(ae,ue){ae.initDebugOverlayCanvas();const fe=ae.debugOverlayCanvas,de=ae.context.gl,_e=ae.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,fe.width,fe.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ue,5,5),_e.strokeText(ue,5,5),ae.debugOverlayTexture.update(fe),ae.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(v,`${se} ${N}kB`);const oe=v.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(h,p.TRIANGLES,T,C,di.alphaBlended,ti.disabled,Ic(l.be.transparent,K),null,oe,R,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),x.draw(h,p.LINE_STRIP,T,C,I,ti.disabled,Ic(l.be.red),F,oe,R,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function pn(v,e,r,h){const{isRenderingGlobe:p}=h,x=v.context,T=x.gl,C=v.transform,I=v.colorModeForRenderPass(),R=v.getDepthModeFor3D(),F=v.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,v.width,v.height]);for(const j of r){const N=e.getTerrainMesh(j.tileID),Z=v.renderToTexture.getTexture(j),K=e.getTerrainData(j.tileID);x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,Z.texture);const se=e.getMeshFrameDelta(C.zoom),oe=C.calculateFogMatrix(j.tileID.toUnwrapped()),ae=Fu(se,oe,v.style.sky,C.pitch,p),ue=C.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(x,T.TRIANGLES,R,Kt.disabled,I,ti.backCCW,ae,K,ue,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Go(v,e){if(!e.mesh){const r=new l.aK;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const h=new l.aM;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new jr(v.createVertexBuffer(r,co.members),v.createIndexBuffer(h),l.aL.simpleSegment(0,0,r.length,h.length))}return e.mesh}class $i{constructor(e,r){this.context=new wi(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Je.maxUnderzooming+Je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Po}resize(e,r,h){if(this.width=Math.floor(e*h),this.height=Math.floor(r*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,r=new l.aK;r.emplaceBack(0,0),r.emplaceBack(l.$,0),r.emplaceBack(0,l.$),r.emplaceBack(l.$,l.$),this.tileExtentBuffer=e.createVertexBuffer(r,co.members),this.tileExtentSegments=l.aL.simpleSegment(0,0,4,2);const h=new l.aK;h.emplaceBack(0,0),h.emplaceBack(l.$,0),h.emplaceBack(0,l.$),h.emplaceBack(l.$,l.$),this.debugBuffer=e.createVertexBuffer(h,co.members),this.debugSegments=l.aL.simpleSegment(0,0,4,5);const p=new l.c5;p.emplaceBack(0,0,0,0),p.emplaceBack(l.$,0,l.$,0),p.emplaceBack(0,l.$,0,l.$),p.emplaceBack(l.$,l.$,l.$,l.$),this.rasterBoundsBuffer=e.createVertexBuffer(p,Oh.members),this.rasterBoundsSegments=l.aL.simpleSegment(0,0,4,2);const x=new l.aK;x.emplaceBack(0,0),x.emplaceBack(l.$,0),x.emplaceBack(0,l.$),x.emplaceBack(l.$,l.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(x,co.members),this.rasterBoundsSegmentsPosOnly=l.aL.simpleSegment(0,0,4,5);const T=new l.aK;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(T,co.members),this.viewportSegments=l.aL.simpleSegment(0,0,4,2);const C=new l.c6;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(C);const I=new l.aM;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(I);const R=this.context.gl;this.stencilClearMode=new Kt({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new jr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=l.L();l.bX(h,0,this.width,this.height,0,0,1),l.N(h,h,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const p={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Vt.disabled,this.stencilClearMode,di.disabled,ti.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const p=this.context;p.setColorMode(di.disabled),p.setDepthMode(Vt.disabled);const x={};for(const T of r)x[T.key]=this.nextStencilID++;this._renderTileMasks(x,r,h,!0),this._renderTileMasks(x,r,h,!1),this._tileClippingMaskIDs=x}_renderTileMasks(e,r,h,p){const x=this.context,T=x.gl,C=this.style.projection,I=this.transform,R=this.useProgram("clippingMask");for(const F of r){const j=e[F.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(F),Z=C.getMeshFromTileID(this.context,F.canonical,p,!0,"stencil"),K=I.getProjectionData({overscaledTileID:F,applyGlobeMatrix:!h,applyTerrainMatrix:!0});R.draw(x,T.TRIANGLES,Vt.disabled,new Kt({func:T.ALWAYS,mask:0},j,255,T.KEEP,T.KEEP,T.REPLACE),di.disabled,h?ti.disabled:ti.backCCW,null,N,K,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,h=this.style.projection,p=this.transform,x=this.useProgram("depth"),T=this.getDepthModeFor3D(),C=qe(p,{tileSize:p.tileSize});for(const I of C){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),F=h.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),j=p.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(e,r.TRIANGLES,T,Kt.disabled,di.disabled,ti.backCCW,null,R,j,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Kt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Kt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,h=e.sort((T,C)=>C.overscaledZ-T.overscaledZ),p=h[h.length-1].overscaledZ,x=h[0].overscaledZ-p+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+p]=new Kt({func:r.GEQUAL,mask:255},C+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=x,[T,h]}return[{[p]:Kt.disabled},h]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,h=e.sort((T,C)=>C.overscaledZ-T.overscaledZ),p=h[h.length-1].overscaledZ,x=h[0].overscaledZ-p+1;if(this.clearStencil(),x>1){const T={},C={};for(let I=0;I<x;I++)T[I+p]=new Kt({func:r.GREATER,mask:255},x+1+I,255,r.KEEP,r.KEEP,r.REPLACE),C[I+p]=new Kt({func:r.GREATER,mask:255},1+I,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*x+1,[T,C,h]}return this.nextStencilID=3,[{[p]:new Kt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[p]:new Kt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},h]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new di([e.CONSTANT_COLOR,e.ONE],new l.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?di.unblended:di.alphaBlended}getDepthModeForSublayer(e,r,h){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Vt(h||this.context.gl.LEQUAL,r,[p,p])}getDepthModeFor3D(){return new Vt(this.context.gl.LEQUAL,Vt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var h,p;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(X.now()),this.imageManager.beginFrame();const x=this.style._order,T=this.style.sourceCaches,C={},I={},R={},F={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(const N in T){const Z=T[N];Z.used&&Z.prepare(this.context),C[N]=Z.getVisibleCoordinates(!1),I[N]=C[N].slice().reverse(),R[N]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<x.length;N++)if(this.style._layers[x[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of x){const Z=this.style._layers[N];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const K=I[Z.source];(Z.type==="custom"||K.length)&&this.renderLayer(this,T[Z.source],Z,K,F)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?l.be.black:l.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,Z){const K=N.context,se=K.gl,oe=((we,pe,Ae)=>{const $e=Math.cos(pe.rollInRadians),De=Math.sin(pe.rollInRadians),Be=Q(pe),Ve=pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:we.properties.get("sky-color"),u_horizon_color:we.properties.get("horizon-color"),u_horizon:[(pe.width/2-Be*De)*Ae,(pe.height/2+Be*$e)*Ae],u_horizon_normal:[-De,$e],u_sky_horizon_blend:we.properties.get("sky-horizon-blend")*pe.height/2*Ae,u_sky_blend:Ve}})(Z,N.style.map.transform,N.pixelRatio),ae=new Vt(se.LEQUAL,Vt.ReadWrite,[0,1]),ue=Kt.disabled,fe=N.colorModeForRenderPass(),de=N.useProgram("sky"),_e=Go(K,Z);de.draw(K,se.TRIANGLES,ae,ue,fe,ti.disabled,oe,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[x[this.currentLayer]],Z=T[N.source],K=C[N.source];this._renderTileClippingMasks(N,K,!1),this.renderLayer(this,Z,N,K,F)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const N=this.style._layers[x[this.currentLayer]],Z=T[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,F))continue;this.opaquePassEnabledForLayer()||j||(j=!0,F.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const K=(N.type==="symbol"?R:I)[N.source];this._renderTileClippingMasks(N,C[N.source],!!this.renderToTexture),this.renderLayer(this,Z,N,K,F)}if(F.isRenderingGlobe&&function(N,Z,K){const se=N.context,oe=se.gl,ae=N.useProgram("atmosphere"),ue=new Vt(oe.LEQUAL,Vt.ReadOnly,[0,1]),fe=N.transform,de=function(Ve,vt){const gt=Ve.properties.get("position"),rt=[-gt.x,-gt.y,-gt.z],kt=l.af(new Float64Array(16));return Ve.properties.get("anchor")==="map"&&(l.b5(kt,kt,vt.rollInRadians),l.b6(kt,kt,-vt.pitchInRadians),l.b5(kt,kt,vt.bearingInRadians),l.b6(kt,kt,vt.center.lat*Math.PI/180),l.by(kt,kt,-vt.center.lng*Math.PI/180)),l.c4(rt,rt,kt),rt}(K,N.transform),_e=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=Z.properties.get("atmosphere-blend")*_e.projectionTransition;if(we===0)return;const pe=ps(fe.worldSize,fe.center.lat),Ae=fe.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,l.av($e,$e,fe.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,l.av($e,$e,Ae),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const De=((Ve,vt,gt,rt,kt)=>({u_sun_pos:Ve,u_atmosphere_blend:vt,u_globe_position:gt,u_globe_radius:rt,u_inv_proj_matrix:kt}))(de,we,[$e[0],$e[1],$e[2]],pe,Ae),Be=Go(se,Z);ae.draw(se,oe.TRIANGLES,ue,Kt.disabled,di.alphaBlended,ti.disabled,De,null,null,"atmosphere",Be.vertexBuffer,Be.indexBuffer,Be.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=function(Z,K){let se=null;const oe=Object.values(Z._layers).flatMap(de=>de.source&&!de.isHidden(K)?[Z.sourceCaches[de.source]]:[]),ae=oe.filter(de=>de.getSource().type==="vector"),ue=oe.filter(de=>de.getSource().type!=="vector"),fe=de=>{(!se||se.getSource().maxzoom<de.getSource().maxzoom)&&(se=de)};return ae.forEach(de=>fe(de)),se||ue.forEach(de=>fe(de)),se}(this.style,this.transform.zoom);N&&function(Z,K,se){for(let oe=0;oe<se.length;oe++)Uc(Z,K,se[oe])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const Z=N.transform.padding;ml(N,N.transform.height-(Z.top||0),3,or),ml(N,Z.bottom||0,3,Pn),Kl(N,Z.left||0,3,zr),Kl(N,N.transform.width-(Z.right||0),3,xr);const K=N.transform.centerPoint;(function(se,oe,ae,ue){Xl(se,oe-1,ae-10,2,20,ue),Xl(se,oe-10,ae-1,20,2,ue)})(N,K.x,N.transform.height-K.y,Zs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!l.c7(r,h):!l.c8(r,h)),p||(p=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(l.c9(r,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,T){const C=x.context,I=C.gl,R=x.transform,F=di.unblended,j=new Vt(I.LEQUAL,Vt.ReadWrite,[0,1]),N=T.sourceCache.getRenderableTiles(),Z=x.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.be.transparent,depth:1});for(const K of N){const se=T.getTerrainMesh(K.tileID),oe=T.getTerrainData(K.tileID),ae=R.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:T.getMeshFrameDelta(R.zoom)};Z.draw(C,I.TRIANGLES,j,Kt.disabled,F,ti.backCCW,ue,oe,ae,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,T){const C=x.context,I=C.gl,R=x.transform,F=di.unblended,j=new Vt(I.LEQUAL,Vt.ReadWrite,[0,1]),N=T.getCoordsTexture(),Z=T.sourceCache.getRenderableTiles(),K=x.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.be.transparent,depth:1}),T.coordsIndex=[];for(const se of Z){const oe=T.getTerrainMesh(se.tileID),ae=T.getTerrainData(se.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.texture);const ue={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(R.zoom)},fe=R.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(C,I.TRIANGLES,j,Kt.disabled,F,ti.backCCW,ue,ae,fe,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),T.coordsIndex.push(se.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(e,r,h,p,x){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(p||[]).length)&&(this.id=h.id,l.ca(h)?function(T,C,I,R,F,j){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:N}=j,Z=Kt.disabled,K=T.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,oe,ae,ue,fe,de,_e,we,pe){const Ae=oe.transform,$e=oe.style.map.terrain,De=fe==="map",Be=de==="map";for(const Ve of se){const vt=ue.getTile(Ve),gt=vt.getBucket(ae);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const rt=l.am(gt.textSizeData,Ae.zoom),kt=l.aB(vt,1,oe.transform.zoom),gi=ei(De,oe.transform,kt),Vi=ae.layout.get("icon-text-fit")!=="none"&&gt.hasIconData();if(rt){const yn=Math.pow(2,Ae.zoom-vt.tileID.overscaledZ),Ji=$e?(vn,nn)=>$e.getElevation(Ve,vn,nn):null;$u(gt,De,Be,pe,Ae,gi,yn,rt,Vi,l.aC(Ae,vt,_e,we),Ve.toUnwrapped(),Ji)}}}(R,T,I,C,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),F),I.paint.get("icon-opacity").constantOr(1)!==0&&Vu(T,C,I,R,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),Z,K,N),I.paint.get("text-opacity").constantOr(1)!==0&&Vu(T,C,I,R,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),Z,K,N),C.map.showCollisionBoxes&&(Bc(T,C,I,R,!0),Bc(T,C,I,R,!1))}(e,r,h,p,this.style.placement.variableOffsets,x):l.cb(h)?function(T,C,I,R,F){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,N=I.paint.get("circle-opacity"),Z=I.paint.get("circle-stroke-width"),K=I.paint.get("circle-stroke-opacity"),se=!I.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(Z.constantOr(1)===0||K.constantOr(1)===0))return;const oe=T.context,ae=oe.gl,ue=T.transform,fe=T.getDepthModeForSublayer(0,Vt.ReadOnly),de=Kt.disabled,_e=T.colorModeForRenderPass(),we=[],pe=ue.getCircleRadiusCorrection();for(let Ae=0;Ae<R.length;Ae++){const $e=R[Ae],De=C.getTile($e),Be=De.getBucket(I);if(!Be)continue;const Ve=I.paint.get("circle-translate"),vt=I.paint.get("circle-translate-anchor"),gt=l.aC(ue,De,Ve,vt),rt=Be.programConfigurations.get(I.id),kt=T.useProgram("circle",rt),gi=Be.layoutVertexBuffer,Vi=Be.indexBuffer,yn=T.style.map.terrain&&T.style.map.terrain.getTerrainData($e),Ji={programConfiguration:rt,program:kt,layoutVertexBuffer:gi,indexBuffer:Vi,uniformValues:ol(T,De,I,gt,pe),terrainData:yn,projectionData:ue.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(se){const vn=Be.segments.get();for(const nn of vn)we.push({segments:new l.aL([nn]),sortKey:nn.sortKey,state:Ji})}else we.push({segments:Be.segments,sortKey:0,state:Ji})}se&&we.sort((Ae,$e)=>Ae.sortKey-$e.sortKey);for(const Ae of we){const{programConfiguration:$e,program:De,layoutVertexBuffer:Be,indexBuffer:Ve,uniformValues:vt,terrainData:gt,projectionData:rt}=Ae.state;De.draw(oe,ae.TRIANGLES,fe,de,_e,ti.backCCW,vt,gt,rt,I.id,Be,Ve,Ae.segments,I.paint,T.transform.zoom,$e)}}(e,r,h,p,x):l.cc(h)?function(T,C,I,R,F){if(I.paint.get("heatmap-opacity")===0)return;const j=T.context,{isRenderingToTexture:N,isRenderingGlobe:Z}=F;if(T.style.map.terrain){for(const K of R){const se=C.getTile(K);C.hasRenderableParent(K)||(T.renderPass==="offscreen"?y(T,se,I,K,Z):T.renderPass==="translucent"&&P(T,I,K,N,Z))}j.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?function(K,se,oe,ae){const ue=K.context,fe=ue.gl,de=K.transform,_e=Kt.disabled,we=new di([fe.ONE,fe.ONE],l.be.transparent,[!0,!0,!0,!0]);(function(pe,Ae,$e){const De=pe.gl;pe.activeTexture.set(De.TEXTURE1),pe.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Be=$e.heatmapFbos.get(l.c1);Be?(De.bindTexture(De.TEXTURE_2D,Be.colorAttachment.get()),pe.bindFramebuffer.set(Be.framebuffer)):(Be=z(pe,Ae.width/4,Ae.height/4),$e.heatmapFbos.set(l.c1,Be))})(ue,K,oe),ue.clear({color:l.be.transparent});for(let pe=0;pe<ae.length;pe++){const Ae=ae[pe];if(se.hasRenderableParent(Ae))continue;const $e=se.getTile(Ae),De=$e.getBucket(oe);if(!De)continue;const Be=De.programConfigurations.get(oe.id),Ve=K.useProgram("heatmap",Be),vt=de.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),gt=de.getCircleRadiusCorrection();Ve.draw(ue,fe.TRIANGLES,Vt.disabled,_e,we,ti.backCCW,ll($e,de.zoom,oe.paint.get("heatmap-intensity"),gt),null,vt,oe.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,oe.paint,de.zoom,Be)}ue.viewport.set([0,0,K.width,K.height])}(T,C,I,R):T.renderPass==="translucent"&&function(K,se){const oe=K.context,ae=oe.gl;oe.setColorMode(K.colorModeForRenderPass());const ue=se.heatmapFbos.get(l.c1);ue&&(oe.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,ue.colorAttachment.get()),oe.activeTexture.set(ae.TEXTURE1),U(oe,se).bind(ae.LINEAR,ae.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(oe,ae.TRIANGLES,Vt.disabled,Kt.disabled,K.colorModeForRenderPass(),ti.disabled,to(K,se,0,1),null,null,se.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,se.paint,K.transform.zoom))}(T,I)}(e,r,h,p,x):l.cd(h)?function(T,C,I,R,F){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,N=I.paint.get("line-opacity"),Z=I.paint.get("line-width");if(N.constantOr(1)===0||Z.constantOr(1)===0)return;const K=T.getDepthModeForSublayer(0,Vt.ReadOnly),se=T.colorModeForRenderPass(),oe=I.paint.get("line-dasharray"),ae=I.paint.get("line-pattern"),ue=ae.constantOr(1),fe=I.paint.get("line-gradient"),de=I.getCrossfadeParameters(),_e=ue?"linePattern":oe?"lineSDF":fe?"lineGradient":"line",we=T.context,pe=we.gl,Ae=T.transform;let $e=!0;for(const De of R){const Be=C.getTile(De);if(ue&&!Be.patternsLoaded())continue;const Ve=Be.getBucket(I);if(!Ve)continue;const vt=Ve.programConfigurations.get(I.id),gt=T.context.program.get(),rt=T.useProgram(_e,vt),kt=$e||rt.program!==gt,gi=T.style.map.terrain&&T.style.map.terrain.getTerrainData(De),Vi=ae.constantOr(null);if(Vi&&Be.imageAtlas){const Qi=Be.imageAtlas,rn=Qi.patternPositions[Vi.to.toString()],wr=Qi.patternPositions[Vi.from.toString()];rn&&wr&&vt.setConstantPatternPositions(rn,wr)}const yn=Ae.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Ji=Ae.getPixelScale(),vn=ue?ga(T,Be,I,Ji,de):oe?Lc(T,Be,I,Ji,oe,de):fe?Ac(T,Be,I,Ji,Ve.lineClipsArray.length):Vo(T,Be,I,Ji);if(ue)we.activeTexture.set(pe.TEXTURE0),Be.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),vt.updatePaintBuffers(de);else if(oe&&(kt||T.lineAtlas.dirty))we.activeTexture.set(pe.TEXTURE0),T.lineAtlas.bind(we);else if(fe){const Qi=Ve.gradients[I.id];let rn=Qi.texture;if(I.gradientVersion!==Qi.version){let wr=256;if(I.stepInterpolant){const Di=C.getSource().maxzoom,sr=De.canonical.z===Di?Math.ceil(1<<T.transform.maxZoom-De.canonical.z):1;wr=l.ag(l.c2(Ve.maxLineLength/l.$*1024*sr),256,we.maxTextureSize)}Qi.gradient=l.c3({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:wr,image:Qi.gradient||void 0,clips:Ve.lineClipsArray}),Qi.texture?Qi.texture.update(Qi.gradient):Qi.texture=new l.T(we,Qi.gradient,pe.RGBA),Qi.version=I.gradientVersion,rn=Qi.texture}we.activeTexture.set(pe.TEXTURE0),rn.bind(I.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}const nn=T.stencilModeForClipping(De);rt.draw(we,pe.TRIANGLES,K,nn,se,ti.disabled,vn,gi,yn,I.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,I.paint,T.transform.zoom,vt,Ve.layoutVertexBuffer2),$e=!1}}(e,r,h,p,x):l.ce(h)?function(T,C,I,R,F){const j=I.paint.get("fill-color"),N=I.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:Z}=F,K=T.colorModeForRenderPass(),se=I.paint.get("fill-pattern"),oe=T.opaquePassEnabledForLayer()&&!se.constantOr(1)&&j.constantOr(l.be.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===oe){const ae=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);ve(T,C,I,R,ae,K,!1,Z)}if(T.renderPass==="translucent"&&I.paint.get("fill-antialias")){const ae=T.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);ve(T,C,I,R,ae,K,!0,Z)}}(e,r,h,p,x):l.cf(h)?function(T,C,I,R,F){const j=I.paint.get("fill-extrusion-opacity");if(j===0)return;const{isRenderingToTexture:N}=F;if(T.renderPass==="translucent"){const Z=new Vt(T.context.gl.LEQUAL,Vt.ReadWrite,T.depthRangeFor3D);if(j!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Oe(T,C,I,R,Z,Kt.disabled,di.disabled,N),Oe(T,C,I,R,Z,T.stencilModeFor3D(),T.colorModeForRenderPass(),N);else{const K=T.colorModeForRenderPass();Oe(T,C,I,R,Z,Kt.disabled,K,N)}}}(e,r,h,p,x):l.cg(h)?function(T,C,I,R,F){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,N=T.context,Z=T.style.projection.useSubdivision,K=T.getDepthModeForSublayer(0,Vt.ReadOnly),se=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(oe,ae,ue,fe,de,_e,we){const pe=oe.context,Ae=pe.gl;for(const $e of ue){const De=ae.getTile($e),Be=De.dem;if(!Be||!Be.data||!De.needsHillshadePrepare)continue;const Ve=Be.dim,vt=Be.stride,gt=Be.getPixels();if(pe.activeTexture.set(Ae.TEXTURE1),pe.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||oe.getTileTexture(vt),De.demTexture){const kt=De.demTexture;kt.update(gt,{premultiply:!1}),kt.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE)}else De.demTexture=new l.T(pe,gt,Ae.RGBA,{premultiply:!1}),De.demTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);pe.activeTexture.set(Ae.TEXTURE0);let rt=De.fbo;if(!rt){const kt=new l.T(pe,{width:Ve,height:Ve,data:null},Ae.RGBA);kt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),rt=De.fbo=pe.createFramebuffer(Ve,Ve,!0,!1),rt.colorAttachment.set(kt.texture)}pe.bindFramebuffer.set(rt.framebuffer),pe.viewport.set([0,0,Ve,Ve]),oe.useProgram("hillshadePrepare").draw(pe,Ae.TRIANGLES,de,_e,we,ti.disabled,Fh(De.tileID,Be),null,null,fe.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),De.needsHillshadePrepare=!1}})(T,C,R,I,K,Kt.disabled,se),N.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(Z){const[oe,ae,ue]=T.stencilConfigForOverlapTwoPass(R);Ge(T,C,I,ue,oe,K,se,!1,j),Ge(T,C,I,ue,ae,K,se,!0,j)}else{const[oe,ae]=T.getStencilConfigForOverlapAndUpdateStencilID(R);Ge(T,C,I,ae,oe,K,se,!1,j)}}(e,r,h,p,x):l.ch(h)?function(T,C,I,R,F){if(T.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:j}=F,N=T.style.projection.useSubdivision,Z=T.getDepthModeForSublayer(0,Vt.ReadOnly),K=T.colorModeForRenderPass();if(N){const[se,oe,ae]=T.stencilConfigForOverlapTwoPass(R);st(T,C,I,ae,se,Z,K,!1,j),st(T,C,I,ae,oe,Z,K,!0,j)}else{const[se,oe]=T.getStencilConfigForOverlapAndUpdateStencilID(R);st(T,C,I,oe,se,Z,K,!1,j)}}(e,r,h,p,x):l.ci(h)?function(T,C,I,R,F){if(T.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:j}=F,N=C.getSource(),Z=T.style.projection.useSubdivision;if(N instanceof _t)Ht(T,C,I,R,null,!1,!1,N.tileCoords,N.flippedWindingOrder,j);else if(Z){const[K,se,oe]=T.stencilConfigForOverlapTwoPass(R);Ht(T,C,I,oe,K,!1,!0,Lt,!1,j),Ht(T,C,I,oe,se,!0,!0,Lt,!1,j)}else{const[K,se]=T.getStencilConfigForOverlapAndUpdateStencilID(R);Ht(T,C,I,se,K,!1,!0,Lt,!1,j)}}(e,r,h,p,x):l.cj(h)?function(T,C,I,R,F){const j=I.paint.get("background-color"),N=I.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:Z}=F,K=T.context,se=K.gl,oe=T.style.projection,ae=T.transform,ue=ae.tileSize,fe=I.paint.get("background-pattern");if(T.isPatternMissing(fe))return;const de=!fe&&j.a===1&&N===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==de)return;const _e=Kt.disabled,we=T.getDepthModeForSublayer(0,de==="opaque"?Vt.ReadWrite:Vt.ReadOnly),pe=T.colorModeForRenderPass(),Ae=T.useProgram(fe?"backgroundPattern":"background"),$e=R||qe(ae,{tileSize:ue,terrain:T.style.map.terrain});fe&&(K.activeTexture.set(se.TEXTURE0),T.imageManager.bind(T.context));const De=I.getCrossfadeParameters();for(const Be of $e){const Ve=ae.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),vt=fe?jh(N,T,fe,{tileID:Be,tileSize:ue},De):io(N,j),gt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Be),rt=oe.getMeshFromTileID(K,Be.canonical,!1,!0,"raster");Ae.draw(K,se.TRIANGLES,we,_e,pe,ti.backCCW,vt,gt,Ve,I.id,rt.vertexBuffer,rt.indexBuffer,rt.segments)}}(e,0,h,p,x):l.ck(h)&&function(T,C,I,R){const{isRenderingGlobe:F}=R,j=T.context,N=I.implementation,Z=T.style.projection,K=T.transform,se=K.getProjectionDataForCustomLayer(F),oe={farZ:K.farZ,nearZ:K.nearZ,fov:K.fov*Math.PI/180,modelViewProjectionMatrix:K.modelViewProjectionMatrix,projectionMatrix:K.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:se},ae=N.renderingMode?N.renderingMode:"2d";if(T.renderPass==="offscreen"){const ue=N.prerender;ue&&(T.setCustomLayerDefaults(),j.setColorMode(T.colorModeForRenderPass()),ue.call(N,j.gl,oe),j.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),j.setColorMode(T.colorModeForRenderPass()),j.setStencilMode(Kt.disabled);const ue=ae==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,Vt.ReadOnly);j.setDepthMode(ue),N.render(j.gl,oe),j.setDirty(),T.setBaseState(),j.bindFramebuffer.set(null)}}(e,0,h,x))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!r||!h}useProgram(e,r,h=!1,p=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,T=this.style.projection,C=h?Ar.projectionMercator:T.shaderPreludeCode,I=h?Uo:T.shaderDefine,R=e+(r?r.cacheKey:"")+`/${h?ha:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[R]||(this.cache[R]=new jl(this.context,Ar[e],r,Bu[e],this._showOverdrawInspector,x,C,I,p)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function qs(v,e){let r,h=!1,p=null,x=null;const T=()=>{p=null,h&&(v.apply(x,r),p=setTimeout(T,e),h=!1)};return(...C)=>(h=!0,x=this,r=C,p||T(),p)}class gl{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let h;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:h,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const h=r.join("/");let p=h;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${h}`);let x=window.location.hash.replace(p,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let T=window.location.href.replace(/(#.+)?$/,x);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=qs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,p),T=Math.round(r.lng*x)/x,C=Math.round(r.lat*x)/x,I=this._map.getBearing(),R=this._map.getPitch();let F="";if(F+=e?`/${T}/${C}/${h}`:`${h}/${C}/${T}`,(I||R)&&(F+="/"+Math.round(10*I)/10),R&&(F+=`/${Math.round(R)}`),this._hashName){const j=this._hashName;let N=!1;const Z=window.location.hash.slice(1).split("&").map(K=>{const se=K.split("=")[0];return se===j?(N=!0,`${se}=${F}`):K}).filter(K=>K);return N||Z.push(`${j}=${F}`),`#${Z.join("&")}`}return`#${F}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.S(+e[2],+e[1])}catch{return!1}const r=+e[0],h=+(e[3]||0),p=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&h>=-180&&h<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Sa={linearity:.3,easing:l.cl(0,0,.3,1)},Pa=l.e({deceleration:2500,maxSpeed:1400},Sa),_l=l.e({deceleration:20,maxSpeed:1400},Sa),Ca=l.e({deceleration:1e3,maxSpeed:360},Sa),$c=l.e({deceleration:1e3,maxSpeed:90},Sa),Tp=l.e({deceleration:1e3,maxSpeed:360},Sa);class Sp{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:X.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=X.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)r.zoom+=x.zoomDelta||0,r.bearing+=x.bearingDelta||0,r.pitch+=x.pitchDelta||0,r.roll+=x.rollDelta||0,x.panDelta&&r.pan._add(x.panDelta),x.around&&(r.around=x.around),x.pinchAround&&(r.pinchAround=x.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const x=Jl(r.pan.mag(),h,l.e({},Pa,e||{})),T=r.pan.mult(x.amount/r.pan.mag()),C=this._map.cameraHelper.handlePanInertia(T,this._map.transform);p.center=C.easingCenter,p.offset=C.easingOffset,Yl(p,x)}if(r.zoom){const x=Jl(r.zoom,h,_l);p.zoom=this._map.transform.zoom+x.amount,Yl(p,x)}if(r.bearing){const x=Jl(r.bearing,h,Ca);p.bearing=this._map.transform.bearing+l.ag(x.amount,-179,179),Yl(p,x)}if(r.pitch){const x=Jl(r.pitch,h,$c);p.pitch=this._map.transform.pitch+x.amount,Yl(p,x)}if(r.roll){const x=Jl(r.roll,h,Tp);p.roll=this._map.transform.roll+l.ag(x.amount,-179,179),Yl(p,x)}if(p.zoom||p.bearing){const x=r.pinchAround===void 0?r.around:r.pinchAround;p.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function Yl(v,e){(!v.duration||v.duration<e.duration)&&(v.duration=e.duration,v.easing=e.easing)}function Jl(v,e,r){const{maxSpeed:h,linearity:p,deceleration:x}=r,T=l.ag(v*p/(e/1e3),-h,h),C=Math.abs(T)/(x*p);return{easing:r.easing,duration:1e3*C,amount:T*(C/2)}}class no extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,h,p={}){h=h instanceof MouseEvent?h:new MouseEvent(e,h);const x=q.mousePos(r.getCanvas(),h),T=r.unproject(x);super(e,l.e({point:x,lngLat:T,originalEvent:h},p)),this._defaultPrevented=!1,this.target=r}}class Ho extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,h){const p=e==="touchend"?h.changedTouches:h.touches,x=q.touchPos(r.getCanvasContainer(),p),T=x.map(I=>r.unproject(I)),C=x.reduce((I,R,F,j)=>I.add(R.div(j.length)),new l.P(0,0));super(e,{points:x,point:C,lngLats:T,lngLat:r.unproject(C),originalEvent:h}),this._defaultPrevented=!1}}class Zh extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class Pp{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Zh(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new no(e.type,this._map,e))}mouseup(e){this._map.fire(new no(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new no(e.type,this._map,e))}dblclick(e){return this._firePreventable(new no(e.type,this._map,e))}mouseover(e){this._map.fire(new no(e.type,this._map,e))}mouseout(e){this._map.fire(new no(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ho(e.type,this._map,e))}touchmove(e){this._map.fire(new Ho(e.type,this._map,e))}touchend(e){this._map.fire(new Ho(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ho(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cp{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new no(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new no("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new no(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ql{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class qh{constructor(e,r){this._map=e,this._tr=new Ql(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const h=r;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const x=Math.min(p.x,h.x),T=Math.max(p.x,h.x),C=Math.min(p.y,h.y),I=Math.max(p.y,h.y);q.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=T-x+"px",this._box.style.height=I-C+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const h=this._startPos,p=r;if(this.reset(),q.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:x=>x.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new l.l(e,{originalEvent:r}))}}function Zu(v,e){if(v.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${e.length}`);const r={};for(let h=0;h<v.length;h++)r[v[h].identifier]=e[h];return r}class Mp{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const x=new l.P(0,0);for(const T of p)x._add(T);return x.div(p.length)}(r),this.touches=Zu(h,r)))}touchmove(e,r,h){if(this.aborted||!this.centroid)return;const p=Zu(h,r);for(const x in this.touches){const T=p[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(e,r,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class qu{constructor(e){this.singleTap=new Mp(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,h){this.singleTap.touchstart(e,r,h)}touchmove(e,r,h){this.singleTap.touchmove(e,r,h)}touchend(e,r,h){const p=this.singleTap.touchend(e,r,h);if(p){const x=e.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(x&&T||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Gu{constructor(e){this._tr=new Ql(e),this._zoomIn=new qu({numTouches:1,numTaps:2}),this._zoomOut=new qu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,h){this._zoomIn.touchstart(e,r,h),this._zoomOut.touchstart(e,r,h)}touchmove(e,r,h){this._zoomIn.touchmove(e,r,h),this._zoomOut.touchmove(e,r,h)}touchend(e,r,h){const p=this._zoomIn.touchend(e,r,h),x=this._zoomOut.touchend(e,r,h),T=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:e})}):x?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(x)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=Array.isArray(r)?r[0]:r;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ro=0,Wo=2,Ep={[Ro]:1,[Wo]:2};class Vr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=q.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,h){const p=Ep[h];return r.buttons===void 0||(r.buttons&p)!==p}(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class tc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Dm{constructor(e=new Vr({checkCorrectEvent:()=>!0}),r=new tc){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,h){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const Hu=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=e=>{e.preventDefault()}};class Om{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,h){return this._calculateTransform(e,r,h)}touchmove(e,r,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,r,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,h){this._calculateTransform(e,r,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,h){h.length>0&&(this._active=!0);const p=Zu(h,r),x=new l.P(0,0),T=new l.P(0,0);let C=0;for(const R in p){const F=p[R],j=this._touches[R];j&&(x._add(F),T._add(F.sub(j)),C++,p[R]=F)}if(this._touches=p,this._shouldBePrevented(C)||!T.mag())return;const I=T.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,h){if(!this._firstTwoTouches)return;e.preventDefault();const[p,x]=this._firstTwoTouches,T=Vc(h,r,p),C=Vc(h,r,x);if(!T||!C)return;const I=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],I,e)}touchend(e,r,h){if(!this._firstTwoTouches)return;const[p,x]=this._firstTwoTouches,T=Vc(h,r,p),C=Vc(h,r,x);T&&C||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vc(v,e,r){for(let h=0;h<v.length;h++)if(v[h].identifier===r)return e[h]}function ic(v,e){return Math.log(v/e)/Math.LN2}class bs extends Gh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ic(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ic(this._distance,h),pinchAround:r}}}function Mt(v,e){return 180*v.angleWith(e)/Math.PI}class Hh extends Gh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,h){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mt(this._vector,p),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,h=Mt(e,this._startVector);return Math.abs(h)<r}}function Zc(v){return Math.abs(v.y)>Math.abs(v.x)}class Wh extends Gh{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,h){super.touchstart(e,r,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,Zc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),x=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,x,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,h){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,x=r.mag()>=2;if(!p&&!x)return;if(!p||!x)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const T=e.y>0==r.y>0;return Zc(e)&&Zc(r)&&T}}const qc={panStep:100,bearingStep:15,pitchStep:10};class nc{constructor(e){this._tr=new Ql(e);const r=qc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,h=0,p=0,x=0,T=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),x=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),x=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),T=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:C=>{const I=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Kh,zoom:r?Math.round(I.zoom)+r*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+h*this._bearingStep,pitch:I.pitch+p*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kh(v){return v*(2-v)}const Ci=4.000244140625,Xh=1/450;class Ip{constructor(e,r){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new Ql(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xh}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const h=X.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,r!==0&&r%Ci==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=q.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(l.S.convert(h.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Ci?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&I!==0&&(I=1/I);const R=typeof this._targetZoom!="number"?e.scale:l.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),l.aj(R*I)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,p=this._easing;let x,T=!1;if(this._type==="wheel"&&h&&p){const C=X.now()-this._lastWheelEventTime,I=Math.min((C+5)/200,1),R=p(I);x=l.C.number(h,r,R),I<1?this._frameId||(this._frameId=!0):T=!0}else x=r,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!T,zoomDelta:x-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=l.cn;if(this._prevEase){const h=this._prevEase,p=(X.now()-h.start)/h.duration,x=h.easing(p+.01)-h.easing(p),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);r=l.cl(T,C,.25,1)}return this._prevEase={start:X.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Wu{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fm{constructor(e){this._tr=new Ql(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bm{constructor(){this._tap=new qu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,h){if(!this._swipePoint)if(this._tapTime){const p=r[0],x=e.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;x&&T?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,r,h)}touchmove(e,r,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=r[0],x=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(e,r,h)}touchend(e,r,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(e,r,h);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(e,r,h){this._el=e,this._mousePan=r,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ku{constructor(e,r,h,p){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=h,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Jh{constructor(e,r,h,p){this._el=e,this._touchZoom=r,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ap{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=r,this._container.appendChild(p);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=h,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Gc=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class Nm extends l.l{}function Qh(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class Ma{constructor(e,r){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,x)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,C={needsRenderFrame:!1},I={},R={};for(const{handlerName:N,handler:Z,allowed:K}of this._handlers){if(!Z.isEnabled())continue;let se;if(this._blockedByActive(R,K,N))Z.reset();else if(Z[x||p.type]){if(l.co(p,x||p.type)){const oe=q.mousePos(this._map.getCanvas(),p);se=Z[x||p.type](p,oe)}else if(l.cp(p,x||p.type)){const oe=this._getMapTouches(p.touches),ae=q.touchPos(this._map.getCanvas(),oe);se=Z[x||p.type](p,ae,oe)}else l.cq(x||p.type)||(se=Z[x||p.type](p));this.mergeHandlerResult(C,I,se,N,T),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||Z.isActive())&&(R[N]=Z)}const F={};for(const N in this._previousActiveHandlers)R[N]||(F[N]=T);this._previousActiveHandlers=R,(Object.keys(F).length||Qh(C))&&(this._changes.push([C,I,F]),this._triggerRenderFrame()),(Object.keys(R).length||Qh(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=C;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sp(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,x,T]of this._listeners)q.addEventListener(p,x,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[e,r,h]of this._listeners)q.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){const r=this._map,h=r.getCanvasContainer();this._add("mapEvent",new Pp(r,e));const p=r.boxZoom=new qh(r,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const x=r.cooperativeGestures=new Ap(r,e.cooperativeGestures);this._add("cooperativeGestures",x),e.cooperativeGestures&&x.enable();const T=new Gu(r),C=new Fm(r);r.doubleClickZoom=new Wu(C,T),this._add("tapZoom",T),this._add("clickZoom",C),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const I=new Bm;this._add("tapDragZoom",I);const R=r.touchPitch=new Wh(r);this._add("touchPitch",R),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const F=()=>r.project(r.getCenter()),j=function({enable:de,clickTolerance:_e,aroundCenter:we=!0,minPixelCenterThreshold:pe=100,rotateDegreesPerPixelMoved:Ae=.8},$e){const De=new Vr({checkCorrectEvent:Be=>q.mouseButton(Be)===0&&Be.ctrlKey||q.mouseButton(Be)===2&&!Be.ctrlKey});return new ec({clickTolerance:_e,move:(Be,Ve)=>{const vt=$e();if(we&&Math.abs(vt.y-Be.y)>pe)return{bearingDelta:l.cm(new l.P(Be.x,Ve.y),Ve,vt)};let gt=(Ve.x-Be.x)*Ae;return we&&Ve.y<vt.y&&(gt=-gt),{bearingDelta:gt}},moveStateManager:De,enable:de,assignEvents:Hu})}(e,F),N=function({enable:de,clickTolerance:_e,pitchDegreesPerPixelMoved:we=-.5}){const pe=new Vr({checkCorrectEvent:Ae=>q.mouseButton(Ae)===0&&Ae.ctrlKey||q.mouseButton(Ae)===2});return new ec({clickTolerance:_e,move:(Ae,$e)=>({pitchDelta:($e.y-Ae.y)*we}),moveStateManager:pe,enable:de,assignEvents:Hu})}(e),Z=function({enable:de,clickTolerance:_e,rollDegreesPerPixelMoved:we=.3},pe){const Ae=new Vr({checkCorrectEvent:$e=>q.mouseButton($e)===2&&$e.ctrlKey});return new ec({clickTolerance:_e,move:($e,De)=>{const Be=pe();let Ve=(De.x-$e.x)*we;return De.y<Be.y&&(Ve=-Ve),{rollDelta:Ve}},moveStateManager:Ae,enable:de,assignEvents:Hu})}(e,F);r.dragRotate=new Ku(e,j,N,Z),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const K=function({enable:de,clickTolerance:_e}){const we=new Vr({checkCorrectEvent:pe=>q.mouseButton(pe)===0&&!pe.ctrlKey});return new ec({clickTolerance:_e,move:(pe,Ae)=>({around:Ae,panDelta:Ae.sub(pe)}),activateOnStart:!0,moveStateManager:we,enable:de,assignEvents:Hu})}(e),se=new Om(e,r);r.dragPan=new Yh(h,K,se),this._add("mousePan",K),this._add("touchPan",se,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const oe=new Hh,ae=new bs;r.touchZoomRotate=new Jh(h,ae,oe,I),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const ue=r.scrollZoom=new Ip(r,()=>this._triggerRenderFrame());this._add("scrollZoom",ue,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const fe=r.keyboard=new nc(r);this._add("keyboard",fe),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Cp(r))}_add(e,r,h){this._handlers.push({handlerName:e,handler:r,allowed:h}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gc(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,h){for(const p in e)if(p!==h&&(!r||r.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const h of e)this._el.contains(h.target)&&r.push(h);return r}mergeHandlerResult(e,r,h,p,x){if(!h)return;l.e(e,h);const T={handlerName:p,originalEvent:h.originalEvent||x};h.zoomDelta!==void 0&&(r.zoom=T),h.panDelta!==void 0&&(r.drag=T),h.rollDelta!==void 0&&(r.roll=T),h.pitchDelta!==void 0&&(r.pitch=T),h.bearingDelta!==void 0&&(r.rotate=T)}_applyChanges(){const e={},r={},h={};for(const[p,x,T]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(e.rollDelta=(e.rollDelta||0)+p.rollDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),l.e(r,x),l.e(h,T);this._updateMapTransform(e,r,h),this._changes=[]}_updateMapTransform(e,r,h){const p=this._map,x=p._getTransformForUpdate(),T=p.terrain;if(!(Qh(e)||T&&this._terrainMovement))return this._fireEvents(r,h,!0);p._stop(!0);let{panDelta:C,zoomDelta:I,bearingDelta:R,pitchDelta:F,rollDelta:j,around:N,pinchAround:Z}=e;Z!==void 0&&(N=Z),N=N||p.transform.centerPoint,T&&!x.isPointOnMapSurface(N)&&(N=x.centerPoint);const K={panDelta:C,zoomDelta:I,rollDelta:j,pitchDelta:F,bearingDelta:R,around:N};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(N)&&(N=x.centerPoint);const se=N.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(C?N.sub(C):N);T?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(K,x),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?x.setCenter(x.screenPointToLocation(x.centerPoint.sub(C))):this._map.cameraHelper.handleMapControlsPan(K,x,se):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(K,x,se))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(K,x),this._map.cameraHelper.handleMapControlsPan(K,x,se)),p._applyUpdatedTransform(x),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,h,!0)}_fireEvents(e,r,h){const p=Gc(this._eventsInProgress),x=Gc(e),T={};for(const j in e){const{originalEvent:N}=e[j];this._eventsInProgress[j]||(T[`${j}start`]=N),this._eventsInProgress[j]=e[j]}!p&&x&&this._fireEvent("movestart",x.originalEvent);for(const j in T)this._fireEvent(j,T[j]);x&&this._fireEvent("move",x.originalEvent);for(const j in e){const{originalEvent:N}=e[j];this._fireEvent(j,N)}const C={};let I;for(const j in this._eventsInProgress){const{handlerName:N,originalEvent:Z}=this._eventsInProgress[j];this._handlersById[N].isActive()||(delete this._eventsInProgress[j],I=r[N]||Z,C[`${j}end`]=I)}for(const j in C)this._fireEvent(j,C[j]);const R=Gc(this._eventsInProgress),F=(p||x)&&!R;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(h&&F){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!j||!j.essential&&X.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()):(N(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new l.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Nm("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class fn extends l.E{constructor(e,r,h){super(),this._renderFrameCallback=()=>{const p=Math.min((X.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new l.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,h){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},r),h)}panTo(e,r,h){return this.easeTo(l.e({center:e},r),h)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,h){return this.easeTo(l.e({zoom:e},r),h)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",r)).fire(new l.l("move",r)).fire(new l.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,h){return this.easeTo(l.e({bearing:e},r),h)}resetNorth(e,r){return this.rotateTo(0,l.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Pe.convert(e).adjustAntiMeridian();const h=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,r)}_cameraForBoxAndBearing(e,r,h,p){const x={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const R=p.padding;p.padding={top:R,bottom:R,right:R,left:R}}const T=l.e(x,p.padding);p.padding=T;const C=this.transform,I=new Pe(e,r);return this.cameraHelper.cameraForBoxAndBearing(p,T,I,h,C)}fitBounds(e,r,h){return this._fitInternal(this.cameraForBounds(e,r),r,h)}fitScreenCoordinates(e,r,h,p,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(r)),h,p),p,x)}_fitInternal(e,r,h){return e?(delete(r=l.e(e,r)).padding,r.linear?this.easeTo(r,h):this.flyTo(r,h)):this}jumpTo(e,r){this.stop();const h=this._getTransformForUpdate();let p=!1,x=!1,T=!1;const C=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);const I=h.zoom!==C;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(p=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(x=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(T=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new l.l("movestart",r)).fire(new l.l("move",r)),I&&this.fire(new l.l("zoomstart",r)).fire(new l.l("zoom",r)).fire(new l.l("zoomend",r)),p&&this.fire(new l.l("rotatestart",r)).fire(new l.l("rotate",r)).fire(new l.l("rotateend",r)),x&&this.fire(new l.l("pitchstart",r)).fire(new l.l("pitch",r)).fire(new l.l("pitchend",r)),T&&this.fire(new l.l("rollstart",r)).fire(new l.l("roll",r)).fire(new l.l("rollend",r)),this.fire(new l.l("moveend",r))}calculateCameraOptionsFromTo(e,r,h,p=0){const x=l.a0.fromLngLat(e,r),T=l.a0.fromLngLat(h,p),C=T.x-x.x,I=T.y-x.y,R=T.z-x.z,F=Math.hypot(C,I,R);if(F===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(C,I),N=l.aj(this.transform.cameraToCenterDistance/F/this.transform.tileSize),Z=180*Math.atan2(C,-I)/Math.PI;let K=180*Math.acos(j/F)/Math.PI;return K=R<0?90-K:90+K,{center:T.toLngLat(),elevation:p,zoom:N,pitch:K,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,h,p,x){const T=this.transform.calculateCenterFromCameraLngLatAlt(e,r,h,p);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:h,pitch:p,roll:x}}easeTo(e,r){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.cn},e)).animate===!1||!e.essential&&X.prefersReducedMotion)&&(e.duration=0);const h=this._getTransformForUpdate(),p=this.getBearing(),x=h.pitch,T=h.roll,C="bearing"in e?this._normalizeBearing(e.bearing,p):p,I="pitch"in e?+e.pitch:x,R="roll"in e?this._normalizeBearing(e.roll,T):T,F="padding"in e?e.padding:h.padding,j=l.P.convert(e.offset);let N,Z;e.around&&(N=l.S.convert(e.around),Z=h.locationToScreenPoint(N));const K={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(h,{bearing:C,pitch:I,roll:R,padding:F,around:N,aroundPoint:Z,offsetAsPoint:j,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||p!==C,this._pitching=this._pitching||I!==x,this._rolling=this._rolling||R!==T,this._padding=!h.isPaddingEqual(F),this._zooming=this._zooming||se.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,K),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease(oe=>{se.easeFunc(oe),this.terrain&&!e.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(h),this._fireMoveEvents(r)},oe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,oe)},e),this}_prepareEase(e,r,h={}){this._moving=!0,r||h.moving||this.fire(new l.l("movestart",e)),this._zooming&&!h.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(r-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(l.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),h=e.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(h<p){const x=this.calculateCameraOptionsFromTo(r,p,e.center,e.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(p=>this._elevateCameraIfInsideTerrain(p)),this.transformCameraUpdate&&r.push(p=>this.transformCameraUpdate(p)),!r.length)return;const h=e.clone();for(const p of r){const x=h.clone(),{center:T,zoom:C,roll:I,pitch:R,bearing:F,elevation:j}=p(x);T&&x.setCenter(T),j!==void 0&&x.setElevation(j),C!==void 0&&x.setZoom(C),I!==void 0&&x.setRoll(I),R!==void 0&&x.setPitch(R),F!==void 0&&x.setBearing(F),h.apply(x)}this.transform.apply(h)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const h=this._zooming,p=this._rotating,x=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new l.l("zoomend",e)),p&&this.fire(new l.l("rotateend",e)),x&&this.fire(new l.l("pitchend",e)),T&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,r){if(!e.essential&&X.prefersReducedMotion){const Ve=l.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ve,r)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cn},e);const h=this._getTransformForUpdate(),p=h.bearing,x=h.pitch,T=h.roll,C=h.padding,I="bearing"in e?this._normalizeBearing(e.bearing,p):p,R="pitch"in e?+e.pitch:x,F="roll"in e?this._normalizeBearing(e.roll,T):T,j="padding"in e?e.padding:h.padding,N=l.P.convert(e.offset);let Z=h.centerPoint.add(N);const K=h.screenPointToLocation(Z),se=this.cameraHelper.handleFlyTo(h,{bearing:I,pitch:R,roll:F,padding:j,locationAtOffset:K,offsetAsPoint:N,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let oe=e.curve;const ae=Math.max(h.width,h.height),ue=ae/se.scaleOfZoom,fe=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(oe=Math.sqrt(ae/se.scaleOfMinZoom/fe*2));const de=oe*oe;function _e(Ve){const vt=(ue*ue-ae*ae+(Ve?-1:1)*de*de*fe*fe)/(2*(Ve?ue:ae)*de*fe);return Math.log(Math.sqrt(vt*vt+1)-vt)}function we(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function pe(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Ae=_e(!1);let $e=function(Ve){return pe(Ae)/pe(Ae+oe*Ve)},De=function(Ve){return ae*((pe(Ae)*(we(vt=Ae+oe*Ve)/pe(vt))-we(Ae))/de)/fe;var vt},Be=(_e(!0)-Ae)/oe;if(Math.abs(fe)<2e-6||!isFinite(Be)){if(Math.abs(ae-ue)<1e-6)return this.easeTo(e,r);const Ve=ue<ae?-1:1;Be=Math.abs(Math.log(ue/ae))/oe,De=()=>0,$e=vt=>Math.exp(Ve*oe*vt)}return e.duration="duration"in e?+e.duration:1e3*Be/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=p!==I,this._pitching=R!==x,this._rolling=F!==T,this._padding=!h.isPaddingEqual(j),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease(Ve=>{const vt=Ve*Be,gt=1/$e(vt),rt=De(vt);this._rotating&&h.setBearing(l.C.number(p,I,Ve)),this._pitching&&h.setPitch(l.C.number(x,R,Ve)),this._rolling&&h.setRoll(l.C.number(T,F,Ve)),this._padding&&(h.interpolatePadding(C,j,Ve),Z=h.centerPoint.add(N)),se.easeFunc(Ve,gt,rt,Z),this.terrain&&!e.freezeElevation&&this._updateElevation(Ve),this._applyUpdatedTransform(h),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,r)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,r,h){h.animate===!1||h.duration===0?(e(1),r()):(this._easeStart=X.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=l.aN(e,-180,180);const h=Math.abs(e-r);return Math.abs(e-360-r)<h&&(e-=360),Math.abs(e+360-r)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.S.convert(e),this.transform.tileZoom):null}}const Hc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Xu{constructor(e=Hc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const h=this._map._getUIString(`AttributionControl.${r}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style.sourceCaches;for(const p in r){const x=r[p];if(x.used||x.usedForTerrain){const T=x.getSource();T.attribution&&e.indexOf(T.attribution)<0&&e.push(T.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,x)=>p.length-x.length),e=e.filter((p,x)=>{for(let T=x+1;T<e.length;T++)if(e[T].indexOf(p)>=0)return!1;return!0});const h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=q.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ed{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const h=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const r=q.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Lp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,h=r?this._queue.concat(r):this._queue;for(const p of h)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const h of r)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var kp=l.aI([{name:"a_pos3d",type:"Int16",components:3}]);class jm extends l.E{constructor(e){super(),this._lastTilesetChange=X.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const h={};for(const p of qe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),l.bX(p.terrainRttPosMatrix32f,0,l.$,l.$,0,0,1),this._tiles[p.key]=new vi(p,this.tileSize),this._lastTilesetChange=X.now());for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(e){for(const r in this._tiles){const h=this._tiles[r];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID,x=e.clone(),T=l.b9();if(p.canonical.equals(e.canonical))l.bX(T,0,l.$,l.$,0,0,1);else if(p.canonical.isChildOf(e.canonical)){const C=p.canonical.z-e.canonical.z,I=p.canonical.x-(p.canonical.x>>C<<C),R=p.canonical.y-(p.canonical.y>>C<<C),F=l.$>>C;l.bX(T,0,F,F,0,0,1),l.M(T,T,[-I*F,-R*F,0])}else{if(!e.canonical.isChildOf(p.canonical))continue;{const C=e.canonical.z-p.canonical.z,I=e.canonical.x-(e.canonical.x>>C<<C),R=e.canonical.y-(e.canonical.y>>C<<C),F=l.$>>C;l.bX(T,0,l.$,l.$,0,0,1),l.M(T,T,[I*F,R*F,0]),l.N(T,T,[1/2**C,1/2**C,0])}}x.terrainRttPosMatrix32f=new Float32Array(T),r[h]=x}return r}_getTerrainCoordsForTileRanges(e,r){const h={};for(const p of this._renderableTilesKeys){const x=this._tiles[p].tileID;if(!this._isWithinTileRanges(x,r))continue;const T=e.clone(),C=l.b9();if(x.canonical.z===e.canonical.z){const I=e.canonical.x-x.canonical.x,R=e.canonical.y-x.canonical.y;l.bX(C,0,l.$,l.$,0,0,1),l.M(C,C,[I*l.$,R*l.$,0])}else if(x.canonical.z>e.canonical.z){const I=x.canonical.z-e.canonical.z,R=x.canonical.x-(x.canonical.x>>I<<I),F=x.canonical.y-(x.canonical.y>>I<<I),j=e.canonical.x-(x.canonical.x>>I),N=e.canonical.y-(x.canonical.y>>I),Z=l.$>>I;l.bX(C,0,Z,Z,0,0,1),l.M(C,C,[-R*Z+j*l.$,-F*Z+N*l.$,0])}else{const I=e.canonical.z-x.canonical.z,R=e.canonical.x-(e.canonical.x>>I<<I),F=e.canonical.y-(e.canonical.y>>I<<I),j=(e.canonical.x>>I)-x.canonical.x,N=(e.canonical.y>>I)-x.canonical.y,Z=l.$<<I;l.bX(C,0,Z,Z,0,0,1),l.M(C,C,[R*l.$+j*Z,F*l.$+N*Z,0])}T.terrainRttPosMatrix32f=new Float32Array(C),h[p]=T}return h}getSourceTile(e,r){const h=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!x||!x.dem)&&r)for(;p>=h.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(e.scaledTo(p--).key);return x}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class ws{constructor(e,r,h){this._meshCache={},this.painter=e,this.sourceCache=new jm(r),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,h,p=l.$){var x;if(!(r>=0&&r<p&&h>=0&&h<p))return 0;const T=this.getTerrainData(e),C=(x=T.tile)===null||x===void 0?void 0:x.dem;if(!C)return 0;const I=l.cr([],[r/p*l.$,h/p*l.$],T.u_terrain_matrix),R=[I[0]*C.dim,I[1]*C.dim],F=Math.floor(R[0]),j=Math.floor(R[1]),N=R[0]-F,Z=R[1]-j;return C.get(F,j)*(1-N)*(1-Z)+C.get(F+1,j)*N*(1-Z)+C.get(F,j+1)*(1-N)*Z+C.get(F+1,j+1)*N*Z}getElevationForLngLatZoom(e,r){if(!l.cs(r,e.wrap()))return 0;const{tileID:h,mercatorX:p,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(h,p%l.$,x%l.$,l.$)}getElevation(e,r,h,p=l.$){return this.getDEMElevation(e,r,h,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(p,x,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.af([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const p=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new l.T(p,r.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),r.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const h=r&&r+r.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){const p=this.sourceCache.sourceCache._source.maxzoom;let x=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?x=e.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=e.canonical.x-(e.canonical.x>>x<<x),C=e.canonical.y-(e.canonical.y>>x<<x),I=l.ct(new Float64Array(16),[1/(l.$<<x),1/(l.$<<x),0]);l.M(I,I,[T*l.$,C*l.$,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,h=r.width/devicePixelRatio,p=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(r.context,{width:h,height:p,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(r.context,{width:h,height:p,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,T=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)r[T+0]=255&C,r[T+1]=255&x,r[T+2]=C>>8<<4|x>>8,r[T+3]=0;const h=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),p=new l.T(e,h,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),h=this.painter.context,p=h.gl,x=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(x,C-T-1,1,1,p.RGBA,p.UNSIGNED_BYTE,r),h.bindFramebuffer.set(null);const I=r[0]+(r[2]>>4<<8),R=r[1]+((15&r[2])<<8),F=this.coordsIndex[255-r[3]],j=F&&this.sourceCache.getTileByID(F);if(!j)return null;const N=this._coordsTextureSize,Z=(1<<j.tileID.canonical.z)*N;return new l.a0((j.tileID.canonical.x*N+I)/Z+j.tileID.wrap,(j.tileID.canonical.y*N+R)/Z,this.getElevation(j.tileID,I,R,N))}depthAtPoint(e){const r=new Uint8Array(4),h=this.painter.context,p=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,r),h.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const h=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,p=h&&e.canonical.y===0,x=h&&e.canonical.y===(1<<e.canonical.z)-1,T=`m_${p?"n":""}_${x?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const C=this.painter.context,I=new l.cu,R=new l.aM,F=this.meshSize,j=l.$/F,N=F*F;for(let pe=0;pe<=F;pe++)for(let Ae=0;Ae<=F;Ae++)I.emplaceBack(Ae*j,pe*j,0);for(let pe=0;pe<N;pe+=F+1)for(let Ae=0;Ae<F;Ae++)R.emplaceBack(Ae+pe,F+Ae+pe+1,F+Ae+pe+2),R.emplaceBack(Ae+pe,F+Ae+pe+2,Ae+pe+1);const Z=I.length,K=Z+(F+1),se=(F+1)*F,oe=p?l.bg:0,ae=p?0:1,ue=x?l.bh:l.$,fe=x?0:1;for(let pe=0;pe<=F;pe++)I.emplaceBack(pe*j,oe,ae);for(let pe=0;pe<=F;pe++)I.emplaceBack(pe*j,ue,fe);for(let pe=0;pe<F;pe++)R.emplaceBack(se+pe,K+pe,K+pe+1),R.emplaceBack(se+pe,K+pe+1,se+pe+1),R.emplaceBack(0+pe,Z+pe+1,Z+pe),R.emplaceBack(0+pe,0+pe+1,Z+pe+1);const de=I.length,_e=de+2*(F+1);for(const pe of[0,1])for(let Ae=0;Ae<=F;Ae++)for(const $e of[0,1])I.emplaceBack(pe*l.$,Ae*j,$e);for(let pe=0;pe<2*F;pe+=2)R.emplaceBack(de+pe,de+pe+1,de+pe+3),R.emplaceBack(de+pe,de+pe+3,de+pe+2),R.emplaceBack(_e+pe,_e+pe+3,_e+pe+1),R.emplaceBack(_e+pe,_e+pe+2,_e+pe+3);const we=new jr(C.createVertexBuffer(I,kp.members),C.createIndexBuffer(R),l.aL.simpleSegment(0,0,I.length,R.length));return this._meshCache[T]=we,we}getMeshFrameDelta(e){return 2*Math.PI*l.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var h;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return r&&r.dem&&(h.minElevation=r.dem.min*this.exaggeration,h.maxElevation=r.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,r){const h=l.a0.fromLngLat(e.wrap()),p=(1<<r)*l.$,x=h.x*p,T=h.y*p,C=Math.floor(x/l.$),I=Math.floor(T/l.$);return{tileID:new l.Z(r,0,r,C,I),mercatorX:x,mercatorY:T}}}class Yu{constructor(e,r,h){this._context=e,this._size=r,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(h.texture),{id:e,fbo:r,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Rt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Xt{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Yu(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(h=>!e._layers[h].isHidden(r)),this._coordsAscending={};for(const h in e.sourceCaches){this._coordsAscending[h]={};const p=e.sourceCaches[h].getVisibleCoordinates(),x=e.sourceCaches[h].getSource(),T=x instanceof _t?x.terrainTileRanges:null;for(const C of p){const I=this.terrain.sourceCache.getTerrainCoords(C,T);for(const R in I)this._coordsAscending[h][R]||(this._coordsAscending[h][R]=[]),this._coordsAscending[h][R].push(I[R])}}this._coordsAscendingStr={};for(const h of e._order){const p=e._layers[h],x=p.source;if(Rt[p.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const T in this._coordsAscending[x])this._coordsAscendingStr[x][T]=this._coordsAscending[x][T].map(C=>C.key).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsAscendingStr){const x=this._coordsAscendingStr[p][h.tileID.key];x&&x!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const h=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),p=e.type,x=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Rt[p]&&(this._prevType&&Rt[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(e.id),!T))return!0;if(Rt[this._prevType]||Rt[p]&&T){this._prevType=p;const C=this._stacks.length-1,I=this._stacks[C]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(pn(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[C]){const j=this.pool.getObjectForId(R.rtt[C].id);if(j.stamp===R.rtt[C].stamp){this.pool.useObject(j);continue}}const F=this.pool.getOrCreateFreeObject();this.pool.useObject(F),this.pool.stampObject(F),R.rtt[C]={id:F.id,stamp:F.stamp},x.context.bindFramebuffer.set(F.fbo.framebuffer),x.context.clear({color:l.be.transparent,stencil:0}),x.currentStencilSource=void 0;for(let j=0;j<I.length;j++){const N=x.style._layers[I[j]],Z=N.source?this._coordsAscending[N.source][R.tileID.key]:[R.tileID];x.context.viewport.set([0,0,F.fbo.width,F.fbo.height]),x._renderTileClippingMasks(N,Z,!0),x.renderLayer(x,x.style.sourceCaches[N.source],N,Z,h),N.source&&(R.rttCoords[N.source]=this._coordsAscendingStr[N.source][R.tileID.key])}}return pn(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),Rt[p]}return!1}}const Ju={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},td=E,Wc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Hc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Zr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class zp{constructor(e,r,h=!1){this.mousedown=x=>{this.startMove(x,q.mousePos(this.element,x)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,q.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHanlder.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const p=new Dm;this._rotatePitchHanlder=new ec({clickTolerance:3,move:(x,T)=>{const C=r.getBoundingClientRect(),I=new l.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:l.cm(new l.P(x.x,T.y),T,I),pitchDelta:h?-.5*(T.y-x.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=e,q.addEventListener(r,"mousedown",this.mousedown),q.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHanlder.dragStart(e,r),q.disableDrag()}move(e,r){const h=this.map,{bearingDelta:p,pitchDelta:x}=this._rotatePitchHanlder.dragMove(e,r)||{};p&&h.setBearing(h.getBearing()+p),x&&h.setPitch(h.getPitch()+x)}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let br;function Rp(v,e,r,h=!1){if(h||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();const p=new l.S(v.lng,v.lat);if(v=new l.S(v.lng,v.lat),e){const x=new l.S(v.lng-360,v.lat),T=new l.S(v.lng+360,v.lat),C=r.locationToScreenPoint(v).distSqr(e);r.locationToScreenPoint(x).distSqr(e)<C?v=x:r.locationToScreenPoint(T).distSqr(e)<C&&(v=T)}for(;Math.abs(v.lng-r.center.lng)>180;){const x=r.locationToScreenPoint(v);if(x.x>=0&&x.y>=0&&x.x<=r.width&&x.y<=r.height)break;v.lng>r.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(v))?v:p}const yl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _n(v,e,r){const h=v.classList;for(const p in yl)h.remove(`maplibregl-${r}-anchor-${p}`);h.add(`maplibregl-${r}-anchor-${e}`)}class Cn extends l.E{constructor(e){if(super(),this._onKeyPress=r=>{const h=r.code,p=r.charCode||r.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=r=>{const h=r.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=Rp(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${yl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${p}`),X.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const r=q.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${h}px`),r.setAttributeNS(null,"width",`${p}px`),r.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const x=q.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const T=q.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=q.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of I){const ue=q.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ae.rx),ue.setAttributeNS(null,"ry",ae.ry),C.appendChild(ue)}const R=q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const F=q.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(F);const j=q.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const N=q.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(N);const Z=q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const K=q.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=q.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const oe=q.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),K.appendChild(se),K.appendChild(oe),T.appendChild(C),T.appendChild(R),T.appendChild(j),T.appendChild(Z),T.appendChild(K),r.appendChild(T),r.setAttributeNS(null,"height",h*this._scale+"px"),r.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(r),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),_n(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,h;const p=(r=this._map)===null||r===void 0?void 0:r.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!p||x){const Z=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const T=this._map,C=T.terrain.depthAtPoint(this._pos),I=T.terrain.getElevationForLngLatZoom(this._lngLat,T.transform.tileZoom);if(T.transform.lngLatToCameraDepth(this._lngLat,I)-C<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/T.transform.pixelsPerMeter,F=Math.sin(T.getPitch()*Math.PI/180)*R,j=T.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),N=T.transform.lngLatToCameraDepth(this._lngLat,I+F)-j>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Dp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ea=0,Ia=!1;const id={maxWidth:100,unit:"metric"};function Qu(v,e,r){const h=r&&r.maxWidth||100,p=v._container.clientHeight/2,x=v._container.clientWidth/2,T=v.unproject([x-h/2,p]),C=v.unproject([x+h/2,p]),I=Math.round(v.project(C).x-v.project(T).x),R=Math.min(h,I,v._container.clientWidth),F=T.distanceTo(C);if(r&&r.unit==="imperial"){const j=3.2808*F;j>5280?vl(e,R,j/5280,v._getUIString("ScaleControl.Miles")):vl(e,R,j,v._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?vl(e,R,F/1852,v._getUIString("ScaleControl.NauticalMiles")):F>=1e3?vl(e,R,F/1e3,v._getUIString("ScaleControl.Kilometers")):vl(e,R,F,v._getUIString("ScaleControl.Meters"))}function vl(v,e,r,h){const p=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(C),T*C}(r);v.style.width=e*(p/r)+"px",v.innerHTML=`${p}&nbsp;${h}`}const Kc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},nd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eh(v){if(v){if(typeof v=="number"){const e=Math.round(Math.abs(v)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,v),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-v),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(v,0),right:new l.P(-v,0)}}if(v instanceof l.P||Array.isArray(v)){const e=l.P.convert(v);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(v.center||[0,0]),top:l.P.convert(v.top||[0,0]),"top-left":l.P.convert(v["top-left"]||[0,0]),"top-right":l.P.convert(v["top-right"]||[0,0]),bottom:l.P.convert(v.bottom||[0,0]),"bottom-left":l.P.convert(v["bottom-left"]||[0,0]),"bottom-right":l.P.convert(v["bottom-right"]||[0,0]),left:l.P.convert(v.left||[0,0]),right:l.P.convert(v.right||[0,0])}}return eh(new l.P(0,0))}const rd=E;g.AJAXError=l.cy,g.Event=l.l,g.Evented=l.E,g.LngLat=l.S,g.MercatorCoordinate=l.a0,g.Point=l.P,g.addProtocol=l.cz,g.config=l.a,g.removeProtocol=l.cA,g.AttributionControl=Xu,g.BoxZoomHandler=qh,g.CanvasSource=dt,g.CooperativeGesturesHandler=Ap,g.DoubleClickZoomHandler=Wu,g.DragPanHandler=Yh,g.DragRotateHandler=Ku,g.EdgeInsets=Lr,g.FullscreenControl=class extends l.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=xt,g.GeolocateControl=class extends l.E{constructor(v){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new l.S(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,p=this._map.getBearing(),x=l.e({bearing:p},this.options.fitBoundsOptions),T=Pe.fromLngLat(r,h);this._map.fitBounds(T,x,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new l.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ia)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cn({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))})}},this.options=l.e({},Dp,v)}onAdd(v){return this._map=v,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(e=!1){if(br!==void 0&&!e)return br;if(window.navigator.permissions===void 0)return br=!!window.navigator.geolocation,br;try{br=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{br=!!window.navigator.geolocation}return br})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ea=0,Ia=!1}_isOutOfMapMaxBounds(v){const e=this._map.getMaxBounds(),r=v.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),e=v.getSouthEast(),r=v.getNorthEast(),h=e.distanceTo(r),p=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ea--,Ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ea++,Ea>1?(v={maximumAge:6e5,timeout:0},Ia=!0):(v=this.options.positionOptions,Ia=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const e=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=q.create("button","maplibregl-ctrl-globe",this._container),q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},g.Hash=gl,g.ImageSource=_t,g.KeyboardHandler=nc,g.LngLatBounds=Pe,g.LogoControl=ed,g.Map=class extends fn{constructor(v){var e,r;l.cv.mark(l.cw.create);const h=Object.assign(Object.assign(Object.assign({},Wc),v),{canvasContextAttributes:Object.assign(Object.assign({},Wc.canvasContextAttributes),v.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new li,x=new da;if(h.minZoom!==void 0&&p.setMinZoom(h.minZoom),h.maxZoom!==void 0&&p.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&p.setMinPitch(h.minPitch),h.maxPitch!==void 0&&p.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&p.setRenderWorldCopies(h.renderWorldCopies),super(p,x,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Lp,this._controls=[],this._mapId=l.a6(),this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ju),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=xe.addThrottleControl(()=>this.isMoving()),this._requestManager=new be(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const I=qs(R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())},50);this._resizeObserver=new ResizeObserver(R=>{C?I(R):C=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ma(this,h),this._hash=h.hash&&new gl(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,l.e({},h.fitBoundsOptions,{duration:0}))));const T=typeof h.style=="string"||((r=(e=h.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Xu(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new ed,h.logoPosition),this.on("style.load",()=>{if(T||this._resizeTransform(),this.transform.unmodified){const C=l.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}}),this.on("data",C=>{this._update(C.dataType==="style"),this.fire(new l.l(`${C.dataType}data`,C))}),this.on("dataloading",C=>{this.fire(new l.l(`${C.dataType}dataloading`,C))}),this.on("dataabort",C=>{this.fire(new l.l("sourcedataabort",C))})}_getMapId(){return this._mapId}setGlobalStateProperty(v,e){return this.style.setGlobalStateProperty(v,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,e){if(e===void 0&&(e=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=v.onAdd(this);this._controls.push(v);const h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(r,h.firstChild):h.appendChild(r),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(v);return e>-1&&this._controls.splice(e,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,e,r,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,e,r,h)}resize(v,e=!0){const[r,h]=this._containerDimensions(),p=this._getClampedPixelRatio(r,h);if(this._resizeCanvas(r,h,p),this.painter.resize(r,h,p),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const C=this._getClampedPixelRatio(r,h);this._resizeCanvas(r,h,C),this.painter.resize(r,h,C)}this._resizeTransform(e);const x=!this._moving;return x&&(this.stop(),this.fire(new l.l("movestart",v)).fire(new l.l("move",v))),this.fire(new l.l("resize",v)),x&&this.fire(new l.l("moveend",v)),this}_resizeTransform(v=!0){var e;const[r,h]=this._containerDimensions();this.transform.resize(r,h,v),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,h,v)}_getClampedPixelRatio(v,e){const{0:r,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),x=v*p,T=e*p;return Math.min(x>r?r/x:1,T>h?h/T:1)*p}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Pe.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}project(v){return this.transform.locationToScreenPoint(l.S.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(l.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,e,r){if(v==="mouseenter"||v==="mouseover"){let h=!1;return{layers:e,listener:r,delegates:{mousemove:x=>{const T=e.filter(I=>this.getLayer(I)),C=T.length!==0?this.queryRenderedFeatures(x.point,{layers:T}):[];C.length?h||(h=!0,r.call(this,new no(v,this,x.originalEvent,{features:C}))):h=!1},mouseout:()=>{h=!1}}}}if(v==="mouseleave"||v==="mouseout"){let h=!1;return{layers:e,listener:r,delegates:{mousemove:T=>{const C=e.filter(I=>this.getLayer(I));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?h=!0:h&&(h=!1,r.call(this,new no(v,this,T.originalEvent)))},mouseout:T=>{h&&(h=!1,r.call(this,new no(v,this,T.originalEvent)))}}}}{const h=p=>{const x=e.filter(C=>this.getLayer(C)),T=x.length!==0?this.queryRenderedFeatures(p.point,{layers:x}):[];T.length&&(p.features=T,r.call(this,p),delete p.features)};return{layers:e,listener:r,delegates:{[v]:h}}}}_saveDelegatedListener(v,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(e)}_removeDelegatedListener(v,e,r){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const h=this._delegatedListeners[v];for(let p=0;p<h.length;p++){const x=h[p];if(x.listener===r&&x.layers.length===e.length&&x.layers.every(T=>e.includes(T))){for(const T in x.delegates)this.off(T,x.delegates[T]);return void h.splice(p,1)}}}on(v,e,r){if(r===void 0)return super.on(v,e);const h=typeof e=="string"?[e]:e,p=this._createDelegatedListener(v,h,r);this._saveDelegatedListener(v,p);for(const x in p.delegates)this.on(x,p.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(v,h,r)}}}once(v,e,r){if(r===void 0)return super.once(v,e);const h=typeof e=="string"?[e]:e,p=this._createDelegatedListener(v,h,r);for(const x in p.delegates){const T=p.delegates[x];p.delegates[x]=(...C)=>{this._removeDelegatedListener(v,h,r),T(...C)}}this._saveDelegatedListener(v,p);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(v,e,r){return r===void 0?super.off(v,e):(this._removeDelegatedListener(v,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(v,e){if(!this.style)return[];let r;const h=v instanceof l.P||Array.isArray(v),p=h?v:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:v)||{},p instanceof l.P||typeof p[0]=="number")r=[l.P.convert(p)];else{const x=l.P.convert(p[0]),T=l.P.convert(p[1]);r=[x,new l.P(T.x,x.y),T,new l.P(x.x,T.y),x]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(v,e){return this.style.querySourceFeatures(v,e)}setStyle(v,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(v,e))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const e=this._locale[v];if(e==null)throw new Error(`Missing UI string '${v}'`);return e}_updateStyle(v,e){var r,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,e));const p=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new nl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,e,p):this.style.loadJSON(v,e,p),this):((h=(r=this.style)===null||r===void 0?void 0:r.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,e){if(typeof v=="string"){const r=this._requestManager.transformRequest(v,"Style");l.j(r,new AbortController).then(h=>{this._updateDiff(h.data,e)}).catch(h=>{h&&this.fire(new l.k(h))})}else typeof v=="object"&&this._updateDiff(v,e)}_updateDiff(v,e){try{this.style.setState(v,e)&&this._update(!0)}catch(r){l.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(v,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(v,e){return this._lazyInitEmptyStyle(),this.style.addSource(v,e),this._update(!0)}isSourceLoaded(v){const e=this.style&&this.style.sourceCaches[v];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const e=this.style.sourceCaches[v.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const h=this.style._layers[r];h.type==="hillshade"&&h.source===v.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),h.type==="color-relief"&&h.source===v.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ws(this.painter,e,v),this.painter.renderToTexture=new Xt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var h;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=r.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:v})),this}getTerrain(){var v,e;return(e=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const e in v){const r=v[e]._tiles;for(const h in r){const p=r[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,e,r){if(r){const h=this.getSource(r);if(!h)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);h.calculateTileZoom=je(Math.max(1,v),Math.max(1,e))}else for(const h in this.style.sourceCaches)this.style.sourceCaches[h].getSource().calculateTileZoom=je(Math.max(1,v),Math.max(1,e));return this._update(!0),this}refreshTiles(v,e){const r=this.style.sourceCaches[v];if(!r)throw new Error(`There is no source cache with ID "${v}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map(h=>new l.a3(h.z,h.x,h.y)))}addImage(v,e,r={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:x,stretchY:T,content:C,textFitWidth:I,textFitHeight:R}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:j,data:N}=e,Z=e;return this.style.addImage(v,{data:new l.R({width:F,height:j},new Uint8Array(N)),pixelRatio:h,stretchX:x,stretchY:T,content:C,textFitWidth:I,textFitHeight:R,sdf:p,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,v),this}}{const{width:F,height:j,data:N}=X.getImageData(e);this.style.addImage(v,{data:new l.R({width:F,height:j},N),pixelRatio:h,stretchX:x,stretchY:T,content:C,textFitWidth:I,textFitHeight:R,sdf:p,version:0})}}updateImage(v,e){const r=this.style.getImage(v);if(!r)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=e instanceof HTMLImageElement||l.b(e)?X.getImageData(e):e,{width:p,height:x,data:T}=h;if(p===void 0||x===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==r.data.width||x!==r.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(e instanceof HTMLImageElement||l.b(e));return r.data.replace(T,C),this.style.updateImage(v,r),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return xe.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,e){return this._lazyInitEmptyStyle(),this.style.addLayer(v,e),this._update(!0)}moveLayer(v,e){return this.style.moveLayer(v,e),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,e,r){return this.style.setLayerZoomRange(v,e,r),this._update(!0)}setFilter(v,e,r={}){return this.style.setFilter(v,e,r),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,e,r,h={}){return this.style.setPaintProperty(v,e,r,h),this._update(!0)}getPaintProperty(v,e){return this.style.getPaintProperty(v,e)}setLayoutProperty(v,e,r,h={}){return this.style.setLayoutProperty(v,e,r,h),this._update(!0)}getLayoutProperty(v,e){return this.style.getLayoutProperty(v,e)}setGlyphs(v,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,e,r,h=>{h||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,e,r=>{r||this._update(!0)}),this}setLight(v,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,e){return this.style.setFeatureState(v,e),this._update()}removeFeatureState(v,e){return this.style.removeFeatureState(v,e),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,e=0;return this._container&&(v=this._container.clientWidth||400,e=this._container.clientHeight||300),[v,e]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",v);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),h=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],h);const p=this._controlContainer=q.create("div","maplibregl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{x[T]=q.create("div",`maplibregl-ctrl-${T} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,e,r){this._canvas.width=Math.floor(r*v),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{e={requestedAttributes:v},h&&(e.statusMessage=h.statusMessage,e.type=h.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!r){const h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new $i(r,this.transform),te.testSupport(r)}migrateProjection(v,e){super.migrateProjection(v,e),this.painter.transform=v,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var e,r,h,p,x;const T=this._idleTriggered?this._fadeDuration:0,C=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,N=X.now();this.style.zoomHistory.update(j,N);const Z=new l.F(j,{now:N,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),K=Z.crossFadingFactor();K===1&&K===this._crossFadingFactor||(I=!0,this._crossFadingFactor=K),this.style.update(Z)}const R=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==C;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cv.mark(l.cw.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const F=this._sourcesDirty||this._styleDirty||this._placementDirty;return F||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,l.cv.mark(l.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xe.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cv.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,X.frame(this._frameRequest,v=>{l.cv.frame(v),this._frameRequest=null;try{this._render(v)}catch(e){if(!l.cx(e)&&!function(r){return r.message===Wl}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return td}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},g.MapMouseEvent=no,g.MapTouchEvent=Ho,g.MapWheelEvent=Zh,g.Marker=Cn,g.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const h=this._map._getUIString(`NavigationControl.${r}`);e.title=h,e.setAttribute("aria-label",h)},this.options=l.e({},Zr,v),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,e){const r=q.create("button",v,this._container);return r.type="button",r.addEventListener("click",e),r}},g.Popup=class extends l.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Rp(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor;const p=eh(this.options.offset);if(!h){const T=this._container.offsetWidth,C=this._container.offsetHeight;let I;I=r.y+p.bottom.y<C?["top"]:r.y>this._map.transform.height-C?["bottom"]:[],r.x<T/2?I.push("left"):r.x>this._map.transform.width-T/2&&I.push("right"),h=I.length===0?"bottom":I.join("-")}let x=r.add(p[h]);this.options.subpixelPositioning||(x=x.round()),q.setTransform(this._container,`${yl[h]} translate(${x.x}px,${x.y}px)`),_n(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Kc),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=l.S.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const e=document.createDocumentFragment(),r=document.createElement("body");let h;for(r.innerHTML=v;h=r.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(nd);v&&v.focus()}},g.RasterDEMTileSource=nt,g.RasterTileSource=at,g.ScaleControl=class{constructor(v){this._onMove=()=>{Qu(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Qu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},id),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=Ip,g.Style=nl,g.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=Wh,g.TwoFingersTouchRotateHandler=Hh,g.TwoFingersTouchZoomHandler=bs,g.TwoFingersTouchZoomRotateHandler=Jh,g.VectorTileSource=ct,g.VideoSource=wt,g.addSourceType=(v,e)=>l._(void 0,void 0,void 0,function*(){if(Pt(v))throw new Error(`A source type called "${v}" already exists.`);((r,h)=>{$t[r]=h})(v,e)}),g.clearPrewarmedResources=function(){const v=Xi;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Yt),Xi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.createTileMesh=Mc,g.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return yi().getRTLTextPluginStatus()},g.getVersion=function(){return rd},g.getWorkerCount=function(){return pi.workerCount},g.getWorkerUrl=function(){return l.a.WORKER_URL},g.importScriptInWorkers=function(v){return On().broadcast("IS",v)},g.prewarm=function(){Ai().acquire(Yt)},g.setMaxParallelImageRequests=function(v){l.a.MAX_PARALLEL_IMAGE_REQUESTS=v},g.setRTLTextPlugin=function(v,e){return yi().setRTLTextPlugin(v,e)},g.setWorkerCount=function(v){pi.workerCount=v},g.setWorkerUrl=function(v){l.a.WORKER_URL=v}});var _=a;return _})}(_f)),_f.exports}var _E=gE();const qt=lm(_E);function yE(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class vE{constructor(){this._apiKey="",this._fetch=yE(),this.tileCacheSize=200}set apiKey(i){this._apiKey=i}get apiKey(){return this._apiKey}set fetch(i){this._fetch=i}get fetch(){return this._fetch}}const Ph=new vE,xE={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},bE={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},mp={...xE,...bE};function wE(n,i=mp){return n in i?n[n]:null}function U_(n,i=mp){for(const a of Object.values(i))if(a.code===n)return a;return null}function $_(n,i=mp){for(const a of Object.values(i))if(a.flag===n)return a;return null}function TE(n){return n!==null&&typeof n=="object"&&"code"in n&&"flag"in n&&"name"in n&&"latin"in n&&"isMode"in n&&"geocoding"in n&&(typeof n.code=="string"||n.code===null)&&typeof n.flag=="string"&&typeof n.name=="string"&&typeof n.latin=="boolean"&&typeof n.isMode=="boolean"&&typeof n.geocoding=="boolean"}function Fx(n,i=mp){return TE(n)?$_(n.flag,i):typeof n!="string"?null:wE(n,i)||U_(n,i)||$_(n,i)||null}async function SE(n,i={}){if(Ph.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(n).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Ph.fetch(n,i)}const Fw={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Fw);class PE extends Error{constructor(i,a=""){super(`Call to enpoint ${i.url} failed with the status code ${i.status}. ${a}`),this.res=i}}const Bx={403:"Key is missing, invalid or restricted"};async function CE(n={}){const i=new URL("geolocation/ip.json",Fw.maptilerApiURL);i.searchParams.set("key",n.apiKey??Ph.apiKey),"elevation"in n&&i.searchParams.set("elevation",n.elevation?"true":"false");const a=i.toString(),d=await SE(a);if(!d.ok)throw new PE(d,d.status in Bx?Bx[d.status]:"");return await d.json()}const Nx={info:CE};function Bw(n){const i=/^maptiler:\/\/(.*)/;let a;const d=n.trim();let m;return d.startsWith("http://")||d.startsWith("https://")?m=d:(a=i.exec(d))!==null?m=`https://api.maptiler.com/maps/${a[1]}/style.json`:m=`https://api.maptiler.com/maps/${d}/style.json`,m}class Nw{constructor(i,a,d,m,_,g,l=!1){this.name=i,this.variantType=a,this.id=d,this.referenceStyle=m,this.description=_,this.imageURL=g,this.deprecated=l}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(i){return this.referenceStyle.hasVariant(i)}getVariant(i){const a=this.referenceStyle.getVariant(i);return this.warnIfDeprecated(a),a}getVariants(){return this.referenceStyle.getVariants().filter(i=>i!==this).map(i=>(this.warnIfDeprecated(i),i))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return Bw(this.getId())}warnIfDeprecated(i=this){if(!i.deprecated)return i;const a=i.getFullName();return console.warn(`Style "${a}" is deprecated and will be removed in a future version.`),i}}class jw{constructor(i,a){this.name=i,this.id=a,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(i){this.variants[i.getType()]=i,this.orderedVariants.push(i)}hasVariant(i){return i in this.variants}getVariant(i){return i in this.variants?this.variants[i]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const Vd=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function ME(n){return new Proxy(n,{get(i,a,d){return i.hasVariant(a)?i.getVariant(a):a.toString().toUpperCase()===a?n.getDefaultVariant():Reflect.get(i,a,d)}})}function EE(){const n={};for(let i=0;i<Vd.length;i+=1){const a=Vd[i],d=ME(new jw(a.name,a.referenceStyleID));for(let m=0;m<a.variants.length;m+=1){const _=a.variants[m],g=new Nw(_.name,_.variantType,_.id,d,_.description,_.imageURL,_.deprecated);d.addVariant(g)}n[a.referenceStyleID]=d}return n}const Zd=EE();var sf={exports:{}},jx;function IE(){if(jx)return sf.exports;jx=1;var n=typeof Reflect=="object"?Reflect:null,i=n&&typeof n.apply=="function"?n.apply:function(be,ke,Qe){return Function.prototype.apply.call(be,ke,Qe)},a;n&&typeof n.ownKeys=="function"?a=n.ownKeys:Object.getOwnPropertySymbols?a=function(be){return Object.getOwnPropertyNames(be).concat(Object.getOwnPropertySymbols(be))}:a=function(be){return Object.getOwnPropertyNames(be)};function d(xe){console&&console.warn&&console.warn(xe)}var m=Number.isNaN||function(be){return be!==be};function _(){_.init.call(this)}sf.exports=_,sf.exports.once=ze,_.EventEmitter=_,_.prototype._events=void 0,_.prototype._eventsCount=0,_.prototype._maxListeners=void 0;var g=10;function l(xe){if(typeof xe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof xe)}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(xe){if(typeof xe!="number"||xe<0||m(xe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+xe+".");g=xe}}),_.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_.prototype.setMaxListeners=function(be){if(typeof be!="number"||be<0||m(be))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+be+".");return this._maxListeners=be,this};function E(xe){return xe._maxListeners===void 0?_.defaultMaxListeners:xe._maxListeners}_.prototype.getMaxListeners=function(){return E(this)},_.prototype.emit=function(be){for(var ke=[],Qe=1;Qe<arguments.length;Qe++)ke.push(arguments[Qe]);var tt=be==="error",et=this._events;if(et!==void 0)tt=tt&&et.error===void 0;else if(!tt)return!1;if(tt){var ht;if(ke.length>0&&(ht=ke[0]),ht instanceof Error)throw ht;var At=new Error("Unhandled error."+(ht?" ("+ht.message+")":""));throw At.context=ht,At}var lt=et[be];if(lt===void 0)return!1;if(typeof lt=="function")i(lt,this,ke);else for(var Et=lt.length,jt=te(lt,Et),Qe=0;Qe<Et;++Qe)i(jt[Qe],this,ke);return!0};function k(xe,be,ke,Qe){var tt,et,ht;if(l(ke),et=xe._events,et===void 0?(et=xe._events=Object.create(null),xe._eventsCount=0):(et.newListener!==void 0&&(xe.emit("newListener",be,ke.listener?ke.listener:ke),et=xe._events),ht=et[be]),ht===void 0)ht=et[be]=ke,++xe._eventsCount;else if(typeof ht=="function"?ht=et[be]=Qe?[ke,ht]:[ht,ke]:Qe?ht.unshift(ke):ht.push(ke),tt=E(xe),tt>0&&ht.length>tt&&!ht.warned){ht.warned=!0;var At=new Error("Possible EventEmitter memory leak detected. "+ht.length+" "+String(be)+" listeners added. Use emitter.setMaxListeners() to increase limit");At.name="MaxListenersExceededWarning",At.emitter=xe,At.type=be,At.count=ht.length,d(At)}return xe}_.prototype.addListener=function(be,ke){return k(this,be,ke,!1)},_.prototype.on=_.prototype.addListener,_.prototype.prependListener=function(be,ke){return k(this,be,ke,!0)};function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $(xe,be,ke){var Qe={fired:!1,wrapFn:void 0,target:xe,type:be,listener:ke},tt=O.bind(Qe);return tt.listener=ke,Qe.wrapFn=tt,tt}_.prototype.once=function(be,ke){return l(ke),this.on(be,$(this,be,ke)),this},_.prototype.prependOnceListener=function(be,ke){return l(ke),this.prependListener(be,$(this,be,ke)),this},_.prototype.removeListener=function(be,ke){var Qe,tt,et,ht,At;if(l(ke),tt=this._events,tt===void 0)return this;if(Qe=tt[be],Qe===void 0)return this;if(Qe===ke||Qe.listener===ke)--this._eventsCount===0?this._events=Object.create(null):(delete tt[be],tt.removeListener&&this.emit("removeListener",be,Qe.listener||ke));else if(typeof Qe!="function"){for(et=-1,ht=Qe.length-1;ht>=0;ht--)if(Qe[ht]===ke||Qe[ht].listener===ke){At=Qe[ht].listener,et=ht;break}if(et<0)return this;et===0?Qe.shift():ce(Qe,et),Qe.length===1&&(tt[be]=Qe[0]),tt.removeListener!==void 0&&this.emit("removeListener",be,At||ke)}return this},_.prototype.off=_.prototype.removeListener,_.prototype.removeAllListeners=function(be){var ke,Qe,tt;if(Qe=this._events,Qe===void 0)return this;if(Qe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Qe[be]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Qe[be]),this;if(arguments.length===0){var et=Object.keys(Qe),ht;for(tt=0;tt<et.length;++tt)ht=et[tt],ht!=="removeListener"&&this.removeAllListeners(ht);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ke=Qe[be],typeof ke=="function")this.removeListener(be,ke);else if(ke!==void 0)for(tt=ke.length-1;tt>=0;tt--)this.removeListener(be,ke[tt]);return this};function X(xe,be,ke){var Qe=xe._events;if(Qe===void 0)return[];var tt=Qe[be];return tt===void 0?[]:typeof tt=="function"?ke?[tt.listener||tt]:[tt]:ke?Ce(tt):te(tt,tt.length)}_.prototype.listeners=function(be){return X(this,be,!0)},_.prototype.rawListeners=function(be){return X(this,be,!1)},_.listenerCount=function(xe,be){return typeof xe.listenerCount=="function"?xe.listenerCount(be):q.call(xe,be)},_.prototype.listenerCount=q;function q(xe){var be=this._events;if(be!==void 0){var ke=be[xe];if(typeof ke=="function")return 1;if(ke!==void 0)return ke.length}return 0}_.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]};function te(xe,be){for(var ke=new Array(be),Qe=0;Qe<be;++Qe)ke[Qe]=xe[Qe];return ke}function ce(xe,be){for(;be+1<xe.length;be++)xe[be]=xe[be+1];xe.pop()}function Ce(xe){for(var be=new Array(xe.length),ke=0;ke<be.length;++ke)be[ke]=xe[ke].listener||xe[ke];return be}function ze(xe,be){return new Promise(function(ke,Qe){function tt(ht){xe.removeListener(be,et),Qe(ht)}function et(){typeof xe.removeListener=="function"&&xe.removeListener("error",tt),ke([].slice.call(arguments))}Fe(xe,be,et,{once:!0}),be!=="error"&&Ue(xe,tt,{once:!0})})}function Ue(xe,be,ke){typeof xe.on=="function"&&Fe(xe,"error",be,ke)}function Fe(xe,be,ke,Qe){if(typeof xe.on=="function")Qe.once?xe.once(be,ke):xe.on(be,ke);else if(typeof xe.addEventListener=="function")xe.addEventListener(be,function tt(et){Qe.once&&xe.removeEventListener(be,tt),ke(et)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof xe)}return sf.exports}var AE=IE();const LE=lm(AE),Hr=[];for(let n=0;n<256;++n)Hr.push((n+256).toString(16).slice(1));function kE(n,i=0){return(Hr[n[i+0]]+Hr[n[i+1]]+Hr[n[i+2]]+Hr[n[i+3]]+"-"+Hr[n[i+4]]+Hr[n[i+5]]+"-"+Hr[n[i+6]]+Hr[n[i+7]]+"-"+Hr[n[i+8]]+Hr[n[i+9]]+"-"+Hr[n[i+10]]+Hr[n[i+11]]+Hr[n[i+12]]+Hr[n[i+13]]+Hr[n[i+14]]+Hr[n[i+15]]).toLowerCase()}let qg;const zE=new Uint8Array(16);function RE(){if(!qg){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");qg=crypto.getRandomValues.bind(crypto)}return qg(zE)}const DE=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ux={randomUUID:DE};function OE(n,i,a){if(Ux.randomUUID&&!n)return Ux.randomUUID();n=n||{};const d=n.random??n.rng?.()??RE();if(d.length<16)throw new Error("Random bytes length must be >= 16");return d[6]=d[6]&15|64,d[8]=d[8]&63|128,kE(d)}const Uw="3.7.7",FE=Uw,Lh=typeof Buffer=="function",$x=typeof TextDecoder=="function"?new TextDecoder:void 0,Vx=typeof TextEncoder=="function"?new TextEncoder:void 0,BE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",kd=Array.prototype.slice.call(BE),af=(n=>{let i={};return n.forEach((a,d)=>i[a]=d),i})(kd),NE=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Wr=String.fromCharCode.bind(String),Zx=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),$w=n=>n.replace(/=/g,"").replace(/[+\/]/g,i=>i=="+"?"-":"_"),Vw=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),Zw=n=>{let i,a,d,m,_="";const g=n.length%3;for(let l=0;l<n.length;){if((a=n.charCodeAt(l++))>255||(d=n.charCodeAt(l++))>255||(m=n.charCodeAt(l++))>255)throw new TypeError("invalid character found");i=a<<16|d<<8|m,_+=kd[i>>18&63]+kd[i>>12&63]+kd[i>>6&63]+kd[i&63]}return g?_.slice(0,g-3)+"===".substring(g):_},Ly=typeof btoa=="function"?n=>btoa(n):Lh?n=>Buffer.from(n,"binary").toString("base64"):Zw,V_=Lh?n=>Buffer.from(n).toString("base64"):n=>{let a=[];for(let d=0,m=n.length;d<m;d+=4096)a.push(Wr.apply(null,n.subarray(d,d+4096)));return Ly(a.join(""))},yf=(n,i=!1)=>i?$w(V_(n)):V_(n),jE=n=>{if(n.length<2){var i=n.charCodeAt(0);return i<128?n:i<2048?Wr(192|i>>>6)+Wr(128|i&63):Wr(224|i>>>12&15)+Wr(128|i>>>6&63)+Wr(128|i&63)}else{var i=65536+(n.charCodeAt(0)-55296)*1024+(n.charCodeAt(1)-56320);return Wr(240|i>>>18&7)+Wr(128|i>>>12&63)+Wr(128|i>>>6&63)+Wr(128|i&63)}},UE=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,qw=n=>n.replace(UE,jE),qx=Lh?n=>Buffer.from(n,"utf8").toString("base64"):Vx?n=>V_(Vx.encode(n)):n=>Ly(qw(n)),Ch=(n,i=!1)=>i?$w(qx(n)):qx(n),Gx=n=>Ch(n,!0),$E=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,VE=n=>{switch(n.length){case 4:var i=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),a=i-65536;return Wr((a>>>10)+55296)+Wr((a&1023)+56320);case 3:return Wr((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return Wr((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Gw=n=>n.replace($E,VE),Hw=n=>{if(n=n.replace(/\s+/g,""),!NE.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let i,a="",d,m;for(let _=0;_<n.length;)i=af[n.charAt(_++)]<<18|af[n.charAt(_++)]<<12|(d=af[n.charAt(_++)])<<6|(m=af[n.charAt(_++)]),a+=d===64?Wr(i>>16&255):m===64?Wr(i>>16&255,i>>8&255):Wr(i>>16&255,i>>8&255,i&255);return a},ky=typeof atob=="function"?n=>atob(Vw(n)):Lh?n=>Buffer.from(n,"base64").toString("binary"):Hw,Ww=Lh?n=>Zx(Buffer.from(n,"base64")):n=>Zx(ky(n).split("").map(i=>i.charCodeAt(0))),Kw=n=>Ww(Xw(n)),ZE=Lh?n=>Buffer.from(n,"base64").toString("utf8"):$x?n=>$x.decode(Ww(n)):n=>Gw(ky(n)),Xw=n=>Vw(n.replace(/[-_]/g,i=>i=="-"?"+":"/")),Z_=n=>ZE(Xw(n)),qE=n=>{if(typeof n!="string")return!1;const i=n.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(i)||!/[^\s0-9a-zA-Z\-_]/.test(i)},Yw=n=>({value:n,enumerable:!1,writable:!0,configurable:!0}),Jw=function(){const n=(i,a)=>Object.defineProperty(String.prototype,i,Yw(a));n("fromBase64",function(){return Z_(this)}),n("toBase64",function(i){return Ch(this,i)}),n("toBase64URI",function(){return Ch(this,!0)}),n("toBase64URL",function(){return Ch(this,!0)}),n("toUint8Array",function(){return Kw(this)})},Qw=function(){const n=(i,a)=>Object.defineProperty(Uint8Array.prototype,i,Yw(a));n("toBase64",function(i){return yf(this,i)}),n("toBase64URI",function(){return yf(this,!0)}),n("toBase64URL",function(){return yf(this,!0)})},GE=()=>{Jw(),Qw()},HE={version:Uw,VERSION:FE,atob:ky,atobPolyfill:Hw,btoa:Ly,btoaPolyfill:Zw,fromBase64:Z_,toBase64:Ch,encode:Ch,encodeURI:Gx,encodeURL:Gx,utob:qw,btou:Gw,decode:Z_,isValid:qE,fromUint8Array:yf,toUint8Array:Kw,extendString:Jw,extendUint8Array:Qw,extendBuiltins:GE};var WE=Object.defineProperty,e2=n=>{throw TypeError(n)},KE=(n,i,a)=>i in n?WE(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a,Dt=(n,i,a)=>KE(n,typeof i!="symbol"?i+"":i,a),zy=(n,i,a)=>i.has(n)||e2("Cannot "+a),Zi=(n,i,a)=>(zy(n,i,"read from private field"),a?a.call(n):i.get(n)),du=(n,i,a)=>i.has(n)?e2("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,a),vh=(n,i,a,d)=>(zy(n,i,"write to private field"),i.set(n,a),a),ts=(n,i,a)=>(zy(n,i,"access private method"),a);const Gi={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...mp};function Hx(){if(typeof navigator>"u"){const n=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return U_(n)||Gi.ENGLISH}return Array.from(new Set(navigator.languages.map(n=>n.split("-")[0]))).map(n=>U_(n)).filter(n=>n)[0]??Gi.LOCAL}const vo={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Gi.STYLE,secondaryLanguage:Gi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(vo);const Ry=OE();class XE extends LE{constructor(){super(...arguments),Dt(this,"primaryLanguage",vo.primaryLanguage),Dt(this,"secondaryLanguage"),Dt(this,"session",!0),Dt(this,"caching",!0),Dt(this,"telemetry",!0),Dt(this,"_unit","metric"),Dt(this,"_apiKey","")}set unit(i){this._unit=i,this.emit("unit",i)}get unit(){return this._unit}set apiKey(i){this._apiKey=i,Ph.apiKey=i,this.emit("apiKey",i)}get apiKey(){return this._apiKey}set fetch(i){Ph.fetch=i}get fetch(){return Ph.fetch}}const Zn=new XE,q_="localcache_source",G_="localcache",YE="maptiler_sdk",JE=1e3,QE=100,H_=typeof caches<"u",{addProtocol:Wx}=qt;function eI(n,i){if(H_&&Zn.caching&&Zn.session&&n.host===vo.maptilerApiHost){if(i==="Source"&&n.href.includes("tiles.json"))return n.href.replace("https://",`${q_}://`);if(i==="Tile"||i==="Glyphs")return n.href.replace("https://",`${G_}://`)}return n.href}let Gg;async function t2(){return Gg||(Gg=await caches.open(YE)),Gg}let Kx=0;async function tI(){const n=await t2(),i=await n.keys(),a=i.slice(0,Math.max(i.length-JE,0));for(const d of a)n.delete(d)}function iI(){Wx(q_,async(n,i)=>{if(!n.url)throw new Error("");n.url=n.url.replace(`${q_}://`,"https://");const a=n;a.signal=i.signal;const d=await fetch(n.url,a),m=await d.json();return m.tiles&&m.tiles.length>0&&(m.tiles[0]+=`&last-modified=${d.headers.get("Last-Modified")}`),{data:m,cacheControl:d.headers.get("Cache-Control"),expires:d.headers.get("Expires")}}),Wx(G_,async(n,i)=>{if(!n.url)throw new Error("");n.url=n.url.replace(`${G_}://`,"https://");const a=new URL(n.url),d=new URL(a);d.searchParams.delete("mtsid"),d.searchParams.delete("key");const m=d.toString(),_=new URL(a);_.searchParams.delete("last-modified");const g=_.toString(),l=async X=>({data:await X.arrayBuffer(),cacheControl:X.headers.get("Cache-Control"),expires:X.headers.get("Expires")}),E=await t2(),k=await E.match(m);if(k)return l(k);const O=n;O.signal=i.signal;const $=await fetch(g,O);return $.status>=200&&$.status<300&&(E.put(m,$.clone()).catch(()=>{}),++Kx>QE&&(tI(),Kx=0)),l($)})}function nI(){if(typeof window>"u")return;const n=qt.getRTLTextPluginStatus();if(n==="unavailable"||n==="requested")try{qt.setRTLTextPlugin(vo.rtlPluginURL,!0)}catch{}}function rI(n,i){for(const a of n)typeof i[a]=="function"&&(i[a]=i[a].bind(i))}function Xx(n,i){let a=null;try{a=new URL(n)}catch{return{url:n}}return a.host===vo.maptilerApiHost&&(a.searchParams.has("key")||a.searchParams.append("key",Zn.apiKey),Zn.session&&a.searchParams.append("mtsid",Ry)),{url:eI(a,i)}}function Yx(n){return(i,a)=>{if(n!=null){const d=n(i,a),m=Xx(d?.url??"",a);return{...d,...m}}return Xx(i,a)}}function i2(){return Math.random().toString(36).substring(2)}function cm(n){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(n)}function oI(n){try{return JSON.parse(n)}catch{}return null}function sI(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function aI(n){const i=sI();if(!i)return;let a=null;if(typeof n=="string"?a=document.getElementById(n):n instanceof HTMLElement&&(a=n),!a)throw new Error("The Map container must be provided.");const d=document.createElement("div");throw d.innerHTML=i,d.classList.add("webgl-warning-div"),a.appendChild(d),new Error(i)}function Jx(n,i){return!(!Array.isArray(n)||n.length!==2||n[0]!=="get"||typeof n[1]!="string"||i&&!n[1].startsWith("name:")||!i&&n[1]!=="name")}function lI(n,i,a){const d=structuredClone(n),m=_=>{if(typeof _!="string")for(let g=0;g<_.length;g+=1)Jx(_[g],a)?_[g]=structuredClone(i):m(_[g])};return Jx(d,a)?i:(m(d),d)}function cI(n,i){const a=i?/\{name:\S+\}/:/\{name\}/;return{contains:a.test(n),exactMatch:new RegExp(`^${a.source}$`).test(n)}}function uI(n,i,a){const d=a?/\{name:\S+\}/:/\{name\}/,m=n.split(d);return["concat",...m.flatMap((_,g)=>g===m.length-1?[_]:[_,i])]}function hI(n){var i;const a=/\{name(?::(?<language>\S+))?\}/g,d=[];for(;;){const m=a.exec(n);if(!m)break;const _=((i=m.groups)==null?void 0:i.language)??null;d.push(_)}return d}function dI(n){return!Array.isArray(n)||n.length!==2||n[0]!=="get"||typeof n[1]!="string"?null:n[1].trim()==="name"?{isLanguage:!0,localization:null}:n[1].trim().startsWith("name:")?{isLanguage:!0,localization:n[1].trim().split(":").pop()}:null}function pI(n){const i=[],a=structuredClone(n),d=m=>{if(typeof m!="string")for(let _=0;_<m.length;_+=1){const g=dI(m[_]);g?i.push(g.localization):d(m[_])}};return d([a]),i}function fI(n,i){const a=[];for(const _ of n){if(_.type!=="symbol")continue;const g=_,{id:l,layout:E}=g;if(!E||!("text-field"in E))continue;const k=i.getLayoutProperty(l,"text-field");if(k)if(typeof k=="string"){const O=hI(k);a.push(O)}else{const O=pI(k);a.push(O)}}const d=a.flat(),m={unlocalized:0,localized:{}};for(const _ of d)_===null?m.unlocalized+=1:(_ in m.localized||(m.localized[_]=0),m.localized[_]+=1);return m}(class extends qt.Marker{addTo(n){return super.addTo(n)}});class DR extends qt.Popup{addTo(i){return super.addTo(i)}}class OR extends qt.Style{constructor(i,a={}){super(i,a)}}class FR extends qt.CanvasSource{onAdd(i){super.onAdd(i)}}class BR extends qt.GeoJSONSource{onAdd(i){super.onAdd(i)}}class NR extends qt.ImageSource{onAdd(i){super.onAdd(i)}}class jR extends qt.RasterTileSource{onAdd(i){super.onAdd(i)}}class UR extends qt.RasterDEMTileSource{onAdd(i){super.onAdd(i)}}class $R extends qt.VectorTileSource{onAdd(i){super.onAdd(i)}}class VR extends qt.VideoSource{onAdd(i){super.onAdd(i)}}class mI extends qt.NavigationControl{onAdd(i){return super.onAdd(i)}}class gI extends qt.GeolocateControl{onAdd(i){return super.onAdd(i)}}class ZR extends qt.AttributionControl{onAdd(i){return super.onAdd(i)}}class _I extends qt.LogoControl{onAdd(i){return super.onAdd(i)}}class yI extends qt.ScaleControl{onAdd(i){return super.onAdd(i)}}class vI extends qt.FullscreenControl{onAdd(i){return super.onAdd(i)}}class qR extends qt.TerrainControl{onAdd(i){return super.onAdd(i)}}class GR extends qt.BoxZoomHandler{constructor(i,a){super(i,a)}}class HR extends qt.ScrollZoomHandler{constructor(i,a){super(i,a)}}class WR extends qt.CooperativeGesturesHandler{constructor(i,a){super(i,a)}}class KR extends qt.KeyboardHandler{constructor(i){super(i)}}class XR extends qt.TwoFingersTouchPitchHandler{constructor(i){super(i)}}class YR extends qt.MapWheelEvent{constructor(i,a,d){super(i,a,d)}}class JR extends qt.MapTouchEvent{constructor(i,a,d){super(i,a,d)}}class QR extends qt.MapMouseEvent{constructor(i,a,d,m={}){super(i,a,d,m)}}class Qx extends _I{constructor(i={}){super(i),Dt(this,"logoURL",""),Dt(this,"linkURL",""),this.logoURL=i.logoURL??vo.maptilerLogoURL,this.linkURL=i.linkURL??vo.maptilerURL}onAdd(i){this._map=i,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const a=window.document.createElement("a");return a.style.backgroundRepeat="no-repeat",a.style.cursor="pointer",a.style.display="block",a.style.height="23px",a.style.margin="0 0 -4px -4px",a.style.overflow="hidden",a.style.width="88px",a.style.backgroundImage=`url(${this.logoURL})`,a.style.backgroundSize="100px 30px",a.style.width="100px",a.style.height="30px",a.target="_blank",a.rel="noopener",a.href=this.linkURL,a.setAttribute("aria-label","MapTiler logo"),a.setAttribute("rel","noopener"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var xI=8,bI={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},wI={"*":{type:"source"}},TI=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],SI={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},PI={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},CI={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},MI={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},EI={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},II={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},AI={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},LI=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],kI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},zI={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},RI={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},DI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},OI={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},FI={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},BI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},NI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jI={type:"array",value:"*"},UI={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},$I={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},VI={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},ZI={type:"array",value:"*",minimum:1},qI={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},GI={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},HI={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},WI={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},KI=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],XI={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},YI={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},JI={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},QI={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},eA={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},tA={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},iA={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},nA={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},rA={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},oA={"*":{type:"string"}},sA={$version:xI,$root:bI,sources:wI,source:TI,source_vector:SI,source_raster:PI,source_raster_dem:CI,source_geojson:MI,source_video:EI,source_image:II,layer:AI,layout:LI,layout_background:kI,layout_fill:zI,layout_circle:RI,layout_heatmap:DI,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:OI,layout_symbol:FI,layout_raster:BI,layout_hillshade:NI,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:jI,filter_operator:UI,geometry_type:$I,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:VI,expression:ZI,light:qI,sky:GI,terrain:HI,projection:WI,paint:KI,paint_fill:XI,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:YI,paint_circle:JI,paint_heatmap:QI,paint_symbol:eA,paint_raster:tA,paint_hillshade:iA,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:nA,transition:rA,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:oA};let bt=class{constructor(i,a,d,m){this.message=(i?`${i}: `:"")+d,m&&(this.identifier=m),a!=null&&a.__line__&&(this.line=a.__line__)}};function Df(n,...i){for(const a of i)for(const d in a)n[d]=a[d];return n}class Ua extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Dy{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[d,m]of a)this.bindings[d]=m}concat(i){return new Dy(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return this.bindings[i]?!0:this.parent?this.parent.has(i):!1}}const um={kind:"null"},St={kind:"number"},ki={kind:"string"},Mi={kind:"boolean"},Za={kind:"color"},hm={kind:"projectionDefinition"},Tu={kind:"object"},Ti={kind:"value"},aA={kind:"error"},dm={kind:"collator"},pm={kind:"formatted"},fm={kind:"padding"},ip={kind:"colorArray"},mm={kind:"numberArray"},gp={kind:"resolvedImage"},gm={kind:"variableAnchorOffsetCollection"};function rs(n,i){return{kind:"array",itemType:n,N:i}}function Dn(n){if(n.kind==="array"){const i=Dn(n.itemType);return typeof n.N=="number"?`array<${i}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${i}>`}else return n.kind}const lA=[um,St,ki,Mi,Za,hm,pm,Tu,rs(Ti),fm,mm,ip,gp,gm];function np(n,i){if(i.kind==="error")return null;if(n.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!np(n.itemType,i.itemType))&&(typeof n.N!="number"||n.N===i.N))return null}else{if(n.kind===i.kind)return null;if(n.kind==="value"){for(const a of lA)if(!np(a,i))return null}}return`Expected ${Dn(n)} but found ${Dn(i)} instead.`}function Oy(n,i){return i.some(a=>a.kind===n.kind)}function Su(n,i){return i.some(a=>a==="null"?n===null:a==="array"?Array.isArray(n):a==="object"?n&&!Array.isArray(n)&&typeof n=="object":a===typeof n)}function hc(n,i){return n.kind==="array"&&i.kind==="array"?n.itemType.kind===i.itemType.kind&&typeof n.N=="number":n.kind===i.kind}const n2=.96422,r2=1,o2=.82521,s2=4/29,Mh=6/29,a2=3*Mh*Mh,cA=Mh*Mh*Mh,uA=Math.PI/180,hA=180/Math.PI;function l2(n){return n=n%360,n<0&&(n+=360),n}function c2([n,i,a,d]){n=Hg(n),i=Hg(i),a=Hg(a);let m,_;const g=Wg((.2225045*n+.7168786*i+.0606169*a)/r2);n===i&&i===a?m=_=g:(m=Wg((.4360747*n+.3850649*i+.1430804*a)/n2),_=Wg((.0139322*n+.0971045*i+.7141733*a)/o2));const l=116*g-16;return[l<0?0:l,500*(m-g),200*(g-_),d]}function Hg(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Wg(n){return n>cA?Math.pow(n,1/3):n/a2+s2}function u2([n,i,a,d]){let m=(n+16)/116,_=isNaN(i)?m:m+i/500,g=isNaN(a)?m:m-a/200;return m=r2*Xg(m),_=n2*Xg(_),g=o2*Xg(g),[Kg(3.1338561*_-1.6168667*m-.4906146*g),Kg(-.9787684*_+1.9161415*m+.033454*g),Kg(.0719453*_-.2289914*m+1.4052427*g),d]}function Kg(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function Xg(n){return n>Mh?n*n*n:a2*(n-s2)}function dA(n){const[i,a,d,m]=c2(n),_=Math.sqrt(a*a+d*d);return[Math.round(_*1e4)?l2(Math.atan2(d,a)*hA):NaN,_,i,m]}function pA([n,i,a,d]){return n=isNaN(n)?0:n*uA,u2([a,Math.cos(n)*i,Math.sin(n)*i,d])}function fA([n,i,a,d]){n=l2(n),i/=100,a/=100;function m(_){const g=(_+n/30)%12,l=i*Math.min(a,1-a);return a-l*Math.max(-1,Math.min(g-3,9-g,1))}return[m(0),m(8),m(4),d]}const mA=Object.hasOwn||function(n,i){return Object.prototype.hasOwnProperty.call(n,i)};function qd(n,i){return mA(n,i)?n[i]:void 0}function gA(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const i=qd(_A,n);if(i){const[m,_,g]=i;return[m/255,_/255,g/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const m=n.length<6?1:2;let _=1;return[lf(n.slice(_,_+=m)),lf(n.slice(_,_+=m)),lf(n.slice(_,_+=m)),lf(n.slice(_,_+m)||"ff")]}if(n.startsWith("rgb")){const m=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,_=n.match(m);if(_){const[g,l,E,k,O,$,X,q,te,ce,Ce,ze]=_,Ue=[k||" ",X||" ",ce].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){const Fe=[E,$,te].join(""),xe=Fe==="%%%"?100:Fe===""?255:0;if(xe){const be=[xh(+l/xe,0,1),xh(+O/xe,0,1),xh(+q/xe,0,1),Ce?eb(+Ce,ze):1];if(tb(be))return be}}return}}const a=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,d=n.match(a);if(d){const[m,_,g,l,E,k,O,$,X]=d,q=[g||" ",E||" ",O].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const te=[+_,xh(+l,0,100),xh(+k,0,100),$?eb(+$,X):1];if(tb(te))return fA(te)}}}function lf(n){return parseInt(n.padEnd(2,n),16)/255}function eb(n,i){return xh(i?n/100:n,0,1)}function xh(n,i,a){return Math.min(Math.max(i,n),a)}function tb(n){return!n.some(Number.isNaN)}const _A={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Pu(n,i,a){return n+a*(i-n)}function rp(n,i,a){return n.map((d,m)=>Pu(d,i[m],a))}class an{constructor(i,a,d,m=1,_=!0){this.r=i,this.g=a,this.b=d,this.a=m,_||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[i,a,d,m]))}static parse(i){if(i instanceof an)return i;if(typeof i!="string")return;const a=gA(i);if(a)return new an(...a,!1)}get rgb(){const{r:i,g:a,b:d,a:m}=this,_=m||1/0;return this.overwriteGetter("rgb",[i/_,a/_,d/_,m])}get hcl(){return this.overwriteGetter("hcl",dA(this.rgb))}get lab(){return this.overwriteGetter("lab",c2(this.rgb))}overwriteGetter(i,a){return Object.defineProperty(this,i,{value:a}),a}toString(){const[i,a,d,m]=this.rgb;return`rgba(${[i,a,d].map(_=>Math.round(_*255)).join(",")},${m})`}static interpolate(i,a,d,m="rgb"){switch(m){case"rgb":{const[_,g,l,E]=rp(i.rgb,a.rgb,d);return new an(_,g,l,E,!1)}case"hcl":{const[_,g,l,E]=i.hcl,[k,O,$,X]=a.hcl;let q,te;if(!isNaN(_)&&!isNaN(k)){let Fe=k-_;k>_&&Fe>180?Fe-=360:k<_&&_-k>180&&(Fe+=360),q=_+d*Fe}else isNaN(_)?isNaN(k)?q=NaN:(q=k,(l===1||l===0)&&(te=O)):(q=_,($===1||$===0)&&(te=g));const[ce,Ce,ze,Ue]=pA([q,te??Pu(g,O,d),Pu(l,$,d),Pu(E,X,d)]);return new an(ce,Ce,ze,Ue,!1)}case"lab":{const[_,g,l,E]=u2(rp(i.lab,a.lab,d));return new an(_,g,l,E,!1)}}}}an.black=new an(0,0,0,1);an.white=new an(1,1,1,1);an.transparent=new an(0,0,0,0);an.red=new an(1,0,0,1);class Fy{constructor(i,a,d){i?this.sensitivity=a?"variant":"case":this.sensitivity=a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const yA=["bottom","center","top"];class W_{constructor(i,a,d,m,_,g){this.text=i,this.image=a,this.scale=d,this.fontStack=m,this.textColor=_,this.verticalAlign=g}}class El{constructor(i){this.sections=i}static fromString(i){return new El([new W_(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof El?i:El.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class ea{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ea)return i;if(typeof i=="number")return new ea([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const a of i)if(typeof a!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]];break}return new ea(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,a,d){return new ea(rp(i.values,a.values,d))}}class ta{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ta)return i;if(typeof i=="number")return new ta([i]);if(Array.isArray(i)){for(const a of i)if(typeof a!="number")return;return new ta(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,a,d){return new ta(rp(i.values,a.values,d))}}class ss{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ss)return i;if(typeof i=="string"){const d=an.parse(i);return d?new ss([d]):void 0}if(!Array.isArray(i))return;const a=[];for(const d of i){if(typeof d!="string")return;const m=an.parse(d);if(!m)return;a.push(m)}return new ss(a)}toString(){return JSON.stringify(this.values)}static interpolate(i,a,d,m="rgb"){const _=[];if(i.values.length!=a.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${a.values.length}), cannot interpolate.`);for(let g=0;g<i.values.length;g++)_.push(an.interpolate(i.values[g],a.values[g],d,m));return new ss(_)}}class Nn extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const vA=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qa{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof qa)return i;if(!(!Array.isArray(i)||i.length<1||i.length%2!==0)){for(let a=0;a<i.length;a+=2){const d=i[a],m=i[a+1];if(typeof d!="string"||!vA.has(d)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new qa(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,a,d){const m=i.values,_=a.values;if(m.length!==_.length)throw new Nn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${a.toString()}`);const g=[];for(let l=0;l<m.length;l+=2){if(m[l]!==_[l])throw new Nn(`Cannot interpolate values containing mismatched anchors. from[${l}]: ${m[l]}, to[${l}]: ${_[l]}`);g.push(m[l]);const[E,k]=m[l+1],[O,$]=_[l+1];g.push([Pu(E,O,d),Pu(k,$,d)])}return new qa(g)}}class Pc{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Pc({name:i,available:!1}):null}}class Js{constructor(i,a,d){this.from=i,this.to=a,this.transition=d}static interpolate(i,a,d){return new Js(i,a,d)}static parse(i){if(i instanceof Js)return i;if(Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number")return new Js(i[0],i[1],i[2]);if(typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number")return new Js(i.from,i.to,i.transition);if(typeof i=="string")return new Js(i,i,1)}}function h2(n,i,a,d){return typeof n=="number"&&n>=0&&n<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?typeof d>"u"||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[n,i,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[n,i,a,d]:[n,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function op(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Js||n instanceof an||n instanceof Fy||n instanceof El||n instanceof ea||n instanceof ta||n instanceof ss||n instanceof qa||n instanceof Pc)return!0;if(Array.isArray(n)){for(const i of n)if(!op(i))return!1;return!0}else if(typeof n=="object"){for(const i in n)if(!op(n[i]))return!1;return!0}else return!1}function dr(n){if(n===null)return um;if(typeof n=="string")return ki;if(typeof n=="boolean")return Mi;if(typeof n=="number")return St;if(n instanceof an)return Za;if(n instanceof Js)return hm;if(n instanceof Fy)return dm;if(n instanceof El)return pm;if(n instanceof ea)return fm;if(n instanceof ta)return mm;if(n instanceof ss)return ip;if(n instanceof qa)return gm;if(n instanceof Pc)return gp;if(Array.isArray(n)){const i=n.length;let a;for(const d of n){const m=dr(d);if(!a)a=m;else{if(a===m)continue;a=Ti;break}}return rs(a||Ti,i)}else return Tu}function Gd(n){const i=typeof n;return n===null?"":i==="string"||i==="number"||i==="boolean"?String(n):n instanceof an||n instanceof Js||n instanceof El||n instanceof ea||n instanceof ta||n instanceof ss||n instanceof qa||n instanceof Pc?n.toString():JSON.stringify(n)}class Ih{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!op(i[1]))return a.error("invalid value");const d=i[1];let m=dr(d);const _=a.expectedType;return m.kind==="array"&&m.N===0&&_&&_.kind==="array"&&(typeof _.N!="number"||_.N===0)&&(m=_),new Ih(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const cf={string:ki,number:St,boolean:Mi,object:Tu};class Qs{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let d=1,m;const _=i[0];if(_==="array"){let l;if(i.length>2){const k=i[1];if(typeof k!="string"||!(k in cf)||k==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);l=cf[k],d++}else l=Ti;let E;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=i[2],d++}m=rs(l,E)}else{if(!cf[_])throw new Error(`Types doesn't contain name = ${_}`);m=cf[_]}const g=[];for(;d<i.length;d++){const l=a.parse(i[d],d,Ti);if(!l)return null;g.push(l)}return new Qs(m,g)}evaluate(i){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(i);if(np(this.type,dr(d))){if(a===this.args.length-1)throw new Nn(`Expected value to be of type ${Dn(this.type)}, but found ${Dn(dr(d))} instead.`)}else return d}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ib={"to-boolean":Mi,"to-color":Za,"to-number":St,"to-string":ki};class gc{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[0];if(!ib[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return a.error("Expected one argument.");const m=ib[d],_=[];for(let g=1;g<i.length;g++){const l=a.parse(i[g],g,Ti);if(!l)return null;_.push(l)}return new gc(m,_)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let a,d;for(const m of this.args){if(a=m.evaluate(i),d=null,a instanceof an)return a;if(typeof a=="string"){const _=i.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(a.length<3||a.length>4?d=`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:d=h2(a[0],a[1],a[2],a[3]),!d))return new an(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Nn(d||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const d of this.args){a=d.evaluate(i);const m=ea.parse(a);if(m)return m}throw new Nn(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"numberArray":{let a;for(const d of this.args){a=d.evaluate(i);const m=ta.parse(a);if(m)return m}throw new Nn(`Could not parse numberArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"colorArray":{let a;for(const d of this.args){a=d.evaluate(i);const m=ss.parse(a);if(m)return m}throw new Nn(`Could not parse colorArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const d of this.args){a=d.evaluate(i);const m=qa.parse(a);if(m)return m}throw new Nn(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const d of this.args){if(a=d.evaluate(i),a===null)return 0;const m=Number(a);if(!isNaN(m))return m}throw new Nn(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return El.fromString(Gd(this.args[0].evaluate(i)));case"resolvedImage":return Pc.fromString(Gd(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Gd(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const xA=["Unknown","Point","LineString","Polygon"];class d2{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let a=this._parseColorCache.get(i);return a||(a=an.parse(i),this._parseColorCache.set(i,a)),a}}class _m{constructor(i,a,d=[],m,_=new Dy,g=[]){this.registry=i,this.path=d,this.key=d.map(l=>`[${l}]`).join(""),this.scope=_,this.errors=g,this.expectedType=m,this._isConstant=a}parse(i,a,d,m,_={}){return a?this.concat(a,d,m)._parse(i,_):this._parse(i,_)}_parse(i,a){(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number")&&(i=["literal",i]);function d(m,_,g){return g==="assert"?new Qs(_,[m]):g==="coerce"?new gc(_,[m]):m}if(Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[m];if(_){let g=_.parse(i,this);if(!g)return null;if(this.expectedType){const l=this.expectedType,E=g.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&E.kind==="value")g=d(g,l,a.typeAnnotation||"assert");else if(l.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(l.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(l.kind)&&["value","number","array"].includes(E.kind)||l.kind==="colorArray"&&["value","string","array"].includes(E.kind)||l.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))g=d(g,l,a.typeAnnotation||"coerce");else if(this.checkSubtype(l,E))return null}if(!(g instanceof Ih)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const l=new d2;try{g=new Ih(g.type,g.evaluate(l))}catch(E){return this.error(E.message),null}}return g}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof i>"u"?this.error("'undefined' value invalid. Use null instead."):typeof i=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof i} instead.`)}concat(i,a,d){const m=typeof i=="number"?this.path.concat(i):this.path,_=d?this.scope.concat(d):this.scope;return new _m(this.registry,this._isConstant,m,a||null,_,this.errors)}error(i,...a){const d=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new Ua(d,i))}checkSubtype(i,a){const d=np(i,a);return d&&this.error(d),d}}class ym{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let _=1;_<i.length-1;_+=2){const g=i[_];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,_);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const l=a.parse(i[_+1],_+1);if(!l)return null;d.push([g,l])}const m=a.parse(i[i.length-1],i.length-1,a.expectedType,d);return m?new ym(d,m):null}outputDefined(){return this.result.outputDefined()}}class vm{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=i[1];return a.scope.has(d)?new vm(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class By{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,St),m=a.parse(i[2],2,rs(a.expectedType||Ti));if(!d||!m)return null;const _=m.type;return new By(_.itemType,d,m)}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new Nn(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new Nn(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new Nn(`Array index must be an integer, but found ${a} instead.`);return d[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Ny{constructor(i,a){this.type=Mi,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Ti),m=a.parse(i[2],2,Ti);return!d||!m?null:Oy(d.type,[Mi,ki,St,um,Ti])?new Ny(d,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(d.type)} instead`)}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!Su(a,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(dr(a))} instead.`);if(!Su(d,["string","array"]))throw new Nn(`Expected second argument to be of type array or string, but found ${Dn(dr(d))} instead.`);return d.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Of{constructor(i,a,d){this.type=St,this.needle=i,this.haystack=a,this.fromIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Ti),m=a.parse(i[2],2,Ti);if(!d||!m)return null;if(!Oy(d.type,[Mi,ki,St,um,Ti]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(d.type)} instead`);if(i.length===4){const _=a.parse(i[3],3,St);return _?new Of(d,m,_):null}else return new Of(d,m)}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!Su(a,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(dr(a))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(i)),Su(d,["string"])){const _=d.indexOf(a,m);return _===-1?-1:[...d.slice(0,_)].length}else{if(Su(d,["array"]))return d.indexOf(a,m);throw new Nn(`Expected second argument to be of type array or string, but found ${Dn(dr(d))} instead.`)}}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class jy{constructor(i,a,d,m,_,g){this.inputType=i,this.type=a,this.input=d,this.cases=m,this.outputs=_,this.otherwise=g}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!==1)return a.error("Expected an even number of arguments.");let d,m;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);const _={},g=[];for(let k=2;k<i.length-1;k+=2){let O=i[k];const $=i[k+1];Array.isArray(O)||(O=[O]);const X=a.concat(k);if(O.length===0)return X.error("Expected at least one branch label.");for(const te of O){if(typeof te!="number"&&typeof te!="string")return X.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return X.error("Numeric branch labels must be integer values.");if(!d)d=dr(te);else if(X.checkSubtype(d,dr(te)))return null;if(typeof _[String(te)]<"u")return X.error("Branch labels must be unique.");_[String(te)]=g.length}const q=a.parse($,k,m);if(!q)return null;m=m||q.type,g.push(q)}const l=a.parse(i[1],1,Ti);if(!l)return null;const E=a.parse(i[i.length-1],i.length-1,m);return!E||l.type.kind!=="value"&&a.concat(1).checkSubtype(d,l.type)?null:new jy(d,m,l,_,g,E)}evaluate(i){const a=this.input.evaluate(i);return(dr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Uy{constructor(i,a,d){this.type=i,this.branches=a,this.otherwise=d}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!==0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const m=[];for(let g=1;g<i.length-1;g+=2){const l=a.parse(i[g],g,Mi);if(!l)return null;const E=a.parse(i[g+1],g+1,d);if(!E)return null;m.push([l,E]),d=d||E.type}const _=a.parse(i[i.length-1],i.length-1,d);if(!_)return null;if(!d)throw new Error("Can't infer output type");return new Uy(d,m,_)}evaluate(i){for(const[a,d]of this.branches)if(a.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,d]of this.branches)i(a),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class Ff{constructor(i,a,d,m){this.type=i,this.input=a,this.beginIndex=d,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Ti),m=a.parse(i[2],2,St);if(!d||!m)return null;if(!Oy(d.type,[rs(Ti),ki,Ti]))return a.error(`Expected first argument to be of type array or string, but found ${Dn(d.type)} instead`);if(i.length===4){const _=a.parse(i[3],3,St);return _?new Ff(d.type,d,m,_):null}else return new Ff(d.type,d,m)}evaluate(i){const a=this.input.evaluate(i),d=this.beginIndex.evaluate(i);let m;if(this.endIndex&&(m=this.endIndex.evaluate(i)),Su(a,["string"]))return[...a].slice(d,m).join("");if(Su(a,["array"]))return a.slice(d,m);throw new Nn(`Expected first argument to be of type array or string, but found ${Dn(dr(a))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function p2(n,i){const a=n.length-1;let d=0,m=a,_=0,g,l;for(;d<=m;)if(_=Math.floor((d+m)/2),g=n[_],l=n[_+1],g<=i){if(_===a||i<l)return _;d=_+1}else if(g>i)m=_-1;else throw new Nn("Input is not a number.");return 0}class xm{constructor(i,a,d){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[m,_]of d)this.labels.push(m),this.outputs.push(_)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return a.error("Expected an even number of arguments.");const d=a.parse(i[1],1,St);if(!d)return null;const m=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let g=1;g<i.length;g+=2){const l=g===1?-1/0:i[g],E=i[g+1],k=g,O=g+1;if(typeof l!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(m.length&&m[m.length-1][0]>=l)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const $=a.parse(E,O,_);if(!$)return null;_=_||$.type,m.push([l,$])}return new xm(_,d,m)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return d[0].evaluate(i);const _=a.length;if(m>=a[_-1])return d[_-1].evaluate(i);const g=p2(a,m);return d[g].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function bA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yg,nb;function wA(){if(nb)return Yg;nb=1,Yg=n;function n(i,a,d,m){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=d,this.p2y=m}return n.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,m=0;m<8;m++){var _=this.sampleCurveX(d)-i;if(Math.abs(_)<a)return d;var g=this.sampleCurveDerivativeX(d);if(Math.abs(g)<1e-6)break;d=d-_/g}var l=0,E=1;for(d=i,m=0;m<20&&(_=this.sampleCurveX(d),!(Math.abs(_-i)<a));m++)i>_?l=d:E=d,d=(E-l)*.5+l;return d},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},Yg}var TA=wA(),SA=bA(TA);class Ga{constructor(i,a,d,m,_){this.type=i,this.operator=a,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(const[g,l]of _)this.labels.push(g),this.outputs.push(l)}static interpolationFactor(i,a,d,m){let _=0;if(i.name==="exponential")_=Jg(a,i.base,d,m);else if(i.name==="linear")_=Jg(a,1,d,m);else if(i.name==="cubic-bezier"){const g=i.controlPoints;_=new SA(g[0],g[1],g[2],g[3]).solve(Jg(a,1,d,m))}return _}static parse(i,a){let[d,m,_,...g]=i;if(!Array.isArray(m)||m.length===0)return a.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const k=m[1];if(typeof k!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:k}}else if(m[0]==="cubic-bezier"){const k=m.slice(1);if(k.length!==4||k.some(O=>typeof O!="number"||O<0||O>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:k}}else return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,St),!_)return null;const l=[];let E=null;(d==="interpolate-hcl"||d==="interpolate-lab")&&a.expectedType!=ip?E=Za:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let k=0;k<g.length;k+=2){const O=g[k],$=g[k+1],X=k+3,q=k+4;if(typeof O!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(l.length&&l[l.length-1][0]>=O)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const te=a.parse($,q,E);if(!te)return null;E=E||te.type,l.push([O,te])}return!hc(E,St)&&!hc(E,hm)&&!hc(E,Za)&&!hc(E,fm)&&!hc(E,mm)&&!hc(E,ip)&&!hc(E,gm)&&!hc(E,rs(St))?a.error(`Type ${Dn(E)} is not interpolatable.`):new Ga(E,d,m,_,l)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return d[0].evaluate(i);const _=a.length;if(m>=a[_-1])return d[_-1].evaluate(i);const g=p2(a,m),l=a[g],E=a[g+1],k=Ga.interpolationFactor(this.interpolation,m,l,E),O=d[g].evaluate(i),$=d[g+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Pu(O,$,k);case"color":return an.interpolate(O,$,k);case"padding":return ea.interpolate(O,$,k);case"colorArray":return ss.interpolate(O,$,k);case"numberArray":return ta.interpolate(O,$,k);case"variableAnchorOffsetCollection":return qa.interpolate(O,$,k);case"array":return rp(O,$,k);case"projectionDefinition":return Js.interpolate(O,$,k)}case"interpolate-hcl":switch(this.type.kind){case"color":return an.interpolate(O,$,k,"hcl");case"colorArray":return ss.interpolate(O,$,k,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return an.interpolate(O,$,k,"lab");case"colorArray":return ss.interpolate(O,$,k,"lab")}}}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Jg(n,i,a,d){const m=d-a,_=n-a;return m===0?0:i===1?_/m:(Math.pow(i,_)-1)/(Math.pow(i,m)-1)}class sp{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let d=null;const m=a.expectedType;m&&m.kind!=="value"&&(d=m);const _=[];for(const g of i.slice(1)){const l=a.parse(g,1+_.length,d,void 0,{typeAnnotation:"omit"});if(!l)return null;d=d||l.type,_.push(l)}if(!d)throw new Error("No output type");return m&&_.some(g=>np(m,g.type))?new sp(Ti,_):new sp(d,_)}evaluate(i){let a=null,d=0,m;for(const _ of this.args)if(d++,a=_.evaluate(i),a&&a instanceof Pc&&!a.available&&(m||(m=a.name),a=null,d===this.args.length&&(a=m)),a!==null)break;return a}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function rb(n,i){return n==="=="||n==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function PA(n,i,a){return i===a}function CA(n,i,a){return i!==a}function MA(n,i,a){return i<a}function EA(n,i,a){return i>a}function IA(n,i,a){return i<=a}function AA(n,i,a){return i>=a}function f2(n,i,a,d){return d.compare(i,a)===0}function LA(n,i,a,d){return!f2(n,i,a,d)}function kA(n,i,a,d){return d.compare(i,a)<0}function zA(n,i,a,d){return d.compare(i,a)>0}function RA(n,i,a,d){return d.compare(i,a)<=0}function DA(n,i,a,d){return d.compare(i,a)>=0}function kh(n,i,a){const d=n!=="=="&&n!=="!=";return class m2{constructor(_,g,l){this.type=Mi,this.lhs=_,this.rhs=g,this.collator=l,this.hasUntypedArgument=_.type.kind==="value"||g.type.kind==="value"}static parse(_,g){if(_.length!==3&&_.length!==4)return g.error("Expected two or three arguments.");const l=_[0];let E=g.parse(_[1],1,Ti);if(!E)return null;if(!rb(l,E.type))return g.concat(1).error(`"${l}" comparisons are not supported for type '${Dn(E.type)}'.`);let k=g.parse(_[2],2,Ti);if(!k)return null;if(!rb(l,k.type))return g.concat(2).error(`"${l}" comparisons are not supported for type '${Dn(k.type)}'.`);if(E.type.kind!==k.type.kind&&E.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${Dn(E.type)}' and '${Dn(k.type)}'.`);d&&(E.type.kind==="value"&&k.type.kind!=="value"?E=new Qs(k.type,[E]):E.type.kind!=="value"&&k.type.kind==="value"&&(k=new Qs(E.type,[k])));let O=null;if(_.length===4){if(E.type.kind!=="string"&&k.type.kind!=="string"&&E.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(O=g.parse(_[3],3,dm),!O)return null}return new m2(E,k,O)}evaluate(_){const g=this.lhs.evaluate(_),l=this.rhs.evaluate(_);if(d&&this.hasUntypedArgument){const E=dr(g),k=dr(l);if(E.kind!==k.kind||!(E.kind==="string"||E.kind==="number"))throw new Nn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${E.kind}, ${k.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const E=dr(g),k=dr(l);if(E.kind!=="string"||k.kind!=="string")return i(_,g,l)}return this.collator?a(_,g,l,this.collator.evaluate(_)):i(_,g,l)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const OA=kh("==",PA,f2),FA=kh("!=",CA,LA),BA=kh("<",MA,kA),NA=kh(">",EA,zA),jA=kh("<=",IA,RA),UA=kh(">=",AA,DA);class bm{constructor(i,a,d){this.type=dm,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const m=a.parse(d["case-sensitive"]===void 0?!1:d["case-sensitive"],1,Mi);if(!m)return null;const _=a.parse(d["diacritic-sensitive"]===void 0?!1:d["diacritic-sensitive"],1,Mi);if(!_)return null;let g=null;return d.locale&&(g=a.parse(d.locale,1,ki),!g)?null:new bm(m,_,g)}evaluate(i){return new Fy(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class $y{constructor(i,a,d,m,_){this.type=ki,this.number=i,this.locale=a,this.currency=d,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const d=a.parse(i[1],1,St);if(!d)return null;const m=i[2];if(typeof m!="object"||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let _=null;if(m.locale&&(_=a.parse(m.locale,1,ki),!_))return null;let g=null;if(m.currency&&(g=a.parse(m.currency,1,ki),!g))return null;let l=null;if(m["min-fraction-digits"]&&(l=a.parse(m["min-fraction-digits"],1,St),!l))return null;let E=null;return m["max-fraction-digits"]&&(E=a.parse(m["max-fraction-digits"],1,St),!E)?null:new $y(d,_,g,l,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Vy{constructor(i){this.type=pm,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const m=[];let _=!1;for(let g=1;g<=i.length-1;++g){const l=i[g];if(_&&typeof l=="object"&&!Array.isArray(l)){_=!1;let E=null;if(l["font-scale"]&&(E=a.parse(l["font-scale"],1,St),!E))return null;let k=null;if(l["text-font"]&&(k=a.parse(l["text-font"],1,rs(ki)),!k))return null;let O=null;if(l["text-color"]&&(O=a.parse(l["text-color"],1,Za),!O))return null;let $=null;if(l["vertical-align"]){if(typeof l["vertical-align"]=="string"&&!yA.includes(l["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${l["vertical-align"]}' instead.`);if($=a.parse(l["vertical-align"],1,ki),!$)return null}const X=m[m.length-1];X.scale=E,X.font=k,X.textColor=O,X.verticalAlign=$}else{const E=a.parse(i[g],1,Ti);if(!E)return null;const k=E.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Vy(m)}evaluate(i){const a=d=>{const m=d.content.evaluate(i);return dr(m)===gp?new W_("",m,null,null,null,d.verticalAlign?d.verticalAlign.evaluate(i):null):new W_(Gd(m),null,d.scale?d.scale.evaluate(i):null,d.font?d.font.evaluate(i).join(","):null,d.textColor?d.textColor.evaluate(i):null,d.verticalAlign?d.verticalAlign.evaluate(i):null)};return new El(this.sections.map(a))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor),a.verticalAlign&&i(a.verticalAlign)}outputDefined(){return!1}}class Zy{constructor(i){this.type=gp,this.input=i}static parse(i,a){if(i.length!==2)return a.error("Expected two arguments.");const d=a.parse(i[1],1,ki);return d?new Zy(d):a.error("No image name provided.")}evaluate(i){const a=this.input.evaluate(i),d=Pc.fromString(a);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(a)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class qy{constructor(i){this.type=St,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=a.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Dn(d.type)} instead.`):new qy(d):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new Nn(`Expected value to be of type string or array, but found ${Dn(dr(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ha=8192;function $A(n,i){const a=VA(n[0]),d=qA(n[1]),m=Math.pow(2,i.z);return[Math.round(a*m*Ha),Math.round(d*m*Ha)]}function Gy(n,i){const a=Math.pow(2,i.z),d=(n[0]/Ha+i.x)/a,m=(n[1]/Ha+i.y)/a;return[ZA(d),GA(m)]}function VA(n){return(180+n)/360}function ZA(n){return n*360-180}function qA(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function GA(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function _p(n,i){n[0]=Math.min(n[0],i[0]),n[1]=Math.min(n[1],i[1]),n[2]=Math.max(n[2],i[0]),n[3]=Math.max(n[3],i[1])}function ap(n,i){return!(n[0]<=i[0]||n[2]>=i[2]||n[1]<=i[1]||n[3]>=i[3])}function HA(n,i,a){return i[1]>n[1]!=a[1]>n[1]&&n[0]<(a[0]-i[0])*(n[1]-i[1])/(a[1]-i[1])+i[0]}function WA(n,i,a){const d=n[0]-i[0],m=n[1]-i[1],_=n[0]-a[0],g=n[1]-a[1];return d*g-_*m===0&&d*_<=0&&m*g<=0}function wm(n,i,a,d){const m=[i[0]-n[0],i[1]-n[1]],_=[d[0]-a[0],d[1]-a[1]];return JA(_,m)===0?!1:!!(ob(n,i,a,d)&&ob(a,d,n,i))}function KA(n,i,a){for(const d of a)for(let m=0;m<d.length-1;++m)if(wm(n,i,d[m],d[m+1]))return!0;return!1}function zh(n,i,a=!1){let d=!1;for(const m of i)for(let _=0;_<m.length-1;_++){if(WA(n,m[_],m[_+1]))return a;HA(n,m[_],m[_+1])&&(d=!d)}return d}function XA(n,i){for(const a of i)if(zh(n,a))return!0;return!1}function g2(n,i){for(const a of n)if(!zh(a,i))return!1;for(let a=0;a<n.length-1;++a)if(KA(n[a],n[a+1],i))return!1;return!0}function YA(n,i){for(const a of i)if(g2(n,a))return!0;return!1}function JA(n,i){return n[0]*i[1]-n[1]*i[0]}function ob(n,i,a,d){const m=n[0]-a[0],_=n[1]-a[1],g=i[0]-a[0],l=i[1]-a[1],E=d[0]-a[0],k=d[1]-a[1],O=m*k-E*_,$=g*k-E*l;return O>0&&$<0||O<0&&$>0}function Hy(n,i,a){const d=[];for(let m=0;m<n.length;m++){const _=[];for(let g=0;g<n[m].length;g++){const l=$A(n[m][g],a);_p(i,l),_.push(l)}d.push(_)}return d}function _2(n,i,a){const d=[];for(let m=0;m<n.length;m++){const _=Hy(n[m],i,a);d.push(_)}return d}function y2(n,i,a,d){if(n[0]<a[0]||n[0]>a[2]){const m=d*.5;let _=n[0]-a[0]>m?-d:a[0]-n[0]>m?d:0;_===0&&(_=n[0]-a[2]>m?-d:a[2]-n[0]>m?d:0),n[0]+=_}_p(i,n)}function QA(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function sb(n,i,a,d){const m=Math.pow(2,d.z)*Ha,_=[d.x*Ha,d.y*Ha],g=[];for(const l of n)for(const E of l){const k=[E.x+_[0],E.y+_[1]];y2(k,i,a,m),g.push(k)}return g}function ab(n,i,a,d){const m=Math.pow(2,d.z)*Ha,_=[d.x*Ha,d.y*Ha],g=[];for(const l of n){const E=[];for(const k of l){const O=[k.x+_[0],k.y+_[1]];_p(i,O),E.push(O)}g.push(E)}if(i[2]-i[0]<=m/2){QA(i);for(const l of g)for(const E of l)y2(E,i,a,m)}return g}function eL(n,i){const a=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(i.type==="Polygon"){const _=Hy(i.coordinates,d,m),g=sb(n.geometry(),a,d,m);if(!ap(a,d))return!1;for(const l of g)if(!zh(l,_))return!1}if(i.type==="MultiPolygon"){const _=_2(i.coordinates,d,m),g=sb(n.geometry(),a,d,m);if(!ap(a,d))return!1;for(const l of g)if(!XA(l,_))return!1}return!0}function tL(n,i){const a=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(i.type==="Polygon"){const _=Hy(i.coordinates,d,m),g=ab(n.geometry(),a,d,m);if(!ap(a,d))return!1;for(const l of g)if(!g2(l,_))return!1}if(i.type==="MultiPolygon"){const _=_2(i.coordinates,d,m),g=ab(n.geometry(),a,d,m);if(!ap(a,d))return!1;for(const l of g)if(!YA(l,_))return!1}return!0}class Cu{constructor(i,a){this.type=Mi,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(op(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const m=[];for(const _ of d.features){const{type:g,coordinates:l}=_.geometry;g==="Polygon"&&m.push(l),g==="MultiPolygon"&&m.push(...l)}if(m.length){const _={type:"MultiPolygon",coordinates:m};return new Cu(d,_)}}else if(d.type==="Feature"){const m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Cu(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Cu(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return eL(i,this.geometries);if(i.geometryType()==="LineString")return tL(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class v2{constructor(i=[],a=(d,m)=>d<m?-1:d>m?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:d}=this,m=a[i];for(;i>0;){const _=i-1>>1,g=a[_];if(d(m,g)>=0)break;a[i]=g,i=_}a[i]=m}_down(i){const{data:a,compare:d}=this,m=this.length>>1,_=a[i];for(;i<m;){let g=(i<<1)+1;const l=g+1;if(l<this.length&&d(a[l],a[g])<0&&(g=l),d(a[g],_)>=0)break;a[i]=a[g],i=g}a[i]=_}}function iL(n,i){if(n.length<=1)return[n];const a=[];let d,m;for(const _ of n){const g=nL(_);g!==0&&(_.area=Math.abs(g),m===void 0&&(m=g<0),m===g<0?(d&&a.push(d),d=[_]):d.push(_))}return d&&a.push(d),a}function nL(n){let i=0;for(let a=0,d=n.length,m=d-1,_,g;a<d;m=a++)_=n[a],g=n[m],i+=(g.x-_.x)*(_.y+g.y);return i}const rL=6378.137,lb=1/298.257223563,cb=lb*(2-lb),ub=Math.PI/180;class Wy{constructor(i){const a=ub*rL*1e3,d=Math.cos(i*ub),m=1/(1-cb*(1-d*d)),_=Math.sqrt(m);this.kx=a*_*d,this.ky=a*_*m*(1-cb)}distance(i,a){const d=this.wrap(i[0]-a[0])*this.kx,m=(i[1]-a[1])*this.ky;return Math.sqrt(d*d+m*m)}pointOnLine(i,a){let d=1/0,m,_,g,l;for(let E=0;E<i.length-1;E++){let k=i[E][0],O=i[E][1],$=this.wrap(i[E+1][0]-k)*this.kx,X=(i[E+1][1]-O)*this.ky,q=0;($!==0||X!==0)&&(q=(this.wrap(a[0]-k)*this.kx*$+(a[1]-O)*this.ky*X)/($*$+X*X),q>1?(k=i[E+1][0],O=i[E+1][1]):q>0&&(k+=$/this.kx*q,O+=X/this.ky*q)),$=this.wrap(a[0]-k)*this.kx,X=(a[1]-O)*this.ky;const te=$*$+X*X;te<d&&(d=te,m=k,_=O,g=E,l=q)}return{point:[m,_],index:g,t:Math.max(0,Math.min(1,l))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}const K_=100,X_=50;function x2(n,i){return i[0]-n[0]}function Bf(n){return n[1]-n[0]+1}function zl(n,i){return n[1]>=n[0]&&n[1]<i}function Y_(n,i){if(n[0]>n[1])return[null,null];const a=Bf(n);if(i){if(a===2)return[n,null];const m=Math.floor(a/2);return[[n[0],n[0]+m],[n[0]+m,n[1]]]}if(a===1)return[n,null];const d=Math.floor(a/2)-1;return[[n[0],n[0]+d],[n[0]+d+1,n[1]]]}function J_(n,i){if(!zl(i,n.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let d=i[0];d<=i[1];++d)_p(a,n[d]);return a}function Q_(n){const i=[1/0,1/0,-1/0,-1/0];for(const a of n)for(const d of a)_p(i,d);return i}function hb(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Ky(n,i,a){if(!hb(n)||!hb(i))return NaN;let d=0,m=0;return n[2]<i[0]&&(d=i[0]-n[2]),n[0]>i[2]&&(d=n[0]-i[2]),n[1]>i[3]&&(m=n[1]-i[3]),n[3]<i[1]&&(m=i[1]-n[3]),a.distance([0,0],[d,m])}function vu(n,i,a){const d=a.pointOnLine(i,n);return a.distance(n,d.point)}function Xy(n,i,a,d,m){const _=Math.min(vu(n,[a,d],m),vu(i,[a,d],m)),g=Math.min(vu(a,[n,i],m),vu(d,[n,i],m));return Math.min(_,g)}function oL(n,i,a,d,m){if(!(zl(i,n.length)&&zl(d,a.length)))return 1/0;let _=1/0;for(let g=i[0];g<i[1];++g){const l=n[g],E=n[g+1];for(let k=d[0];k<d[1];++k){const O=a[k],$=a[k+1];if(wm(l,E,O,$))return 0;_=Math.min(_,Xy(l,E,O,$,m))}}return _}function sL(n,i,a,d,m){if(!(zl(i,n.length)&&zl(d,a.length)))return NaN;let _=1/0;for(let g=i[0];g<=i[1];++g)for(let l=d[0];l<=d[1];++l)if(_=Math.min(_,m.distance(n[g],a[l])),_===0)return _;return _}function aL(n,i,a){if(zh(n,i,!0))return 0;let d=1/0;for(const m of i){const _=m[0],g=m[m.length-1];if(_!==g&&(d=Math.min(d,vu(n,[g,_],a)),d===0))return d;const l=a.pointOnLine(m,n);if(d=Math.min(d,a.distance(n,l.point)),d===0)return d}return d}function lL(n,i,a,d){if(!zl(i,n.length))return NaN;for(let _=i[0];_<=i[1];++_)if(zh(n[_],a,!0))return 0;let m=1/0;for(let _=i[0];_<i[1];++_){const g=n[_],l=n[_+1];for(const E of a)for(let k=0,O=E.length,$=O-1;k<O;$=k++){const X=E[$],q=E[k];if(wm(g,l,X,q))return 0;m=Math.min(m,Xy(g,l,X,q,d))}}return m}function db(n,i){for(const a of n)for(const d of a)if(zh(d,i,!0))return!0;return!1}function cL(n,i,a,d=1/0){const m=Q_(n),_=Q_(i);if(d!==1/0&&Ky(m,_,a)>=d)return d;if(ap(m,_)){if(db(n,i))return 0}else if(db(i,n))return 0;let g=1/0;for(const l of n)for(let E=0,k=l.length,O=k-1;E<k;O=E++){const $=l[O],X=l[E];for(const q of i)for(let te=0,ce=q.length,Ce=ce-1;te<ce;Ce=te++){const ze=q[Ce],Ue=q[te];if(wm($,X,ze,Ue))return 0;g=Math.min(g,Xy($,X,ze,Ue,a))}}return g}function pb(n,i,a,d,m,_){if(!_)return;const g=Ky(J_(d,_),m,a);g<i&&n.push([g,_,[0,0]])}function uf(n,i,a,d,m,_,g){if(!_||!g)return;const l=Ky(J_(d,_),J_(m,g),a);l<i&&n.push([l,_,g])}function Nf(n,i,a,d,m=1/0){let _=Math.min(d.distance(n[0],a[0][0]),m);if(_===0)return _;const g=new v2([[0,[0,n.length-1],[0,0]]],x2),l=Q_(a);for(;g.length>0;){const E=g.pop();if(E[0]>=_)continue;const k=E[1],O=i?X_:K_;if(Bf(k)<=O){if(!zl(k,n.length))return NaN;if(i){const $=lL(n,k,a,d);if(isNaN($)||$===0)return $;_=Math.min(_,$)}else for(let $=k[0];$<=k[1];++$){const X=aL(n[$],a,d);if(_=Math.min(_,X),_===0)return 0}}else{const $=Y_(k,i);pb(g,_,d,n,l,$[0]),pb(g,_,d,n,l,$[1])}}return _}function jf(n,i,a,d,m,_=1/0){let g=Math.min(_,m.distance(n[0],a[0]));if(g===0)return g;const l=new v2([[0,[0,n.length-1],[0,a.length-1]]],x2);for(;l.length>0;){const E=l.pop();if(E[0]>=g)continue;const k=E[1],O=E[2],$=i?X_:K_,X=d?X_:K_;if(Bf(k)<=$&&Bf(O)<=X){if(!zl(k,n.length)&&zl(O,a.length))return NaN;let q;if(i&&d)q=oL(n,k,a,O,m),g=Math.min(g,q);else if(i&&!d){const te=n.slice(k[0],k[1]+1);for(let ce=O[0];ce<=O[1];++ce)if(q=vu(a[ce],te,m),g=Math.min(g,q),g===0)return g}else if(!i&&d){const te=a.slice(O[0],O[1]+1);for(let ce=k[0];ce<=k[1];++ce)if(q=vu(n[ce],te,m),g=Math.min(g,q),g===0)return g}else q=sL(n,k,a,O,m),g=Math.min(g,q)}else{const q=Y_(k,i),te=Y_(O,d);uf(l,g,m,n,a,q[0],te[0]),uf(l,g,m,n,a,q[0],te[1]),uf(l,g,m,n,a,q[1],te[0]),uf(l,g,m,n,a,q[1],te[1])}}return g}function uL(n,i){const a=n.geometry(),d=a.flat().map(g=>Gy([g.x,g.y],n.canonical));if(a.length===0)return NaN;const m=new Wy(d[0][1]);let _=1/0;for(const g of i){switch(g.type){case"Point":_=Math.min(_,jf(d,!1,[g.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,jf(d,!1,g.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,Nf(d,!1,g.coordinates,m,_));break}if(_===0)return _}return _}function hL(n,i){const a=n.geometry(),d=a.flat().map(g=>Gy([g.x,g.y],n.canonical));if(a.length===0)return NaN;const m=new Wy(d[0][1]);let _=1/0;for(const g of i){switch(g.type){case"Point":_=Math.min(_,jf(d,!0,[g.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,jf(d,!0,g.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,Nf(d,!0,g.coordinates,m,_));break}if(_===0)return _}return _}function dL(n,i){const a=n.geometry();if(a.length===0||a[0].length===0)return NaN;const d=iL(a).map(g=>g.map(l=>l.map(E=>Gy([E.x,E.y],n.canonical)))),m=new Wy(d[0][0][0][1]);let _=1/0;for(const g of i)for(const l of d){switch(g.type){case"Point":_=Math.min(_,Nf([g.coordinates],!1,l,m,_));break;case"LineString":_=Math.min(_,Nf(g.coordinates,!0,l,m,_));break;case"Polygon":_=Math.min(_,cL(l,g.coordinates,m,_));break}if(_===0)return _}return _}function Qg(n){return n.type==="MultiPolygon"?n.coordinates.map(i=>({type:"Polygon",coordinates:i})):n.type==="MultiLineString"?n.coordinates.map(i=>({type:"LineString",coordinates:i})):n.type==="MultiPoint"?n.coordinates.map(i=>({type:"Point",coordinates:i})):[n]}class Mu{constructor(i,a){this.type=St,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(op(i[1])){const d=i[1];if(d.type==="FeatureCollection")return new Mu(d,d.features.map(m=>Qg(m.geometry)).flat());if(d.type==="Feature")return new Mu(d,Qg(d.geometry));if("type"in d&&"coordinates"in d)return new Mu(d,Qg(d))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return uL(i,this.geometries);if(i.geometryType()==="LineString")return hL(i,this.geometries);if(i.geometryType()==="Polygon")return dL(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class yp{constructor(i){this.type=Ti,this.key=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=i[1];return d==null?a.error("Global state property must be defined."):typeof d!="string"?a.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new yp(d)}evaluate(i){var a;const d=(a=i.globals)===null||a===void 0?void 0:a.globalState;return!d||Object.keys(d).length===0?null:qd(d,this.key)}eachChild(){}outputDefined(){return!1}}const Yy={"==":OA,"!=":FA,">":NA,"<":BA,">=":UA,"<=":jA,array:Qs,at:By,boolean:Qs,case:Uy,coalesce:sp,collator:bm,format:Vy,image:Zy,in:Ny,"index-of":Of,interpolate:Ga,"interpolate-hcl":Ga,"interpolate-lab":Ga,length:qy,let:ym,literal:Ih,match:jy,number:Qs,"number-format":$y,object:Qs,slice:Ff,step:xm,string:Qs,"to-boolean":gc,"to-color":gc,"to-number":gc,"to-string":gc,var:vm,within:Cu,distance:Mu,"global-state":yp};class ia{constructor(i,a,d,m){this.name=i,this.type=a,this._evaluate=d,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,a){const d=i[0],m=ia.definitions[d];if(!m)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(m)?m[0]:m.type,g=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,l=g.filter(([k])=>!Array.isArray(k)||k.length===i.length-1);let E=null;for(const[k,O]of l){E=new _m(a.registry,Uf,a.path,null,a.scope);const $=[];let X=!1;for(let q=1;q<i.length;q++){const te=i[q],ce=Array.isArray(k)?k[q-1]:k.type,Ce=E.parse(te,1+$.length,ce);if(!Ce){X=!0;break}$.push(Ce)}if(!X){if(Array.isArray(k)&&k.length!==$.length){E.error(`Expected ${k.length} arguments, but found ${$.length} instead.`);continue}for(let q=0;q<$.length;q++){const te=Array.isArray(k)?k[q]:k.type,ce=$[q];E.concat(q+1).checkSubtype(te,ce.type)}if(E.errors.length===0)return new ia(d,_,O,$)}}if(l.length===1)a.errors.push(...E.errors);else{const k=(l.length?l:g).map(([$])=>fL($)).join(" | "),O=[];for(let $=1;$<i.length;$++){const X=a.parse(i[$],1+O.length);if(!X)return null;O.push(Dn(X.type))}a.error(`Expected arguments of type ${k}, but found (${O.join(", ")}) instead.`)}return null}static register(i,a){ia.definitions=a;for(const d in a)i[d]=ia}}function fb(n,[i,a,d,m]){i=i.evaluate(n),a=a.evaluate(n),d=d.evaluate(n);const _=m?m.evaluate(n):1,g=h2(i,a,d,_);if(g)throw new Nn(g);return new an(i/255,a/255,d/255,_,!1)}function mb(n,i){return n in i}function e_(n,i){const a=i[n];return typeof a>"u"?null:a}function pL(n,i,a,d){for(;a<=d;){const m=a+d>>1;if(i[m]===n)return!0;i[m]>n?d=m-1:a=m+1}return!1}function pu(n){return{type:n}}ia.register(Yy,{error:[aA,[ki],(n,[i])=>{throw new Nn(i.evaluate(n))}],typeof:[ki,[Ti],(n,[i])=>Dn(dr(i.evaluate(n)))],"to-rgba":[rs(St,4),[Za],(n,[i])=>{const[a,d,m,_]=i.evaluate(n).rgb;return[a*255,d*255,m*255,_]}],rgb:[Za,[St,St,St],fb],rgba:[Za,[St,St,St,St],fb],has:{type:Mi,overloads:[[[ki],(n,[i])=>mb(i.evaluate(n),n.properties())],[[ki,Tu],(n,[i,a])=>mb(i.evaluate(n),a.evaluate(n))]]},get:{type:Ti,overloads:[[[ki],(n,[i])=>e_(i.evaluate(n),n.properties())],[[ki,Tu],(n,[i,a])=>e_(i.evaluate(n),a.evaluate(n))]]},"feature-state":[Ti,[ki],(n,[i])=>e_(i.evaluate(n),n.featureState||{})],properties:[Tu,[],n=>n.properties()],"geometry-type":[ki,[],n=>n.geometryType()],id:[Ti,[],n=>n.id()],zoom:[St,[],n=>n.globals.zoom],"heatmap-density":[St,[],n=>n.globals.heatmapDensity||0],elevation:[St,[],n=>n.globals.elevation||0],"line-progress":[St,[],n=>n.globals.lineProgress||0],accumulated:[Ti,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[St,pu(St),(n,i)=>{let a=0;for(const d of i)a+=d.evaluate(n);return a}],"*":[St,pu(St),(n,i)=>{let a=1;for(const d of i)a*=d.evaluate(n);return a}],"-":{type:St,overloads:[[[St,St],(n,[i,a])=>i.evaluate(n)-a.evaluate(n)],[[St],(n,[i])=>-i.evaluate(n)]]},"/":[St,[St,St],(n,[i,a])=>i.evaluate(n)/a.evaluate(n)],"%":[St,[St,St],(n,[i,a])=>i.evaluate(n)%a.evaluate(n)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(n,[i,a])=>Math.pow(i.evaluate(n),a.evaluate(n))],sqrt:[St,[St],(n,[i])=>Math.sqrt(i.evaluate(n))],log10:[St,[St],(n,[i])=>Math.log(i.evaluate(n))/Math.LN10],ln:[St,[St],(n,[i])=>Math.log(i.evaluate(n))],log2:[St,[St],(n,[i])=>Math.log(i.evaluate(n))/Math.LN2],sin:[St,[St],(n,[i])=>Math.sin(i.evaluate(n))],cos:[St,[St],(n,[i])=>Math.cos(i.evaluate(n))],tan:[St,[St],(n,[i])=>Math.tan(i.evaluate(n))],asin:[St,[St],(n,[i])=>Math.asin(i.evaluate(n))],acos:[St,[St],(n,[i])=>Math.acos(i.evaluate(n))],atan:[St,[St],(n,[i])=>Math.atan(i.evaluate(n))],min:[St,pu(St),(n,i)=>Math.min(...i.map(a=>a.evaluate(n)))],max:[St,pu(St),(n,i)=>Math.max(...i.map(a=>a.evaluate(n)))],abs:[St,[St],(n,[i])=>Math.abs(i.evaluate(n))],round:[St,[St],(n,[i])=>{const a=i.evaluate(n);return a<0?-Math.round(-a):Math.round(a)}],floor:[St,[St],(n,[i])=>Math.floor(i.evaluate(n))],ceil:[St,[St],(n,[i])=>Math.ceil(i.evaluate(n))],"filter-==":[Mi,[ki,Ti],(n,[i,a])=>n.properties()[i.value]===a.value],"filter-id-==":[Mi,[Ti],(n,[i])=>n.id()===i.value],"filter-type-==":[Mi,[ki],(n,[i])=>n.geometryType()===i.value],"filter-<":[Mi,[ki,Ti],(n,[i,a])=>{const d=n.properties()[i.value],m=a.value;return typeof d==typeof m&&d<m}],"filter-id-<":[Mi,[Ti],(n,[i])=>{const a=n.id(),d=i.value;return typeof a==typeof d&&a<d}],"filter->":[Mi,[ki,Ti],(n,[i,a])=>{const d=n.properties()[i.value],m=a.value;return typeof d==typeof m&&d>m}],"filter-id->":[Mi,[Ti],(n,[i])=>{const a=n.id(),d=i.value;return typeof a==typeof d&&a>d}],"filter-<=":[Mi,[ki,Ti],(n,[i,a])=>{const d=n.properties()[i.value],m=a.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[Mi,[Ti],(n,[i])=>{const a=n.id(),d=i.value;return typeof a==typeof d&&a<=d}],"filter->=":[Mi,[ki,Ti],(n,[i,a])=>{const d=n.properties()[i.value],m=a.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[Mi,[Ti],(n,[i])=>{const a=n.id(),d=i.value;return typeof a==typeof d&&a>=d}],"filter-has":[Mi,[Ti],(n,[i])=>i.value in n.properties()],"filter-has-id":[Mi,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Mi,[rs(ki)],(n,[i])=>i.value.indexOf(n.geometryType())>=0],"filter-id-in":[Mi,[rs(Ti)],(n,[i])=>i.value.indexOf(n.id())>=0],"filter-in-small":[Mi,[ki,rs(Ti)],(n,[i,a])=>a.value.indexOf(n.properties()[i.value])>=0],"filter-in-large":[Mi,[ki,rs(Ti)],(n,[i,a])=>pL(n.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Mi,overloads:[[[Mi,Mi],(n,[i,a])=>i.evaluate(n)&&a.evaluate(n)],[pu(Mi),(n,i)=>{for(const a of i)if(!a.evaluate(n))return!1;return!0}]]},any:{type:Mi,overloads:[[[Mi,Mi],(n,[i,a])=>i.evaluate(n)||a.evaluate(n)],[pu(Mi),(n,i)=>{for(const a of i)if(a.evaluate(n))return!0;return!1}]]},"!":[Mi,[Mi],(n,[i])=>!i.evaluate(n)],"is-supported-script":[Mi,[ki],(n,[i])=>{const a=n.globals&&n.globals.isSupportedScript;return a?a(i.evaluate(n)):!0}],upcase:[ki,[ki],(n,[i])=>i.evaluate(n).toUpperCase()],downcase:[ki,[ki],(n,[i])=>i.evaluate(n).toLowerCase()],concat:[ki,pu(Ti),(n,i)=>i.map(a=>Gd(a.evaluate(n))).join("")],"resolved-locale":[ki,[dm],(n,[i])=>i.evaluate(n).resolvedLocale()]});function fL(n){return Array.isArray(n)?`(${n.map(Dn).join(", ")})`:`(${Dn(n.type)}...)`}function Uf(n){if(n instanceof vm)return Uf(n.boundExpression);if(n instanceof ia&&n.name==="error"||n instanceof bm||n instanceof Cu||n instanceof Mu||n instanceof yp)return!1;const i=n instanceof gc||n instanceof Qs;let a=!0;return n.eachChild(d=>{i?a=a&&Uf(d):a=a&&d instanceof Ih}),a?Tm(n)&&Sm(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Tm(n){if(n instanceof ia&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Cu||n instanceof Mu)return!1;let i=!0;return n.eachChild(a=>{i&&!Tm(a)&&(i=!1)}),i}function lp(n){if(n instanceof ia&&n.name==="feature-state")return!1;let i=!0;return n.eachChild(a=>{i&&!lp(a)&&(i=!1)}),i}function Sm(n,i){if(n instanceof ia&&i.indexOf(n.name)>=0)return!1;let a=!0;return n.eachChild(d=>{a&&!Sm(d,i)&&(a=!1)}),a}function ey(n){return{result:"success",value:n}}function bh(n){return{result:"error",value:n}}function $f(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function b2(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function w2(n){return!!n.expression&&n.expression.interpolated}function Bi(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Jy(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&dr(n)===Tu}class mL{constructor(i,a){this.expression=i,this._warningHistory={},this._evaluator=new d2,this._defaultValue=a?yL(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(i,a,d,m,_,g){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(i,a,d,m,_,g){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g||null;try{const l=this.expression.evaluate(this._evaluator);if(l==null||typeof l=="number"&&l!==l)return this._defaultValue;if(this._enumValues&&!(l in this._enumValues))throw new Nn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(l)} instead.`);return l}catch(l){return this._warningHistory[l.message]||(this._warningHistory[l.message]=!0,typeof console<"u"&&console.warn(l.message)),this._defaultValue}}}function T2(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Yy}function S2(n,i){const a=new _m(Yy,Uf,[],i?_L(i):void 0),d=a.parse(n,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?ey(new mL(d,i)):bh(a.errors)}class gb{constructor(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent=i!=="constant"&&!lp(a.expression),this.globalStateRefs=Qy(a.expression)}evaluateWithoutErrorHandling(i,a,d,m,_,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,m,_,g)}evaluate(i,a,d,m,_,g){return this._styleExpression.evaluate(i,a,d,m,_,g)}}class _b{constructor(i,a,d,m){this.kind=i,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!lp(a.expression),this.globalStateRefs=Qy(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,d,m,_,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,m,_,g)}evaluate(i,a,d,m,_,g){return this._styleExpression.evaluate(i,a,d,m,_,g)}interpolationFactor(i,a,d){return this.interpolationType?Ga.interpolationFactor(this.interpolationType,i,a,d):0}}function gL(n,i){const a=S2(n,i);if(a.result==="error")return a;const d=a.value.expression,m=Tm(d);if(!m&&!$f(i))return bh([new Ua("","data expressions not supported")]);const _=Sm(d,["zoom"]);if(!_&&!b2(i))return bh([new Ua("","zoom expressions not supported")]);const g=vf(d);if(!g&&!_)return bh([new Ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(g instanceof Ua)return bh([g]);if(g instanceof Ga&&!w2(i))return bh([new Ua("",'"interpolate" expressions cannot be used with this property')]);if(!g)return ey(m?new gb("constant",a.value):new gb("source",a.value));const l=g instanceof Ga?g.interpolation:void 0;return ey(m?new _b("camera",a.value,g.labels,l):new _b("composite",a.value,g.labels,l))}function vf(n){let i=null;if(n instanceof ym)i=vf(n.result);else if(n instanceof sp){for(const a of n.args)if(i=vf(a),i)break}else(n instanceof xm||n instanceof Ga)&&n.input instanceof ia&&n.input.name==="zoom"&&(i=n);return i instanceof Ua||n.eachChild(a=>{const d=vf(a);d instanceof Ua?i=d:!i&&d?i=new Ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new Ua("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Qy(n,i=new Set){return n instanceof yp&&i.add(n.key),n.eachChild(a=>{Qy(a,i)}),i}function _L(n){const i={color:Za,string:ki,number:St,enum:ki,boolean:Mi,formatted:pm,padding:fm,numberArray:mm,colorArray:ip,projectionDefinition:hm,resolvedImage:gp,variableAnchorOffsetCollection:gm};return n.type==="array"?rs(i[n.value]||Ti,n.length):i[n.type]}function yL(n){if(n.type==="color"&&Jy(n.default))return new an(0,0,0,0);switch(n.type){case"color":return an.parse(n.default)||null;case"padding":return ea.parse(n.default)||null;case"numberArray":return ta.parse(n.default)||null;case"colorArray":return ss.parse(n.default)||null;case"variableAnchorOffsetCollection":return qa.parse(n.default)||null;case"projectionDefinition":return Js.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function P2(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const i of n.slice(1))if(!P2(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function C2(n){const i=n.key,a=n.value;return a?[new bt(i,a,"constants have been deprecated as of v8")]:[]}function qn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Au(n){if(Array.isArray(n))return n.map(Au);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const i={};for(const a in n)i[a]=Au(n[a]);return i}return qn(n)}function Ms(n){const i=n.key,a=n.value,d=n.valueSpec||{},m=n.objectElementValidators||{},_=n.style,g=n.styleSpec,l=n.validateSpec;let E=[];const k=Bi(a);if(k!=="object")return[new bt(i,a,`object expected, ${k} found`)];for(const O in a){const $=O.split(".")[0],X=qd(d,$)||d["*"];let q;if(qd(m,$))q=m[$];else if(qd(d,$))q=l;else if(m["*"])q=m["*"];else if(d["*"])q=l;else{E.push(new bt(i,a[O],`unknown property "${O}"`));continue}E=E.concat(q({key:(i&&`${i}.`)+O,value:a[O],valueSpec:X,style:_,styleSpec:g,object:a,objectKey:O,validateSpec:l},a))}for(const O in d)m[O]||d[O].required&&d[O].default===void 0&&a[O]===void 0&&E.push(new bt(i,a,`missing required property "${O}"`));return E}function ev(n){const i=n.value,a=n.valueSpec,d=n.validateSpec,m=n.style,_=n.styleSpec,g=n.key,l=n.arrayElementValidator||d;if(Bi(i)!=="array")return[new bt(g,i,`array expected, ${Bi(i)} found`)];if(a.length&&i.length!==a.length)return[new bt(g,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new bt(g,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let E={type:a.value,values:a.values};_.$version<7&&(E.function=a.function),Bi(a.value)==="object"&&(E=a.value);let k=[];for(let O=0;O<i.length;O++)k=k.concat(l({array:i,arrayIndex:O,value:i[O],valueSpec:E,validateSpec:n.validateSpec,style:m,styleSpec:_,key:`${g}[${O}]`}));return k}function Pm(n){const i=n.key,a=n.value,d=n.valueSpec;let m=Bi(a);return m==="number"&&a!==a&&(m="NaN"),m!=="number"?[new bt(i,a,`number expected, ${m} found`)]:"minimum"in d&&a<d.minimum?[new bt(i,a,`${a} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&a>d.maximum?[new bt(i,a,`${a} is greater than the maximum value ${d.maximum}`)]:[]}function M2(n){const i=n.valueSpec,a=qn(n.value.type);let d,m={},_,g;const l=a!=="categorical"&&n.value.property===void 0,E=!l,k=Bi(n.value.stops)==="array"&&Bi(n.value.stops[0])==="array"&&Bi(n.value.stops[0][0])==="object",O=Ms({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:$,default:te}});return a==="identity"&&l&&O.push(new bt(n.key,n.value,'missing required property "property"')),a!=="identity"&&!n.value.stops&&O.push(new bt(n.key,n.value,'missing required property "stops"')),a==="exponential"&&n.valueSpec.expression&&!w2(n.valueSpec)&&O.push(new bt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(E&&!$f(n.valueSpec)?O.push(new bt(n.key,n.value,"property functions not supported")):l&&!b2(n.valueSpec)&&O.push(new bt(n.key,n.value,"zoom functions not supported"))),(a==="categorical"||k)&&n.value.property===void 0&&O.push(new bt(n.key,n.value,'"property" property is required')),O;function $(ce){if(a==="identity")return[new bt(ce.key,ce.value,'identity function may not have a "stops" property')];let Ce=[];const ze=ce.value;return Ce=Ce.concat(ev({key:ce.key,value:ze,valueSpec:ce.valueSpec,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:X})),Bi(ze)==="array"&&ze.length===0&&Ce.push(new bt(ce.key,ze,"array must have at least one stop")),Ce}function X(ce){let Ce=[];const ze=ce.value,Ue=ce.key;if(Bi(ze)!=="array")return[new bt(Ue,ze,`array expected, ${Bi(ze)} found`)];if(ze.length!==2)return[new bt(Ue,ze,`array length 2 expected, length ${ze.length} found`)];if(k){if(Bi(ze[0])!=="object")return[new bt(Ue,ze,`object expected, ${Bi(ze[0])} found`)];if(ze[0].zoom===void 0)return[new bt(Ue,ze,"object stop key must have zoom")];if(ze[0].value===void 0)return[new bt(Ue,ze,"object stop key must have value")];if(g&&g>qn(ze[0].zoom))return[new bt(Ue,ze[0].zoom,"stop zoom values must appear in ascending order")];qn(ze[0].zoom)!==g&&(g=qn(ze[0].zoom),_=void 0,m={}),Ce=Ce.concat(Ms({key:`${Ue}[0]`,value:ze[0],valueSpec:{zoom:{}},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:Pm,value:q}}))}else Ce=Ce.concat(q({key:`${Ue}[0]`,value:ze[0],validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec},ze));return T2(Au(ze[1]))?Ce.concat([new bt(`${Ue}[1]`,ze[1],"expressions are not allowed in function stops.")]):Ce.concat(ce.validateSpec({key:`${Ue}[1]`,value:ze[1],valueSpec:i,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec}))}function q(ce,Ce){const ze=Bi(ce.value),Ue=qn(ce.value),Fe=ce.value!==null?ce.value:Ce;if(!d)d=ze;else if(ze!==d)return[new bt(ce.key,Fe,`${ze} stop domain type must match previous stop domain type ${d}`)];if(ze!=="number"&&ze!=="string"&&ze!=="boolean")return[new bt(ce.key,Fe,"stop domain value must be a number, string, or boolean")];if(ze!=="number"&&a!=="categorical"){let xe=`number expected, ${ze} found`;return $f(i)&&a===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(ce.key,Fe,xe)]}return a==="categorical"&&ze==="number"&&(!isFinite(Ue)||Math.floor(Ue)!==Ue)?[new bt(ce.key,Fe,`integer expected, found ${Ue}`)]:a!=="categorical"&&ze==="number"&&_!==void 0&&Ue<_?[new bt(ce.key,Fe,"stop domain values must appear in ascending order")]:(_=Ue,a==="categorical"&&Ue in m?[new bt(ce.key,Fe,"stop domain values must be unique")]:(m[Ue]=!0,[]))}function te(ce){return ce.validateSpec({key:ce.key,value:ce.value,valueSpec:i,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec})}}function Ah(n){const i=(n.expressionContext==="property"?gL:S2)(Au(n.value),n.valueSpec);if(i.result==="error")return i.value.map(d=>new bt(`${n.key}${d.key}`,n.value,d.message));const a=i.value.expression||i.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!a.outputDefined())return[new bt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!lp(a))return[new bt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!lp(a))return[new bt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Sm(a,["zoom","feature-state"]))return[new bt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Tm(a))return[new bt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vL(n){const i=n.value,a=n.key,d=Bi(i);return d!=="boolean"?[new bt(a,i,`boolean expected, ${d} found`)]:[]}function ty(n){const i=n.key,a=n.value,d=Bi(a);return d!=="string"?[new bt(i,a,`color expected, ${d} found`)]:an.parse(String(a))?[]:[new bt(i,a,`color expected, "${a}" found`)]}function cp(n){const i=n.key,a=n.value,d=n.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(qn(a))===-1&&m.push(new bt(i,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(qn(a))===-1&&m.push(new bt(i,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function tv(n){return P2(Au(n.value))?Ah(Df({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):E2(n)}function E2(n){const i=n.value,a=n.key;if(Bi(i)!=="array")return[new bt(a,i,`array expected, ${Bi(i)} found`)];const d=n.styleSpec;let m,_=[];if(i.length<1)return[new bt(a,i,"filter array must have at least 1 element")];switch(_=_.concat(cp({key:`${a}[0]`,value:i[0],valueSpec:d.filter_operator,style:n.style,styleSpec:n.styleSpec})),qn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&qn(i[1])==="$type"&&_.push(new bt(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&_.push(new bt(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=Bi(i[1]),m!=="string"&&_.push(new bt(`${a}[1]`,i[1],`string expected, ${m} found`)));for(let g=2;g<i.length;g++)m=Bi(i[g]),qn(i[1])==="$type"?_=_.concat(cp({key:`${a}[${g}]`,value:i[g],valueSpec:d.geometry_type,style:n.style,styleSpec:n.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&_.push(new bt(`${a}[${g}]`,i[g],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let g=1;g<i.length;g++)_=_.concat(E2({key:`${a}[${g}]`,value:i[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":m=Bi(i[1]),i.length!==2?_.push(new bt(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):m!=="string"&&_.push(new bt(`${a}[1]`,i[1],`string expected, ${m} found`));break}return _}function I2(n,i){const a=n.key,d=n.validateSpec,m=n.style,_=n.styleSpec,g=n.value,l=n.objectKey,E=_[`${i}_${n.layerType}`];if(!E)return[];const k=l.match(/^(.*)-transition$/);if(i==="paint"&&k&&E[k[1]]&&E[k[1]].transition)return d({key:a,value:g,valueSpec:_.transition,style:m,styleSpec:_});const O=n.valueSpec||E[l];if(!O)return[new bt(a,g,`unknown property "${l}"`)];let $;if(Bi(g)==="string"&&$f(O)&&!O.tokens&&($=/^{([^}]+)}$/.exec(g)))return[new bt(a,g,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const X=[];return n.layerType==="symbol"&&(l==="text-field"&&m&&!m.glyphs&&X.push(new bt(a,g,'use of "text-field" requires a style "glyphs" property')),l==="text-font"&&Jy(Au(g))&&qn(g.type)==="identity"&&X.push(new bt(a,g,'"text-font" does not support identity functions'))),X.concat(d({key:n.key,value:g,valueSpec:O,style:m,styleSpec:_,expressionContext:"property",propertyType:i,propertyKey:l}))}function A2(n){return I2(n,"paint")}function L2(n){return I2(n,"layout")}function k2(n){let i=[];const a=n.value,d=n.key,m=n.style,_=n.styleSpec;if(Bi(a)!=="object")return[new bt(d,a,`object expected, ${Bi(a)} found`)];!a.type&&!a.ref&&i.push(new bt(d,a,'either "type" or "ref" is required'));let g=qn(a.type);const l=qn(a.ref);if(a.id){const E=qn(a.id);for(let k=0;k<n.arrayIndex;k++){const O=m.layers[k];qn(O.id)===E&&i.push(new bt(d,a.id,`duplicate layer id "${a.id}", previously used at line ${O.id.__line__}`))}}if("ref"in a){["type","source","source-layer","filter","layout"].forEach(k=>{k in a&&i.push(new bt(d,a[k],`"${k}" is prohibited for ref layers`))});let E;m.layers.forEach(k=>{qn(k.id)===l&&(E=k)}),E?E.ref?i.push(new bt(d,a.ref,"ref cannot reference another ref layer")):g=qn(E.type):i.push(new bt(d,a.ref,`ref layer "${l}" not found`))}else if(g!=="background")if(!a.source)i.push(new bt(d,a,'missing required property "source"'));else{const E=m.sources&&m.sources[a.source],k=E&&qn(E.type);E?k==="vector"&&g==="raster"?i.push(new bt(d,a.source,`layer "${a.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?i.push(new bt(d,a.source,`layer "${a.id}" requires a raster-dem source`)):k!=="raster-dem"&&g==="color-relief"?i.push(new bt(d,a.source,`layer "${a.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?i.push(new bt(d,a.source,`layer "${a.id}" requires a vector source`)):k==="vector"&&!a["source-layer"]?i.push(new bt(d,a,`layer "${a.id}" must specify a "source-layer"`)):k==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?i.push(new bt(d,a.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g==="line"&&a.paint&&a.paint["line-gradient"]&&(k!=="geojson"||!E.lineMetrics)&&i.push(new bt(d,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new bt(d,a.source,`source "${a.source}" not found`))}return i=i.concat(Ms({key:d,value:a,valueSpec:_.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*"(){return[]},type(){return n.validateSpec({key:`${d}.type`,value:a.type,valueSpec:_.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:a,objectKey:"type"})},filter:tv,layout(E){return Ms({layer:a,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*"(k){return L2(Df({layerType:g},k))}}})},paint(E){return Ms({layer:a,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*"(k){return A2(Df({layerType:g},k))}}})}}})),i}function Lu(n){const i=n.value,a=n.key,d=Bi(i);return d!=="string"?[new bt(a,i,`string expected, ${d} found`)]:[]}function xL(n){var i;const a=(i=n.sourceName)!==null&&i!==void 0?i:"",d=n.value,m=n.styleSpec,_=m.source_raster_dem,g=n.style;let l=[];const E=Bi(d);if(d===void 0)return l;if(E!=="object")return l.push(new bt("source_raster_dem",d,`object expected, ${E} found`)),l;const k=qn(d.encoding)==="custom",O=["redFactor","greenFactor","blueFactor","baseShift"],$=n.value.encoding?`"${n.value.encoding}"`:"Default";for(const X in d)!k&&O.includes(X)?l.push(new bt(X,d[X],`In "${a}": "${X}" is only valid when "encoding" is set to "custom". ${$} encoding found`)):_[X]?l=l.concat(n.validateSpec({key:X,value:d[X],valueSpec:_[X],validateSpec:n.validateSpec,style:g,styleSpec:m})):l.push(new bt(X,d[X],`unknown property "${X}"`));return l}const yb={promoteId:bL};function z2(n){const i=n.value,a=n.key,d=n.styleSpec,m=n.style,_=n.validateSpec;if(!i.type)return[new bt(a,i,'"type" is required')];const g=qn(i.type);let l;switch(g){case"vector":case"raster":return l=Ms({key:a,value:i,valueSpec:d[`source_${g.replace("-","_")}`],style:n.style,styleSpec:d,objectElementValidators:yb,validateSpec:_}),l;case"raster-dem":return l=xL({sourceName:a,value:i,style:n.style,styleSpec:d,validateSpec:_}),l;case"geojson":if(l=Ms({key:a,value:i,valueSpec:d.source_geojson,style:m,styleSpec:d,validateSpec:_,objectElementValidators:yb}),i.cluster)for(const E in i.clusterProperties){const[k,O]=i.clusterProperties[E],$=typeof k=="string"?[k,["accumulated"],["get",E]]:k;l.push(...Ah({key:`${a}.${E}.map`,value:O,expressionContext:"cluster-map"})),l.push(...Ah({key:`${a}.${E}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return l;case"video":return Ms({key:a,value:i,valueSpec:d.source_video,style:m,validateSpec:_,styleSpec:d});case"image":return Ms({key:a,value:i,valueSpec:d.source_image,style:m,validateSpec:_,styleSpec:d});case"canvas":return[new bt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cp({key:`${a}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bL({key:n,value:i}){if(Bi(i)==="string")return Lu({key:n,value:i});{const a=[];for(const d in i)a.push(...Lu({key:`${n}.${d}`,value:i[d]}));return a}}function R2(n){const i=n.value,a=n.styleSpec,d=a.light,m=n.style;let _=[];const g=Bi(i);if(i===void 0)return _;if(g!=="object")return _=_.concat([new bt("light",i,`object expected, ${g} found`)]),_;for(const l in i){const E=l.match(/^(.*)-transition$/);E&&d[E[1]]&&d[E[1]].transition?_=_.concat(n.validateSpec({key:l,value:i[l],valueSpec:a.transition,validateSpec:n.validateSpec,style:m,styleSpec:a})):d[l]?_=_.concat(n.validateSpec({key:l,value:i[l],valueSpec:d[l],validateSpec:n.validateSpec,style:m,styleSpec:a})):_=_.concat([new bt(l,i[l],`unknown property "${l}"`)])}return _}function D2(n){const i=n.value,a=n.styleSpec,d=a.sky,m=n.style,_=Bi(i);if(i===void 0)return[];if(_!=="object")return[new bt("sky",i,`object expected, ${_} found`)];let g=[];for(const l in i)d[l]?g=g.concat(n.validateSpec({key:l,value:i[l],valueSpec:d[l],style:m,styleSpec:a})):g=g.concat([new bt(l,i[l],`unknown property "${l}"`)]);return g}function O2(n){const i=n.value,a=n.styleSpec,d=a.terrain,m=n.style;let _=[];const g=Bi(i);if(i===void 0)return _;if(g!=="object")return _=_.concat([new bt("terrain",i,`object expected, ${g} found`)]),_;for(const l in i)d[l]?_=_.concat(n.validateSpec({key:l,value:i[l],valueSpec:d[l],validateSpec:n.validateSpec,style:m,styleSpec:a})):_=_.concat([new bt(l,i[l],`unknown property "${l}"`)]);return _}function wL(n){return Lu(n).length===0?[]:Ah(n)}function TL(n){return Lu(n).length===0?[]:Ah(n)}function SL(n){const i=n.key,a=n.value;if(Bi(a)==="array"){if(a.length<1||a.length>4)return[new bt(i,a,`padding requires 1 to 4 values; ${a.length} values found`)];const d={type:"number"};let m=[];for(let _=0;_<a.length;_++)m=m.concat(n.validateSpec({key:`${i}[${_}]`,value:a[_],validateSpec:n.validateSpec,valueSpec:d}));return m}else return Pm({key:i,value:a,valueSpec:{}})}function PL(n){const i=n.key,a=n.value;if(Bi(a)==="array"){const d={type:"number"};if(a.length<1)return[new bt(i,a,"array length at least 1 expected, length 0 found")];let m=[];for(let _=0;_<a.length;_++)m=m.concat(n.validateSpec({key:`${i}[${_}]`,value:a[_],validateSpec:n.validateSpec,valueSpec:d}));return m}else return Pm({key:i,value:a,valueSpec:{}})}function CL(n){const i=n.key,a=n.value;if(Bi(a)==="array"){if(a.length<1)return[new bt(i,a,"array length at least 1 expected, length 0 found")];let d=[];for(let m=0;m<a.length;m++)d=d.concat(ty({key:`${i}[${m}]`,value:a[m]}));return d}else return ty({key:i,value:a})}function ML(n){const i=n.key,a=n.value,d=Bi(a),m=n.styleSpec;if(d!=="array"||a.length<1||a.length%2!==0)return[new bt(i,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let g=0;g<a.length;g+=2)_=_.concat(cp({key:`${i}[${g}]`,value:a[g],valueSpec:m.layout_symbol["text-anchor"]})),_=_.concat(ev({key:`${i}[${g+1}]`,value:a[g+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:m}));return _}function F2(n){let i=[];const a=n.value,d=n.key;if(Array.isArray(a)){const m=[],_=[];for(const g in a){a[g].id&&m.includes(a[g].id)&&i.push(new bt(d,a,`all the sprites' ids must be unique, but ${a[g].id} is duplicated`)),m.push(a[g].id),a[g].url&&_.includes(a[g].url)&&i.push(new bt(d,a,`all the sprites' URLs must be unique, but ${a[g].url} is duplicated`)),_.push(a[g].url);const l={id:{type:"string",required:!0},url:{type:"string",required:!0}};i=i.concat(Ms({key:`${d}[${g}]`,value:a[g],valueSpec:l,validateSpec:n.validateSpec}))}return i}else return Lu({key:d,value:a})}function EL(n){const i=n.value,a=n.styleSpec,d=a.projection,m=n.style,_=Bi(i);if(i===void 0)return[];if(_!=="object")return[new bt("projection",i,`object expected, ${_} found`)];let g=[];for(const l in i)d[l]?g=g.concat(n.validateSpec({key:l,value:i[l],valueSpec:d[l],style:m,styleSpec:a})):g=g.concat([new bt(l,i[l],`unknown property "${l}"`)]);return g}function IL(n){const i=n.key;let a=n.value;a=a instanceof String?a.valueOf():a;const d=Bi(a);return d==="array"&&!LL(a)&&!AL(a)?[new bt(i,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]:["array","string"].includes(d)?[]:[new bt(i,a,`projection expected, invalid type "${d}" found`)]}function AL(n){return!!["interpolate","step","literal"].includes(n[0])}function LL(n){return Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"}function kL(n){return!!n&&n.constructor===Object}function B2(n){return kL(n.value)?[]:[new bt(n.key,n.value,`object expected, ${Bi(n.value)} found`)]}const vb={"*"(){return[]},array:ev,boolean:vL,number:Pm,color:ty,constants:C2,enum:cp,filter:tv,function:M2,layer:k2,object:Ms,source:z2,light:R2,sky:D2,terrain:O2,projection:EL,projectionDefinition:IL,string:Lu,formatted:wL,resolvedImage:TL,padding:SL,numberArray:PL,colorArray:CL,variableAnchorOffsetCollection:ML,sprite:F2,state:B2};function Vf(n){const i=n.value,a=n.valueSpec,d=n.styleSpec;return n.validateSpec=Vf,a.expression&&Jy(qn(i))?M2(n):a.expression&&T2(Au(i))?Ah(n):a.type&&vb[a.type]?vb[a.type](n):Ms(Df({},n,{valueSpec:a.type?d[a.type]:a}))}function N2(n){const i=n.value,a=n.key,d=Lu(n);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new bt(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new bt(a,i,'"glyphs" url must include a "{range}" token'))),d}function as(n,i=sA){let a=[];return a=a.concat(Vf({key:"",value:n,valueSpec:i.$root,styleSpec:i,style:n,validateSpec:Vf,objectElementValidators:{glyphs:N2,"*"(){return[]}}})),n.constants&&(a=a.concat(C2({key:"constants",value:n.constants}))),j2(a)}as.source=sa(oa(z2));as.sprite=sa(oa(F2));as.glyphs=sa(oa(N2));as.light=sa(oa(R2));as.sky=sa(oa(D2));as.terrain=sa(oa(O2));as.state=sa(oa(B2));as.layer=sa(oa(k2));as.filter=sa(oa(tv));as.paintProperty=sa(oa(A2));as.layoutProperty=sa(oa(L2));function oa(n){return function(i){return n({...i,validateSpec:Vf})}}function j2(n){return[].concat(n).sort((i,a)=>i.line-a.line)}function sa(n){return function(...i){return j2(n.apply(this,i))}}function xb(n){if(!n)return{style:Zd[Vd[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof n=="string"){const i=RL(n);return i.isValidStyle?{style:i.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:i.isValidJSON?{style:Zd[Vd[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:n.startsWith("http")?{style:n,requiresUrlMonitoring:!0,isFallback:!1}:n.toLowerCase().includes(".json")?{style:zL(n),requiresUrlMonitoring:!0,isFallback:!1}:{style:Bw(n),requiresUrlMonitoring:!0,isFallback:!1}}return n instanceof Nw?{style:n.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:n instanceof jw?{style:n.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:as(n).length===0?{style:n,requiresUrlMonitoring:!1,isFallback:!1}:{style:Zd[Vd[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function zL(n){try{return new URL(n).href}catch{}return new URL(n,location.origin).href}function RL(n){try{const i=JSON.parse(n),a=as(i);return{isValidJSON:!0,isValidStyle:a.length===0,styleObject:a.length===0?i:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Il(n,i,a){const d=window.document.createElement(n);return i!==void 0&&(d.className=i),a&&a.appendChild(d),d}function iv(n){n.parentNode&&n.parentNode.removeChild(n)}class DL{constructor(){Dt(this,"_map"),Dt(this,"_container"),Dt(this,"_terrainButton"),rI(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(i){return this._map=i,this._container=Il("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Il("button","maplibregl-ctrl-terrain",this._container),Il("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){iv(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class OL extends mI{constructor(i={}){super({showCompass:i.showCompass??!0,showZoom:i.showZoom??!0,visualizePitch:i.visualizePitch??!0}),Dt(this,"_rotateCompassArrow",()=>{const a=this._map.getBearing(),d=this._map.getPitch(),m=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(d*(Math.PI/180))**.5)}) rotateX(${Math.min(70,d)}deg) rotateZ(${-a}deg)`:`rotate(${-a}deg)`;this._compassIcon.style.transform=m}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",a=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}))}_createButton(i,a){const d=super._createButton(i,a);return d.clickFunction=a,d}}const bb=qt.Marker,wb=qt.LngLat,FL=qt.LngLatBounds;class BL extends gI{constructor(){super(...arguments),Dt(this,"lastUpdatedCenter",new wb(0,0)),Dt(this,"_updateCamera",i=>{var a;const d=new wb(i.coords.longitude,i.coords.latitude),m=i.coords.accuracy,_={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},g=this._map.getZoom();g>(((a=this.options.fitBoundsOptions)==null?void 0:a.maxZoom)??30)&&(_.zoom=g),this._map.fitBounds(FL.fromLngLat(d,m),_,{geolocateSource:!0});let l=!1;const E=()=>{l=!0};this._map.once("click",E),this._map.once("dblclick",E),this._map.once("dragstart",E),this._map.once("mousedown",E),this._map.once("touchstart",E),this._map.once("wheel",E),this._map.once("moveend",()=>{this._map.off("click",E),this._map.off("dblclick",E),this._map.off("dragstart",E),this._map.off("mousedown",E),this._map.off("touchstart",E),this._map.off("wheel",E),!l&&(this.lastUpdatedCenter=this._map.getCenter())})}),Dt(this,"_finishSetupUI",i=>{if(this._map){if(i===!1){const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Il("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bb({element:this._dotElement}),this._circleElement=Il("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bb({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",a=>{const d=a.originalEvent&&a.originalEvent.type==="resize",m=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!a.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!d&&m>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),Dt(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const i=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],a=this._map.project(i),d=this._map.unproject([a.x,a.y]),m=this._map.unproject([a.x+20,a.y]),_=d.distanceTo(m)/20,g=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var is,Na,mu,gu,Ps,xf,yo,U2,Cs,$2;class t_{constructor(i,a){du(this,yo),du(this,is),Dt(this,"map"),du(this,Na),du(this,mu),du(this,gu),du(this,Ps,!1),du(this,xf),i.style!==void 0&&vh(this,Ps,!0),vh(this,is,{zoomAdjust:-4,position:"top-right",...a,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...i,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...i.containerStyle??{}}}),i.lockZoom!==void 0&&(Zi(this,is).minZoom=i.lockZoom,Zi(this,is).maxZoom=i.lockZoom)}setStyle(i,a){Zi(this,Ps)||this.map.setStyle(i,a),ts(this,yo,Cs).call(this)}addLayer(i,a){return Zi(this,Ps)||this.map.addLayer(i,a),ts(this,yo,Cs).call(this),this.map}moveLayer(i,a){return Zi(this,Ps)||this.map.moveLayer(i,a),ts(this,yo,Cs).call(this),this.map}removeLayer(i){return Zi(this,Ps)||this.map.removeLayer(i),ts(this,yo,Cs).call(this),this}setLayerZoomRange(i,a,d){return Zi(this,Ps)||this.map.setLayerZoomRange(i,a,d),ts(this,yo,Cs).call(this),this}setFilter(i,a,d){return Zi(this,Ps)||this.map.setFilter(i,a,d),ts(this,yo,Cs).call(this),this}setPaintProperty(i,a,d,m){return Zi(this,Ps)||this.map.setPaintProperty(i,a,d,m),ts(this,yo,Cs).call(this),this}setLayoutProperty(i,a,d,m){return Zi(this,Ps)||this.map.setLayoutProperty(i,a,d,m),ts(this,yo,Cs).call(this),this}setGlyphs(i,a){return Zi(this,Ps)||this.map.setGlyphs(i,a),ts(this,yo,Cs).call(this),this}onAdd(i){vh(this,Na,i),vh(this,mu,Il("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[a,d]of Object.entries(Zi(this,is).containerStyle))Zi(this,mu).style.setProperty(a,d);return Zi(this,is).container=Zi(this,mu),Zi(this,is).zoom=i.getZoom()+Zi(this,is).zoomAdjust,this.map=new q2(Zi(this,is)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{ts(this,yo,U2).call(this,Zi(this,is).parentRect),vh(this,xf,ts(this,yo,$2).call(this))}),Zi(this,mu)}onRemove(){var i;(i=Zi(this,xf))==null||i.call(this),iv(Zi(this,mu))}}is=new WeakMap,Na=new WeakMap,mu=new WeakMap,gu=new WeakMap,Ps=new WeakMap,xf=new WeakMap,yo=new WeakSet,U2=function(n){n===void 0||n.linePaint===void 0&&n.fillPaint===void 0||(vh(this,gu,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Zi(this,gu)}),(n.lineLayout!==void 0||n.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...n.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...n.linePaint}}),n.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...n.fillPaint}}),ts(this,yo,Cs).call(this))},Cs=function(){if(Zi(this,gu)===void 0)return;const{devicePixelRatio:n}=window,i=Zi(this,Na).getCanvas(),a=i.width/n,d=i.height/n,m=Zi(this,Na).unproject.bind(Zi(this,Na)),_=m([0,0]),g=m([a,0]),l=m([0,d]),E=m([a,d]);Zi(this,gu).geometry.coordinates=[[l.toArray(),E.toArray(),g.toArray(),_.toArray(),l.toArray()]];const k=this.map.getSource("parentRect");k!==void 0&&k.setData(Zi(this,gu))},$2=function(){const{pitchAdjust:n}=Zi(this,is),i=()=>{_("parent")},a=()=>{_("minimap")},d=()=>{Zi(this,Na).on("move",i),this.map.on("move",a)},m=()=>{Zi(this,Na).off("move",i),this.map.off("move",a)},_=g=>{m();const l=g==="parent"?Zi(this,Na):this.map,E=g==="parent"?this.map:Zi(this,Na),k=l.getCenter(),O=l.getZoom()+Zi(this,is).zoomAdjust*(g==="parent"?1:-1),$=l.getBearing(),X=l.getPitch();E.jumpTo({center:k,zoom:O,bearing:$,pitch:n?X:0}),ts(this,yo,Cs).call(this),d()};return d(),()=>{m()}};class NL{constructor(){Dt(this,"map"),Dt(this,"container"),Dt(this,"projectionButton")}onAdd(i){return this.map=i,this.container=Il("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Il("button","maplibregl-ctrl-projection",this.container),Il("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),i.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){iv(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}const jL="3.6.0",UL={version:jL};class $L{constructor(i,a=2e3){Dt(this,"map"),Dt(this,"registeredModules",new Set),this.map=i,setTimeout(async()=>{if(!Zn.telemetry)return;const d=this.preparePayload();try{(await fetch(d,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(m){console.warn("The metrics could not be sent to MapTiler Cloud",m)}},Math.max(1e3,a))}registerModule(i,a){this.registeredModules.add(`${i}:${a}`)}preparePayload(){const i=new URL(vo.telemetryURL);return i.searchParams.append("sdk",UL.version),i.searchParams.append("key",Zn.apiKey),i.searchParams.append("mtsid",Ry),i.searchParams.append("session",Zn.session?"1":"0"),i.searchParams.append("caching",Zn.caching?"1":"0"),i.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),i.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),i.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&i.searchParams.append("modules",Array.from(this.registeredModules).join("|")),i.href}}var up=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,i=arguments.length;i--;)n+=arguments[i]*arguments[i];return Math.sqrt(n)});function Hd(){var n=new up(16);return up!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function VL(n,i,a,d,m,_,g,l,E,k,O,$,X,q,te,ce,Ce){return n[0]=i,n[1]=a,n[2]=d,n[3]=m,n[4]=_,n[5]=g,n[6]=l,n[7]=E,n[8]=k,n[9]=O,n[10]=$,n[11]=X,n[12]=q,n[13]=te,n[14]=ce,n[15]=Ce,n}function ZL(n,i,a){var d=i[0],m=i[1],_=i[2],g=i[3],l=i[4],E=i[5],k=i[6],O=i[7],$=i[8],X=i[9],q=i[10],te=i[11],ce=i[12],Ce=i[13],ze=i[14],Ue=i[15],Fe=a[0],xe=a[1],be=a[2],ke=a[3];return n[0]=Fe*d+xe*l+be*$+ke*ce,n[1]=Fe*m+xe*E+be*X+ke*Ce,n[2]=Fe*_+xe*k+be*q+ke*ze,n[3]=Fe*g+xe*O+be*te+ke*Ue,Fe=a[4],xe=a[5],be=a[6],ke=a[7],n[4]=Fe*d+xe*l+be*$+ke*ce,n[5]=Fe*m+xe*E+be*X+ke*Ce,n[6]=Fe*_+xe*k+be*q+ke*ze,n[7]=Fe*g+xe*O+be*te+ke*Ue,Fe=a[8],xe=a[9],be=a[10],ke=a[11],n[8]=Fe*d+xe*l+be*$+ke*ce,n[9]=Fe*m+xe*E+be*X+ke*Ce,n[10]=Fe*_+xe*k+be*q+ke*ze,n[11]=Fe*g+xe*O+be*te+ke*Ue,Fe=a[12],xe=a[13],be=a[14],ke=a[15],n[12]=Fe*d+xe*l+be*$+ke*ce,n[13]=Fe*m+xe*E+be*X+ke*Ce,n[14]=Fe*_+xe*k+be*q+ke*ze,n[15]=Fe*g+xe*O+be*te+ke*Ue,n}function qL(n,i,a){var d=a[0],m=a[1],_=a[2];return n[0]=i[0]*d,n[1]=i[1]*d,n[2]=i[2]*d,n[3]=i[3]*d,n[4]=i[4]*m,n[5]=i[5]*m,n[6]=i[6]*m,n[7]=i[7]*m,n[8]=i[8]*_,n[9]=i[9]*_,n[10]=i[10]*_,n[11]=i[11]*_,n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n}function Tb(n,i,a){var d=Math.sin(a),m=Math.cos(a),_=i[4],g=i[5],l=i[6],E=i[7],k=i[8],O=i[9],$=i[10],X=i[11];return i!==n&&(n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15]),n[4]=_*m+k*d,n[5]=g*m+O*d,n[6]=l*m+$*d,n[7]=E*m+X*d,n[8]=k*m-_*d,n[9]=O*m-g*d,n[10]=$*m-l*d,n[11]=X*m-E*d,n}function GL(n,i,a){var d=Math.sin(a),m=Math.cos(a),_=i[0],g=i[1],l=i[2],E=i[3],k=i[8],O=i[9],$=i[10],X=i[11];return i!==n&&(n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15]),n[0]=_*m-k*d,n[1]=g*m-O*d,n[2]=l*m-$*d,n[3]=E*m-X*d,n[8]=_*d+k*m,n[9]=g*d+O*m,n[10]=l*d+$*m,n[11]=E*d+X*m,n}function Sb(n,i,a){var d=Math.sin(a),m=Math.cos(a),_=i[0],g=i[1],l=i[2],E=i[3],k=i[4],O=i[5],$=i[6],X=i[7];return i!==n&&(n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15]),n[0]=_*m+k*d,n[1]=g*m+O*d,n[2]=l*m+$*d,n[3]=E*m+X*d,n[4]=k*m-_*d,n[5]=O*m-g*d,n[6]=$*m-l*d,n[7]=X*m-E*d,n}function HL(n,i,a,d,m){var _=1/Math.tan(i/2),g;return n[0]=_/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,m!=null&&m!==1/0?(g=1/(d-m),n[10]=(m+d)*g,n[14]=2*m*d*g):(n[10]=-1,n[14]=-2*d),n}var WL=HL;function bf(){var n=new up(3);return up!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function KL(n,i,a){var d=new up(3);return d[0]=n,d[1]=i,d[2]=a,d}function i_(n,i){var a=i[0],d=i[1],m=i[2],_=a*a+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),n[0]=i[0]*_,n[1]=i[1]*_,n[2]=i[2]*_,n}function Pb(n,i,a){var d=i[0],m=i[1],_=i[2],g=a[0],l=a[1],E=a[2];return n[0]=m*E-_*l,n[1]=_*g-d*E,n[2]=d*l-m*g,n}(function(){var n=bf();return function(i,a,d,m,_,g){var l,E;for(a||(a=3),d||(d=0),m?E=Math.min(m*a+d,i.length):E=i.length,l=d;l<E;l+=a)n[0]=i[l],n[1]=i[l+1],n[2]=i[l+2],_(n,n,g),i[l]=n[0],i[l+1]=n[1],i[l+2]=n[2];return i}})();function XL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cb,Mb;function YL(){return Mb||(Mb=1,Cb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Cb}var n_,Eb;function V2(){if(Eb)return n_;Eb=1;const n=YL(),i={};for(const m of Object.keys(n))i[n[m]]=m;const a={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};n_=a;for(const m of Object.keys(a)){if(!("channels"in a[m]))throw new Error("missing channels property: "+m);if(!("labels"in a[m]))throw new Error("missing channel labels property: "+m);if(a[m].labels.length!==a[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:_,labels:g}=a[m];delete a[m].channels,delete a[m].labels,Object.defineProperty(a[m],"channels",{value:_}),Object.defineProperty(a[m],"labels",{value:g})}a.rgb.hsl=function(m){const _=m[0]/255,g=m[1]/255,l=m[2]/255,E=Math.min(_,g,l),k=Math.max(_,g,l),O=k-E;let $,X;k===E?$=0:_===k?$=(g-l)/O:g===k?$=2+(l-_)/O:l===k&&($=4+(_-g)/O),$=Math.min($*60,360),$<0&&($+=360);const q=(E+k)/2;return k===E?X=0:q<=.5?X=O/(k+E):X=O/(2-k-E),[$,X*100,q*100]},a.rgb.hsv=function(m){let _,g,l,E,k;const O=m[0]/255,$=m[1]/255,X=m[2]/255,q=Math.max(O,$,X),te=q-Math.min(O,$,X),ce=function(Ce){return(q-Ce)/6/te+1/2};return te===0?(E=0,k=0):(k=te/q,_=ce(O),g=ce($),l=ce(X),O===q?E=l-g:$===q?E=1/3+_-l:X===q&&(E=2/3+g-_),E<0?E+=1:E>1&&(E-=1)),[E*360,k*100,q*100]},a.rgb.hwb=function(m){const _=m[0],g=m[1];let l=m[2];const E=a.rgb.hsl(m)[0],k=1/255*Math.min(_,Math.min(g,l));return l=1-1/255*Math.max(_,Math.max(g,l)),[E,k*100,l*100]},a.rgb.cmyk=function(m){const _=m[0]/255,g=m[1]/255,l=m[2]/255,E=Math.min(1-_,1-g,1-l),k=(1-_-E)/(1-E)||0,O=(1-g-E)/(1-E)||0,$=(1-l-E)/(1-E)||0;return[k*100,O*100,$*100,E*100]};function d(m,_){return(m[0]-_[0])**2+(m[1]-_[1])**2+(m[2]-_[2])**2}return a.rgb.keyword=function(m){const _=i[m];if(_)return _;let g=1/0,l;for(const E of Object.keys(n)){const k=n[E],O=d(m,k);O<g&&(g=O,l=E)}return l},a.keyword.rgb=function(m){return n[m]},a.rgb.xyz=function(m){let _=m[0]/255,g=m[1]/255,l=m[2]/255;_=_>.04045?((_+.055)/1.055)**2.4:_/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;const E=_*.4124+g*.3576+l*.1805,k=_*.2126+g*.7152+l*.0722,O=_*.0193+g*.1192+l*.9505;return[E*100,k*100,O*100]},a.rgb.lab=function(m){const _=a.rgb.xyz(m);let g=_[0],l=_[1],E=_[2];g/=95.047,l/=100,E/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;const k=116*l-16,O=500*(g-l),$=200*(l-E);return[k,O,$]},a.hsl.rgb=function(m){const _=m[0]/360,g=m[1]/100,l=m[2]/100;let E,k,O;if(g===0)return O=l*255,[O,O,O];l<.5?E=l*(1+g):E=l+g-l*g;const $=2*l-E,X=[0,0,0];for(let q=0;q<3;q++)k=_+1/3*-(q-1),k<0&&k++,k>1&&k--,6*k<1?O=$+(E-$)*6*k:2*k<1?O=E:3*k<2?O=$+(E-$)*(2/3-k)*6:O=$,X[q]=O*255;return X},a.hsl.hsv=function(m){const _=m[0];let g=m[1]/100,l=m[2]/100,E=g;const k=Math.max(l,.01);l*=2,g*=l<=1?l:2-l,E*=k<=1?k:2-k;const O=(l+g)/2,$=l===0?2*E/(k+E):2*g/(l+g);return[_,$*100,O*100]},a.hsv.rgb=function(m){const _=m[0]/60,g=m[1]/100;let l=m[2]/100;const E=Math.floor(_)%6,k=_-Math.floor(_),O=255*l*(1-g),$=255*l*(1-g*k),X=255*l*(1-g*(1-k));switch(l*=255,E){case 0:return[l,X,O];case 1:return[$,l,O];case 2:return[O,l,X];case 3:return[O,$,l];case 4:return[X,O,l];case 5:return[l,O,$]}},a.hsv.hsl=function(m){const _=m[0],g=m[1]/100,l=m[2]/100,E=Math.max(l,.01);let k,O;O=(2-g)*l;const $=(2-g)*E;return k=g*E,k/=$<=1?$:2-$,k=k||0,O/=2,[_,k*100,O*100]},a.hwb.rgb=function(m){const _=m[0]/360;let g=m[1]/100,l=m[2]/100;const E=g+l;let k;E>1&&(g/=E,l/=E);const O=Math.floor(6*_),$=1-l;k=6*_-O,O&1&&(k=1-k);const X=g+k*($-g);let q,te,ce;switch(O){default:case 6:case 0:q=$,te=X,ce=g;break;case 1:q=X,te=$,ce=g;break;case 2:q=g,te=$,ce=X;break;case 3:q=g,te=X,ce=$;break;case 4:q=X,te=g,ce=$;break;case 5:q=$,te=g,ce=X;break}return[q*255,te*255,ce*255]},a.cmyk.rgb=function(m){const _=m[0]/100,g=m[1]/100,l=m[2]/100,E=m[3]/100,k=1-Math.min(1,_*(1-E)+E),O=1-Math.min(1,g*(1-E)+E),$=1-Math.min(1,l*(1-E)+E);return[k*255,O*255,$*255]},a.xyz.rgb=function(m){const _=m[0]/100,g=m[1]/100,l=m[2]/100;let E,k,O;return E=_*3.2406+g*-1.5372+l*-.4986,k=_*-.9689+g*1.8758+l*.0415,O=_*.0557+g*-.204+l*1.057,E=E>.0031308?1.055*E**(1/2.4)-.055:E*12.92,k=k>.0031308?1.055*k**(1/2.4)-.055:k*12.92,O=O>.0031308?1.055*O**(1/2.4)-.055:O*12.92,E=Math.min(Math.max(0,E),1),k=Math.min(Math.max(0,k),1),O=Math.min(Math.max(0,O),1),[E*255,k*255,O*255]},a.xyz.lab=function(m){let _=m[0],g=m[1],l=m[2];_/=95.047,g/=100,l/=108.883,_=_>.008856?_**(1/3):7.787*_+16/116,g=g>.008856?g**(1/3):7.787*g+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;const E=116*g-16,k=500*(_-g),O=200*(g-l);return[E,k,O]},a.lab.xyz=function(m){const _=m[0],g=m[1],l=m[2];let E,k,O;k=(_+16)/116,E=g/500+k,O=k-l/200;const $=k**3,X=E**3,q=O**3;return k=$>.008856?$:(k-16/116)/7.787,E=X>.008856?X:(E-16/116)/7.787,O=q>.008856?q:(O-16/116)/7.787,E*=95.047,k*=100,O*=108.883,[E,k,O]},a.lab.lch=function(m){const _=m[0],g=m[1],l=m[2];let E;E=Math.atan2(l,g)*360/2/Math.PI,E<0&&(E+=360);const k=Math.sqrt(g*g+l*l);return[_,k,E]},a.lch.lab=function(m){const _=m[0],g=m[1],l=m[2]/360*2*Math.PI,E=g*Math.cos(l),k=g*Math.sin(l);return[_,E,k]},a.rgb.ansi16=function(m,_=null){const[g,l,E]=m;let k=_===null?a.rgb.hsv(m)[2]:_;if(k=Math.round(k/50),k===0)return 30;let O=30+(Math.round(E/255)<<2|Math.round(l/255)<<1|Math.round(g/255));return k===2&&(O+=60),O},a.hsv.ansi16=function(m){return a.rgb.ansi16(a.hsv.rgb(m),m[2])},a.rgb.ansi256=function(m){const _=m[0],g=m[1],l=m[2];return _===g&&g===l?_<8?16:_>248?231:Math.round((_-8)/247*24)+232:16+36*Math.round(_/255*5)+6*Math.round(g/255*5)+Math.round(l/255*5)},a.ansi16.rgb=function(m){let _=m%10;if(_===0||_===7)return m>50&&(_+=3.5),_=_/10.5*255,[_,_,_];const g=(~~(m>50)+1)*.5,l=(_&1)*g*255,E=(_>>1&1)*g*255,k=(_>>2&1)*g*255;return[l,E,k]},a.ansi256.rgb=function(m){if(m>=232){const k=(m-232)*10+8;return[k,k,k]}m-=16;let _;const g=Math.floor(m/36)/5*255,l=Math.floor((_=m%36)/6)/5*255,E=_%6/5*255;return[g,l,E]},a.rgb.hex=function(m){const _=(((Math.round(m[0])&255)<<16)+((Math.round(m[1])&255)<<8)+(Math.round(m[2])&255)).toString(16).toUpperCase();return"000000".substring(_.length)+_},a.hex.rgb=function(m){const _=m.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!_)return[0,0,0];let g=_[0];_[0].length===3&&(g=g.split("").map($=>$+$).join(""));const l=parseInt(g,16),E=l>>16&255,k=l>>8&255,O=l&255;return[E,k,O]},a.rgb.hcg=function(m){const _=m[0]/255,g=m[1]/255,l=m[2]/255,E=Math.max(Math.max(_,g),l),k=Math.min(Math.min(_,g),l),O=E-k;let $,X;return O<1?$=k/(1-O):$=0,O<=0?X=0:E===_?X=(g-l)/O%6:E===g?X=2+(l-_)/O:X=4+(_-g)/O,X/=6,X%=1,[X*360,O*100,$*100]},a.hsl.hcg=function(m){const _=m[1]/100,g=m[2]/100,l=g<.5?2*_*g:2*_*(1-g);let E=0;return l<1&&(E=(g-.5*l)/(1-l)),[m[0],l*100,E*100]},a.hsv.hcg=function(m){const _=m[1]/100,g=m[2]/100,l=_*g;let E=0;return l<1&&(E=(g-l)/(1-l)),[m[0],l*100,E*100]},a.hcg.rgb=function(m){const _=m[0]/360,g=m[1]/100,l=m[2]/100;if(g===0)return[l*255,l*255,l*255];const E=[0,0,0],k=_%1*6,O=k%1,$=1-O;let X=0;switch(Math.floor(k)){case 0:E[0]=1,E[1]=O,E[2]=0;break;case 1:E[0]=$,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=O;break;case 3:E[0]=0,E[1]=$,E[2]=1;break;case 4:E[0]=O,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=$}return X=(1-g)*l,[(g*E[0]+X)*255,(g*E[1]+X)*255,(g*E[2]+X)*255]},a.hcg.hsv=function(m){const _=m[1]/100,g=m[2]/100,l=_+g*(1-_);let E=0;return l>0&&(E=_/l),[m[0],E*100,l*100]},a.hcg.hsl=function(m){const _=m[1]/100,g=m[2]/100*(1-_)+.5*_;let l=0;return g>0&&g<.5?l=_/(2*g):g>=.5&&g<1&&(l=_/(2*(1-g))),[m[0],l*100,g*100]},a.hcg.hwb=function(m){const _=m[1]/100,g=m[2]/100,l=_+g*(1-_);return[m[0],(l-_)*100,(1-l)*100]},a.hwb.hcg=function(m){const _=m[1]/100,g=1-m[2]/100,l=g-_;let E=0;return l<1&&(E=(g-l)/(1-l)),[m[0],l*100,E*100]},a.apple.rgb=function(m){return[m[0]/65535*255,m[1]/65535*255,m[2]/65535*255]},a.rgb.apple=function(m){return[m[0]/255*65535,m[1]/255*65535,m[2]/255*65535]},a.gray.rgb=function(m){return[m[0]/100*255,m[0]/100*255,m[0]/100*255]},a.gray.hsl=function(m){return[0,0,m[0]]},a.gray.hsv=a.gray.hsl,a.gray.hwb=function(m){return[0,100,m[0]]},a.gray.cmyk=function(m){return[0,0,0,m[0]]},a.gray.lab=function(m){return[m[0],0,0]},a.gray.hex=function(m){const _=Math.round(m[0]/100*255)&255,g=((_<<16)+(_<<8)+_).toString(16).toUpperCase();return"000000".substring(g.length)+g},a.rgb.gray=function(m){return[(m[0]+m[1]+m[2])/3/255*100]},n_}var r_,Ib;function JL(){if(Ib)return r_;Ib=1;const n=V2();function i(){const _={},g=Object.keys(n);for(let l=g.length,E=0;E<l;E++)_[g[E]]={distance:-1,parent:null};return _}function a(_){const g=i(),l=[_];for(g[_].distance=0;l.length;){const E=l.pop(),k=Object.keys(n[E]);for(let O=k.length,$=0;$<O;$++){const X=k[$],q=g[X];q.distance===-1&&(q.distance=g[E].distance+1,q.parent=E,l.unshift(X))}}return g}function d(_,g){return function(l){return g(_(l))}}function m(_,g){const l=[g[_].parent,_];let E=n[g[_].parent][_],k=g[_].parent;for(;g[k].parent;)l.unshift(g[k].parent),E=d(n[g[k].parent][k],E),k=g[k].parent;return E.conversion=l,E}return r_=function(_){const g=a(_),l={},E=Object.keys(g);for(let k=E.length,O=0;O<k;O++){const $=E[O];g[$].parent!==null&&(l[$]=m($,g))}return l},r_}var o_,Ab;function QL(){if(Ab)return o_;Ab=1;const n=V2(),i=JL(),a={},d=Object.keys(n);function m(g){const l=function(...E){const k=E[0];return k==null?k:(k.length>1&&(E=k),g(E))};return"conversion"in g&&(l.conversion=g.conversion),l}function _(g){const l=function(...E){const k=E[0];if(k==null)return k;k.length>1&&(E=k);const O=g(E);if(typeof O=="object")for(let $=O.length,X=0;X<$;X++)O[X]=Math.round(O[X]);return O};return"conversion"in g&&(l.conversion=g.conversion),l}return d.forEach(g=>{a[g]={},Object.defineProperty(a[g],"channels",{value:n[g].channels}),Object.defineProperty(a[g],"labels",{value:n[g].labels});const l=i(g);Object.keys(l).forEach(E=>{const k=l[E];a[g][E]=_(k),a[g][E].raw=m(k)})}),o_=a,o_}var ek=QL();const tk=XL(ek);function Lb({gl:n,type:i,source:a}){const d=n.createShader(i);if(d===null)throw new Error("Cannot create shader");if(n.shaderSource(d,a),n.compileShader(d),!n.getShaderParameter(d,n.COMPILE_STATUS))throw console.error("Shader compilation error:",n.getShaderInfoLog(d)),n.deleteShader(d),new Error("Cannot compile shader");return d}function ik({gl:n,vertexShaderSource:i,fragmentShaderSource:a}){const d=Lb({gl:n,type:n.VERTEX_SHADER,source:i}),m=Lb({gl:n,type:n.FRAGMENT_SHADER,source:a}),_=n.createProgram();if(n.attachShader(_,d),n.attachShader(_,m),n.linkProgram(_),!n.getProgramParameter(_,n.LINK_STATUS))throw console.error("Error: ",n.getProgramInfoLog(_)),new Error("Cannot link shader program");return _}function nk(n,i,a){const d=n.getUniformLocation(i,a);if(d===null)throw new Error(`Cannot get uniform location for ${a}`);return d}function Z2({gl:n,vertexShaderSource:i,fragmentShaderSource:a,attributesKeys:d,uniformsKeys:m,vertices:_,indices:g}){const l=ik({gl:n,vertexShaderSource:i,fragmentShaderSource:a}),E=d.reduce((q,te)=>(q[te]=n.getAttribLocation(l,`a_${te}`),q),{}),k=m.reduce((q,te)=>(q[te]=nk(n,l,`u_${te}`),q),{}),O=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,O),n.bufferData(n.ARRAY_BUFFER,new Float32Array(_),n.STATIC_DRAW);let $,X;return g!==void 0&&($=n.createBuffer(),X=g.length,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),n.STATIC_DRAW)),{shaderProgram:l,programInfo:{attributesLocations:E,uniformsLocations:k},positionBuffer:O,indexBuffer:$,indexBufferLength:X}}function wf(n){if(!n)return[1,1,1,0];if(n==="transparent")return[1,1,1,0];try{const i=rk(n),a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(i);if(a!=null&&a.length){const m=!!a[4];return[...tk.hex.rgb(i).map(_=>_/255),m?parseInt(a[4],16)/255:1]}const d=i.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(i.includes("rgb")){const m=i.includes("rgba"),_=[...d.map(g=>parseFloat(g)).map((g,l)=>l<3?g/255:g)];return m||_.push(1),_}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${n} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let Md;function rk(n){return Md=Md??document.createElement("canvas").getContext("2d"),Md?(Md.fillStyle=n,Md.fillStyle):"#000000"}const nv=1,Es=nv/2,Is=nv/2,As=nv/2,ok=[-.5,-.5,As,Es,-.5,As,Es,Is,As,-.5,Is,As],sk=[-.5,-.5,-.5,-.5,Is,-.5,Es,Is,-.5,Es,-.5,-.5],ak=[-.5,Is,-.5,-.5,Is,As,Es,Is,As,Es,Is,-.5],lk=[-.5,-.5,-.5,Es,-.5,-.5,Es,-.5,As,-.5,-.5,As],ck=[Es,-.5,-.5,Es,Is,-.5,Es,Is,As,Es,-.5,As],uk=[-.5,-.5,-.5,-.5,-.5,As,-.5,Is,As,-.5,Is,-.5],hk=[...ok,...sk,...ak,...lk,...ck,...uk],dk=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],pk=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,kb=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Eh={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var _u=(n=>(n.POSITIVE_X="pX",n.NEGATIVE_X="nX",n.POSITIVE_Y="pY",n.NEGATIVE_Y="nY",n.POSITIVE_Z="pZ",n.NEGATIVE_Z="nZ",n))(_u||{});let hf,zb,Rb;function fk({gl:n,faces:i,onReady:a,forceRefresh:d}){hf&&!d&&Rb===JSON.stringify(i)&&a(hf,zb),Rb=JSON.stringify(i);const m=hf??n.createTexture();if(n.bindTexture(n.TEXTURE_CUBE_MAP,m),!i){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const _=Object.keys(i).length;if(_!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${_}`);return}const g=Object.entries(i).map(([l,E])=>new Promise((k,O)=>{const $=l;if(E===void 0){O(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${l} is undefined`));return}const X=new Image;X.crossOrigin="anonymous";const q=()=>{k({image:X,key:$})};X.src=E,X.complete&&X.naturalWidth>0?q():X.onload=q,X.onerror=()=>{O(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${E}`))}}));Promise.all(g).then(l=>{for(let k=0;k<l.length;k++){const O=n.RGBA,$=n.RGBA,X=n.UNSIGNED_BYTE,{image:q,key:te}=l[k]??{};if(!q||!te){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const ce=mk(n,te);n.bindTexture(n.TEXTURE_CUBE_MAP,m),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(ce,0,O,$,X,q)}n.bindTexture(n.TEXTURE_CUBE_MAP,m),n.generateMipmap(n.TEXTURE_CUBE_MAP),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);const E=l.map(k=>k.image);a(m,E),zb=E,hf=m}).catch(l=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",l)})}function mk(n,i){if(i===_u.POSITIVE_X)return n.TEXTURE_CUBE_MAP_POSITIVE_X;if(i===_u.NEGATIVE_X)return n.TEXTURE_CUBE_MAP_NEGATIVE_X;if(i===_u.POSITIVE_Y)return n.TEXTURE_CUBE_MAP_POSITIVE_Y;if(i===_u.NEGATIVE_Y)return n.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(i===_u.POSITIVE_Z)return n.TEXTURE_CUBE_MAP_POSITIVE_Z;if(i===_u.NEGATIVE_Z)return n.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${i}`)}function gk(n,i,a){return[_c(n[0],i[0],a),_c(n[1],i[1],a),_c(n[2],i[2],a),_c(n[3],i[3],a)]}function _c(n,i,a){return n+(i-n)*a}const gh="https://api.maptiler.com/resources/space",_k=["vertexPosition"],yk=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],Db="%USE_TEXTURE_MACRO_MARKER%",vk="#define USE_TEXTURE",xk=Eh.stars;function bk(n,i){if(n===!0)return i;const a={...n};if(n.faces||n.path)return delete a.preset,a;const d=n.preset;if(d!==void 0&&!(d in Eh))throw new Error(`[CubemapLayer]: Invalid preset "${d}". Available presets: ${Object.keys(Eh).join(", ")}`);return{...a,color:a.color??Eh[d].color??"hsl(233,100%,92%)"}}class s_{constructor(i){Dt(this,"id","Cubemap Layer"),Dt(this,"type","custom"),Dt(this,"renderingMode","3d"),Dt(this,"map"),Dt(this,"faces"),Dt(this,"useCubemapTexture",!0),Dt(this,"currentFadeOpacity",0),Dt(this,"cubeMapNeedsUpdate",!1),Dt(this,"bgColor"),Dt(this,"previousBgColor",[0,0,0,0]),Dt(this,"targetBgColor",[0,0,0,0]),Dt(this,"transitionDelta",0),Dt(this,"gl"),Dt(this,"cubemap"),Dt(this,"texture"),Dt(this,"currentFacesDefinitionKey",""),Dt(this,"options"),Dt(this,"imageIsAnimating",!1),Dt(this,"imageFadeInDelta",0);const a=bk(i,xk);this.options=a,this.currentFacesDefinitionKey=JSON.stringify(a.faces??a.preset??a.path),this.bgColor=[0,0,0,0],this.targetBgColor=wf(a.color),this.faces=Ob(a),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:i}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const a=yk.filter(d=>d==="cubeSampler"||d==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=Z2({gl:this.gl,vertexShaderSource:pk,fragmentShaderSource:this.useCubemapTexture?kb.replace(Db,vk):kb.replace(Db,""),attributesKeys:_k,uniformsKeys:a,vertices:hk,indices:dk}),this.cubeMapNeedsUpdate=i,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(i,a){this.map=i,this.gl=a,this.updateCubemap()}onRemove(i,a){this.cubemap&&(a.deleteProgram(this.cubemap.shaderProgram),a.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(i,a){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;fk({gl:i,faces:a,onReady:d=>{this.texture=d,this.animateIn()}})}}prerender(i,a){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const i=()=>{this.transitionDelta<1&&(requestAnimationFrame(i),this.bgColor=gk(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(i)}animateIn(){if(this.imageIsAnimating)return;this.imageIsAnimating=!0;const i=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=_c(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(i);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0};requestAnimationFrame(i)}animateOut(){return this.imageIsAnimating?Promise.resolve():new Promise(i=>{const a=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=_c(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,i();return}requestAnimationFrame(a)};requestAnimationFrame(a)})}render(i,a){if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.DST_ALPHA),i.useProgram(this.cubemap.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,this.cubemap.positionBuffer),i.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const d=.1,m=1e4,_=i.canvas,g=_.clientWidth/_.clientHeight,l=this.map.transform,E=l.fov*(Math.PI/180),k=Hd();WL(k,E,g,d,m),Sb(k,k,l.rollInRadians),Tb(k,k,-l.pitchInRadians),Sb(k,k,l.bearingInRadians);const O=l.center.lat*Math.PI/180,$=l.center.lng*Math.PI/180;Tb(k,k,O),GL(k,k,-$),i.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,k);const X=Hd();if(i.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,X),i.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),i.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_CUBE_MAP,this.texture),i.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),i.drawElements(i.TRIANGLES,this.cubemap.indexBufferLength,i.UNSIGNED_SHORT,0)}setBgColor(i){this.targetBgColor=i,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(i){if(await this.animateOut(),!i.faces&&!i.preset&&!i.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",this.animateIn();return}this.faces=Ob(i),this.currentFacesDefinitionKey=JSON.stringify(i.faces??i.preset??i.path)}async setCubemap(i){this.options=i;const a=JSON.stringify(i.faces??i.preset??i.path),d=this.currentFacesDefinitionKey!==a;d&&(await this.setCubemapFaces(i),this.cubeMapNeedsUpdate=!0);const m=wf(i.color);if(i.color&&this.targetBgColor.toString()!==m.toString())this.setBgColor(m);else if(!i.color&&i.preset&&i.preset in Eh){const _=Eh[i.preset];this.setBgColor(wf(_.color))}this.updateCubemap({facesNeedUpdate:d})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function Ob(n){if(n.faces)return n.faces;if(n.preset)return{pX:`${gh}/${n.preset}/px.webp`,nX:`${gh}/${n.preset}/nx.webp`,pY:`${gh}/${n.preset}/py.webp`,nY:`${gh}/${n.preset}/ny.webp`,pZ:`${gh}/${n.preset}/pz.webp`,nZ:`${gh}/${n.preset}/nz.webp`};if(n.path){const i=n.path.baseUrl,a=n.path.format??"png";return{pX:`${i}/px.${a}`,nX:`${i}/nx.${a}`,pY:`${i}/py.${a}`,nY:`${i}/ny.${a}`,pZ:`${i}/pz.${a}`,nZ:`${i}/nz.${a}`}}return null}const wk=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,Tk=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

vec2 center = vec2(0.0, 0.0);
// TODO: We could look at implementing a color ramp instead.
// Render the color ramp to a canvas and then to a texture
// then select the color based on the distance from the center.
void main() {

  // QUASI SUCCESS
  // float distanceFromGlobeEdge = (distance(center, v_pos) - 2.0) / (sqrt(v_scale) * 1.05) + 1.0;
  // ORIGINAL
  // float distanceFromGlobeEdge = distance(center, v_pos) - 1.0; 
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastScaledStopPosition = u_stops[i - 1] * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,zd=2,Sk=["position"],Pk=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],Ck=[-2,-2,0,zd,-2,0,-2,zd,0,zd,zd,0],Fb={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},Bb=.06;class a_{constructor(i){if(Dt(this,"id","Halo Layer"),Dt(this,"type","custom"),Dt(this,"renderingMode","3d"),Dt(this,"gradient"),Dt(this,"scale",0),Dt(this,"animationDelta",0),Dt(this,"map"),Dt(this,"plane"),typeof i=="boolean"){this.gradient=Fb;return}this.gradient={...Fb,...i}}onAdd(i,a){this.map=i,this.plane=Z2({gl:a,vertexShaderSource:wk,fragmentShaderSource:Tk,attributesKeys:Sk,uniformsKeys:Pk,vertices:Ck}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){return new Promise(i=>{this.animationDelta=0;const a=()=>{if(this.animationDelta<1){this.scale=_c(0,this.gradient.scale,this.animationDelta),this.animationDelta+=Bb,this.map.triggerRepaint(),requestAnimationFrame(a);return}i()};a()})}async animateOut(){return this.animationDelta=0,new Promise(i=>{const a=()=>{if(this.animationDelta<1){this.scale=_c(this.gradient.scale,0,this.animationDelta),this.animationDelta+=Bb,this.map.triggerRepaint(),requestAnimationFrame(a);return}i()};a()})}onRemove(i,a){this.plane!==void 0&&(a.deleteProgram(this.plane.shaderProgram),a.deleteBuffer(this.plane.positionBuffer))}prerender(i,a){}render(i,a){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.useProgram(this.plane.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,this.plane.positionBuffer);const d=this.plane.programInfo.attributesLocations.position;i.enableVertexAttribArray(d),i.vertexAttribPointer(d,3,i.FLOAT,!1,0,0);const m=Hd(),_=this.scale;qL(m,m,[_,_,_]);const g=Hd();ZL(g,a.defaultProjectionData.mainMatrix,m);const l=this.plane.programInfo.uniformsLocations.matrix;i.uniformMatrix4fv(l,!1,g);const E=Hd(),k=this.map.transform.cameraPosition,O=i_(bf(),k),$=KL(0,1,0),X=bf();Pb(X,$,O),i_(X,X);const q=bf();Pb(q,O,X),i_(q,q),VL(E,X[0],X[1],X[2],0,q[0],q[1],q[2],0,O[0],O[1],O[2],0,0,0,0,1);const te=this.plane.programInfo.uniformsLocations.rotationMatrix;i.uniformMatrix4fv(te,!1,E);const ce=this.gradient.stops.length,Ce=[],ze=[];for(let Ue=0;Ue<=ce;Ue++)if(Ue<ce){Ce[Ue]=this.gradient.stops[Ue][0];const Fe=wf(this.gradient.stops[Ue][1]);ze.push(...Fe)}i.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,ce),i.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Ce)),i.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(ze)),i.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,zd),i.uniform1f(this.plane.programInfo.uniformsLocations.scale,_),i.drawArrays(i.TRIANGLE_STRIP,0,4)}async setGradient(i){await this.animateOut(),this.gradient=i,await this.animateIn()}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}const Mk={POINT:"POINT",COUNTRY:"COUNTRY"};let q2=class G2 extends qt.Map{constructor(i){aI(i.container),i.apiKey&&(Zn.apiKey=i.apiKey);const{style:a,requiresUrlMonitoring:d,isFallback:m}=xb(i.style);m&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Zn.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const _=location.hash;let g={compact:!1};i.customAttribution?g.customAttribution=i.customAttribution:i.attributionControl&&typeof i.attributionControl=="object"&&(g={...g,...i.attributionControl});const l={...i,style:a,maplibreLogo:!1,transformRequest:Yx(i.transformRequest),attributionControl:i.forceNoAttributionControl===!0?!1:g};delete l.style,super(l),Dt(this,"telemetry"),Dt(this,"space"),Dt(this,"halo"),Dt(this,"options"),Dt(this,"isTerrainEnabled",!1),Dt(this,"terrainExaggeration",1),Dt(this,"primaryLanguage"),Dt(this,"terrainGrowing",!1),Dt(this,"terrainFlattening",!1),Dt(this,"minimap"),Dt(this,"forceLanguageUpdate"),Dt(this,"languageAlwaysBeenStyle"),Dt(this,"isReady",!1),Dt(this,"terrainAnimationDuration",1e3),Dt(this,"monitoredStyleUrls"),Dt(this,"styleInProcess",!1),Dt(this,"curentProjection"),Dt(this,"originalLabelStyle",new window.Map),Dt(this,"isStyleLocalized",!1),Dt(this,"languageIsUpdated",!1),this.options=i,this.setStyle(a),d&&this.monitorStyleUrl(a);const E=()=>{let q="The distant style could not be loaded.";this.getStyle()?q+="Leaving the style as is.":(this.setStyle(Zd.STREETS),q+=`Loading default MapTiler Cloud style "${Zd.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(q)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",q=>{if(q.error instanceof qt.AJAXError){const te=q.error.url,ce=new URL(te);ce.search="";const Ce=ce.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Ce)&&(this.monitoredStyleUrls.delete(Ce),E());return}if(this.styleInProcess){E();return}}),Zn.caching&&!H_&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Zn.caching&&H_&&iI(),typeof i.language>"u")this.primaryLanguage=Zn.primaryLanguage;else{const q=Fx(i.language,Gi);this.primaryLanguage=q??Zn.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Gi.STYLE||this.primaryLanguage===Gi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Gi.STYLE,this.terrainExaggeration=i.terrainExaggeration??this.terrainExaggeration,this.curentProjection=i.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!i.geolocate||i.center||i.hash&&_)return;try{if(i.geolocate===Mk.COUNTRY){await this.fitToIpBounds();return}}catch(te){console.warn(te.message)}let q;try{await this.centerOnIpPoint(i.zoom),q=this.getCameraHash()}catch(te){console.warn(te.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(te=>{q===this.getCameraHash()&&(this.terrain?this.easeTo({center:[te.coords.longitude,te.coords.latitude],zoom:i.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[te.coords.longitude,te.coords.latitude],zoom:i.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let q={logo:null};try{const te=Object.keys(this.style.sourceCaches).map(Ce=>this.getSource(Ce)).filter(Ce=>Ce&&"url"in Ce&&typeof Ce.url=="string"&&Ce.url.includes("tiles.json")),ce=new URL(te[0].url);ce.searchParams.has("key")||ce.searchParams.append("key",Zn.apiKey),q=await(await fetch(ce.href)).json()}catch{}if(i.forceNoAttributionControl!==!0)if("logo"in q&&q.logo){const te=q.logo;this.addControl(new Qx({logoURL:te}),i.logoPosition)}else i.maptilerLogo&&this.addControl(new Qx,i.logoPosition);if(i.scaleControl){const te=i.scaleControl===!0||i.scaleControl===void 0?"bottom-right":i.scaleControl,ce=new yI({unit:Zn.unit});this.addControl(ce,te),Zn.on("unit",Ce=>{ce.setUnit(Ce)})}if(i.navigationControl!==!1){const te=i.navigationControl===!0||i.navigationControl===void 0?"top-right":i.navigationControl;this.addControl(new OL,te)}if(i.geolocateControl!==!1){const te=i.geolocateControl===!0||i.geolocateControl===void 0?"top-right":i.geolocateControl;this.addControl(new BL({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),te)}if(i.terrainControl){const te=i.terrainControl===!0||i.terrainControl===void 0?"top-right":i.terrainControl;this.addControl(new DL,te)}if(i.projectionControl){const te=i.projectionControl===!0||i.projectionControl===void 0?"top-right":i.projectionControl;this.addControl(new NL,te)}if(i.fullscreenControl){const te=i.fullscreenControl===!0||i.fullscreenControl===void 0?"top-right":i.fullscreenControl;this.addControl(new vI({}),te)}this.isReady=!0,this.fire("ready",{target:this})});let k=!1,O=!1,$;this.once("ready",()=>{k=!0,O&&this.fire("loadWithTerrain",$)}),this.once("style.load",()=>{const{minimap:q}=i;if(typeof q=="object"){const{zoom:te,center:ce,style:Ce,language:ze,apiKey:Ue,maptilerLogo:Fe,canvasContextAttributes:xe,refreshExpiredTiles:be,maxBounds:ke,scrollZoom:Qe,minZoom:tt,maxZoom:et,boxZoom:ht,locale:At,fadeDuration:lt,crossSourceCollisions:Et,clickTolerance:jt,bounds:Ni,fitBoundsOptions:ni,pixelRatio:ri,validateStyle:It}=i;this.minimap=new t_(q,{zoom:te,center:ce,style:Ce,language:ze,apiKey:Ue,container:"null",maptilerLogo:Fe,canvasContextAttributes:xe,refreshExpiredTiles:be,maxBounds:ke,scrollZoom:Qe,minZoom:tt,maxZoom:et,boxZoom:ht,locale:At,fadeDuration:lt,crossSourceCollisions:Et,clickTolerance:jt,bounds:Ni,fitBoundsOptions:ni,pixelRatio:ri,validateStyle:It}),this.addControl(this.minimap,q.position??"bottom-left")}else q===!0?(this.minimap=new t_({},i),this.addControl(this.minimap,"bottom-left")):q!==void 0&&q!==!1&&(this.minimap=new t_({},i),this.addControl(this.minimap,q))});const X=q=>{q.terrain&&(O=!0,$={type:"loadWithTerrain",target:this,terrain:q.terrain},this.off("terrain",X),k&&this.fire("loadWithTerrain",$))};this.on("terrain",X),i.terrain&&this.enableTerrain(i.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",te=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",te)});const q=this.getLayersOrder()[0];i.space&&this.initSpace({options:i,before:q}),i.halo&&this.initHalo({options:i,before:q})}),this.telemetry=new $L(this)}getSpace(){return this.space}setSpace(i){if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(i);return}this.space=new s_(i),this.once("load",()=>{const a=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,a)})}}setSpaceFromStyle({style:i}){var a,d,m;const _=(d=(a=i.metadata)==null?void 0:a.maptiler)==null?void 0:d.space;if(!_){this.setSpace({color:"transparent"});return}if(JSON.stringify((m=this.space)==null?void 0:m.getConfig())===JSON.stringify(_)){if(this.space&&!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}this.space.setCubemap(_)}})()}setHaloFromStyle({style:i}){var a,d,m;const _=(a=i.metadata)==null?void 0:a.maptiler;if(JSON.stringify((d=this.halo)==null?void 0:d.getConfig())===JSON.stringify(_?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const g=this.getLayersOrder().indexOf(((m=this.space)==null?void 0:m.id)??"")+1,l=this.getLayersOrder()[g];this.addLayer(this.halo,l)}return}if(!(_!=null&&_.halo)){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:0});return}(()=>{var g;if(this.halo){if(!this.getLayer(this.halo.id)){const l=this.getLayersOrder().indexOf(((g=this.space)==null?void 0:g.id)??"")+1,E=this.getLayersOrder()[l];this.addLayer(this.halo,E)}this.halo.setGradient(_.halo)}})()}initSpace({options:i=this.options,before:a,spec:d}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,a);return}if(i.space===!1)return;const m=d;if(i.space){this.space=new s_(i.space),this.addLayer(this.space,a);return}m&&(this.space=new s_(m),this.addLayer(this.space,a))}initHalo({options:i=this.options,before:a,spec:d}){if(this.halo&&this.getLayer(this.halo.id)||i.halo===!1)return;const m=d;if(i.halo){this.halo=new a_(i.halo),this.addLayer(this.halo,a);return}m&&(this.halo=new a_(m),this.addLayer(this.halo,a))}getHalo(){return this.halo}setHalo(i){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(i);return}this.halo=new a_(i),this.once("load",()=>{var a;const d=this.getLayersOrder(),m=d[0],_=d.indexOf(((a=this.space)==null?void 0:a.id)??"")+2,g=d[_];this.halo&&this.addLayer(this.halo,this.space?g:m)})}}recreate(){const i={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new G2({...this.options})),this.once("load",()=>{this.jumpTo(i)})}setTerrainAnimationDuration(i){this.terrainAnimationDuration=Math.max(i,0)}async onLoadAsync(){return new Promise(i=>{if(this.loaded()){i(this);return}this.once("load",()=>{i(this)})})}async onReadyAsync(){return new Promise(i=>{if(this.isReady){i(this);return}this.once("ready",()=>{i(this)})})}async onLoadWithTerrainAsync(){return new Promise(i=>{if(this.isReady&&this.terrain){i(this);return}this.once("loadWithTerrain",()=>{i(this)})})}monitorStyleUrl(i){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const a=new URL(i);a.search="",this.monitoredStyleUrls.add(a.href)}setStyle(i,a){var d,m,_,g,l;this.originalLabelStyle.clear(),(d=this.minimap)==null||d.setStyle(i),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const E=xb(i);if(E.requiresUrlMonitoring&&this.monitorStyleUrl(E.style),E.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}this.styleInProcess=!0;const k=this.getStyle(),O=E.style,$=((m=k?.terrain)==null?void 0:m.source)!==((_=O?.terrain)==null?void 0:_.source)||((g=k?.terrain)==null?void 0:g.exaggeration)!==((l=O?.terrain)==null?void 0:l.exaggeration);try{super.setStyle(E.style,a)}catch(q){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",q)}if(typeof E.style=="string"||E.requiresUrlMonitoring)return this;const X=()=>{this.setSpaceFromStyle({style:E.style}),this.setHaloFromStyle({style:E.style})};if($)this.once("terrain",X);else return X(),this;return this.styleInProcess&&this.once("style.load",()=>{var q,te,ce,Ce;const ze=this.getLayersOrder()[0],Ue=E.style;this.space?this.setSpaceFromStyle({style:Ue}):this.initSpace({before:ze,spec:(te=(q=Ue.metadata)==null?void 0:q.maptiler)==null?void 0:te.space}),this.halo?this.setHaloFromStyle({style:Ue}):this.initHalo({before:ze,spec:(Ce=(ce=Ue.metadata)==null?void 0:ce.maptiler)==null?void 0:Ce.halo})}),this}addLayer(i,a){var d;return(d=this.minimap)==null||d.addLayer(i,a),super.addLayer(i,a)}moveLayer(i,a){var d;return(d=this.minimap)==null||d.moveLayer(i,a),super.moveLayer(i,a)}removeLayer(i){var a;return(a=this.minimap)==null||a.removeLayer(i),super.removeLayer(i)}setLayerZoomRange(i,a,d){var m;return(m=this.minimap)==null||m.setLayerZoomRange(i,a,d),super.setLayerZoomRange(i,a,d)}setFilter(i,a,d){var m;return(m=this.minimap)==null||m.setFilter(i,a,d),super.setFilter(i,a,d)}setPaintProperty(i,a,d,m){var _;return(_=this.minimap)==null||_.setPaintProperty(i,a,d,m),super.setPaintProperty(i,a,d,m)}setLayoutProperty(i,a,d,m){var _;return(_=this.minimap)==null||_.setLayoutProperty(i,a,d,m),super.setLayoutProperty(i,a,d,m)}setGlyphs(i,a){var d;return(d=this.minimap)==null||d.setGlyphs(i,a),super.setGlyphs(i,a)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?$_(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(i){var a;(a=this.minimap)==null||a.map.setLanguage(i),this.onStyleReady(()=>{this.setPrimaryLanguage(i)})}setPrimaryLanguage(i){const a=this.getStyleLanguage(),d=Fx(i,Gi);if(!d){console.warn(`The language "${d}" is not supported.`);return}if(!(d.flag===Gi.STYLE.flag&&a&&(a.flag===Gi.AUTO.flag||a.flag===Gi.VISITOR.flag))&&(d.flag!==Gi.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===d&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Gi.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=d;let m=d;if(d.flag===Gi.STYLE.flag){if(!a){console.warn("The style has no default languages or has an invalid one.");return}m=a}let _=Gi.LOCAL.flag,g=["get",_];m.flag===Gi.VISITOR.flag?(_=Hx().flag,g=["case",["all",["has",_],["has",Gi.LOCAL.flag]],["case",["==",["get",_],["get",Gi.LOCAL.flag]],["get",Gi.LOCAL.flag],["format",["get",_],{"font-scale":.8},`
`,["get",Gi.LOCAL.flag],{"font-scale":1.1}]],["get",Gi.LOCAL.flag]]):m.flag===Gi.VISITOR_ENGLISH.flag?(_=Gi.ENGLISH.flag,g=["case",["all",["has",_],["has",Gi.LOCAL.flag]],["case",["==",["get",_],["get",Gi.LOCAL.flag]],["get",Gi.LOCAL.flag],["format",["get",_],{"font-scale":.8},`
`,["get",Gi.LOCAL.flag],{"font-scale":1.1}]],["get",Gi.LOCAL.flag]]):m.flag===Gi.AUTO.flag?(_=Hx().flag,g=["coalesce",["get",_],["get",Gi.LOCAL.flag]]):m===Gi.LOCAL?(_=Gi.LOCAL.flag,g=["get",_]):(_=m.flag,g=["coalesce",["get",_],["get",Gi.LOCAL.flag]]);const{layers:l}=this.getStyle(),E=this.originalLabelStyle.size===0;if(E){const k=fI(l,this);this.isStyleLocalized=Object.keys(k.localized).length>0}for(const k of l){if(k.type!=="symbol")continue;const O=k,$=this.getSource(O.source);if(!$||!("url"in $&&typeof $.url=="string")||new URL($.url).host!==vo.maptilerApiHost)continue;const{id:X,layout:q}=O;if(!q||!("text-field"in q))continue;let te;if(E?(te=this.getLayoutProperty(X,"text-field"),this.originalLabelStyle.set(X,te)):te=this.originalLabelStyle.get(X),typeof te=="string"){const{contains:ce,exactMatch:Ce}=cI(te,this.isStyleLocalized);if(!ce)continue;if(Ce)this.setLayoutProperty(X,"text-field",g);else{const ze=uI(te,g,this.isStyleLocalized);this.setLayoutProperty(X,"text-field",ze)}}else{const ce=lI(te,g,this.isStyleLocalized);this.setLayoutProperty(X,"text-field",ce)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(i){if(!this.terrain)return;const a=performance.now(),d=this.terrain.exaggeration,m=i-d,_=()=>{if(!this.terrain||this.terrainFlattening)return;const g=(performance.now()-a)/this.terrainAnimationDuration;if(g<.99){const l=1-(1-g)**4,E=d+l*m;this.terrain.exaggeration=E,requestAnimationFrame(_)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=i,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(_)}enableTerrain(i=this.terrainExaggeration){if(i<0){console.warn("Terrain exaggeration cannot be negative.");return}const a=m=>{!this.terrain||m.type!=="data"||m.dataType!=="source"||!("source"in m)||m.sourceId!=="maptiler-terrain"||m.source.type!=="raster-dem"||m.isSourceLoaded&&(this.off("data",a),this.growTerrain(i))},d=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=i,this.on("data",a),this.addSource(vo.terrainSourceId,{type:"raster-dem",url:vo.terrainSourceURL}),this.setTerrain({source:vo.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(i);return}if(this.loaded()||this.isTerrainEnabled)d();else{const m=()=>{this.getTerrain()&&this.getSource(vo.terrainSourceId)||d()};this.once("load",()=>{m()}),this.once("moveend",()=>{m()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const i=performance.now(),a=this.terrain.exaggeration,d=()=>{if(!this.terrain||this.terrainGrowing)return;const m=(performance.now()-i)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,m<.99){const _=(1-m)**4,g=a*_;this.terrain.exaggeration=g,requestAnimationFrame(d)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(vo.terrainSourceId)&&this.removeSource(vo.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(d)}setTerrainExaggeration(i,a=!0){!a&&this.terrain?(this.terrainExaggeration=i,this.terrain.exaggeration=i,this.triggerRepaint()):this.enableTerrain(i)}onStyleReady(i){this.isStyleLoaded()?i():this.once("styledata",()=>{i()})}async fitToIpBounds(){const i=await Nx.info();this.fitBounds(i.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(i){const a=await Nx.info();this.jumpTo({center:[a.longitude??0,a.latitude??0],zoom:i||11})}getCameraHash(){const i=new Float32Array(5),a=this.getCenter();return i[0]=a.lng,i[1]=a.lat,i[2]=this.getZoom(),i[3]=this.getPitch(),i[4]=this.getBearing(),HE.fromUint8Array(new Uint8Array(i.buffer))}getSdkConfig(){return Zn}getMaptilerSessionId(){return Ry}setTransformRequest(i){return super.setTransformRequest(Yx(i)),this}isGlobeProjection(){const i=this.getProjection();return i?i.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};function rv(n){if(typeof DOMParser<"u"){const i=new DOMParser().parseFromString(n,"application/xml");if(i.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return i}throw new Error("No XML parser found")}function H2(n,i){if(!n.hasChildNodes())return!1;for(const a of Array.from(n.childNodes)){const d=a.nodeName;if(typeof d=="string"&&d.trim().toLowerCase()===i.toLowerCase())return!0}return!1}function Nb(n){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(n);throw new Error("No XML serializer found")}function W2(n){const i=typeof n=="string"?rv(n):n;if(!H2(i,"gpx"))throw new Error("The XML document is not valid GPX");const a=Or(i,"trk"),d=Or(i,"rte"),m=Or(i,"wpt"),_={type:"FeatureCollection",features:[]};for(const g of Array.from(a)){const l=Lk(g);l&&_.features.push(l)}for(const g of Array.from(d)){const l=kk(g);l&&_.features.push(l)}for(const g of Array.from(m))_.features.push(zk(g));return _}function K2(n,i){let a=n;if(typeof a=="string"&&(a=rv(a)),!H2(a,"kml"))throw new Error("The XML document is not valid KML");const d={type:"FeatureCollection",features:[]},m={},_={},g={},l=Or(a,"Placemark"),E=Or(a,"Style"),k=Or(a,"StyleMap");for(const O of Array.from(E)){const $=Ub(Nb(O)).toString(16);m[`#${Eu(O,"id")}`]=$,_[$]=O}for(const O of Array.from(k)){m[`#${Eu(O,"id")}`]=Ub(Nb(O)).toString(16);const $=Or(O,"Pair"),X={};for(const q of Array.from($))X[on(_i(q,"key"))??""]=on(_i(q,"styleUrl"));g[`#${Eu(O,"id")}`]=X}for(const O of Array.from(l))d.features=d.features.concat(Ak(O,m,_,g));return d}function jb(n){if(n===null)return["#000000",1];let i="",a=1,d=n;return d.startsWith("#")&&(d=d.substring(1)),(d.length===6||d.length===3)&&(i=d),d.length===8&&(a=Number.parseInt(d.substring(0,2),16)/255,i=`#${d.substring(6,8)}${d.substring(4,6)}${d.substring(2,4)}`),[i??"#000000",a??1]}function Ek(n){return J2(n.split(" "))}function Ik(n){let i=Or(n,"coord");const a=[],d=[];i.length===0&&(i=Or(n,"gx:coord"));for(const _ of Array.from(i))a.push(Ek(on(_)??""));const m=Or(n,"when");for(const _ of Array.from(m))d.push(on(_));return{coords:a,times:d}}function Tf(n){const i=["Polygon","LineString","Point","Track","gx:Track"];let a,d,m,_,g;const l=[],E=[];if(_i(n,"MultiGeometry")!==null)return Tf(_i(n,"MultiGeometry"));if(_i(n,"MultiTrack")!==null)return Tf(_i(n,"MultiTrack"));if(_i(n,"gx:MultiTrack")!==null)return Tf(_i(n,"gx:MultiTrack"));for(m=0;m<i.length;m++)if(d=Or(n,i[m]),d){for(_=0;_<d.length;_++)if(a=d[_],i[m]==="Point")l.push({type:"Point",coordinates:Q2(on(_i(a,"coordinates"))??"")});else if(i[m]==="LineString")l.push({type:"LineString",coordinates:Vb(on(_i(a,"coordinates"))??"")});else if(i[m]==="Polygon"){const k=Or(a,"LinearRing"),O=[];for(g=0;g<k.length;g++)O.push(Vb(on(_i(k[g],"coordinates"))??""));l.push({type:"Polygon",coordinates:O})}else if(i[m]==="Track"||i[m]==="gx:Track"){const k=Ik(a);l.push({type:"LineString",coordinates:k.coords}),k.times.length&&E.push(k.times)}}return{geoms:l,coordTimes:E}}function Ak(n,i,a,d){const m=Tf(n),_={},g=on(_i(n,"name")),l=on(_i(n,"address")),E=on(_i(n,"description")),k=_i(n,"TimeSpan"),O=_i(n,"TimeStamp"),$=_i(n,"ExtendedData"),X=_i(n,"visibility");let q,te=on(_i(n,"styleUrl")),ce=_i(n,"LineStyle"),Ce=_i(n,"PolyStyle");if(!m.geoms.length)return[];if(g&&(_.name=g),l&&(_.address=l),te){te.startsWith("#")||(te=`#${te}`),_.styleUrl=te,i[te]&&(_.styleHash=i[te]),d[te]&&(_.styleMapHash=d[te],_.styleHash=i[d[te].normal??""]);const Ue=a[_.styleHash??""];if(Ue){ce||(ce=_i(Ue,"LineStyle")),Ce||(Ce=_i(Ue,"PolyStyle"));const Fe=_i(Ue,"IconStyle");if(Fe){const xe=_i(Fe,"Icon");if(xe){const be=on(_i(xe,"href"));be&&(_.icon=be)}}}}if(E&&(_.description=E),k){const Ue=on(_i(k,"begin")),Fe=on(_i(k,"end"));Ue&&Fe&&(_.timespan={begin:Ue,end:Fe})}if(O!==null&&(_.timestamp=on(_i(O,"when"))??new Date().toISOString()),ce!==null){const Ue=jb(on(_i(ce,"color"))),Fe=Ue[0],xe=Ue[1],be=Number.parseFloat(on(_i(ce,"width"))??"");Fe&&(_.stroke=Fe),Number.isNaN(xe)||(_["stroke-opacity"]=xe),Number.isNaN(be)||(_["stroke-width"]=be)}if(Ce){const Ue=jb(on(_i(Ce,"color"))),Fe=Ue[0],xe=Ue[1],be=on(_i(Ce,"fill")),ke=on(_i(Ce,"outline"));Fe&&(_.fill=Fe),Number.isNaN(xe)||(_["fill-opacity"]=xe),be&&(_["fill-opacity"]=be==="1"?_["fill-opacity"]||1:0),ke&&(_["stroke-opacity"]=ke==="1"?_["stroke-opacity"]||1:0)}if($){const Ue=Or($,"Data"),Fe=Or($,"SimpleData");for(q=0;q<Ue.length;q++)_[Ue[q].getAttribute("name")??""]=on(_i(Ue[q],"value"))??"";for(q=0;q<Fe.length;q++)_[Fe[q].getAttribute("name")??""]=on(Fe[q])??""}X!==null&&(_.visibility=on(X)??""),m.coordTimes.length!==0&&(_.coordTimes=m.coordTimes.length===1?m.coordTimes[0]:m.coordTimes);const ze={type:"Feature",geometry:m.geoms.length===1?m.geoms[0]:{type:"GeometryCollection",geometries:m.geoms},properties:_};return Eu(n,"id")&&(ze.id=Eu(n,"id")??void 0),[ze]}function X2(n,i){const a=Or(n,i),d=[],m=[];let _=[];const g=a.length;if(!(g<2)){for(let l=0;l<g;l++){const E=eT(a[l]);d.push(E.coordinates),E.time&&m.push(E.time),(E.heartRate||_.length)&&(_.length===0&&(_=new Array(l).fill(null)),_.push(E.heartRate))}return{line:d,times:m,heartRates:_}}}function Lk(n){const i=Or(n,"trkseg"),a=[],d=[],m=[];let _;for(let l=0;l<i.length;l++)if(_=X2(i[l],"trkpt"),_!==void 0&&(_.line&&a.push(_.line),_.times&&_.times.length&&d.push(_.times),m.length||_.heartRates&&_.heartRates.length)){if(!m.length)for(let E=0;E<l;E++)m.push(new Array(a[E].length).fill(null));_.heartRates&&_.heartRates.length?m.push(_.heartRates):m.push(new Array(_.line.length).fill(null))}if(a.length===0)return;const g={...ov(n),...Y2(_i(n,"extensions"))};return d.length!==0&&(g.coordTimes=a.length===1?d[0]:d),m.length!==0&&(g.heartRates=a.length===1?m[0]:m),a.length===1?{type:"Feature",properties:g,geometry:{type:"LineString",coordinates:a[0]}}:{type:"Feature",properties:g,geometry:{type:"MultiLineString",coordinates:a}}}function kk(n){const i=X2(n,"rtept");return i===void 0?void 0:{type:"Feature",properties:{...ov(n),...Y2(_i(n,"extensions"))},geometry:{type:"LineString",coordinates:i.line}}}function zk(n){return{type:"Feature",properties:{...ov(n),...iy(n,["sym"])},geometry:{type:"Point",coordinates:eT(n).coordinates}}}function Y2(n){const i={};if(n){const a=_i(n,"line");if(a){const d=on(_i(a,"color")),m=Number.parseFloat(on(_i(a,"opacity"))??"0"),_=Number.parseFloat(on(_i(a,"width"))??"0");d&&(i.stroke=d),Number.isNaN(m)||(i["stroke-opacity"]=m),Number.isNaN(_)||(i["stroke-width"]=_*96/25.4)}}return i}function ov(n){const i=iy(n,["name","cmt","desc","type","time","keywords"]),a=Or(n,"link");if(a.length!==0){i.links=[];for(const d of Array.from(a)){const m={href:Eu(d,"href"),...iy(d,["text","type"])};i.links.push(m)}}return i}function Ub(n){let i=0;if(!n||!n.length)return i;for(let a=0;a<n.length;a++)i=(i<<5)-i+n.charCodeAt(a)|0;return i}function Or(n,i){return n.getElementsByTagName(i)}function Eu(n,i){return n.getAttribute(i)}function $b(n,i){return Number.parseFloat(Eu(n,i)??"0")}function _i(n,i){const a=Or(n,i);return a.length?a[0]:null}function Rk(n){return n.normalize&&n.normalize(),n}function J2(n){return n.map(Number.parseFloat).map(i=>Number.isNaN(i)?null:i)}function on(n){return n&&Rk(n),n&&n.textContent}function iy(n,i){const a={};let d,m;for(m=0;m<i.length;m++)d=_i(n,i[m]),d&&(a[i[m]]=on(d)??"");return a}function Q2(n){return J2(n.replace(/\s*/g,"").split(","))}function Vb(n){const i=n.replace(/^\s*|\s*$/g,"").split(/\s+/),a=[];for(const d of i)a.push(Q2(d));return a}function eT(n){const i=[$b(n,"lon"),$b(n,"lat")],a=_i(n,"ele"),d=_i(n,"gpxtpx:hr")||_i(n,"hr"),m=_i(n,"time");let _;return a&&(_=Number.parseFloat(on(a)??"0"),Number.isNaN(_)||i.push(_)),{coordinates:i,time:m?on(m):null,heartRate:d!==null?Number.parseFloat(on(d)??"0"):null}}function Dk(n){let i=n;try{typeof i=="string"&&(i=rv(i))}catch{return null}try{return W2(i)}catch{}try{return K2(i)}catch{}return null}async function Ok(n,i={}){const a=i.download??!1,d=await Fk(n);if(a){const m=i.filename??"maptiler_screenshot.png",_=document.createElement("a");_.style.display="none",document.body.appendChild(_),_.href=URL.createObjectURL(d),_.download=m,_.click(),setTimeout(()=>{document.body.removeChild(_),URL.revokeObjectURL(_.href)},0)}return d}function Fk(n){return new Promise((i,a)=>{n.redraw(),n.once("idle",()=>{n.getCanvas().toBlob(d=>{if(!d){a(Error("Screenshot could not be created."));return}i(d)},"image/png")})})}const ny=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Cm(){return ny[~~(Math.random()*ny.length)][~~(Math.random()*4)]}function vp(){return`maptiler_source_${i2()}`}function xp(){return`maptiler_layer_${i2()}`}function ry(n,i){if(i<=n[0].zoom)return n[0].value;if(i>=n[n.length-1].zoom)return n[n.length-1].value;for(let a=0;a<n.length-1;a+=1)if(i>=n[a].zoom&&i<n[a+1].zoom){const d=n[a+1].zoom-n[a].zoom,m=(i-n[a].zoom)/d;return m*n[a+1].value+(1-m)*n[a].value}return 0}function xc(n){return["interpolate",["linear"],["zoom"],...n.flatMap(i=>[i.zoom,i.value])]}function en(n){return["interpolate",["linear"],["zoom"],...n.flatMap(i=>[i.zoom,i.value])]}function tT(n,i){if(typeof i=="number"&&typeof n=="number")return 2*i+n;if(typeof i=="number"&&Array.isArray(n))return["interpolate",["linear"],["zoom"],...n.flatMap(a=>[a.zoom,2*i+a.value])];if(typeof n=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(a=>[a.zoom,2*a.value+n])];if(Array.isArray(n)&&Array.isArray(i)){const a=Array.from(new Set([...n.map(d=>d.zoom),...i.map(d=>d.zoom)])).sort((d,m)=>d<m?-1:1);return["interpolate",["linear"],["zoom"],...a.flatMap(d=>[d,2*ry(i,d)+ry(n,d)])]}return 0}function iT(n,i){return["interpolate",["linear"],["get",i],...n.flatMap(a=>[a.propertyValue,a.value])]}function sv(n){const i=n.trimStart(),a=`${i}${" ".repeat(n.length-i.length)}`,d=Array.from(a);if(!d.every(_=>_===" "||_==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(d.some(_=>_==="_")&&d.some(_=>_===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const m=[1];for(let _=1;_<d.length;_+=1){const g=d[_-1],l=d[_];g===l?m[m.length-1]+=1:m.push(1)}return m}function oy(n,i){return["interpolate",["linear"],["get",i],...n.flatMap(a=>[a.value,a.color])]}function sy(n,i,a=!0){return a?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius*.025])],2,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius*.05])],4,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius*.1])],8,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius*.25])],16,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius])]]:["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.value,d.pointRadius])]}function nT(n,i,a=!0){return a?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value*.025])],2,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value*.05])],4,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value*.1])],8,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value*.25])],16,["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value])]]:["interpolate",["linear"],["get",i],...n.flatMap(d=>[d.propertyValue,d.value])]}function ay(n,i){return n.every(a=>a.color[3]===n[0].color[3])?n[0].color[3]?n[0].color[3]/255:1:["interpolate",["linear"],["get",i],...n.getRawColorStops().flatMap(a=>{const d=a.value,m=a.color;return[d,m.length===4?m[3]/255:1]})]}function rT(n,i=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:i+1},(a,d)=>{const m=d/i;return[m,n.getColorHex(m)]}).flat()]}function df(n){const i=n.toString(16);return i.length===1?`0${i}`:i}function Bk(n){return`#${df(n[0])}${df(n[1])}${df(n[2])}${n.length===4?df(n[3]):""}`}class ii extends Array{constructor(i={}){super(),Dt(this,"min",0),Dt(this,"max",1),"min"in i&&(this.min=i.min),"max"in i&&(this.max=i.max),"stops"in i&&this.setStops(i.stops,{clone:!1})}static fromArrayDefinition(i){return new ii({stops:i.map(a=>({value:a[0],color:a[1]}))})}setStops(i,a={clone:!0}){const d=a.clone?this.clone():this;d.length=0;let m=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;for(let g=0;g<i.length;g+=1)m=Math.min(m,i[g].value),_=Math.max(_,i[g].value),d.push({value:i[g].value,color:i[g].color.slice()});return d.sort((g,l)=>g.value<l.value?-1:1),this.min=m,this.max=_,d}scale(i,a,d={clone:!0}){const m=d.clone,_=this[0].value,g=this.at(-1).value-_,l=a-i,E=[];for(let k=0;k<this.length;k+=1){const O=(this[k].value-_)/g*l+i;m?E.push({value:O,color:this[k].color.slice()}):this[k].value=O}return m?new ii({stops:E}):this}at(i){return i<0?this[this.length+i]:this[i]}clone(){return new ii({stops:this.getRawColorStops()})}getRawColorStops(){const i=[];for(let a=0;a<this.length;a+=1)i.push({value:this[a].value,color:this[a].color});return i}reverse(i={clone:!0}){const a=i.clone?this.clone():this;for(let d=0;d<~~(a.length/2);d+=1){const m=a[d].color;a[d].color=a.at(-(d+1)).color,a.at(-(d+1)).color=m}return a}getBounds(){return{min:this.min,max:this.max}}getColor(i,a={smooth:!0}){if(i<=this[0].value)return this[0].color;if(i>=this.at(-1).value)return this.at(-1).color;for(let d=0;d<this.length-1;d+=1){if(i>this[d+1].value)continue;const m=this[d].color;if(!a.smooth)return m.slice();const _=this[d].value,g=this[d+1].value,l=this[d+1].color,E=(g-i)/(g-_);return m.map((k,O)=>Math.round(k*E+l[O]*(1-E)))}return[0,0,0]}getColorHex(i,a={smooth:!0,withAlpha:!1}){return Bk(this.getColor(i,a))}getColorRelative(i,a={smooth:!0}){const d=this.getBounds();return this.getColor(d.min+i*(d.max-d.min),a)}getCanvasStrip(i={horizontal:!0,size:512,smooth:!0}){const a=document.createElement("canvas");a.width=i.horizontal?i.size:1,a.height=i.horizontal?1:i.size;const d=a.getContext("2d");if(!d)throw new Error("Canvs context is missing");const m=d.getImageData(0,0,a.width,a.height),_=m.data,g=i.size,l=this[0].value,E=(this.at(-1).value-l)/g;for(let k=0;k<g;k+=1){const O=this.getColor(l+k*E,{smooth:i.smooth});_[k*4]=O[0],_[k*4+1]=O[1],_[k*4+2]=O[2],_[k*4+3]=O.length>3?O[3]:255}return d.putImageData(m,0,0),a}resample(i,a=15){const d=this.getBounds(),m=this.scale(0,1),_=1/(a-1);let g;if(i==="ease-in-square")g=Array.from({length:a},(l,E)=>{const k=E*_,O=k**2,$=m.getColor(O);return{value:k,color:$}});else if(i==="ease-out-square")g=Array.from({length:a},(l,E)=>{const k=E*_,O=1-(1-k)**2,$=m.getColor(O);return{value:k,color:$}});else if(i==="ease-out-sqrt")g=Array.from({length:a},(l,E)=>{const k=E*_,O=k**.5,$=m.getColor(O);return{value:k,color:$}});else if(i==="ease-in-sqrt")g=Array.from({length:a},(l,E)=>{const k=E*_,O=1-(1-k)**.5,$=m.getColor(O);return{value:k,color:$}});else if(i==="ease-out-exp")g=Array.from({length:a},(l,E)=>{const k=E*_,O=1-2**(-10*k),$=m.getColor(O);return{value:k,color:$}});else if(i==="ease-in-exp")g=Array.from({length:a},(l,E)=>{const k=E*_,O=2**(10*k-10),$=m.getColor(O);return{value:k,color:$}});else throw new Error("Invalid ressampling method.");return new ii({stops:g}).scale(d.min,d.max)}transparentStart(){const i=this.getRawColorStops();i.unshift({value:i[0].value,color:i[0].color.slice()}),i[1].value+=.001;for(const a of i)a.color.length===3&&a.color.push(255);return i[0].color[3]=0,new ii({stops:i})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const oT={NULL:new ii({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new ii({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new ii({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new ii({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new ii({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new ii({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new ii({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new ii({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new ii({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new ii({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new ii({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new ii({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new ii({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new ii({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new ii({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new ii({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new ii({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new ii({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new ii({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new ii({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new ii({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new ii({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new ii({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new ii({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new ii({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new ii({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new ii({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new ii({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new ii({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new ii({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new ii({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new ii({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new ii({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new ii({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new ii({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new ii({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new ii({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new ii({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new ii({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new ii({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new ii({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new ii({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new ii({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new ii({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new ii({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new ii({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new ii({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new ii({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new ii({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function Nk(n,i,a={}){var d,m;if(!i.sourceId&&!i.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let _=i.data;if(typeof _=="string"){if(cm(_))_=`https://api.maptiler.com/data/${i.data}/features.json?key=${Zn.apiKey}`;else if(((d=_.split(".").pop())==null?void 0:d.toLowerCase().trim())==="gpx"){const g=await(await fetch(_,a)).text();_=W2(g)}else if(((m=_.split(".").pop())==null?void 0:m.toLowerCase().trim())==="kml"){const g=await(await fetch(_,a)).text();_=K2(g)}else{const g=oI(_)??Dk(_);g&&(_=g)}if(!_)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return jk(n,{...i,data:_})}function jk(n,i){if(i.layerId&&n.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);const a=i.sourceId??vp(),d=i.layerId??xp(),m={polylineLayerId:d,polylineOutlineLayerId:"",polylineSourceId:a};i.data&&!n.getSource(a)&&n.addSource(a,{type:"geojson",data:i.data});const _=i.lineWidth??3,g=i.lineColor??Cm(),l=i.lineOpacity??1,E=i.lineBlur??0,k=i.lineGapWidth??0;let O=i.lineDashArray??null;const $=i.outlineWidth??1,X=i.outlineColor??"#FFFFFF",q=i.outlineOpacity??1,te=i.outlineBlur??0;if(typeof O=="string"&&(O=sv(O)),i.outline===!0){const ce=`${d}_outline`;m.polylineOutlineLayerId=ce,n.addLayer({id:ce,type:"line",source:a,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof q=="number"?q:en(q),"line-color":typeof X=="string"?X:xc(X),"line-width":tT(_,$),"line-blur":typeof te=="number"?te:en(te)}},i.beforeId)}return n.addLayer({id:d,type:"line",source:a,layout:{"line-join":i.lineJoin??"round","line-cap":i.lineCap??"round"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof l=="number"?l:en(l),"line-color":typeof g=="string"?g:xc(g),"line-width":typeof _=="number"?_:en(_),"line-blur":typeof E=="number"?E:en(E),"line-gap-width":typeof k=="number"?k:en(k),...O&&{"line-dasharray":O}}},i.beforeId),m}function Uk(n,i){if(i.layerId&&n.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);const a=i.sourceId??vp(),d=i.layerId??xp(),m={polygonLayerId:d,polygonOutlineLayerId:i.outline?`${d}_outline`:"",polygonSourceId:a};if(i.data&&!n.getSource(a)){let ce=i.data;typeof ce=="string"&&cm(ce)&&(ce=`https://api.maptiler.com/data/${ce}/features.json?key=${Zn.apiKey}`),n.addSource(a,{type:"geojson",data:ce})}let _=i.outlineDashArray??null;const g=i.outlineWidth??1,l=i.outlineColor??"#FFFFFF",E=i.outlineOpacity??1,k=i.outlineBlur??0,O=i.fillColor??Cm(),$=i.fillOpacity??1,X=i.outlinePosition??"center",q=i.pattern??null;typeof _=="string"&&(_=sv(_));const te=(ce=null)=>{if(n.addLayer({id:d,type:"fill",source:a,minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"fill-color":typeof O=="string"?O:xc(O),"fill-opacity":typeof $=="number"?$:en($),...ce&&{"fill-pattern":ce}}},i.beforeId),i.outline===!0){let Ce;X==="inside"?typeof g=="number"?Ce=.5*g:Ce=en(g.map(({zoom:ze,value:Ue})=>({zoom:ze,value:.5*Ue}))):X==="outside"?typeof g=="number"?Ce=-.5*g:Ce=en(g.map(ze=>({zoom:ze.zoom,value:-.5*ze.value}))):Ce=0,n.addLayer({id:m.polygonOutlineLayerId,type:"line",source:a,layout:{"line-join":i.outlineJoin??"round","line-cap":i.outlineCap??"butt"},minzoom:i.minzoom??0,maxzoom:i.maxzoom??23,paint:{"line-opacity":typeof E=="number"?E:en(E),"line-color":typeof l=="string"?l:xc(l),"line-width":typeof g=="number"?g:en(g),"line-blur":typeof k=="number"?k:en(k),"line-offset":Ce,..._&&{"line-dasharray":_}}},i.beforeId)}};return q?n.hasImage(q)?te(q):n.loadImage(q).then(ce=>{n.addImage(q,ce.data),te(q)}).catch(ce=>{console.error("Could not load the pattern image.",ce.message),te()}):te(),m}function $k(n,i){if(i.layerId&&n.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);const a=i.minPointRadius??10,d=i.maxPointRadius??50,m=i.cluster??!1,_=20,g=Array.isArray(i.pointColor)?i.pointColor:oT.TURBO.scale(10,i.cluster?1e4:1e3).resample("ease-out-square"),l=g.getBounds(),E=i.sourceId??vp(),k=i.layerId??xp(),O=i.showLabel??m,$=i.alignOnViewport??!0,X=i.outline??!1,q=i.outlineOpacity??1,te=i.outlineWidth??1,ce=i.outlineColor??"#FFFFFF";let Ce;const ze=i.zoomCompensation??!0,Ue=i.minzoom??0,Fe=i.maxzoom??23;typeof i.pointOpacity=="number"?Ce=i.pointOpacity:Array.isArray(i.pointOpacity)?Ce=en(i.pointOpacity):i.cluster?Ce=ay(g,"point_count"):i.property?Ce=ay(g,i.property):Ce=en([{zoom:Ue,value:0},{zoom:Ue+.25,value:1},{zoom:Fe-.25,value:1},{zoom:Fe,value:0}]);const xe={pointLayerId:k,clusterLayerId:"",labelLayerId:"",pointSourceId:E};if(i.data&&!n.getSource(E)){let be=i.data;typeof be=="string"&&cm(be)&&(be=`https://api.maptiler.com/data/${be}/features.json?key=${Zn.apiKey}`),n.addSource(E,{type:"geojson",data:be,cluster:m})}if(m){xe.clusterLayerId=`${k}_cluster`;const be=Array.from({length:_},(ke,Qe)=>{const tt=l.min+Qe*(l.max-l.min)/(_-1);return{value:tt,pointRadius:a+(d-a)*(Qe/(_-1))**.5,color:g.getColorHex(tt)}});n.addLayer({id:xe.clusterLayerId,type:"circle",source:E,filter:["has","point_count"],paint:{"circle-color":typeof i.pointColor=="string"?i.pointColor:oy(be,"point_count"),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?en(i.pointRadius):sy(be,"point_count",!1),"circle-pitch-alignment":$?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Ce,...X&&{"circle-stroke-opacity":typeof q=="number"?q:en(q),"circle-stroke-width":typeof te=="number"?te:en(te),"circle-stroke-color":typeof ce=="string"?ce:xc(ce)}},minzoom:Ue,maxzoom:Fe},i.beforeId),n.addLayer({id:xe.pointLayerId,type:"circle",source:E,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":$?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof i.pointColor=="string"?i.pointColor:g.getColorHex(g.getBounds().min),"circle-radius":typeof i.pointRadius=="number"?i.pointRadius:Array.isArray(i.pointRadius)?en(i.pointRadius):be[0].pointRadius*.75,"circle-opacity":Ce,...X&&{"circle-stroke-opacity":typeof q=="number"?q:en(q),"circle-stroke-width":typeof te=="number"?te:en(te),"circle-stroke-color":typeof ce=="string"?ce:xc(ce)}},minzoom:Ue,maxzoom:Fe},i.beforeId)}else{let be=typeof i.pointColor=="string"?i.pointColor:Array.isArray(i.pointColor)?i.pointColor.getColorHex(i.pointColor.getBounds().min):Cm(),ke=typeof i.pointRadius=="number"?ze?en([{zoom:0,value:i.pointRadius*.025},{zoom:2,value:i.pointRadius*.05},{zoom:4,value:i.pointRadius*.1},{zoom:8,value:i.pointRadius*.25},{zoom:16,value:i.pointRadius*1}]):i.pointRadius:Array.isArray(i.pointRadius)?en(i.pointRadius):ze?en([{zoom:0,value:a*.05},{zoom:2,value:a*.1},{zoom:4,value:a*.2},{zoom:8,value:a*.5},{zoom:16,value:a*1}]):a;if(i.property&&Array.isArray(i.pointColor)){const Qe=Array.from({length:_},(tt,et)=>{const ht=l.min+et*(l.max-l.min)/(_-1);return{value:ht,pointRadius:typeof i.pointRadius=="number"?i.pointRadius:a+(d-a)*(et/(_-1))**.5,color:typeof i.pointColor=="string"?i.pointColor:g.getColorHex(ht)}});be=oy(Qe,i.property),ke=sy(Qe,i.property,ze)}n.addLayer({id:xe.pointLayerId,type:"circle",source:E,layout:{"circle-sort-key":i.property?["/",1,["get",i.property]]:0},paint:{"circle-pitch-alignment":$?"viewport":"map","circle-pitch-scale":"map","circle-color":be,"circle-opacity":Ce,"circle-radius":ke,...X&&{"circle-stroke-opacity":typeof q=="number"?q:en(q),"circle-stroke-width":typeof te=="number"?te:en(te),"circle-stroke-color":typeof ce=="string"?ce:xc(ce)}},minzoom:Ue,maxzoom:Fe},i.beforeId)}if(O!==!1&&(i.cluster||i.property)){xe.labelLayerId=`${k}_label`;const be=i.labelColor??"#fff",ke=i.labelSize??12;n.addLayer({id:xe.labelLayerId,type:"symbol",source:E,filter:["has",i.cluster?"point_count":i.property],layout:{"text-field":i.cluster?"{point_count_abbreviated}":`{${i.property}}`,"text-font":["Noto Sans Regular"],"text-size":ke,"text-pitch-alignment":$?"viewport":"map","symbol-sort-key":["/",1,["get",i.cluster?"point_count":i.property]]},paint:{"text-color":be,"text-opacity":Ce},minzoom:Ue,maxzoom:Fe},i.beforeId)}return xe}function Vk(n,i){if(i.layerId&&n.getLayer(i.layerId))throw new Error(`A layer already exists with the layer id: ${i.layerId}`);const a=i.sourceId??vp(),d=i.layerId??xp(),m=i.minzoom??0,_=i.maxzoom??23,g=i.zoomCompensation??!0,l=i.opacity??[{zoom:m,value:0},{zoom:m+.25,value:1},{zoom:_-.25,value:1},{zoom:_,value:0}];let E=Array.isArray(i.colorRamp)?i.colorRamp:oT.TURBO.transparentStart();const k=E.getBounds();(k.min!==0||k.max!==1)&&(E=E.scale(0,1)),E.hasTransparentStart()||(E=E.transparentStart());const O=i.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],$=i.property??null,X=i.weight??1;let q=1;$?typeof X=="number"?(q=X,typeof i.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(X)?q=iT(X,$):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof X=="number"?q=X:Array.isArray(X)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const te=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],ce=i.radius??(g?te:10);let Ce=1;typeof ce=="number"?Ce=ce:Array.isArray(ce)&&"zoom"in ce[0]?Ce=en(ce):$&&Array.isArray(ce)&&"propertyValue"in ce[0]?Ce=nT(ce,$,g):!$&&Array.isArray(ce)&&"propertyValue"in ce[0]?(Ce=en(te),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Ce=en(te);const ze={heatmapLayerId:d,heatmapSourceId:a};if(i.data&&!n.getSource(a)){let Ue=i.data;typeof Ue=="string"&&cm(Ue)&&(Ue=`https://api.maptiler.com/data/${Ue}/features.json?key=${Zn.apiKey}`),n.addSource(a,{type:"geojson",data:Ue})}return n.addLayer({id:d,type:"heatmap",source:a,minzoom:m,maxzoom:_,paint:{"heatmap-weight":q,"heatmap-intensity":typeof O=="number"?O:en(O),"heatmap-color":rT(E),"heatmap-radius":Ce,"heatmap-opacity":typeof l=="number"?l:en(l)}},i.beforeId),ze}const Ed=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:Vk,addPoint:$k,addPolygon:Uk,addPolyline:Nk,colorDrivenByProperty:oy,colorPalettes:ny,computeRampedOutlineWidth:tT,dashArrayMaker:sv,generateRandomLayerName:xp,generateRandomSourceName:vp,getRandomColor:Cm,heatmapIntensityFromColorRamp:rT,lerpZoomNumberValues:ry,opacityDrivenByProperty:ay,paintColorOptionsToPaintSpec:xc,radiusDrivenByProperty:sy,radiusDrivenByPropertyHeatmap:nT,rampedOptionsToLayerPaintSpec:en,rampedPropertyValueWeight:iT,takeScreenshot:Ok},Symbol.toStringTag,{value:"Module"}));nI();qt.Map;qt.Marker;qt.Popup;qt.Style;qt.CanvasSource;qt.GeoJSONSource;qt.ImageSource;qt.RasterTileSource;qt.RasterDEMTileSource;qt.VectorTileSource;qt.VideoSource;qt.NavigationControl;qt.GeolocateControl;qt.AttributionControl;qt.LogoControl;qt.ScaleControl;qt.FullscreenControl;qt.TerrainControl;qt.BoxZoomHandler;qt.ScrollZoomHandler;qt.CooperativeGesturesHandler;qt.KeyboardHandler;qt.TwoFingersTouchPitchHandler;qt.MapWheelEvent;qt.MapTouchEvent;qt.MapMouseEvent;qt.config;qt.getVersion;const{setRTLTextPlugin:tD,getRTLTextPluginStatus:iD,LngLat:nD,LngLatBounds:rD,MercatorCoordinate:oD,Evented:sD,AJAXError:aD,prewarm:lD,clearPrewarmedResources:cD,Hash:uD,Point:hD,EdgeInsets:dD,DragRotateHandler:pD,DragPanHandler:fD,TwoFingersTouchZoomRotateHandler:mD,DoubleClickZoomHandler:gD,TwoFingersTouchZoomHandler:_D,TwoFingersTouchRotateHandler:yD,getWorkerCount:vD,setWorkerCount:xD,getMaxParallelImageRequests:bD,setMaxParallelImageRequests:wD,getWorkerUrl:TD,setWorkerUrl:SD,addSourceType:PD,importScriptInWorkers:CD,addProtocol:MD,removeProtocol:ED}=qt,Zk="@maptiler/leaflet-maptilersdk",qk="4.1.0",Gk=Fi.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(n){Fi.setOptions(this,n),this._throttledUpdate=Fi.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(n){var i;this._container||this._initContainer();const a=this.getPaneName();(i=n.getPane(a))==null||i.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),n.options.zoomAnimation&&Fi.DomEvent.on(n._proxy,Fi.DomUtil.TRANSITION_END,this._transitionEnd,this),n.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(n){var i;this._map._proxy&&this._map.options.zoomAnimation&&Fi.DomEvent.off(this._map._proxy,Fi.DomUtil.TRANSITION_END,this._transitionEnd,this);const a=this.getPaneName();(i=n.getPane(a))==null||i.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const n=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return Fi.latLngBounds(this._map.containerPointToLatLng(i.subtract(n)),this._map.containerPointToLatLng(i.add(n)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(n){this._maptilerMap.setStyle(n)},setLanguage:function(n){this._maptilerMap.setLanguage(n)},_roundPoint:n=>({x:Math.round(n.x),y:Math.round(n.y)}),_initContainer:function(){this._container=Fi.DomUtil.create("div","leaflet-gl-layer");const n=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${n.x}px`,this._container.style.height=`${n.y}px`;const a=this._map.containerPointToLayerPoint([0,0]).subtract(i);Fi.DomUtil.setPosition(this._container,this._roundPoint(a))},_initMaptilerSDK:function(){const n=this._map.getCenter(),i={...this.options,projection:"mercator",container:this._container,center:[n.lng,n.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(i.center=void 0,i.zoom=void 0),this._maptilerMap=new q2(i),this._maptilerMap.telemetry.registerModule(Zk,qk),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let d={logo:null};try{const m=Object.keys(this._maptilerMap.style.sourceCaches).map(g=>this._maptilerMap.getSource(g)).filter(g=>g&&"url"in g&&typeof g.url=="string"&&g?.url.includes("tiles.json")),_=new URL(m[0].url);_.searchParams.has("key")||_.searchParams.append("key",i.apiKey),d=await(await fetch(_.href)).json()}catch{}if(d.logo||i.maptilerLogo){const m=d.logo??"https://api.maptiler.com/resources/logo.svg",_=document.createElement("a");_.href="https://www.maptiler.com",_.style.setProperty("position","absolute"),_.style.setProperty("left","10px"),_.style.setProperty("bottom","2px"),_.style.setProperty("z-index","999");const g=document.createElement("img");g.src=m,g.alt="MapTiler logo",g.width=100,g.height=30,_.appendChild(g),this._map.getContainer().appendChild(_)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const a=this._maptilerMap._actualCanvas;Fi.DomUtil.addClass(a,"leaflet-image-layer"),Fi.DomUtil.addClass(a,"leaflet-zoom-animated"),this.options.interactive&&Fi.DomUtil.addClass(a,"leaflet-interactive"),this.options.className&&Fi.DomUtil.addClass(a,this.options.className),this.addHeatmap=d=>Ed.addHeatmap(this._maptilerMap,d),this.addPolygon=d=>Ed.addPolygon(this._maptilerMap,d),this.addPoint=d=>Ed.addPoint(this._maptilerMap,d),this.addPolyline=d=>Ed.addPolyline(this._maptilerMap,d),this.takeScreenshot=d=>Ed.takeScreenshot(this._maptilerMap,d)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const n=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding),a=this._map.containerPointToLayerPoint([0,0]).subtract(i);Fi.DomUtil.setPosition(this._container,this._roundPoint(a)),this._transformGL(),this._maptilerMap.transform.width!==n.x||this._maptilerMap.transform.height!==n.y?(this._container.style.width=`${n.x}px`,this._container.style.height=`${n.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(n){const i=this._map.getZoomScale(n.zoom),a=this._map.getSize().multiplyBy(this.options.padding*i),d=this.getSize()._divideBy(2),m=this._map.project(n.center,n.zoom)._subtract(d)._add(this._map._getMapPanePos().add(a))._round(),_=this._map.project(this._map.getBounds().getNorthWest(),n.zoom)._subtract(m);Fi.DomUtil.setTransform(this._maptilerMap.getCanvas(),_.subtract(this._offset),i)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const n=this._map.getZoomScale(this._map.getZoom());Fi.DomUtil.setTransform(this._maptilerMap.getCanvas(),new Fi.Point(0,0),n),this._zooming=!1,this._update()},_transitionEnd:function(){Fi.Util.requestAnimFrame(()=>{const n=this._map.getZoom(),i=this._map.getCenter(),a=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Fi.DomUtil.setTransform(this._maptilerMap._actualCanvas,a,1),this._maptilerMap.once("moveend",Fi.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:i,zoom:n-1})},this)},_resize:function(n){this._transitionEnd(n)}});function Hk(n){return new Gk(n)}function sT(n,i){return function(){return n.apply(i,arguments)}}const{toString:Wk}=Object.prototype,{getPrototypeOf:av}=Object,{iterator:Mm,toStringTag:aT}=Symbol,Em=(n=>i=>{const a=Wk.call(i);return n[a]||(n[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),aa=n=>(n=n.toLowerCase(),i=>Em(i)===n),Im=n=>i=>typeof i===n,{isArray:Rh}=Array,hp=Im("undefined");function Kk(n){return n!==null&&!hp(n)&&n.constructor!==null&&!hp(n.constructor)&&Oo(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const lT=aa("ArrayBuffer");function Xk(n){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(n):i=n&&n.buffer&&lT(n.buffer),i}const Yk=Im("string"),Oo=Im("function"),cT=Im("number"),Am=n=>n!==null&&typeof n=="object",Jk=n=>n===!0||n===!1,Sf=n=>{if(Em(n)!=="object")return!1;const i=av(n);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(aT in n)&&!(Mm in n)},Qk=aa("Date"),e5=aa("File"),t5=aa("Blob"),i5=aa("FileList"),n5=n=>Am(n)&&Oo(n.pipe),r5=n=>{let i;return n&&(typeof FormData=="function"&&n instanceof FormData||Oo(n.append)&&((i=Em(n))==="formdata"||i==="object"&&Oo(n.toString)&&n.toString()==="[object FormData]"))},o5=aa("URLSearchParams"),[s5,a5,l5,c5]=["ReadableStream","Request","Response","Headers"].map(aa),u5=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function bp(n,i,{allOwnKeys:a=!1}={}){if(n===null||typeof n>"u")return;let d,m;if(typeof n!="object"&&(n=[n]),Rh(n))for(d=0,m=n.length;d<m;d++)i.call(null,n[d],d,n);else{const _=a?Object.getOwnPropertyNames(n):Object.keys(n),g=_.length;let l;for(d=0;d<g;d++)l=_[d],i.call(null,n[l],l,n)}}function uT(n,i){i=i.toLowerCase();const a=Object.keys(n);let d=a.length,m;for(;d-- >0;)if(m=a[d],i===m.toLowerCase())return m;return null}const xu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hT=n=>!hp(n)&&n!==xu;function ly(){const{caseless:n}=hT(this)&&this||{},i={},a=(d,m)=>{const _=n&&uT(i,m)||m;Sf(i[_])&&Sf(d)?i[_]=ly(i[_],d):Sf(d)?i[_]=ly({},d):Rh(d)?i[_]=d.slice():i[_]=d};for(let d=0,m=arguments.length;d<m;d++)arguments[d]&&bp(arguments[d],a);return i}const h5=(n,i,a,{allOwnKeys:d}={})=>(bp(i,(m,_)=>{a&&Oo(m)?n[_]=sT(m,a):n[_]=m},{allOwnKeys:d}),n),d5=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),p5=(n,i,a,d)=>{n.prototype=Object.create(i.prototype,d),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:i.prototype}),a&&Object.assign(n.prototype,a)},f5=(n,i,a,d)=>{let m,_,g;const l={};if(i=i||{},n==null)return i;do{for(m=Object.getOwnPropertyNames(n),_=m.length;_-- >0;)g=m[_],(!d||d(g,n,i))&&!l[g]&&(i[g]=n[g],l[g]=!0);n=a!==!1&&av(n)}while(n&&(!a||a(n,i))&&n!==Object.prototype);return i},m5=(n,i,a)=>{n=String(n),(a===void 0||a>n.length)&&(a=n.length),a-=i.length;const d=n.indexOf(i,a);return d!==-1&&d===a},g5=n=>{if(!n)return null;if(Rh(n))return n;let i=n.length;if(!cT(i))return null;const a=new Array(i);for(;i-- >0;)a[i]=n[i];return a},_5=(n=>i=>n&&i instanceof n)(typeof Uint8Array<"u"&&av(Uint8Array)),y5=(n,i)=>{const d=(n&&n[Mm]).call(n);let m;for(;(m=d.next())&&!m.done;){const _=m.value;i.call(n,_[0],_[1])}},v5=(n,i)=>{let a;const d=[];for(;(a=n.exec(i))!==null;)d.push(a);return d},x5=aa("HTMLFormElement"),b5=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,d,m){return d.toUpperCase()+m}),Zb=(({hasOwnProperty:n})=>(i,a)=>n.call(i,a))(Object.prototype),w5=aa("RegExp"),dT=(n,i)=>{const a=Object.getOwnPropertyDescriptors(n),d={};bp(a,(m,_)=>{let g;(g=i(m,_,n))!==!1&&(d[_]=g||m)}),Object.defineProperties(n,d)},T5=n=>{dT(n,(i,a)=>{if(Oo(n)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const d=n[a];if(Oo(d)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},S5=(n,i)=>{const a={},d=m=>{m.forEach(_=>{a[_]=!0})};return Rh(n)?d(n):d(String(n).split(i)),a},P5=()=>{},C5=(n,i)=>n!=null&&Number.isFinite(n=+n)?n:i;function M5(n){return!!(n&&Oo(n.append)&&n[aT]==="FormData"&&n[Mm])}const E5=n=>{const i=new Array(10),a=(d,m)=>{if(Am(d)){if(i.indexOf(d)>=0)return;if(!("toJSON"in d)){i[m]=d;const _=Rh(d)?[]:{};return bp(d,(g,l)=>{const E=a(g,m+1);!hp(E)&&(_[l]=E)}),i[m]=void 0,_}}return d};return a(n,0)},I5=aa("AsyncFunction"),A5=n=>n&&(Am(n)||Oo(n))&&Oo(n.then)&&Oo(n.catch),pT=((n,i)=>n?setImmediate:i?((a,d)=>(xu.addEventListener("message",({source:m,data:_})=>{m===xu&&_===a&&d.length&&d.shift()()},!1),m=>{d.push(m),xu.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",Oo(xu.postMessage)),L5=typeof queueMicrotask<"u"?queueMicrotask.bind(xu):typeof process<"u"&&process.nextTick||pT,k5=n=>n!=null&&Oo(n[Mm]),Ye={isArray:Rh,isArrayBuffer:lT,isBuffer:Kk,isFormData:r5,isArrayBufferView:Xk,isString:Yk,isNumber:cT,isBoolean:Jk,isObject:Am,isPlainObject:Sf,isReadableStream:s5,isRequest:a5,isResponse:l5,isHeaders:c5,isUndefined:hp,isDate:Qk,isFile:e5,isBlob:t5,isRegExp:w5,isFunction:Oo,isStream:n5,isURLSearchParams:o5,isTypedArray:_5,isFileList:i5,forEach:bp,merge:ly,extend:h5,trim:u5,stripBOM:d5,inherits:p5,toFlatObject:f5,kindOf:Em,kindOfTest:aa,endsWith:m5,toArray:g5,forEachEntry:y5,matchAll:v5,isHTMLForm:x5,hasOwnProperty:Zb,hasOwnProp:Zb,reduceDescriptors:dT,freezeMethods:T5,toObjectSet:S5,toCamelCase:b5,noop:P5,toFiniteNumber:C5,findKey:uT,global:xu,isContextDefined:hT,isSpecCompliantForm:M5,toJSONObject:E5,isAsyncFn:I5,isThenable:A5,setImmediate:pT,asap:L5,isIterable:k5};function Ei(n,i,a,d,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",i&&(this.code=i),a&&(this.config=a),d&&(this.request=d),m&&(this.response=m,this.status=m.status?m.status:null)}Ye.inherits(Ei,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ye.toJSONObject(this.config),code:this.code,status:this.status}}});const fT=Ei.prototype,mT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{mT[n]={value:n}});Object.defineProperties(Ei,mT);Object.defineProperty(fT,"isAxiosError",{value:!0});Ei.from=(n,i,a,d,m,_)=>{const g=Object.create(fT);return Ye.toFlatObject(n,g,function(E){return E!==Error.prototype},l=>l!=="isAxiosError"),Ei.call(g,n.message,i,a,d,m),g.cause=n,g.name=n.name,_&&Object.assign(g,_),g};const z5=null;function cy(n){return Ye.isPlainObject(n)||Ye.isArray(n)}function gT(n){return Ye.endsWith(n,"[]")?n.slice(0,-2):n}function qb(n,i,a){return n?n.concat(i).map(function(m,_){return m=gT(m),!a&&_?"["+m+"]":m}).join(a?".":""):i}function R5(n){return Ye.isArray(n)&&!n.some(cy)}const D5=Ye.toFlatObject(Ye,{},null,function(i){return/^is[A-Z]/.test(i)});function Lm(n,i,a){if(!Ye.isObject(n))throw new TypeError("target must be an object");i=i||new FormData,a=Ye.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ce,Ce){return!Ye.isUndefined(Ce[ce])});const d=a.metaTokens,m=a.visitor||O,_=a.dots,g=a.indexes,E=(a.Blob||typeof Blob<"u"&&Blob)&&Ye.isSpecCompliantForm(i);if(!Ye.isFunction(m))throw new TypeError("visitor must be a function");function k(te){if(te===null)return"";if(Ye.isDate(te))return te.toISOString();if(Ye.isBoolean(te))return te.toString();if(!E&&Ye.isBlob(te))throw new Ei("Blob is not supported. Use a Buffer instead.");return Ye.isArrayBuffer(te)||Ye.isTypedArray(te)?E&&typeof Blob=="function"?new Blob([te]):Buffer.from(te):te}function O(te,ce,Ce){let ze=te;if(te&&!Ce&&typeof te=="object"){if(Ye.endsWith(ce,"{}"))ce=d?ce:ce.slice(0,-2),te=JSON.stringify(te);else if(Ye.isArray(te)&&R5(te)||(Ye.isFileList(te)||Ye.endsWith(ce,"[]"))&&(ze=Ye.toArray(te)))return ce=gT(ce),ze.forEach(function(Fe,xe){!(Ye.isUndefined(Fe)||Fe===null)&&i.append(g===!0?qb([ce],xe,_):g===null?ce:ce+"[]",k(Fe))}),!1}return cy(te)?!0:(i.append(qb(Ce,ce,_),k(te)),!1)}const $=[],X=Object.assign(D5,{defaultVisitor:O,convertValue:k,isVisitable:cy});function q(te,ce){if(!Ye.isUndefined(te)){if($.indexOf(te)!==-1)throw Error("Circular reference detected in "+ce.join("."));$.push(te),Ye.forEach(te,function(ze,Ue){(!(Ye.isUndefined(ze)||ze===null)&&m.call(i,ze,Ye.isString(Ue)?Ue.trim():Ue,ce,X))===!0&&q(ze,ce?ce.concat(Ue):[Ue])}),$.pop()}}if(!Ye.isObject(n))throw new TypeError("data must be an object");return q(n),i}function Gb(n){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(d){return i[d]})}function lv(n,i){this._pairs=[],n&&Lm(n,this,i)}const _T=lv.prototype;_T.append=function(i,a){this._pairs.push([i,a])};_T.toString=function(i){const a=i?function(d){return i.call(this,d,Gb)}:Gb;return this._pairs.map(function(m){return a(m[0])+"="+a(m[1])},"").join("&")};function O5(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function yT(n,i,a){if(!i)return n;const d=a&&a.encode||O5;Ye.isFunction(a)&&(a={serialize:a});const m=a&&a.serialize;let _;if(m?_=m(i,a):_=Ye.isURLSearchParams(i)?i.toString():new lv(i,a).toString(d),_){const g=n.indexOf("#");g!==-1&&(n=n.slice(0,g)),n+=(n.indexOf("?")===-1?"?":"&")+_}return n}class Hb{constructor(){this.handlers=[]}use(i,a,d){return this.handlers.push({fulfilled:i,rejected:a,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Ye.forEach(this.handlers,function(d){d!==null&&i(d)})}}const vT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},F5=typeof URLSearchParams<"u"?URLSearchParams:lv,B5=typeof FormData<"u"?FormData:null,N5=typeof Blob<"u"?Blob:null,j5={isBrowser:!0,classes:{URLSearchParams:F5,FormData:B5,Blob:N5},protocols:["http","https","file","blob","url","data"]},cv=typeof window<"u"&&typeof document<"u",uy=typeof navigator=="object"&&navigator||void 0,U5=cv&&(!uy||["ReactNative","NativeScript","NS"].indexOf(uy.product)<0),$5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",V5=cv&&window.location.href||"http://localhost",Z5=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:cv,hasStandardBrowserEnv:U5,hasStandardBrowserWebWorkerEnv:$5,navigator:uy,origin:V5},Symbol.toStringTag,{value:"Module"})),lo={...Z5,...j5};function q5(n,i){return Lm(n,new lo.classes.URLSearchParams,Object.assign({visitor:function(a,d,m,_){return lo.isNode&&Ye.isBuffer(a)?(this.append(d,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},i))}function G5(n){return Ye.matchAll(/\w+|\[(\w*)]/g,n).map(i=>i[0]==="[]"?"":i[1]||i[0])}function H5(n){const i={},a=Object.keys(n);let d;const m=a.length;let _;for(d=0;d<m;d++)_=a[d],i[_]=n[_];return i}function xT(n){function i(a,d,m,_){let g=a[_++];if(g==="__proto__")return!0;const l=Number.isFinite(+g),E=_>=a.length;return g=!g&&Ye.isArray(m)?m.length:g,E?(Ye.hasOwnProp(m,g)?m[g]=[m[g],d]:m[g]=d,!l):((!m[g]||!Ye.isObject(m[g]))&&(m[g]=[]),i(a,d,m[g],_)&&Ye.isArray(m[g])&&(m[g]=H5(m[g])),!l)}if(Ye.isFormData(n)&&Ye.isFunction(n.entries)){const a={};return Ye.forEachEntry(n,(d,m)=>{i(G5(d),m,a,0)}),a}return null}function W5(n,i,a){if(Ye.isString(n))try{return(i||JSON.parse)(n),Ye.trim(n)}catch(d){if(d.name!=="SyntaxError")throw d}return(a||JSON.stringify)(n)}const wp={transitional:vT,adapter:["xhr","http","fetch"],transformRequest:[function(i,a){const d=a.getContentType()||"",m=d.indexOf("application/json")>-1,_=Ye.isObject(i);if(_&&Ye.isHTMLForm(i)&&(i=new FormData(i)),Ye.isFormData(i))return m?JSON.stringify(xT(i)):i;if(Ye.isArrayBuffer(i)||Ye.isBuffer(i)||Ye.isStream(i)||Ye.isFile(i)||Ye.isBlob(i)||Ye.isReadableStream(i))return i;if(Ye.isArrayBufferView(i))return i.buffer;if(Ye.isURLSearchParams(i))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let l;if(_){if(d.indexOf("application/x-www-form-urlencoded")>-1)return q5(i,this.formSerializer).toString();if((l=Ye.isFileList(i))||d.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return Lm(l?{"files[]":i}:i,E&&new E,this.formSerializer)}}return _||m?(a.setContentType("application/json",!1),W5(i)):i}],transformResponse:[function(i){const a=this.transitional||wp.transitional,d=a&&a.forcedJSONParsing,m=this.responseType==="json";if(Ye.isResponse(i)||Ye.isReadableStream(i))return i;if(i&&Ye.isString(i)&&(d&&!this.responseType||m)){const g=!(a&&a.silentJSONParsing)&&m;try{return JSON.parse(i)}catch(l){if(g)throw l.name==="SyntaxError"?Ei.from(l,Ei.ERR_BAD_RESPONSE,this,null,this.response):l}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:lo.classes.FormData,Blob:lo.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ye.forEach(["delete","get","head","post","put","patch"],n=>{wp.headers[n]={}});const K5=Ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),X5=n=>{const i={};let a,d,m;return n&&n.split(`
`).forEach(function(g){m=g.indexOf(":"),a=g.substring(0,m).trim().toLowerCase(),d=g.substring(m+1).trim(),!(!a||i[a]&&K5[a])&&(a==="set-cookie"?i[a]?i[a].push(d):i[a]=[d]:i[a]=i[a]?i[a]+", "+d:d)}),i},Wb=Symbol("internals");function Id(n){return n&&String(n).trim().toLowerCase()}function Pf(n){return n===!1||n==null?n:Ye.isArray(n)?n.map(Pf):String(n)}function Y5(n){const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=a.exec(n);)i[d[1]]=d[2];return i}const J5=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function l_(n,i,a,d,m){if(Ye.isFunction(d))return d.call(this,i,a);if(m&&(i=a),!!Ye.isString(i)){if(Ye.isString(d))return i.indexOf(d)!==-1;if(Ye.isRegExp(d))return d.test(i)}}function Q5(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,a,d)=>a.toUpperCase()+d)}function ez(n,i){const a=Ye.toCamelCase(" "+i);["get","set","has"].forEach(d=>{Object.defineProperty(n,d+a,{value:function(m,_,g){return this[d].call(this,i,m,_,g)},configurable:!0})})}let Fo=class{constructor(i){i&&this.set(i)}set(i,a,d){const m=this;function _(l,E,k){const O=Id(E);if(!O)throw new Error("header name must be a non-empty string");const $=Ye.findKey(m,O);(!$||m[$]===void 0||k===!0||k===void 0&&m[$]!==!1)&&(m[$||E]=Pf(l))}const g=(l,E)=>Ye.forEach(l,(k,O)=>_(k,O,E));if(Ye.isPlainObject(i)||i instanceof this.constructor)g(i,a);else if(Ye.isString(i)&&(i=i.trim())&&!J5(i))g(X5(i),a);else if(Ye.isObject(i)&&Ye.isIterable(i)){let l={},E,k;for(const O of i){if(!Ye.isArray(O))throw TypeError("Object iterator must return a key-value pair");l[k=O[0]]=(E=l[k])?Ye.isArray(E)?[...E,O[1]]:[E,O[1]]:O[1]}g(l,a)}else i!=null&&_(a,i,d);return this}get(i,a){if(i=Id(i),i){const d=Ye.findKey(this,i);if(d){const m=this[d];if(!a)return m;if(a===!0)return Y5(m);if(Ye.isFunction(a))return a.call(this,m,d);if(Ye.isRegExp(a))return a.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,a){if(i=Id(i),i){const d=Ye.findKey(this,i);return!!(d&&this[d]!==void 0&&(!a||l_(this,this[d],d,a)))}return!1}delete(i,a){const d=this;let m=!1;function _(g){if(g=Id(g),g){const l=Ye.findKey(d,g);l&&(!a||l_(d,d[l],l,a))&&(delete d[l],m=!0)}}return Ye.isArray(i)?i.forEach(_):_(i),m}clear(i){const a=Object.keys(this);let d=a.length,m=!1;for(;d--;){const _=a[d];(!i||l_(this,this[_],_,i,!0))&&(delete this[_],m=!0)}return m}normalize(i){const a=this,d={};return Ye.forEach(this,(m,_)=>{const g=Ye.findKey(d,_);if(g){a[g]=Pf(m),delete a[_];return}const l=i?Q5(_):String(_).trim();l!==_&&delete a[_],a[l]=Pf(m),d[l]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const a=Object.create(null);return Ye.forEach(this,(d,m)=>{d!=null&&d!==!1&&(a[m]=i&&Ye.isArray(d)?d.join(", "):d)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,a])=>i+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...a){const d=new this(i);return a.forEach(m=>d.set(m)),d}static accessor(i){const d=(this[Wb]=this[Wb]={accessors:{}}).accessors,m=this.prototype;function _(g){const l=Id(g);d[l]||(ez(m,g),d[l]=!0)}return Ye.isArray(i)?i.forEach(_):_(i),this}};Fo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ye.reduceDescriptors(Fo.prototype,({value:n},i)=>{let a=i[0].toUpperCase()+i.slice(1);return{get:()=>n,set(d){this[a]=d}}});Ye.freezeMethods(Fo);function c_(n,i){const a=this||wp,d=i||a,m=Fo.from(d.headers);let _=d.data;return Ye.forEach(n,function(l){_=l.call(a,_,m.normalize(),i?i.status:void 0)}),m.normalize(),_}function bT(n){return!!(n&&n.__CANCEL__)}function Dh(n,i,a){Ei.call(this,n??"canceled",Ei.ERR_CANCELED,i,a),this.name="CanceledError"}Ye.inherits(Dh,Ei,{__CANCEL__:!0});function wT(n,i,a){const d=a.config.validateStatus;!a.status||!d||d(a.status)?n(a):i(new Ei("Request failed with status code "+a.status,[Ei.ERR_BAD_REQUEST,Ei.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function tz(n){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return i&&i[1]||""}function iz(n,i){n=n||10;const a=new Array(n),d=new Array(n);let m=0,_=0,g;return i=i!==void 0?i:1e3,function(E){const k=Date.now(),O=d[_];g||(g=k),a[m]=E,d[m]=k;let $=_,X=0;for(;$!==m;)X+=a[$++],$=$%n;if(m=(m+1)%n,m===_&&(_=(_+1)%n),k-g<i)return;const q=O&&k-O;return q?Math.round(X*1e3/q):void 0}}function nz(n,i){let a=0,d=1e3/i,m,_;const g=(k,O=Date.now())=>{a=O,m=null,_&&(clearTimeout(_),_=null),n.apply(null,k)};return[(...k)=>{const O=Date.now(),$=O-a;$>=d?g(k,O):(m=k,_||(_=setTimeout(()=>{_=null,g(m)},d-$)))},()=>m&&g(m)]}const Zf=(n,i,a=3)=>{let d=0;const m=iz(50,250);return nz(_=>{const g=_.loaded,l=_.lengthComputable?_.total:void 0,E=g-d,k=m(E),O=g<=l;d=g;const $={loaded:g,total:l,progress:l?g/l:void 0,bytes:E,rate:k||void 0,estimated:k&&l&&O?(l-g)/k:void 0,event:_,lengthComputable:l!=null,[i?"download":"upload"]:!0};n($)},a)},Kb=(n,i)=>{const a=n!=null;return[d=>i[0]({lengthComputable:a,total:n,loaded:d}),i[1]]},Xb=n=>(...i)=>Ye.asap(()=>n(...i)),rz=lo.hasStandardBrowserEnv?((n,i)=>a=>(a=new URL(a,lo.origin),n.protocol===a.protocol&&n.host===a.host&&(i||n.port===a.port)))(new URL(lo.origin),lo.navigator&&/(msie|trident)/i.test(lo.navigator.userAgent)):()=>!0,oz=lo.hasStandardBrowserEnv?{write(n,i,a,d,m,_){const g=[n+"="+encodeURIComponent(i)];Ye.isNumber(a)&&g.push("expires="+new Date(a).toGMTString()),Ye.isString(d)&&g.push("path="+d),Ye.isString(m)&&g.push("domain="+m),_===!0&&g.push("secure"),document.cookie=g.join("; ")},read(n){const i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sz(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function az(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}function TT(n,i,a){let d=!sz(i);return n&&(d||a==!1)?az(n,i):i}const Yb=n=>n instanceof Fo?{...n}:n;function ku(n,i){i=i||{};const a={};function d(k,O,$,X){return Ye.isPlainObject(k)&&Ye.isPlainObject(O)?Ye.merge.call({caseless:X},k,O):Ye.isPlainObject(O)?Ye.merge({},O):Ye.isArray(O)?O.slice():O}function m(k,O,$,X){if(Ye.isUndefined(O)){if(!Ye.isUndefined(k))return d(void 0,k,$,X)}else return d(k,O,$,X)}function _(k,O){if(!Ye.isUndefined(O))return d(void 0,O)}function g(k,O){if(Ye.isUndefined(O)){if(!Ye.isUndefined(k))return d(void 0,k)}else return d(void 0,O)}function l(k,O,$){if($ in i)return d(k,O);if($ in n)return d(void 0,k)}const E={url:_,method:_,data:_,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:l,headers:(k,O,$)=>m(Yb(k),Yb(O),$,!0)};return Ye.forEach(Object.keys(Object.assign({},n,i)),function(O){const $=E[O]||m,X=$(n[O],i[O],O);Ye.isUndefined(X)&&$!==l||(a[O]=X)}),a}const ST=n=>{const i=ku({},n);let{data:a,withXSRFToken:d,xsrfHeaderName:m,xsrfCookieName:_,headers:g,auth:l}=i;i.headers=g=Fo.from(g),i.url=yT(TT(i.baseURL,i.url,i.allowAbsoluteUrls),n.params,n.paramsSerializer),l&&g.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let E;if(Ye.isFormData(a)){if(lo.hasStandardBrowserEnv||lo.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if((E=g.getContentType())!==!1){const[k,...O]=E?E.split(";").map($=>$.trim()).filter(Boolean):[];g.setContentType([k||"multipart/form-data",...O].join("; "))}}if(lo.hasStandardBrowserEnv&&(d&&Ye.isFunction(d)&&(d=d(i)),d||d!==!1&&rz(i.url))){const k=m&&_&&oz.read(_);k&&g.set(m,k)}return i},lz=typeof XMLHttpRequest<"u",cz=lz&&function(n){return new Promise(function(a,d){const m=ST(n);let _=m.data;const g=Fo.from(m.headers).normalize();let{responseType:l,onUploadProgress:E,onDownloadProgress:k}=m,O,$,X,q,te;function ce(){q&&q(),te&&te(),m.cancelToken&&m.cancelToken.unsubscribe(O),m.signal&&m.signal.removeEventListener("abort",O)}let Ce=new XMLHttpRequest;Ce.open(m.method.toUpperCase(),m.url,!0),Ce.timeout=m.timeout;function ze(){if(!Ce)return;const Fe=Fo.from("getAllResponseHeaders"in Ce&&Ce.getAllResponseHeaders()),be={data:!l||l==="text"||l==="json"?Ce.responseText:Ce.response,status:Ce.status,statusText:Ce.statusText,headers:Fe,config:n,request:Ce};wT(function(Qe){a(Qe),ce()},function(Qe){d(Qe),ce()},be),Ce=null}"onloadend"in Ce?Ce.onloadend=ze:Ce.onreadystatechange=function(){!Ce||Ce.readyState!==4||Ce.status===0&&!(Ce.responseURL&&Ce.responseURL.indexOf("file:")===0)||setTimeout(ze)},Ce.onabort=function(){Ce&&(d(new Ei("Request aborted",Ei.ECONNABORTED,n,Ce)),Ce=null)},Ce.onerror=function(){d(new Ei("Network Error",Ei.ERR_NETWORK,n,Ce)),Ce=null},Ce.ontimeout=function(){let xe=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded";const be=m.transitional||vT;m.timeoutErrorMessage&&(xe=m.timeoutErrorMessage),d(new Ei(xe,be.clarifyTimeoutError?Ei.ETIMEDOUT:Ei.ECONNABORTED,n,Ce)),Ce=null},_===void 0&&g.setContentType(null),"setRequestHeader"in Ce&&Ye.forEach(g.toJSON(),function(xe,be){Ce.setRequestHeader(be,xe)}),Ye.isUndefined(m.withCredentials)||(Ce.withCredentials=!!m.withCredentials),l&&l!=="json"&&(Ce.responseType=m.responseType),k&&([X,te]=Zf(k,!0),Ce.addEventListener("progress",X)),E&&Ce.upload&&([$,q]=Zf(E),Ce.upload.addEventListener("progress",$),Ce.upload.addEventListener("loadend",q)),(m.cancelToken||m.signal)&&(O=Fe=>{Ce&&(d(!Fe||Fe.type?new Dh(null,n,Ce):Fe),Ce.abort(),Ce=null)},m.cancelToken&&m.cancelToken.subscribe(O),m.signal&&(m.signal.aborted?O():m.signal.addEventListener("abort",O)));const Ue=tz(m.url);if(Ue&&lo.protocols.indexOf(Ue)===-1){d(new Ei("Unsupported protocol "+Ue+":",Ei.ERR_BAD_REQUEST,n));return}Ce.send(_||null)})},uz=(n,i)=>{const{length:a}=n=n?n.filter(Boolean):[];if(i||a){let d=new AbortController,m;const _=function(k){if(!m){m=!0,l();const O=k instanceof Error?k:this.reason;d.abort(O instanceof Ei?O:new Dh(O instanceof Error?O.message:O))}};let g=i&&setTimeout(()=>{g=null,_(new Ei(`timeout ${i} of ms exceeded`,Ei.ETIMEDOUT))},i);const l=()=>{n&&(g&&clearTimeout(g),g=null,n.forEach(k=>{k.unsubscribe?k.unsubscribe(_):k.removeEventListener("abort",_)}),n=null)};n.forEach(k=>k.addEventListener("abort",_));const{signal:E}=d;return E.unsubscribe=()=>Ye.asap(l),E}},hz=function*(n,i){let a=n.byteLength;if(a<i){yield n;return}let d=0,m;for(;d<a;)m=d+i,yield n.slice(d,m),d=m},dz=async function*(n,i){for await(const a of pz(n))yield*hz(a,i)},pz=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const i=n.getReader();try{for(;;){const{done:a,value:d}=await i.read();if(a)break;yield d}}finally{await i.cancel()}},Jb=(n,i,a,d)=>{const m=dz(n,i);let _=0,g,l=E=>{g||(g=!0,d&&d(E))};return new ReadableStream({async pull(E){try{const{done:k,value:O}=await m.next();if(k){l(),E.close();return}let $=O.byteLength;if(a){let X=_+=$;a(X)}E.enqueue(new Uint8Array(O))}catch(k){throw l(k),k}},cancel(E){return l(E),m.return()}},{highWaterMark:2})},km=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",PT=km&&typeof ReadableStream=="function",fz=km&&(typeof TextEncoder=="function"?(n=>i=>n.encode(i))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),CT=(n,...i)=>{try{return!!n(...i)}catch{return!1}},mz=PT&&CT(()=>{let n=!1;const i=new Request(lo.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!i}),Qb=64*1024,hy=PT&&CT(()=>Ye.isReadableStream(new Response("").body)),qf={stream:hy&&(n=>n.body)};km&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!qf[i]&&(qf[i]=Ye.isFunction(n[i])?a=>a[i]():(a,d)=>{throw new Ei(`Response type '${i}' is not supported`,Ei.ERR_NOT_SUPPORT,d)})})})(new Response);const gz=async n=>{if(n==null)return 0;if(Ye.isBlob(n))return n.size;if(Ye.isSpecCompliantForm(n))return(await new Request(lo.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(Ye.isArrayBufferView(n)||Ye.isArrayBuffer(n))return n.byteLength;if(Ye.isURLSearchParams(n)&&(n=n+""),Ye.isString(n))return(await fz(n)).byteLength},_z=async(n,i)=>{const a=Ye.toFiniteNumber(n.getContentLength());return a??gz(i)},yz=km&&(async n=>{let{url:i,method:a,data:d,signal:m,cancelToken:_,timeout:g,onDownloadProgress:l,onUploadProgress:E,responseType:k,headers:O,withCredentials:$="same-origin",fetchOptions:X}=ST(n);k=k?(k+"").toLowerCase():"text";let q=uz([m,_&&_.toAbortSignal()],g),te;const ce=q&&q.unsubscribe&&(()=>{q.unsubscribe()});let Ce;try{if(E&&mz&&a!=="get"&&a!=="head"&&(Ce=await _z(O,d))!==0){let be=new Request(i,{method:"POST",body:d,duplex:"half"}),ke;if(Ye.isFormData(d)&&(ke=be.headers.get("content-type"))&&O.setContentType(ke),be.body){const[Qe,tt]=Kb(Ce,Zf(Xb(E)));d=Jb(be.body,Qb,Qe,tt)}}Ye.isString($)||($=$?"include":"omit");const ze="credentials"in Request.prototype;te=new Request(i,{...X,signal:q,method:a.toUpperCase(),headers:O.normalize().toJSON(),body:d,duplex:"half",credentials:ze?$:void 0});let Ue=await fetch(te,X);const Fe=hy&&(k==="stream"||k==="response");if(hy&&(l||Fe&&ce)){const be={};["status","statusText","headers"].forEach(et=>{be[et]=Ue[et]});const ke=Ye.toFiniteNumber(Ue.headers.get("content-length")),[Qe,tt]=l&&Kb(ke,Zf(Xb(l),!0))||[];Ue=new Response(Jb(Ue.body,Qb,Qe,()=>{tt&&tt(),ce&&ce()}),be)}k=k||"text";let xe=await qf[Ye.findKey(qf,k)||"text"](Ue,n);return!Fe&&ce&&ce(),await new Promise((be,ke)=>{wT(be,ke,{data:xe,headers:Fo.from(Ue.headers),status:Ue.status,statusText:Ue.statusText,config:n,request:te})})}catch(ze){throw ce&&ce(),ze&&ze.name==="TypeError"&&/Load failed|fetch/i.test(ze.message)?Object.assign(new Ei("Network Error",Ei.ERR_NETWORK,n,te),{cause:ze.cause||ze}):Ei.from(ze,ze&&ze.code,n,te)}}),dy={http:z5,xhr:cz,fetch:yz};Ye.forEach(dy,(n,i)=>{if(n){try{Object.defineProperty(n,"name",{value:i})}catch{}Object.defineProperty(n,"adapterName",{value:i})}});const e1=n=>`- ${n}`,vz=n=>Ye.isFunction(n)||n===null||n===!1,MT={getAdapter:n=>{n=Ye.isArray(n)?n:[n];const{length:i}=n;let a,d;const m={};for(let _=0;_<i;_++){a=n[_];let g;if(d=a,!vz(a)&&(d=dy[(g=String(a)).toLowerCase()],d===void 0))throw new Ei(`Unknown adapter '${g}'`);if(d)break;m[g||"#"+_]=d}if(!d){const _=Object.entries(m).map(([l,E])=>`adapter ${l} `+(E===!1?"is not supported by the environment":"is not available in the build"));let g=i?_.length>1?`since :
`+_.map(e1).join(`
`):" "+e1(_[0]):"as no adapter specified";throw new Ei("There is no suitable adapter to dispatch the request "+g,"ERR_NOT_SUPPORT")}return d},adapters:dy};function u_(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Dh(null,n)}function t1(n){return u_(n),n.headers=Fo.from(n.headers),n.data=c_.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),MT.getAdapter(n.adapter||wp.adapter)(n).then(function(d){return u_(n),d.data=c_.call(n,n.transformResponse,d),d.headers=Fo.from(d.headers),d},function(d){return bT(d)||(u_(n),d&&d.response&&(d.response.data=c_.call(n,n.transformResponse,d.response),d.response.headers=Fo.from(d.response.headers))),Promise.reject(d)})}const ET="1.10.0",zm={};["object","boolean","number","function","string","symbol"].forEach((n,i)=>{zm[n]=function(d){return typeof d===n||"a"+(i<1?"n ":" ")+n}});const i1={};zm.transitional=function(i,a,d){function m(_,g){return"[Axios v"+ET+"] Transitional option '"+_+"'"+g+(d?". "+d:"")}return(_,g,l)=>{if(i===!1)throw new Ei(m(g," has been removed"+(a?" in "+a:"")),Ei.ERR_DEPRECATED);return a&&!i1[g]&&(i1[g]=!0,console.warn(m(g," has been deprecated since v"+a+" and will be removed in the near future"))),i?i(_,g,l):!0}};zm.spelling=function(i){return(a,d)=>(console.warn(`${d} is likely a misspelling of ${i}`),!0)};function xz(n,i,a){if(typeof n!="object")throw new Ei("options must be an object",Ei.ERR_BAD_OPTION_VALUE);const d=Object.keys(n);let m=d.length;for(;m-- >0;){const _=d[m],g=i[_];if(g){const l=n[_],E=l===void 0||g(l,_,n);if(E!==!0)throw new Ei("option "+_+" must be "+E,Ei.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Ei("Unknown option "+_,Ei.ERR_BAD_OPTION)}}const Cf={assertOptions:xz,validators:zm},Fa=Cf.validators;let Iu=class{constructor(i){this.defaults=i||{},this.interceptors={request:new Hb,response:new Hb}}async request(i,a){try{return await this._request(i,a)}catch(d){if(d instanceof Error){let m={};Error.captureStackTrace?Error.captureStackTrace(m):m=new Error;const _=m.stack?m.stack.replace(/^.+\n/,""):"";try{d.stack?_&&!String(d.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+_):d.stack=_}catch{}}throw d}}_request(i,a){typeof i=="string"?(a=a||{},a.url=i):a=i||{},a=ku(this.defaults,a);const{transitional:d,paramsSerializer:m,headers:_}=a;d!==void 0&&Cf.assertOptions(d,{silentJSONParsing:Fa.transitional(Fa.boolean),forcedJSONParsing:Fa.transitional(Fa.boolean),clarifyTimeoutError:Fa.transitional(Fa.boolean)},!1),m!=null&&(Ye.isFunction(m)?a.paramsSerializer={serialize:m}:Cf.assertOptions(m,{encode:Fa.function,serialize:Fa.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),Cf.assertOptions(a,{baseUrl:Fa.spelling("baseURL"),withXsrfToken:Fa.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let g=_&&Ye.merge(_.common,_[a.method]);_&&Ye.forEach(["delete","get","head","post","put","patch","common"],te=>{delete _[te]}),a.headers=Fo.concat(g,_);const l=[];let E=!0;this.interceptors.request.forEach(function(ce){typeof ce.runWhen=="function"&&ce.runWhen(a)===!1||(E=E&&ce.synchronous,l.unshift(ce.fulfilled,ce.rejected))});const k=[];this.interceptors.response.forEach(function(ce){k.push(ce.fulfilled,ce.rejected)});let O,$=0,X;if(!E){const te=[t1.bind(this),void 0];for(te.unshift.apply(te,l),te.push.apply(te,k),X=te.length,O=Promise.resolve(a);$<X;)O=O.then(te[$++],te[$++]);return O}X=l.length;let q=a;for($=0;$<X;){const te=l[$++],ce=l[$++];try{q=te(q)}catch(Ce){ce.call(this,Ce);break}}try{O=t1.call(this,q)}catch(te){return Promise.reject(te)}for($=0,X=k.length;$<X;)O=O.then(k[$++],k[$++]);return O}getUri(i){i=ku(this.defaults,i);const a=TT(i.baseURL,i.url,i.allowAbsoluteUrls);return yT(a,i.params,i.paramsSerializer)}};Ye.forEach(["delete","get","head","options"],function(i){Iu.prototype[i]=function(a,d){return this.request(ku(d||{},{method:i,url:a,data:(d||{}).data}))}});Ye.forEach(["post","put","patch"],function(i){function a(d){return function(_,g,l){return this.request(ku(l||{},{method:i,headers:d?{"Content-Type":"multipart/form-data"}:{},url:_,data:g}))}}Iu.prototype[i]=a(),Iu.prototype[i+"Form"]=a(!0)});let bz=class IT{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const d=this;this.promise.then(m=>{if(!d._listeners)return;let _=d._listeners.length;for(;_-- >0;)d._listeners[_](m);d._listeners=null}),this.promise.then=m=>{let _;const g=new Promise(l=>{d.subscribe(l),_=l}).then(m);return g.cancel=function(){d.unsubscribe(_)},g},i(function(_,g,l){d.reason||(d.reason=new Dh(_,g,l),a(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const a=this._listeners.indexOf(i);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const i=new AbortController,a=d=>{i.abort(d)};return this.subscribe(a),i.signal.unsubscribe=()=>this.unsubscribe(a),i.signal}static source(){let i;return{token:new IT(function(m){i=m}),cancel:i}}};function wz(n){return function(a){return n.apply(null,a)}}function Tz(n){return Ye.isObject(n)&&n.isAxiosError===!0}const py={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(py).forEach(([n,i])=>{py[i]=n});function AT(n){const i=new Iu(n),a=sT(Iu.prototype.request,i);return Ye.extend(a,Iu.prototype,i,{allOwnKeys:!0}),Ye.extend(a,i,null,{allOwnKeys:!0}),a.create=function(m){return AT(ku(n,m))},a}const jn=AT(wp);jn.Axios=Iu;jn.CanceledError=Dh;jn.CancelToken=bz;jn.isCancel=bT;jn.VERSION=ET;jn.toFormData=Lm;jn.AxiosError=Ei;jn.Cancel=jn.CanceledError;jn.all=function(i){return Promise.all(i)};jn.spread=wz;jn.isAxiosError=Tz;jn.mergeConfig=ku;jn.AxiosHeaders=Fo;jn.formToJSON=n=>xT(Ye.isHTMLForm(n)?new FormData(n):n);jn.getAdapter=MT.getAdapter;jn.HttpStatusCode=py;jn.default=jn;const{Axios:LD,AxiosError:kD,CanceledError:zD,isCancel:RD,CancelToken:DD,VERSION:OD,all:FD,Cancel:BD,isAxiosError:ND,spread:jD,toFormData:UD,AxiosHeaders:$D,HttpStatusCode:VD,formToJSON:ZD,getAdapter:qD,mergeConfig:GD}=jn,Rm=sE("transport",()=>{const n=Wi(null),i=Wi(null),a=Wi(""),d=Wi(""),m=Wi("08:00"),_=Wi([]),g=Wi(-1),l=Wi(!1),E=Wi(null),k=Wi(null),O=Wi({origin:null,destination:null}),$=Wi([]);function X(ke){E.value=ke}function q(){E.value=null}function te(ke){l.value=ke}function ce(){$.value.forEach(ke=>{k.value&&k.value.removeLayer(ke)}),$.value=[]}function Ce(ke){let Qe=0,tt=ke.length,et=0,ht=0,At=[];for(;Qe<tt;){let lt,Et=0,jt=0;do lt=ke.charCodeAt(Qe++)-63,jt|=(lt&31)<<Et,Et+=5;while(lt>=32);let Ni=jt&1?~(jt>>1):jt>>1;et+=Ni,Et=0,jt=0;do lt=ke.charCodeAt(Qe++)-63,jt|=(lt&31)<<Et,Et+=5;while(lt>=32);let ni=jt&1?~(jt>>1):jt>>1;ht+=ni,At.push([et*1e-5,ht*1e-5])}return At}function ze(ke){if(ce(),ke===-1)return;const Qe=_.value[ke];Qe&&Qe.legs.forEach(tt=>{if(!tt.legGeometry?.points)return;const et=Ce(tt.legGeometry.points),ht=tt.mode==="WALK"?"#888":tt.route?.color?`#${tt.route.color}`:"#2563eb";if(k.value){const At=Fi.polyline(et,{color:ht,weight:5,opacity:.7}).addTo(k.value);$.value.push(At)}})}function Ue(ke,Qe){n.value=ke,a.value=Qe}function Fe(ke,Qe){i.value=ke,d.value=Qe}async function xe(){if(!n.value||!i.value||!m.value){X("Harap masukkan asal, tujuan, dan waktu keberangkatan.");return}q(),te(!0),_.value=[],g.value=0,ce();const ke=new Date().toISOString().slice(0,10),Qe=`
      query Plan(
        $fromPlace: String!
        $toPlace: String!
        $date: String!
        $time: String!
        $arriveBy: Boolean!
        $transportModes: [TransportMode!]
        $numItineraries: Int
      ) {
        plan(
          fromPlace: $fromPlace
          toPlace: $toPlace
          date: $date
          time: $time
          arriveBy: $arriveBy
          transportModes: $transportModes
          numItineraries: $numItineraries
        ) {
          itineraries {
            duration
            legs {
              mode
              startTime
              endTime
              duration
              from {
                name
              }
              to {
                name
              }
              route {
                shortName
                longName
                color
              }
              agency {
                name
              }
              legGeometry {
                length
                points
              }
            }
          }
        }
      }
    `,tt={fromPlace:`${n.value[0]},${n.value[1]}`,toPlace:`${i.value[0]},${i.value[1]}`,date:ke,time:m.value,arriveBy:!1,transportModes:[{mode:"RAIL"},{mode:"BUS"},{mode:"WALK"}],numItineraries:5};try{const ht=(await jn.post("https://api.transportforbandung.org/linraya",{query:Qe,variables:tt},{headers:{"Content-Type":"application/json"}})).data;if(ht.errors){console.error("GraphQL errors:",ht.errors),X("Terjadi kesalahan. Silakan coba lokasi atau waktu yang berbeda.");return}const lt=(ht.data?.plan?.itineraries||[]).filter(Et=>Et.legs.every(jt=>jt.mode!=="WALK"||(jt.distance||jt.duration*1.4)<=5e3));_.value=lt.slice(0,5),g.value=-1,_.value.length===0?X("Tidak ditemukan rute transportasi umum. Silakan ubah titik asal atau tujuan atau gunakan waktu keberangkatan yang berbeda."):setTimeout(()=>{g.value=0,ze(0)},50)}catch(et){console.error("Fetch error:",et),X("Gagal mengambil data. Silakan periksa koneksi Anda dan coba lagi.")}finally{te(!1)}}const be=Ir(()=>_.value.length>0);return{origin:n,destination:i,originText:a,destinationText:d,departureTime:m,routes:_,selectedRouteIndex:g,isLoading:l,error:E,map:k,markers:O,routePolylines:$,setOrigin:Ue,setDestination:Fe,fetchRoutes:xe,drawRoute:ze,clearPolylines:ce,showError:X,clearError:q,setLoading:te,hasRoutes:be}}),Sz={class:"leaflet-popup-content-wrapper"},Pz={class:"leaflet-popup-content"},Cz={__name:"MapMenu",props:{clickPosition:{type:Object,required:!0}},emits:["close","set-origin","set-destination"],setup(n){const i=n,a=Rm(),d=Wi(null),m=()=>{if(!d.value||!i.clickPosition||!a.map)return;const _=a.map.latLngToContainerPoint(i.clickPosition.latlng);d.value.style.transform=`translate(${_.x}px, ${_.y}px)`};return Jd(()=>{a.map&&(a.map.on("move",m),a.map.on("moveend",m),m())}),im(()=>{a.map&&(a.map.off("move",m),a.map.off("moveend",m))}),Va(()=>i.clickPosition,m),(_,g)=>n.clickPosition?(Rn(),Er("div",{key:0,ref_key:"menuElement",ref:d,class:"map-menu leaflet-popup"},[Ut("div",{class:"close-button",onClick:g[0]||(g[0]=l=>_.$emit("close")),"aria-label":"Close popup"},"×"),Ut("div",Sz,[Ut("div",Pz,[Ut("button",{onClick:g[1]||(g[1]=l=>_.$emit("set-origin",n.clickPosition.latlng)),style:{"background-color":"#3b82f6"}},g[3]||(g[3]=[Ut("span",{class:"icon"},[Ut("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Ut("circle",{cx:"12",cy:"10",r:"3"}),Ut("path",{d:"M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z"})])],-1),O_(" Pilih sebagai asal ")])),Ut("button",{onClick:g[2]||(g[2]=l=>_.$emit("set-destination",n.clickPosition.latlng)),style:{"background-color":"#10b981"}},g[4]||(g[4]=[Ut("span",{class:"icon"},[Ut("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Ut("circle",{cx:"12",cy:"10",r:"3"}),Ut("path",{d:"M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z"})])],-1),O_(" Pilih sebagai tujuan ")]))])])],512)):om("",!0)}},Mz=Wa(Cz,[["__scopeId","data-v-379ff5a1"]]),Ez={class:"map-container"},Iz={__name:"MapView",setup(n){const i=Rm(),a=Wi(null),d=Wi(null),m=Wi(null),_=Wi(!1),g=Wi(null),l=Wi(null),E=Wi(null),k=Wi(null),O=Wi(null);Jd(()=>{if(!a.value)return;d.value=Fi.map(a.value).setView([-6.921469933354896,107.60979493527732],13),Hk({apiKey:"cajvPScYRyeaWL7RvReS",style:"https://api.maptiler.com/maps/7cd7cac8-4971-44d1-952b-c04bc40da410/style.json"}).addTo(d.value),delete Fi.Icon.Default.prototype._getIconUrl,Fi.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png"}),Fi.control.fullscreen({position:"topleft",title:"Toggle Fullscreen",forceSeparateButton:!0}).addTo(d.value),q(),d.value.on("contextmenu",xe=>{xe.originalEvent.preventDefault(),m.value={latlng:xe.latlng,containerPoint:d.value.latLngToContainerPoint(xe.latlng)}}),i.map=d.value}),im(()=>{X()});const $=()=>{if(_.value)return;if(!navigator.geolocation){alert("Geolocation is not supported by your browser.");return}const Fe=Fi.icon({iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41]});l.value=Fi.marker([0,0],{icon:Fe,title:"Your Location"}).addTo(d.value);let xe=!1;g.value=navigator.geolocation.watchPosition(be=>{const{latitude:ke,longitude:Qe}=be.coords;l.value.setLatLng([ke,Qe]),xe||(d.value.setView([ke,Qe],16),xe=!0)},be=>{console.error("Error getting location:",be.message),X()},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}),_.value=!0,E.value.getContainer().classList.add("active"),E.value.getContainer().title="Nonaktifkan Pelacakan GPS"},X=()=>{g.value!==null&&(navigator.geolocation.clearWatch(g.value),g.value=null),l.value&&(d.value.removeLayer(l.value),l.value=null),_.value=!1,E.value&&(E.value.getContainer().classList.remove("active"),E.value.getContainer().title="Aktifkan Pelacakan GPS")},q=()=>{const Fe=Fi.Control.extend({onAdd:function(){const xe=Fi.DomUtil.create("button","leaflet-bar leaflet-control leaflet-control-gps");return xe.innerHTML='<i class="bi bi-geo-alt"></i>',xe.title="Aktifkan Pelacakan GPS",xe.style.cssText=`
        width: 34px;
        height: 34px;
        background-color: white;
        border: 2px solid rgba(0,0,0,0.2);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      `,Fi.DomEvent.on(xe,"click",be=>{Fi.DomEvent.stopPropagation(be),_.value?X():$()}),xe}});E.value=new Fe({position:"topleft"}).addTo(d.value)};Jd(()=>{const Fe=new URLSearchParams(window.location.search),xe=Fe.get("r"),be=Fe.get("d");if(xe){const[ke,Qe]=xe.split(",").map(Number);Ce({lat:ke,lng:Qe})}if(be){const[ke,Qe]=be.split(",").map(Number);ze({lat:ke,lng:Qe})}});const te=Fi.icon({iconUrl:"/icons/origin-marker.svg",iconSize:[32,32],iconAnchor:[16,32]}),ce=Fi.icon({iconUrl:"/icons/destination-marker.svg",iconSize:[32,32],iconAnchor:[16,32]}),Ce=Fe=>{i.setOrigin([Fe.lat,Fe.lng],`${Fe.lat.toFixed(5)}, ${Fe.lng.toFixed(5)}`),m.value=null,k.value?k.value.setLatLng(Fe):k.value=Fi.marker(Fe,{icon:te}).addTo(d.value)},ze=Fe=>{i.setDestination([Fe.lat,Fe.lng],`${Fe.lat.toFixed(5)}, ${Fe.lng.toFixed(5)}`),m.value=null,O.value?O.value.setLatLng(Fe):O.value=Fi.marker(Fe,{icon:ce}).addTo(d.value)},Ue=()=>{m.value=null};return Va(()=>i.origin,Fe=>{Fe&&(k.value?k.value.setLatLng(Fe):k.value=Fi.marker(Fe,{icon:te}).addTo(d.value))}),Va(()=>i.destination,Fe=>{Fe&&(O.value?O.value.setLatLng(Fe):O.value=Fi.marker(Fe,{icon:ce}).addTo(d.value))}),(Fe,xe)=>(Rn(),Er("div",Ez,[Ut("div",{id:"map",ref_key:"mapElement",ref:a},null,512),m.value?(Rn(),pp(Mz,{key:0,clickPosition:m.value,onClose:Ue,onSetOrigin:Ce,onSetDestination:ze},null,8,["clickPosition"])):om("",!0)]))}},Az=Wa(Iz,[["__scopeId","data-v-81ddfe0e"]]);var h_,n1;function LT(){if(n1)return h_;n1=1;function n(i){var a=typeof i;return i!=null&&(a=="object"||a=="function")}return h_=n,h_}var d_,r1;function Lz(){if(r1)return d_;r1=1;var n=typeof of=="object"&&of&&of.Object===Object&&of;return d_=n,d_}var p_,o1;function kT(){if(o1)return p_;o1=1;var n=Lz(),i=typeof self=="object"&&self&&self.Object===Object&&self,a=n||i||Function("return this")();return p_=a,p_}var f_,s1;function kz(){if(s1)return f_;s1=1;var n=kT(),i=function(){return n.Date.now()};return f_=i,f_}var m_,a1;function zz(){if(a1)return m_;a1=1;var n=/\s/;function i(a){for(var d=a.length;d--&&n.test(a.charAt(d)););return d}return m_=i,m_}var g_,l1;function Rz(){if(l1)return g_;l1=1;var n=zz(),i=/^\s+/;function a(d){return d&&d.slice(0,n(d)+1).replace(i,"")}return g_=a,g_}var __,c1;function zT(){if(c1)return __;c1=1;var n=kT(),i=n.Symbol;return __=i,__}var y_,u1;function Dz(){if(u1)return y_;u1=1;var n=zT(),i=Object.prototype,a=i.hasOwnProperty,d=i.toString,m=n?n.toStringTag:void 0;function _(g){var l=a.call(g,m),E=g[m];try{g[m]=void 0;var k=!0}catch{}var O=d.call(g);return k&&(l?g[m]=E:delete g[m]),O}return y_=_,y_}var v_,h1;function Oz(){if(h1)return v_;h1=1;var n=Object.prototype,i=n.toString;function a(d){return i.call(d)}return v_=a,v_}var x_,d1;function Fz(){if(d1)return x_;d1=1;var n=zT(),i=Dz(),a=Oz(),d="[object Null]",m="[object Undefined]",_=n?n.toStringTag:void 0;function g(l){return l==null?l===void 0?m:d:_&&_ in Object(l)?i(l):a(l)}return x_=g,x_}var b_,p1;function Bz(){if(p1)return b_;p1=1;function n(i){return i!=null&&typeof i=="object"}return b_=n,b_}var w_,f1;function Nz(){if(f1)return w_;f1=1;var n=Fz(),i=Bz(),a="[object Symbol]";function d(m){return typeof m=="symbol"||i(m)&&n(m)==a}return w_=d,w_}var T_,m1;function jz(){if(m1)return T_;m1=1;var n=Rz(),i=LT(),a=Nz(),d=NaN,m=/^[-+]0x[0-9a-f]+$/i,_=/^0b[01]+$/i,g=/^0o[0-7]+$/i,l=parseInt;function E(k){if(typeof k=="number")return k;if(a(k))return d;if(i(k)){var O=typeof k.valueOf=="function"?k.valueOf():k;k=i(O)?O+"":O}if(typeof k!="string")return k===0?k:+k;k=n(k);var $=_.test(k);return $||g.test(k)?l(k.slice(2),$?2:8):m.test(k)?d:+k}return T_=E,T_}var S_,g1;function Uz(){if(g1)return S_;g1=1;var n=LT(),i=kz(),a=jz(),d="Expected a function",m=Math.max,_=Math.min;function g(l,E,k){var O,$,X,q,te,ce,Ce=0,ze=!1,Ue=!1,Fe=!0;if(typeof l!="function")throw new TypeError(d);E=a(E)||0,n(k)&&(ze=!!k.leading,Ue="maxWait"in k,X=Ue?m(a(k.maxWait)||0,E):X,Fe="trailing"in k?!!k.trailing:Fe);function xe(Et){var jt=O,Ni=$;return O=$=void 0,Ce=Et,q=l.apply(Ni,jt),q}function be(Et){return Ce=Et,te=setTimeout(tt,E),ze?xe(Et):q}function ke(Et){var jt=Et-ce,Ni=Et-Ce,ni=E-jt;return Ue?_(ni,X-Ni):ni}function Qe(Et){var jt=Et-ce,Ni=Et-Ce;return ce===void 0||jt>=E||jt<0||Ue&&Ni>=X}function tt(){var Et=i();if(Qe(Et))return et(Et);te=setTimeout(tt,ke(Et))}function et(Et){return te=void 0,Fe&&O?xe(Et):(O=$=void 0,q)}function ht(){te!==void 0&&clearTimeout(te),Ce=0,O=ce=$=te=void 0}function At(){return te===void 0?q:et(i())}function lt(){var Et=i(),jt=Qe(Et);if(O=arguments,$=this,ce=Et,jt){if(te===void 0)return be(ce);if(Ue)return clearTimeout(te),te=setTimeout(tt,E),xe(ce)}return te===void 0&&(te=setTimeout(tt,E)),q}return lt.cancel=ht,lt.flush=At,lt}return S_=g,S_}var $z=Uz();const _1=lm($z),Vz={class:"search-container"},Zz=["id","value","placeholder"],qz=["onMousedown"],Gz={__name:"SearchInput",props:{id:{type:String,required:!0},modelValue:{type:String,required:!0},placeholder:{type:String,default:""},suggestions:{type:Array,default:()=>[]}},emits:["update:modelValue","select-suggestion"],setup(n,{emit:i}){const a=i,d=Wi(!1),m=g=>{a("update:modelValue",g.display_name),a("select-suggestion",g),d.value=!1},_=()=>{setTimeout(()=>{d.value=!1},200)};return(g,l)=>(Rn(),Er("div",Vz,[Ut("input",{id:n.id,type:"text",value:n.modelValue,onInput:l[0]||(l[0]=E=>g.$emit("update:modelValue",E.target.value)),onFocus:l[1]||(l[1]=E=>d.value=!0),onBlur:_,placeholder:n.placeholder,class:"search-input"},null,40,Zz),Ut("div",{class:Al(["suggestions-list",{visible:d.value&&n.suggestions.length>0}])},[(Rn(!0),Er(ns,null,My(n.suggestions,(E,k)=>(Rn(),Er("div",{key:k,class:"suggestion-item",onMousedown:WM(O=>m(E),["prevent"])},[Ut("p",null,Kr(E.display_name),1)],40,qz))),128))],2)]))}},y1=Wa(Gz,[["__scopeId","data-v-5d36dd2b"]]),Hz={class:"error-message"},Wz={__name:"ErrorMessage",props:{message:String},setup(n){return(i,a)=>(Rn(),Er("div",Hz,Kr(n.message),1))}},Kz=Wa(Wz,[["__scopeId","data-v-9e35aa6a"]]),Xz={class:"search-form"},Yz={class:"form-group"},Jz={class:"form-group"},Qz={class:"form-group"},eR=["disabled"],tR={__name:"SearchForm",setup(n){const i=Rm(),a=Wi(""),d=Wi(""),m=Wi("08:00"),_=Wi([]),g=Wi([]),l=Wi(!1),E=Wi(!1),k=Ir(()=>i.isLoading),O=Ir(()=>i.error),$=_1(async Ce=>{if(!Ce.trim()){_.value=[],l.value=!0;return}try{const ze=await jn.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(Ce)}&format=json&addressdetails=1&limit=5&viewbox=107.213795,-6.519308,107.95582,-7.24864&bounded=1`);_.value=ze.data}catch(ze){console.error("Search error:",ze),_.value=[]}finally{l.value=!1}},400),X=_1(async Ce=>{if(!Ce.trim()){g.value=[],E.value=!0;return}try{const ze=await jn.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(Ce)}&format=json&addressdetails=1&limit=5&viewbox=107.213795,-6.519308,107.95582,-7.24864&bounded=1`);g.value=ze.data}catch(ze){console.error("Search error:",ze),g.value=[]}finally{E.value=!1}},400),q=Ce=>{const ze=[parseFloat(Ce.lat),parseFloat(Ce.lon)];a.value=Ce.display_name,i.setOrigin(ze,Ce.display_name),i.map&&i.map.setView(ze,15)},te=Ce=>{const ze=[parseFloat(Ce.lat),parseFloat(Ce.lon)];d.value=Ce.display_name,i.setDestination(ze,Ce.display_name),i.map&&i.map.setView(ze,15)},ce=()=>{i.departureTime=m.value,i.fetchRoutes()};return Va(()=>i.originText,Ce=>{Ce!==a.value&&(a.value=Ce)}),Va(()=>i.destinationText,Ce=>{Ce!==d.value&&(d.value=Ce)}),Va(()=>i.departureTime,Ce=>{Ce!==m.value&&(m.value=Ce)}),(Ce,ze)=>(Rn(),Er("div",Xz,[Ut("div",Yz,[ze[3]||(ze[3]=Ut("label",{for:"origin"},"Asal",-1)),Yn(y1,{id:"origin",modelValue:a.value,"onUpdate:modelValue":[ze[0]||(ze[0]=Ue=>a.value=Ue),A_($)],placeholder:"Cari lokasi asal",suggestions:_.value,onSelectSuggestion:q},null,8,["modelValue","suggestions","onUpdate:modelValue"])]),Ut("div",Jz,[ze[4]||(ze[4]=Ut("label",{for:"destination"},"Tujuan",-1)),Yn(y1,{id:"destination",modelValue:d.value,"onUpdate:modelValue":[ze[1]||(ze[1]=Ue=>d.value=Ue),A_(X)],placeholder:"Cari lokasi tujuan",suggestions:g.value,onSelectSuggestion:te},null,8,["modelValue","suggestions","onUpdate:modelValue"])]),Ut("div",Qz,[ze[5]||(ze[5]=Ut("label",{for:"departure-time"},"Waktu keberangkatan",-1)),dC(Ut("input",{type:"time",id:"departure-time","onUpdate:modelValue":ze[2]||(ze[2]=Ue=>m.value=Ue)},null,512),[[qM,m.value]])]),Ut("button",{id:"search-button",disabled:k.value,onClick:ce},Kr(k.value?"Mencari Rute...":"Cari Rute"),9,eR),O.value?(Rn(),pp(Kz,{key:0,message:O.value},null,8,["message"])):om("",!0)]))}},iR=Wa(tR,[["__scopeId","data-v-7c70483e"]]),nR={class:"leg-item"},rR={class:"leg-content"},oR={class:"leg-route"},sR={class:"leg-time"},aR={__name:"LegItem",props:{leg:{type:Object,required:!0},isFirst:{type:Boolean,default:!1},isLast:{type:Boolean,default:!1}},setup(n){const i=n,a=Ir(()=>{if(i.leg.mode==="WALK")return`background-color: #888; color: ${E("#888")};`;if(i.leg.route){const k=i.leg.route.color?`#${i.leg.route.color}`:"#3b82f6";return`background-color: ${k}; color: ${E(k)};`}return""}),d=Ir(()=>i.leg.mode==="WALK"?"Berjalan kaki":i.leg.route?`${i.leg.agency?.name||""} ${i.leg.route.shortName||""}`.trim():""),m=Ir(()=>l(i.leg.startTime)),_=Ir(()=>l(i.leg.endTime)),g=Ir(()=>Math.round(i.leg.duration/60));function l(k){const O=new Date(k),$=O.getHours().toString().padStart(2,"0"),X=O.getMinutes().toString().padStart(2,"0");return`${$}:${X}`}function E(k){if(!k)return"black";k=k.replace("#","");const O=parseInt(k.substr(0,2),16),$=parseInt(k.substr(2,2),16),X=parseInt(k.substr(4,2),16);return(O*299+$*587+X*114)/1e3>=128?"black":"white"}return(k,O)=>(Rn(),Er("div",nR,[Ut("div",{class:Al(["leg-icon",{walk:n.leg.mode==="WALK"}])},Kr(n.leg.mode==="WALK"?"🚶":"🚌"),3),Ut("div",rR,[Ut("div",{class:"leg-badge",style:Xf(a.value)},Kr(d.value),5),Ut("div",oR,Kr(n.isFirst?"Asal":n.leg.from.name)+" → "+Kr(n.isLast?"Tujuan":n.leg.to.name),1),Ut("div",sR,Kr(m.value)+" - "+Kr(_.value)+" ("+Kr(g.value)+" menit) ",1)])]))}},lR=Wa(aR,[["__scopeId","data-v-bf8e6812"]]),cR={class:"route-info"},uR={class:"route-duration"},hR={class:"route-stats"},dR={class:"route-stats"},pR={key:0,class:"route-details"},fR={class:"time-summary"},mR={class:"time-row"},gR={class:"time-value"},_R={class:"time-value"},yR={class:"legs-container"},vR={__name:"RouteItem",props:{route:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},emits:["click"],setup(n,{emit:i}){const a=n,d=i,m=Ir(()=>`${Math.round(a.route.duration/60)} menit`),_=Ir(()=>a.route.legs.filter($=>$.mode!=="WALK").length),g=Ir(()=>a.route.legs.filter($=>$.mode==="WALK").length),l=Ir(()=>k(a.route.legs[0].startTime)),E=Ir(()=>k(a.route.legs[a.route.legs.length-1].endTime));function k($){return new Date($).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function O($){$.target===$.currentTarget&&d("click")}return($,X)=>(Rn(),Er("div",{class:"route-item",onClick:O},[Ut("div",{class:Al(["route-summary",{active:n.isActive}])},[Ut("div",cR,[Ut("div",uR,Kr(m.value),1),Ut("div",hR,Kr(_.value)+" rute transportasi umum",1),Ut("div",dR,Kr(g.value)+" kali berjalan kaki",1)]),Ut("div",{class:Al(["route-toggle",{active:n.isActive}])},Kr(n.isActive?"▲":"▼"),3)],2),Yn(SM,{name:"expand"},{default:J1(()=>[n.isActive?(Rn(),Er("div",pR,[Ut("div",fR,[X[0]||(X[0]=Ut("div",{class:"time-row"},[Ut("span",{class:"time-label"},"Berangkat"),Ut("span",{class:"time-label"},"Tiba")],-1)),Ut("div",mR,[Ut("span",gR,Kr(l.value),1),Ut("span",_R,Kr(E.value),1)])]),Ut("div",yR,[(Rn(!0),Er(ns,null,My(n.route.legs,(q,te)=>(Rn(),pp(lR,{key:te,leg:q,"is-first":te===0,"is-last":te===n.route.legs.length-1},null,8,["leg","is-first","is-last"]))),128))])])):om("",!0)]),_:1})]))}},xR=Wa(vR,[["__scopeId","data-v-f804cdf1"]]),bR={class:"routes-container"},wR={key:0,class:"loading-message"},TR={key:1,class:"placeholder-message"},SR={key:2,class:"routes-list"},PR={__name:"RouteList",setup(n){const i=Rm(),a=Ir(()=>i.isLoading),d=Ir(()=>i.routes.length>0),m=Ir(()=>i.routes),_=Ir(()=>i.selectedRouteIndex),g=l=>{const E=l===i.selectedRouteIndex;i.selectedRouteIndex=E?-1:l,i.drawRoute(E?-1:l)};return(l,E)=>(Rn(),Er("div",bR,[a.value&&!d.value?(Rn(),Er("div",wR,E[0]||(E[0]=[Ut("p",null,"Mencari rute terbaik...",-1),Ut("p",null,"Proses ini membutuhkan waktu 2-10 detik",-1)]))):d.value?(Rn(),Er("div",SR,[(Rn(!0),Er(ns,null,My(m.value,(k,O)=>(Rn(),pp(xR,{key:O,route:k,"is-active":O===_.value,onClick:$=>g(O)},null,8,["route","is-active","onClick"]))),128))])):(Rn(),Er("div",TR,' Pilih lokasi asal dan tujuan. Cari tempat di baris pencarian atau klik kanan di peta, lalu klik "Cari Rute" untuk melihat opsi transportasi umum yang tersedia. '))]))}},CR=Wa(PR,[["__scopeId","data-v-e35e0950"]]),MR={class:"sidebar"},ER={class:"routes-list"},IR={__name:"Sidebar",setup(n){return(i,a)=>(Rn(),Er("div",MR,[Yn(iR),a[0]||(a[0]=Ut("h2",null,"Pilihan Rute",-1)),Ut("div",ER,[Yn(CR)])]))}},AR=Wa(IR,[["__scopeId","data-v-c93f75a9"]]),LR={class:"app-container"},kR={class:"main-content"},zR={__name:"App",setup(n){return(i,a)=>(Rn(),Er("div",LR,[Yn(uE),Ut("div",kR,[Yn(AR),Yn(Az)])]))}},RT=YM(zR),RR=eE();RT.use(RR);RT.mount("#app");
